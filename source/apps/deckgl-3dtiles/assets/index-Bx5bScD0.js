var Ck=Object.defineProperty;var Ik=(t,e,i)=>e in t?Ck(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var k=(t,e,i)=>Ik(t,typeof e!="symbol"?e+"":e,i);function Rk(t,e){for(var i=0;i<e.length;i++){const n=e[i];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in t)){const a=Object.getOwnPropertyDescriptor(n,r);a&&Object.defineProperty(t,r,a.get?a:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();var Pk=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vb(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var nR={exports:{}},By={},rR={exports:{}},Yt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vp=Symbol.for("react.element"),Mk=Symbol.for("react.portal"),Bk=Symbol.for("react.fragment"),Dk=Symbol.for("react.strict_mode"),Ok=Symbol.for("react.profiler"),kk=Symbol.for("react.provider"),Fk=Symbol.for("react.context"),Nk=Symbol.for("react.forward_ref"),Lk=Symbol.for("react.suspense"),Uk=Symbol.for("react.memo"),zk=Symbol.for("react.lazy"),AE=Symbol.iterator;function Vk(t){return t===null||typeof t!="object"?null:(t=AE&&t[AE]||t["@@iterator"],typeof t=="function"?t:null)}var sR={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},oR=Object.assign,aR={};function hd(t,e,i){this.props=t,this.context=e,this.refs=aR,this.updater=i||sR}hd.prototype.isReactComponent={};hd.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};hd.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function lR(){}lR.prototype=hd.prototype;function jb(t,e,i){this.props=t,this.context=e,this.refs=aR,this.updater=i||sR}var Hb=jb.prototype=new lR;Hb.constructor=jb;oR(Hb,hd.prototype);Hb.isPureReactComponent=!0;var TE=Array.isArray,cR=Object.prototype.hasOwnProperty,$b={current:null},uR={key:!0,ref:!0,__self:!0,__source:!0};function hR(t,e,i){var n,r={},a=null,u=null;if(e!=null)for(n in e.ref!==void 0&&(u=e.ref),e.key!==void 0&&(a=""+e.key),e)cR.call(e,n)&&!uR.hasOwnProperty(n)&&(r[n]=e[n]);var l=arguments.length-2;if(l===1)r.children=i;else if(1<l){for(var _=Array(l),w=0;w<l;w++)_[w]=arguments[w+2];r.children=_}if(t&&t.defaultProps)for(n in l=t.defaultProps,l)r[n]===void 0&&(r[n]=l[n]);return{$$typeof:Vp,type:t,key:a,ref:u,props:r,_owner:$b.current}}function jk(t,e){return{$$typeof:Vp,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Gb(t){return typeof t=="object"&&t!==null&&t.$$typeof===Vp}function Hk(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(i){return e[i]})}var EE=/\/+/g;function vv(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Hk(""+t.key):e.toString(36)}function Jg(t,e,i,n,r){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var u=!1;if(t===null)u=!0;else switch(a){case"string":case"number":u=!0;break;case"object":switch(t.$$typeof){case Vp:case Mk:u=!0}}if(u)return u=t,r=r(u),t=n===""?"."+vv(u,0):n,TE(r)?(i="",t!=null&&(i=t.replace(EE,"$&/")+"/"),Jg(r,e,i,"",function(w){return w})):r!=null&&(Gb(r)&&(r=jk(r,i+(!r.key||u&&u.key===r.key?"":(""+r.key).replace(EE,"$&/")+"/")+t)),e.push(r)),1;if(u=0,n=n===""?".":n+":",TE(t))for(var l=0;l<t.length;l++){a=t[l];var _=n+vv(a,l);u+=Jg(a,e,i,_,r)}else if(_=Vk(t),typeof _=="function")for(t=_.call(t),l=0;!(a=t.next()).done;)a=a.value,_=n+vv(a,l++),u+=Jg(a,e,i,_,r);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return u}function rg(t,e,i){if(t==null)return t;var n=[],r=0;return Jg(t,n,"","",function(a){return e.call(i,a,r++)}),n}function $k(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(i){(t._status===0||t._status===-1)&&(t._status=1,t._result=i)},function(i){(t._status===0||t._status===-1)&&(t._status=2,t._result=i)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var zr={current:null},Qg={transition:null},Gk={ReactCurrentDispatcher:zr,ReactCurrentBatchConfig:Qg,ReactCurrentOwner:$b};function dR(){throw Error("act(...) is not supported in production builds of React.")}Yt.Children={map:rg,forEach:function(t,e,i){rg(t,function(){e.apply(this,arguments)},i)},count:function(t){var e=0;return rg(t,function(){e++}),e},toArray:function(t){return rg(t,function(e){return e})||[]},only:function(t){if(!Gb(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Yt.Component=hd;Yt.Fragment=Bk;Yt.Profiler=Ok;Yt.PureComponent=jb;Yt.StrictMode=Dk;Yt.Suspense=Lk;Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Gk;Yt.act=dR;Yt.cloneElement=function(t,e,i){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=oR({},t.props),r=t.key,a=t.ref,u=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,u=$b.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(_ in e)cR.call(e,_)&&!uR.hasOwnProperty(_)&&(n[_]=e[_]===void 0&&l!==void 0?l[_]:e[_])}var _=arguments.length-2;if(_===1)n.children=i;else if(1<_){l=Array(_);for(var w=0;w<_;w++)l[w]=arguments[w+2];n.children=l}return{$$typeof:Vp,type:t.type,key:r,ref:a,props:n,_owner:u}};Yt.createContext=function(t){return t={$$typeof:Fk,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:kk,_context:t},t.Consumer=t};Yt.createElement=hR;Yt.createFactory=function(t){var e=hR.bind(null,t);return e.type=t,e};Yt.createRef=function(){return{current:null}};Yt.forwardRef=function(t){return{$$typeof:Nk,render:t}};Yt.isValidElement=Gb;Yt.lazy=function(t){return{$$typeof:zk,_payload:{_status:-1,_result:t},_init:$k}};Yt.memo=function(t,e){return{$$typeof:Uk,type:t,compare:e===void 0?null:e}};Yt.startTransition=function(t){var e=Qg.transition;Qg.transition={};try{t()}finally{Qg.transition=e}};Yt.unstable_act=dR;Yt.useCallback=function(t,e){return zr.current.useCallback(t,e)};Yt.useContext=function(t){return zr.current.useContext(t)};Yt.useDebugValue=function(){};Yt.useDeferredValue=function(t){return zr.current.useDeferredValue(t)};Yt.useEffect=function(t,e){return zr.current.useEffect(t,e)};Yt.useId=function(){return zr.current.useId()};Yt.useImperativeHandle=function(t,e,i){return zr.current.useImperativeHandle(t,e,i)};Yt.useInsertionEffect=function(t,e){return zr.current.useInsertionEffect(t,e)};Yt.useLayoutEffect=function(t,e){return zr.current.useLayoutEffect(t,e)};Yt.useMemo=function(t,e){return zr.current.useMemo(t,e)};Yt.useReducer=function(t,e,i){return zr.current.useReducer(t,e,i)};Yt.useRef=function(t){return zr.current.useRef(t)};Yt.useState=function(t){return zr.current.useState(t)};Yt.useSyncExternalStore=function(t,e,i){return zr.current.useSyncExternalStore(t,e,i)};Yt.useTransition=function(){return zr.current.useTransition()};Yt.version="18.3.1";rR.exports=Yt;var kh=rR.exports;const Wk=Vb(kh);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xk=kh,qk=Symbol.for("react.element"),Kk=Symbol.for("react.fragment"),Zk=Object.prototype.hasOwnProperty,Yk=Xk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Jk={key:!0,ref:!0,__self:!0,__source:!0};function fR(t,e,i){var n,r={},a=null,u=null;i!==void 0&&(a=""+i),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(u=e.ref);for(n in e)Zk.call(e,n)&&!Jk.hasOwnProperty(n)&&(r[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:qk,type:t,key:a,ref:u,props:r,_owner:Yk.current}}By.Fragment=Kk;By.jsx=fR;By.jsxs=fR;nR.exports=By;var e_=nR.exports;async function jp(t,e,i,n){return n._parse(t,e,i,n)}function Di(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Dy=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),SE=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);SE&&parseFloat(SE[1]);const sg=globalThis,th=globalThis.process||{},Qk=globalThis.navigator||{};function pR(t){var n,r;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((r=process.versions)!=null&&r.electron))return!0;const i=typeof navigator<"u"&&navigator.userAgent;return!!(i&&i.indexOf("Electron")>=0)}function Yl(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||pR()}function eF(t){return Yl()?pR()?"Electron":(Qk.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const mR="4.0.7";function tF(t){try{const e=window[t],i="__storage_test__";return e.setItem(i,i),e.removeItem(i),e}catch{return null}}class iF{constructor(e,i,n="sessionStorage"){this.storage=tF(n),this.id=e,this.config=i,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}}_loadConfiguration(){let e={};if(this.storage){const i=this.storage.getItem(this.id);e=i?JSON.parse(i):{}}return Object.assign(this.config,e),this}}function nF(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function rF(t,e=8){const i=Math.max(e-t.length,0);return`${" ".repeat(i)}${t}`}var v_;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(v_||(v_={}));const sF=10;function CE(t){return typeof t!="string"?t:(t=t.toUpperCase(),v_[t]||v_.WHITE)}function oF(t,e,i){return!Yl&&typeof t=="string"&&(e&&(t=`\x1B[${CE(e)}m${t}\x1B[39m`),i&&(t=`\x1B[${CE(i)+sF}m${t}\x1B[49m`)),t}function aF(t,e=["constructor"]){const i=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(i),r=t;for(const a of n){const u=r[a];typeof u=="function"&&(e.find(l=>a===l)||(r[a]=u.bind(t)))}}function Wb(t,e){if(!t)throw new Error("Assertion failed")}function ih(){var e,i,n;let t;if(Yl()&&sg.performance)t=(i=(e=sg==null?void 0:sg.performance)==null?void 0:e.now)==null?void 0:i.call(e);else if("hrtime"in th){const r=(n=th==null?void 0:th.hrtime)==null?void 0:n.call(th);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const nh={debug:Yl()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},lF={enabled:!0,level:0};function rh(){}const IE={},RE={once:!0};class dd{constructor({id:e}={id:""}){this.VERSION=mR,this._startTs=ih(),this._deltaTs=ih(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new iF(`__probe-${this.id}__`,lF),this.timeStamp(`${this.id} started`),aF(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ih()-this._startTs).toPrecision(10))}getDelta(){return Number((ih()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,i){this._storage.setConfiguration({[e]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,i){if(!e)throw new Error(i||"Assertion failed")}warn(e){return this._getLogFunction(0,e,nh.warn,arguments,RE)}error(e){return this._getLogFunction(0,e,nh.error,arguments)}deprecated(e,i){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${i}\` instead`)}removed(e,i){return this.error(`\`${e}\` has been removed. Use \`${i}\` instead`)}probe(e,i){return this._getLogFunction(e,i,nh.log,arguments,{time:!0,once:!0})}log(e,i){return this._getLogFunction(e,i,nh.debug,arguments)}info(e,i){return this._getLogFunction(e,i,console.info,arguments)}once(e,i){return this._getLogFunction(e,i,nh.debug||nh.info,arguments,RE)}table(e,i,n){return i?this._getLogFunction(e,i,console.table||rh,n&&[n],{tag:uF(i)}):rh}time(e,i){return this._getLogFunction(e,i,console.time?console.time:console.info)}timeEnd(e,i){return this._getLogFunction(e,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,i){return this._getLogFunction(e,i,console.timeStamp||rh)}group(e,i,n={collapsed:!1}){const r=PE({logLevel:e,message:i,opts:n}),{collapsed:a}=n;return r.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,i,n={}){return this.group(e,i,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||rh)}withGroup(e,i,n){this.group(e,i)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=gR(e)}_getLogFunction(e,i,n,r,a){if(this._shouldLog(e)){a=PE({logLevel:e,message:i,args:r,opts:a}),n=n||a.method,Wb(n),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=ih();const u=a.tag||a.message;if(a.once&&u)if(!IE[u])IE[u]=ih();else return rh;return i=cF(this.id,a.message,a),n.bind(console,i,...a.args)}return rh}}dd.VERSION=mR;function gR(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Wb(Number.isFinite(e)&&e>=0),e}function PE(t){const{logLevel:e,message:i}=t;t.logLevel=gR(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==i;);switch(typeof e){case"string":case"function":i!==void 0&&n.unshift(i),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return Wb(r==="string"||r==="object"),Object.assign(t,{args:n},t.opts)}function cF(t,e,i){if(typeof e=="string"){const n=i.time?rF(nF(i.total)):"";e=i.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=oF(e,i.color,i.background)}return e}function uF(t){for(const e in t)for(const i in t[e])return i||"untitled";return"empty"}globalThis.probe={};const _R=new dd({id:"@probe.gl/log"});function hF(t,e){return yR(t||{},e)}function yR(t,e,i=0){if(i>3)return e;const n={...t};for(const[r,a]of Object.entries(e))a&&typeof a=="object"&&!Array.isArray(a)?n[r]=yR(n[r]||{},e[r],i+1):n[r]=e[r];return n}function dF(t){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,t)}function fF(t){var i,n;return((n=(i=globalThis.loaders)==null?void 0:i.modules)==null?void 0:n[t])||null}const pF="latest";function mF(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.2"),globalThis._loadersgl_.version}const vR=mF();function Da(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Ys=typeof process!="object"||String(process)!=="[object process]"||process.browser,Xb=typeof importScripts=="function",gF=typeof window<"u"&&typeof window.orientation<"u",ME=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ME&&parseFloat(ME[1]);class _F{constructor(e,i){k(this,"name");k(this,"workerThread");k(this,"isRunning",!0);k(this,"result");k(this,"_resolve",()=>{});k(this,"_reject",()=>{});this.name=e,this.workerThread=i,this.result=new Promise((n,r)=>{this._resolve=n,this._reject=r})}postMessage(e,i){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:i})}done(e){Da(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Da(this.isRunning),this.isRunning=!1,this._reject(e)}}class xv{terminate(){}}const bv=new Map;function yF(t){Da(t.source&&!t.url||!t.source&&t.url);let e=bv.get(t.source||t.url);return e||(t.url&&(e=vF(t.url),bv.set(t.url,e)),t.source&&(e=xR(t.source),bv.set(t.source,e))),Da(e),e}function vF(t){if(!t.startsWith("http"))return t;const e=xF(t);return xR(e)}function xR(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function xF(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function bR(t,e=!0,i){const n=i||new Set;if(t){if(BE(t))n.add(t);else if(BE(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)bR(t[r],e,n)}}return i===void 0?Array.from(n):[]}function BE(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const wv=()=>{};class Z1{constructor(e){k(this,"name");k(this,"source");k(this,"url");k(this,"terminated",!1);k(this,"worker");k(this,"onMessage");k(this,"onError");k(this,"_loadableURL","");const{name:i,source:n,url:r}=e;Da(n||r),this.name=i,this.source=n,this.url=r,this.onMessage=wv,this.onError=a=>console.log(a),this.worker=Ys?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Ys||typeof xv<"u"&&!Ys}destroy(){this.onMessage=wv,this.onError=wv,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,i){i=i||bR(e),this.worker.postMessage(e,i)}_getErrorFromErrorEvent(e){let i="Failed to load ";return i+=`worker ${this.name} from ${this.url}. `,e.message&&(i+=`${e.message} in `),e.lineno&&(i+=`:${e.lineno}:${e.colno}`),new Error(i)}_createBrowserWorker(){this._loadableURL=yF({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},e.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},e.onmessageerror=i=>console.error(i),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new xv(n,{eval:!1})}else if(this.source)e=new xv(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",i=>{this.onMessage(i)}),e.on("error",i=>{this.onError(i)}),e.on("exit",i=>{}),e}}class bF{constructor(e){k(this,"name","unnamed");k(this,"source");k(this,"url");k(this,"maxConcurrency",1);k(this,"maxMobileConcurrency",1);k(this,"onDebug",()=>{});k(this,"reuseWorkers",!0);k(this,"props",{});k(this,"jobQueue",[]);k(this,"idleQueue",[]);k(this,"count",0);k(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Z1.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,i=(r,a,u)=>r.done(u),n=(r,a)=>r.error(a)){const r=new Promise(a=>(this.jobQueue.push({name:e,onMessage:i,onError:n,onStart:a}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:e,backlog:this.jobQueue.length});const n=new _F(i.name,e);e.onMessage=r=>i.onMessage(n,r.type,r.payload),e.onError=r=>i.onError(n,r),i.onStart(n);try{await n.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Ys||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Z1({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return gF?this.maxMobileConcurrency:this.maxConcurrency}}const wF={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Il=class Il{constructor(e){k(this,"props");k(this,"workerPools",new Map);this.props={...wF},this.setProps(e),this.workerPools=new Map}static isSupported(){return Z1.isSupported()}static getWorkerFarm(e={}){return Il._workerFarm=Il._workerFarm||new Il({}),Il._workerFarm.setProps(e),Il._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:i,source:n,url:r}=e;let a=this.workerPools.get(i);return a||(a=new bF({name:i,source:n,url:r}),a.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,a)),a}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};k(Il,"_workerFarm");let x_=Il;function AF(t,e={}){const i=e[t.id]||{},n=Ys?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let r=i.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(Ys?r=`modules/${t.module}/dist/${n}`:r=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!r){let a=t.version;a==="latest"&&(a=pF);const u=a?`@${a}`:"";r=`https://unpkg.com/@loaders.gl/${t.module}${u}/dist/${n}`}return Da(r),r}function TF(t,e=vR){Da(t,"no worker provided");const i=t.version;return!(!e||!i)}const Av={};async function Gc(t,e=null,i={},n=null){return e&&(t=EF(t,e,i,n)),Av[t]=Av[t]||SF(t),await Av[t]}function EF(t,e,i={},n=null){if(!i.useLocalLibraries&&t.startsWith("http"))return t;n=n||t;const r=i.modules||{};return r[n]?r[n]:Ys?i.CDN?(Da(i.CDN.startsWith("http")),`${i.CDN}/${e}@${vR}/dist/libs/${n}`):Xb?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function SF(t){if(t.endsWith("wasm"))return await IF(t);if(!Ys)try{const{requireFromFile:i}=globalThis.loaders||{};return await(i==null?void 0:i(t))}catch(i){return console.error(i),null}if(Xb)return importScripts(t);const e=await RF(t);return CF(e,t)}function CF(t,e){if(!Ys){const{requireFromString:n}=globalThis.loaders||{};return n==null?void 0:n(t,e)}if(Xb)return eval.call(globalThis,t),null;const i=document.createElement("script");i.id=e;try{i.appendChild(document.createTextNode(t))}catch{i.text=t}return document.body.appendChild(i),null}async function IF(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Ys||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function RF(t){const{readFileAsText:e}=globalThis.loaders||{};return Ys||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function PF(t,e){return!x_.isSupported()||!Ys&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function MF(t,e,i,n,r){const a=t.id,u=AF(t,i),_=x_.getWorkerFarm(i).getWorkerPool({name:a,url:u});i=JSON.parse(JSON.stringify(i)),n=JSON.parse(JSON.stringify(n||{}));const w=await _.startJob("process-on-worker",BF.bind(null,r));return w.postMessage("process",{input:e,options:i,context:n}),await(await w.result).result}async function BF(t,e,i,n){switch(i){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:r,input:a,options:u}=n;try{const l=await t(a,u);e.postMessage("done",{id:r,result:l})}catch(l){const _=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:r,error:_})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function DF(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?DE(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?DE(t,0,e):""}function DE(t,e,i){if(t.byteLength<=e+i)return"";const n=new DataView(t);let r="";for(let a=0;a<i;a++)r+=String.fromCharCode(n.getUint8(e+a));return r}function OF(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${DF(t)}"`)}}function kF(t,e,i){if(i=i||t.byteLength,t.byteLength<i||e.byteLength<i)return!1;const n=new Uint8Array(t),r=new Uint8Array(e);for(let a=0;a<n.length;++a)if(n[a]!==r[a])return!1;return!0}function FF(...t){return NF(t)}function NF(t){const e=t.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),i=e.reduce((a,u)=>a+u.byteLength,0),n=new Uint8Array(i);let r=0;for(const a of e)n.set(a,r),r+=a.byteLength;return n.buffer}function qb(t,e,i){const n=i!==void 0?new Uint8Array(t).subarray(e,e+i):new Uint8Array(t).subarray(e);return new Uint8Array(n).buffer}function Hp(t,e){return Di(t>=0),Di(e>0),t+(e-1)&~(e-1)}function LF(t,e,i){let n;if(t instanceof ArrayBuffer)n=new Uint8Array(t);else{const r=t.byteOffset,a=t.byteLength;n=new Uint8Array(t.buffer||t.arrayBuffer,r,a)}return e.set(n,i),i+Hp(n.byteLength,4)}async function UF(t){const e=[];for await(const i of t)e.push(i);return FF(...e)}function OE(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class kE{constructor(e,i){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=i,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=OE(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(OE()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class fd{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,i="count"){return this._getOrCreate({name:e,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const i of Object.values(this.stats))e(i)}getTable(){const e={};return this.forEach(i=>{e[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(i=>this._getOrCreate(i))}_getOrCreate(e){const{name:i,type:n}=e;let r=this.stats[i];return r||(e instanceof kE?r=e:r=new kE(i,n),this.stats[i]=r),r}}const zF="Queued Requests",VF="Active Requests",jF="Cancelled Requests",HF="Queued Requests Ever",$F="Active Requests Ever",GF={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class WF{constructor(e={}){k(this,"props");k(this,"stats");k(this,"activeRequestCount",0);k(this,"requestQueue",[]);k(this,"requestMap",new Map);k(this,"updateTimer",null);this.props={...GF,...e},this.stats=new fd({id:this.props.id}),this.stats.get(zF),this.stats.get(VF),this.stats.get(jF),this.stats.get(HF),this.stats.get($F)}scheduleRequest(e,i=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:i},r=new Promise(a=>(n.resolve=a,n));return this.requestQueue.push(n),this.requestMap.set(e,r),this._issueNewRequests(),r}_issueRequest(e){const{handle:i,resolve:n}=e;let r=!1;const a=()=>{r||(r=!0,this.requestMap.delete(i),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:a}):Promise.resolve({done:a})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let i=0;i<e;++i){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const e=this.requestQueue;for(let i=0;i<e.length;++i){const n=e[i];this._updateRequest(n)||(e.splice(i,1),this.requestMap.delete(n.handle),i--)}e.sort((i,n)=>i.priority-n.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let XF="";const FE={};function qF(t){for(const e in FE)if(t.startsWith(e)){const i=FE[e];t=t.replace(e,i)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${XF}${t}`),t}function KF(t){return t&&typeof t=="object"&&t.isBuffer}function wR(t){if(KF(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function ZF(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const t=(e=window.location)==null?void 0:e.pathname;return(t==null?void 0:t.slice(0,t.lastIndexOf("/")+1))||""}function AR(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function Kb(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function YF(...t){const e=[];for(let a=0;a<t.length;a++)e[a]=t[a];let i="",n=!1,r;for(let a=e.length-1;a>=-1&&!n;a--){let u;a>=0?u=e[a]:(r===void 0&&(r=ZF()),u=r),u.length!==0&&(i=`${u}/${i}`,n=u.charCodeAt(0)===Uf)}return i=JF(i,!n),n?`/${i}`:i.length>0?i:"."}const Uf=47,Tv=46;function JF(t,e){let i="",n=-1,r=0,a,u=!1;for(let l=0;l<=t.length;++l){if(l<t.length)a=t.charCodeAt(l);else{if(a===Uf)break;a=Uf}if(a===Uf){if(!(n===l-1||r===1))if(n!==l-1&&r===2){if(i.length<2||!u||i.charCodeAt(i.length-1)!==Tv||i.charCodeAt(i.length-2)!==Tv){if(i.length>2){const _=i.length-1;let w=_;for(;w>=0&&i.charCodeAt(w)!==Uf;--w);if(w!==_){i=w===-1?"":i.slice(0,w),n=l,r=0,u=!1;continue}}else if(i.length===2||i.length===1){i="",n=l,r=0,u=!1;continue}}e&&(i.length>0?i+="/..":i="..",u=!0)}else{const _=t.slice(n+1,l);i.length>0?i+=`/${_}`:i=_,u=!1}n=l,r=0}else a===Tv&&r!==-1?++r:r=-1}return i}const QF=t=>typeof t=="boolean",Kf=t=>typeof t=="function",$p=t=>t!==null&&typeof t=="object",NE=t=>$p(t)&&t.constructor==={}.constructor,eN=t=>!!t&&typeof t[Symbol.iterator]=="function",tN=t=>t&&typeof t[Symbol.asyncIterator]=="function",su=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,ou=t=>typeof Blob<"u"&&t instanceof Blob,iN=t=>t&&typeof t=="object"&&t.isBuffer,nN=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||$p(t)&&Kf(t.tee)&&Kf(t.cancel)&&Kf(t.getReader),rN=t=>$p(t)&&Kf(t.read)&&Kf(t.pipe)&&QF(t.readable),TR=t=>nN(t)||rN(t);class sN extends Error{constructor(i,n){super(i);k(this,"reason");k(this,"url");k(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}}const oN=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,aN=/^([-\w.]+\/[-\w.+]+)/;function LE(t,e){return t.toLowerCase()===e.toLowerCase()}function lN(t){const e=aN.exec(t);return e?e[1]:t}function UE(t){const e=oN.exec(t);return e?e[1]:""}const ER=/\?.*/;function cN(t){const e=t.match(ER);return e&&e[0]}function Zb(t){return t.replace(ER,"")}function uN(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Oy(t){return su(t)?t.url:ou(t)?t.name||"":typeof t=="string"?t:""}function Yb(t){if(su(t)){const e=t,i=e.headers.get("content-type")||"",n=Zb(e.url);return lN(i)||UE(n)}return ou(t)?t.type||"":typeof t=="string"?UE(t):""}function hN(t){return su(t)?t.headers["content-length"]||-1:ou(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function SR(t){if(su(t))return t;const e={},i=hN(t);i>=0&&(e["content-length"]=String(i));const n=Oy(t),r=Yb(t);r&&(e["content-type"]=r);const a=await pN(t);a&&(e["x-first-bytes"]=a),typeof t=="string"&&(t=new TextEncoder().encode(t));const u=new Response(t,{headers:e});return Object.defineProperty(u,"url",{value:n}),u}async function dN(t){if(!t.ok)throw await fN(t)}async function fN(t){const e=uN(t.url);let i=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;i=i.length>100?`${i.slice(0,100)}...`:i;const n={reason:t.statusText,url:t.url,response:t};try{const r=t.headers.get("Content-Type");n.reason=r!=null&&r.includes("application/json")?await t.json():t.text()}catch{}return new sN(i,n)}async function pN(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const i=t.slice(0,5);return await new Promise(n=>{const r=new FileReader;r.onload=a=>{var u;return n((u=a==null?void 0:a.target)==null?void 0:u.result)},r.readAsDataURL(i)})}if(t instanceof ArrayBuffer){const i=t.slice(0,5);return`data:base64,${mN(i)}`}return null}function mN(t){let e="";const i=new Uint8Array(t);for(let n=0;n<i.byteLength;n++)e+=String.fromCharCode(i[n]);return btoa(e)}function gN(t){return!_N(t)&&!yN(t)}function _N(t){return t.startsWith("http:")||t.startsWith("https:")}function yN(t){return t.startsWith("data:")}async function zE(t,e){var i,n;if(typeof t=="string"){const r=qF(t);return gN(r)&&(i=globalThis.loaders)!=null&&i.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(r,e):await fetch(r,e)}return await SR(t)}const VE=new dd({id:"loaders.gl"});class vN{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class xN{constructor(){k(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const CR={fetch:null,mimeType:void 0,nothrow:!1,log:new xN,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Dy,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},bN={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function IR(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function RR(){const t=IR();return t.globalOptions=t.globalOptions||{...CR},t.globalOptions}function wN(t,e,i,n){return i=i||[],i=Array.isArray(i)?i:[i],AN(t,i),EN(e,t,n)}function AN(t,e){jE(t,null,CR,bN,e);for(const i of e){const n=t&&t[i.id]||{},r=i.options&&i.options[i.id]||{},a=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};jE(n,i.id,r,a,e)}}function jE(t,e,i,n,r){const a=e||"Top level",u=e?`${e}.`:"";for(const l in t){const _=!e&&$p(t[l]),w=l==="baseUri"&&!e,E=l==="workerUrl"&&e;if(!(l in i)&&!w&&!E){if(l in n)VE.warn(`${a} loader option '${u}${l}' no longer supported, use '${n[l]}'`)();else if(!_){const I=TN(l,r);VE.warn(`${a} loader option '${u}${l}' not recognized. ${I}`)()}}}}function TN(t,e){const i=t.toLowerCase();let n="";for(const r of e)for(const a in r.options){if(t===a)return`Did you mean '${r.id}.${a}'?`;const u=a.toLowerCase();(i.startsWith(u)||u.startsWith(i))&&(n=n||`Did you mean '${r.id}.${a}'?`)}return n}function EN(t,e,i){const r={...t.options||{}};return SN(r,i),r.log===null&&(r.log=new vN),HE(r,RR()),HE(r,e),r}function HE(t,e){for(const i in e)if(i in e){const n=e[i];NE(n)&&NE(t[i])?t[i]={...t[i],...e[i]}:t[i]=e[i]}}function SN(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Jb(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function Qb(t){Di(t,"null loader"),Di(Jb(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const PR=()=>{const t=IR();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function CN(t){const e=PR();t=Array.isArray(t)?t:[t];for(const i of t){const n=Qb(i);e.find(r=>n===r)||e.unshift(n)}}function IN(){return PR()}const RN=new dd({id:"loaders.gl"}),PN=/\.([^.]+)$/;async function MN(t,e=[],i,n){if(!MR(t))return null;let r=$E(t,e,{...i,nothrow:!0},n);if(r)return r;if(ou(t)&&(t=await t.slice(0,10).arrayBuffer(),r=$E(t,e,i,n)),!r&&!(i!=null&&i.nothrow))throw new Error(BR(t));return r}function $E(t,e=[],i,n){if(!MR(t))return null;if(e&&!Array.isArray(e))return Qb(e);let r=[];e&&(r=r.concat(e)),i!=null&&i.ignoreRegisteredLoaders||r.push(...IN()),DN(r);const a=BN(t,r,i,n);if(!a&&!(i!=null&&i.nothrow))throw new Error(BR(t));return a}function BN(t,e,i,n){const r=Oy(t),a=Yb(t),u=Zb(r)||(n==null?void 0:n.url);let l=null,_="";return i!=null&&i.mimeType&&(l=Ev(e,i==null?void 0:i.mimeType),_=`match forced by supplied MIME type ${i==null?void 0:i.mimeType}`),l=l||ON(e,u),_=_||(l?`matched url ${u}`:""),l=l||Ev(e,a),_=_||(l?`matched MIME type ${a}`:""),l=l||FN(e,t),_=_||(l?`matched initial data ${DR(t)}`:""),i!=null&&i.fallbackMimeType&&(l=l||Ev(e,i==null?void 0:i.fallbackMimeType),_=_||(l?`matched fallback MIME type ${a}`:"")),_&&RN.log(1,`selectLoader selected ${l==null?void 0:l.name}: ${_}.`),l}function MR(t){return!(t instanceof Response&&t.status===204)}function BR(t){const e=Oy(t),i=Yb(t);let n="No valid loader found (";n+=e?`${AR(e)}, `:"no url provided, ",n+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const r=t?DR(t):"";return n+=r?` first bytes: "${r}"`:"first bytes: not available",n+=")",n}function DN(t){for(const e of t)Qb(e)}function ON(t,e){const i=e&&PN.exec(e),n=i&&i[1];return n?kN(t,n):null}function kN(t,e){e=e.toLowerCase();for(const i of t)for(const n of i.extensions)if(n.toLowerCase()===e)return i;return null}function Ev(t,e){var i;for(const n of t)if((i=n.mimeTypes)!=null&&i.some(r=>LE(e,r))||LE(e,`application/x.${n.id}`))return n;return null}function FN(t,e){if(!e)return null;for(const i of t)if(typeof e=="string"){if(NN(e,i))return i}else if(ArrayBuffer.isView(e)){if(GE(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer&&GE(e,0,i))return i;return null}function NN(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>t.startsWith(n))}function GE(t,e,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(r=>LN(t,e,i,r))}function LN(t,e,i,n){if(n instanceof ArrayBuffer)return kF(n,t,n.byteLength);switch(typeof n){case"function":return n(t);case"string":const r=Y1(t,e,n.length);return n===r;default:return!1}}function DR(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Y1(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Y1(t,0,e):""}function Y1(t,e,i){if(t.byteLength<e+i)return"";const n=new DataView(t);let r="";for(let a=0;a<i;a++)r+=String.fromCharCode(n.getUint8(e+a));return r}const UN=256*1024;function*zN(t,e){const i=(e==null?void 0:e.chunkSize)||UN;let n=0;const r=new TextEncoder;for(;n<t.length;){const a=Math.min(t.length-n,i),u=t.slice(n,n+a);n+=a,yield r.encode(u)}}const VN=256*1024;function*jN(t,e={}){const{chunkSize:i=VN}=e;let n=0;for(;n<t.byteLength;){const r=Math.min(t.byteLength-n,i),a=new ArrayBuffer(r),u=new Uint8Array(t,n,r);new Uint8Array(a).set(u),n+=r,yield a}}const HN=1024*1024;async function*$N(t,e){const i=(e==null?void 0:e.chunkSize)||HN;let n=0;for(;n<t.size;){const r=n+i,a=await t.slice(n,r).arrayBuffer();n=r,yield a}}function WE(t,e){return Dy?GN(t,e):WN(t)}async function*GN(t,e){const i=t.getReader();let n;try{for(;;){const r=n||i.read();e!=null&&e._streamReadAhead&&(n=i.read());const{done:a,value:u}=await r;if(a)return;yield wR(u)}}catch{i.releaseLock()}}async function*WN(t,e){for await(const i of t)yield wR(i)}function XN(t,e){if(typeof t=="string")return zN(t,e);if(t instanceof ArrayBuffer)return jN(t,e);if(ou(t))return $N(t,e);if(TR(t))return WE(t,e);if(su(t))return WE(t.body,e);throw new Error("makeIterator")}const OR="Cannot convert supplied data type";function qN(t,e,i){if(e.text&&typeof t=="string")return t;if(iN(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==n.byteLength)&&(n=n.slice(t.byteOffset,t.byteOffset+r)),n}throw new Error(OR)}async function KN(t,e,i){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||n)return qN(t,e);if(ou(t)&&(t=await SR(t)),su(t)){const r=t;return await dN(r),e.binary?await r.arrayBuffer():await r.text()}if(TR(t)&&(t=XN(t,i)),eN(t)||tN(t))return UF(t);throw new Error(OR)}function kR(t,e){const i=RR(),n=t||i;return typeof n.fetch=="function"?n.fetch:$p(n.fetch)?r=>zE(r,n.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:zE}function ZN(t,e,i){if(i)return i;const n={fetch:kR(e,t),...t};if(n.url){const r=Zb(n.url);n.baseUrl=r,n.queryString=cN(n.url),n.filename=AR(r),n.baseUrl=Kb(r)}return Array.isArray(n.loaders)||(n.loaders=null),n}function YN(t,e){if(t&&!Array.isArray(t))return t;let i;if(t&&(i=Array.isArray(t)?t:[t]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];i=i?[...i,...n]:n}return i&&i.length?i:void 0}async function b_(t,e,i,n){e&&!Array.isArray(e)&&!Jb(e)&&(n=void 0,i=e,e=void 0),t=await t,i=i||{};const r=Oy(t),u=YN(e,n),l=await MN(t,u,i);return l?(i=wN(i,l,u,r),n=ZN({url:r,_parse:b_,loaders:u},i,n||null),await JN(l,t,i,n)):null}async function JN(t,e,i,n){if(TF(t),i=hF(t.options,i),su(e)){const a=e,{ok:u,redirected:l,status:_,statusText:w,type:E,url:I}=a,R=Object.fromEntries(a.headers.entries());n.response={headers:R,ok:u,redirected:l,status:_,statusText:w,type:E,url:I}}e=await KN(e,t,i);const r=t;if(r.parseTextSync&&typeof e=="string")return r.parseTextSync(e,i,n);if(PF(t,i))return await MF(t,e,i,n,b_);if(r.parseText&&typeof e=="string")return await r.parseText(e,i,n);if(r.parse)return await r.parse(e,i,n);throw Da(!r.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function QN(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function FR(t){let e=1/0,i=1/0,n=1/0,r=-1/0,a=-1/0,u=-1/0;const l=t.POSITION?t.POSITION.value:[],_=l&&l.length;for(let w=0;w<_;w+=3){const E=l[w],I=l[w+1],R=l[w+2];e=E<e?E:e,i=I<i?I:i,n=R<n?R:n,r=E>r?E:r,a=I>a?I:a,u=R>u?R:u}return[[e,i,n],[r,a,u]]}function eL(t,e,i){const n=QN(e.value),r=i||tL(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:r}}function tL(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function Wl(t,e,i,n){let r,a;!Array.isArray(e)&&!Jb(e)?(r=[],a=e):(r=e,a=i);const u=kR(a);let l=t;return typeof t=="string"&&(l=await u(t)),ou(t)&&(l=await u(t)),Array.isArray(r)?await b_(l,r,a):await b_(l,r,a)}const iL="4.2.2";var iR;const nL=(iR=globalThis.loaders)==null?void 0:iR.parseImageNode,J1=typeof Image<"u",Q1=typeof ImageBitmap<"u",rL=!!nL,ex=Dy?!0:rL;function sL(t){switch(t){case"auto":return Q1||J1||ex;case"imagebitmap":return Q1;case"image":return J1;case"data":return ex;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function oL(){if(Q1)return"imagebitmap";if(J1)return"image";if(ex)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function aL(t){const e=lL(t);if(!e)throw new Error("Not an image");return e}function NR(t){switch(aL(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),i=e.getContext("2d");if(!i)throw new Error("getImageData");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function lL(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const cL=/^data:image\/svg\+xml/,uL=/\.svg((\?|#).*)?$/;function ew(t){return t&&(cL.test(t)||uL.test(t))}function hL(t,e){if(ew(e)){let n=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(a){throw new Error(a.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return LR(t,e)}function LR(t,e){if(ew(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function UR(t,e,i){const n=hL(t,i),r=self.URL||self.webkitURL,a=typeof n!="string"&&r.createObjectURL(n);try{return await dL(a||n,e)}finally{a&&r.revokeObjectURL(a)}}async function dL(t,e){const i=new Image;return i.src=t,e.image&&e.image.decode&&i.decode?(await i.decode(),i):await new Promise((n,r)=>{try{i.onload=()=>n(i),i.onerror=a=>{const u=a instanceof Error?a.message:"error";r(new Error(u))}}catch(a){r(a)}})}const fL={};let XE=!0;async function pL(t,e,i){let n;ew(i)?n=await UR(t,e,i):n=LR(t,i);const r=e&&e.imagebitmap;return await mL(n,r)}async function mL(t,e=null){if((gL(e)||!XE)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(i){console.warn(i),XE=!1}return await createImageBitmap(t)}function gL(t){for(const e in t||fL)return!1;return!0}function _L(t){return!bL(t,"ftyp",4)||!(t[8]&96)?null:yL(t)}function yL(t){switch(vL(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function vL(t,e,i){return String.fromCharCode(...t.slice(e,i))}function xL(t){return[...t].map(e=>e.charCodeAt(0))}function bL(t,e,i=0){const n=xL(e);for(let r=0;r<n.length;++r)if(n[r]!==t[r+i])return!1;return!0}const Ko=!1,Zf=!0;function tw(t){const e=Gp(t);return AL(e)||SL(e)||TL(e)||EL(e)||wL(e)}function wL(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),i=_L(e);return i?{mimeType:i.mimeType,width:0,height:0}:null}function AL(t){const e=Gp(t);return e.byteLength>=24&&e.getUint32(0,Ko)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Ko),height:e.getUint32(20,Ko)}:null}function TL(t){const e=Gp(t);return e.byteLength>=10&&e.getUint32(0,Ko)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Zf),height:e.getUint16(8,Zf)}:null}function EL(t){const e=Gp(t);return e.byteLength>=14&&e.getUint16(0,Ko)===16973&&e.getUint32(2,Zf)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Zf),height:e.getUint32(22,Zf)}:null}function SL(t){const e=Gp(t);if(!(e.byteLength>=3&&e.getUint16(0,Ko)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:r}=CL();let a=2;for(;a+9<e.byteLength;){const u=e.getUint16(a,Ko);if(r.has(u))return{mimeType:"image/jpeg",height:e.getUint16(a+5,Ko),width:e.getUint16(a+7,Ko)};if(!n.has(u))return null;a+=2,a+=e.getUint16(a,Ko)}return null}function CL(){const t=new Set([65499,65476,65484,65501,65534]);for(let i=65504;i<65520;++i)t.add(i);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Gp(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function IL(t,e){var r;const{mimeType:i}=tw(t)||{},n=(r=globalThis.loaders)==null?void 0:r.parseImageNode;return Di(n),await n(t,i)}async function RL(t,e,i){e=e||{};const r=(e.image||{}).type||"auto",{url:a}=i||{},u=PL(r);let l;switch(u){case"imagebitmap":l=await pL(t,e,a);break;case"image":l=await UR(t,e,a);break;case"data":l=await IL(t);break;default:Di(!1)}return r==="data"&&(l=NR(l)),l}function PL(t){switch(t){case"auto":case"data":return oL();default:return sL(t),t}}const ML=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],BL=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],DL={image:{type:"auto",decode:!0}},zR={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:iL,mimeTypes:BL,extensions:ML,parse:RL,tests:[t=>!!tw(new DataView(t))],options:DL},Sv={};function OL(t){if(Sv[t]===void 0){const e=Dy?FL(t):kL(t);Sv[t]=e}return Sv[t]}function kL(t){var r,a;const e=["image/png","image/jpeg","image/gif"],i=((r=globalThis.loaders)==null?void 0:r.imageFormatsNode)||e;return!!((a=globalThis.loaders)==null?void 0:a.parseImageNode)&&i.includes(t)}function FL(t){switch(t){case"image/avif":case"image/webp":return NL(t);default:return!0}}function NL(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}const ai=new dd({id:"deck"});let tx={};function LL(t){tx=t}function Tr(t,e,i,n){ai.level>0&&tx[t]&&tx[t].call(null,e,i,n)}function UL(t){const e=t[0],i=t[t.length-1];return e==="{"&&i==="}"||e==="["&&i==="]"}const zL={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:UL,parseTextSync:JSON.parse};function VL(){const t="9.0.34",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(ai.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:ai,_registerLoggers:LL},CN([zL,[zR,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const jL=VL();function Lc(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Cv={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function HL(t){const e={};for(const[i,n]of Object.entries(t))e[i]=WL(n);return e}function $L(t,e,i){const n={};for(const[r,a]of Object.entries(e))t&&r in t&&!a.private?(a.validate&&Lc(a.validate(t[r],a),`${i}: invalid ${r}`),n[r]=t[r]):n[r]=a.value;return n}function WL(t){let e=qE(t);if(e!=="object")return{value:t,...Cv[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Cv[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=qE(t.value),{...t,...Cv[e],type:e}):{type:"object",value:null};throw new Error("props")}function qE(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const XL=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,qL=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,KL={vertex:XL,fragment:qL},KE=/void\s+main\s*\([^)]*\)\s*\{\n?/,ZE=/}\n?[^{}]*$/,Iv=[],t_="__LUMA_INJECT_DECLARATIONS__";function ZL(t){const e={vertex:{},fragment:{}};for(const i in t){let n=t[i];const r=YL(i);typeof n=="string"&&(n={order:0,injection:n}),e[r][i]=n}return e}function YL(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function w_(t,e,i,n=!1){const r=e==="vertex";for(const a in i){const u=i[a];u.sort((_,w)=>_.order-w.order),Iv.length=u.length;for(let _=0,w=u.length;_<w;++_)Iv[_]=u[_].injection;const l=`${Iv.join(`
`)}
`;switch(a){case"vs:#decl":r&&(t=t.replace(t_,l));break;case"vs:#main-start":r&&(t=t.replace(KE,_=>_+l));break;case"vs:#main-end":r&&(t=t.replace(ZE,_=>l+_));break;case"fs:#decl":r||(t=t.replace(t_,l));break;case"fs:#main-start":r||(t=t.replace(KE,_=>_+l));break;case"fs:#main-end":r||(t=t.replace(ZE,_=>l+_));break;default:t=t.replace(a,_=>_+l)}}return t=t.replace(t_,""),n&&(t=t.replace(/\}\s*$/,a=>a+KL[e])),t}let JL=1;class Uc{constructor(e){k(this,"name");k(this,"vs");k(this,"fs");k(this,"getModuleUniforms");k(this,"dependencies");k(this,"deprecations");k(this,"defines");k(this,"injections");k(this,"uniforms",{});k(this,"uniformTypes",{});const{name:i,vs:n,fs:r,dependencies:a=[],uniformTypes:u={},uniformPropTypes:l={},getUniforms:_,deprecations:w=[],defines:E={},inject:I={}}=e;Lc(typeof i=="string"),this.name=i,this.vs=n,this.fs=r,this.getModuleUniforms=_,this.dependencies=Uc.instantiateModules(a),this.deprecations=this._parseDeprecationDefinitions(w),this.defines=E,this.injections=ZL(I),this.uniformTypes=u,l&&(this.uniforms=HL(l))}static instantiateModules(e){return e.map(i=>{if(i instanceof Uc)return i;Lc(typeof i!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(i)}' and use it directly.`),i.name||(console.warn("shader module has no name"),i.name=`shader-module-${JL++}`);const n=new Uc(i);return n.dependencies=Uc.instantiateModules(i.dependencies||[]),n})}getModuleSource(e){let i;switch(e){case"vertex":i=this.vs||"";break;case"fragment":i=this.fs||"";break;default:Lc(!1)}const n=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${n}
${i}

`}getUniforms(e,i){return this.getModuleUniforms?this.getModuleUniforms(e,i):$L(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,i){this.deprecations.forEach(n=>{var r;(r=n.regex)!=null&&r.test(e)&&(n.deprecated?i.deprecated(n.old,n.new)():i.removed(n.old,n.new)())})}_parseDeprecationDefinitions(e){return e.forEach(i=>{switch(i.type){case"function":i.regex=new RegExp(`\\b${i.old}\\(`);break;default:i.regex=new RegExp(`${i.type} ${i.old};`)}}),e}_defaultGetUniforms(e={}){const i={},n=this.uniforms;for(const r in n){const a=n[r];r in e&&!a.private?(a.validate&&Lc(a.validate(e[r],a),`${this.name}: invalid ${r}`),i[r]=e[r]):i[r]=a.value}return i}}function YE(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=JE(t.platformInfo,t.vs);let i;return t.fs&&(i=JE(t.platformInfo,t.fs)),{...t,vs:e,fs:i}}function JE(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function ky(t){const e=Uc.instantiateModules(t);return QL(e)}function QL(t){const e={},i={};return VR({modules:t,level:0,moduleMap:e,moduleDepth:i}),Object.keys(i).sort((n,r)=>i[r]-i[n]).map(n=>e[n])}function VR(t){const{modules:e,level:i,moduleMap:n,moduleDepth:r}=t;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const a of e)n[a.name]=a,(r[a.name]===void 0||r[a.name]<i)&&(r[a.name]=i);for(const a of e)a.dependencies&&VR({modules:a.dependencies,level:i+1,moduleMap:n,moduleDepth:r})}function eU(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function tU(t,e){var n;if(Number(((n=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:n[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=QE(t,iU),t;case"fragment":return t=QE(t,nU),t;default:throw new Error(e)}}const jR=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],iU=[...jR,[ix("attribute"),"in $1"],[ix("varying"),"out $1"]],nU=[...jR,[ix("varying"),"in $1"]];function QE(t,e){for(const[i,n]of e)t=t.replace(i,n);return t}function ix(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function HR(t,e){let i="";for(const n in t){const r=t[n];if(i+=`void ${r.signature} {
`,r.header&&(i+=`  ${r.header}`),e[n]){const a=e[n];a.sort((u,l)=>u.order-l.order);for(const u of a)i+=`  ${u.injection}
`}r.footer&&(i+=`  ${r.footer}`),i+=`}
`}return i}function $R(t){const e={vertex:{},fragment:{}};for(const i of t){let n,r;typeof i!="string"?(n=i,r=n.hook):(n={},r=i),r=r.trim();const[a,u]=r.split(":"),l=r.replace(/\(.+/,""),_=Object.assign(n,{signature:u});switch(a){case"vs":e.vertex[l]=_;break;case"fs":e.fragment[l]=_;break;default:throw new Error(a)}}return e}function rU(t,e){return{name:sU(t,e),language:"glsl",version:oU(t)}}function sU(t,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return n?n[1]:e}function oU(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const n=parseInt(i[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const GR=`

${t_}
`,aU=`precision highp float;
`;function lU(t){const e=ky(t.modules||[]);return{source:nx(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:iw(e)}}function cU(t){const e=ky(t.modules||[]);return{vs:nx(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:nx(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:iw(e)}}function uU(t){const{vs:e,fs:i}=t,n=ky(t.modules||[]);return{vs:eS(t.platformInfo,{...t,source:e,stage:"vertex",modules:n}),fs:eS(t.platformInfo,{...t,source:i,stage:"fragment",modules:n}),getUniforms:iw(n)}}function nx(t,e){const{source:i,stage:n,modules:r,hookFunctions:a=[],inject:u={},log:l}=e;Lc(typeof i=="string","shader source must be a string");const _=i;let w="";const E=$R(a),I={},R={},L={};for(const K in u){const fe=typeof u[K]=="string"?{injection:u[K],order:0}:u[K],X=/^(v|f)s:(#)?([\w-]+)$/.exec(K);if(X){const $=X[2],Q=X[3];$?Q==="decl"?R[K]=[fe]:L[K]=[fe]:I[K]=[fe]}else L[K]=[fe]}const W=t.type!=="webgpu"?r:[];for(const K of W){l&&K.checkDeprecations(_,l);const fe=K.getModuleSource(n,"wgsl");w+=fe;const X=K.injections[n];for(const $ in X){const Q=/^(v|f)s:#([\w-]+)$/.exec($);if(Q){const Ce=Q[2]==="decl"?R:L;Ce[$]=Ce[$]||[],Ce[$].push(X[$])}else I[$]=I[$]||[],I[$].push(X[$])}}return w+=GR,w=w_(w,n,R),w+=HR(E[n],I),w+=_,w=w_(w,n,L),w}function eS(t,e){const{id:i,source:n,stage:r,language:a="glsl",modules:u,defines:l={},hookFunctions:_=[],inject:w={},prologue:E=!0,log:I}=e;Lc(typeof n=="string","shader source must be a string");const R=a==="glsl"?rU(n).version:-1,L=t.shaderLanguageVersion,W=R===100?"#version 100":"#version 300 es",fe=n.split(`
`).slice(1).join(`
`),X={};u.forEach(Fe=>{Object.assign(X,Fe.getDefines())}),Object.assign(X,l);let $="";switch(a){case"wgsl":break;case"glsl":$=E?`${W}

// ----- PROLOGUE -------------------------
${hU({id:i,source:n,stage:r})}
${`#define SHADER_TYPE_${r.toUpperCase()}`}
${eU(t)}
${r==="fragment"?aU:""}

// ----- APPLICATION DEFINES -------------------------

${dU(X)}

`:`${W}
`;break}const Q=$R(_),me={},Ce={},Be={};for(const Fe in w){const ze=typeof w[Fe]=="string"?{injection:w[Fe],order:0}:w[Fe],Ve=/^(v|f)s:(#)?([\w-]+)$/.exec(Fe);if(Ve){const je=Ve[2],Ke=Ve[3];je?Ke==="decl"?Ce[Fe]=[ze]:Be[Fe]=[ze]:me[Fe]=[ze]}else Be[Fe]=[ze]}for(const Fe of u){I&&Fe.checkDeprecations(fe,I);const ze=Fe.getModuleSource(r);$+=ze;const Ve=Fe.injections[r];for(const je in Ve){const Ke=/^(v|f)s:#([\w-]+)$/.exec(je);if(Ke){const Pt=Ke[2]==="decl"?Ce:Be;Pt[je]=Pt[je]||[],Pt[je].push(Ve[je])}else me[je]=me[je]||[],me[je].push(Ve[je])}}return $+="// ----- MAIN SHADER SOURCE -------------------------",$+=GR,$=w_($,r,Ce),$+=HR(Q[r],me),$+=fe,$=w_($,r,Be),a==="glsl"&&R!==L&&($=tU($,r)),$.trim()}function iw(t){return function(i){const n={};for(const r of t){const a=r.getUniforms(i,n);Object.assign(n,a)}return n}}function hU(t){const{id:e,source:i,stage:n}=t;return e&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}

`:""}function dU(t={}){let e="";for(const i in t){const n=t[i];(n||Number.isFinite(n))&&(e+=`#define ${i.toUpperCase()} ${t[i]}
`)}return e}const Fc=class Fc{constructor(){k(this,"_hookFunctions",[]);k(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Fc.defaultShaderAssembler=Fc.defaultShaderAssembler||new Fc,Fc.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(i=>i.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const i=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==i)}addShaderHook(e,i){i&&(e=Object.assign(i,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const i=this._getModuleList(e.modules),n=this._hookFunctions,r=YE(e);return{...lU({platformInfo:e.platformInfo,...r,modules:i,hookFunctions:n}),modules:i}}assembleShaderPair(e){const i=YE(e),n=this._getModuleList(e.modules),r=this._hookFunctions,{platformInfo:a}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?cU({platformInfo:a,...i,modules:n,hookFunctions:r}):uU({platformInfo:a,...i,modules:n,hookFunctions:r}),modules:n}}_getModuleList(e=[]){const i=new Array(this._defaultModules.length+e.length),n={};let r=0;for(let a=0,u=this._defaultModules.length;a<u;++a){const l=this._defaultModules[a],_=l.name;i[r++]=l,n[_]=!0}for(let a=0,u=e.length;a<u;++a){const l=e[a],_=l.name;n[_]||(i[r++]=l,n[_]=!0)}return i.length=r,Uc.instantiateModules(i)}};k(Fc,"defaultShaderAssembler");let A_=Fc;const fU=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,pU=`#version 300 es
${fU}`;function mU(t){const{input:e,inputChannels:i,output:n}={};if(!e)return pU;if(!i)throw new Error("inputChannels");const r=gU(i),a=_U(e,i);return`#version 300 es
in ${r} ${e};
out vec4 ${n};
void main() {
  ${n} = ${a};
}`}function gU(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function _U(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const qe=new dd({id:"luma.gl"});class yU{constructor(){k(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new fd({id:e})),this.stats.get(e)}}const nw=new yU;function vU(){const t="9.0.27",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(Yl()&&qe.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:qe,stats:nw}),t}const xU=vU();function bU(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function pp(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:bU(t)}const Rv={};function Jl(t="id"){Rv[t]=Rv[t]||1;const e=Rv[t]++;return`${t}-${e}`}function T_(t){let e=!0;for(const i in t){e=!1;break}return e}var K1;let Pi=(K1=class{constructor(e,i,n){k(this,"id");k(this,"props");k(this,"userData",{});k(this,"_device");k(this,"destroyed",!1);k(this,"allocatedBytes",0);k(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=wU(i,n);const r=this.props.id!=="undefined"?this.props.id:Jl(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get(`${i}s Active`).decrementCount()}trackAllocatedMemory(e,i=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${i} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").subtractCount(this.allocatedBytes),i.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),i=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${i}s Created`).incrementCount(),e.get(`${i}s Active`).incrementCount()}},k(K1,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),K1);function wU(t,e){const i={...e};for(const n in t)t[n]!==void 0&&(i[n]=t[n]);return i}const or=class or extends Pi{constructor(i,n){const r={...n};(n.usage||0)&or.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?r.indexType="uint32":n.data instanceof Uint16Array&&(r.indexType="uint16"));super(i,r,or.defaultProps);k(this,"usage");k(this,"indexType");k(this,"updateTimestamp");k(this,"debugData",new ArrayBuffer(0));this.usage=n.usage||0,this.indexType=r.indexType,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(i,n){throw new Error("not implemented")}_setDebugData(i,n,r){const a=ArrayBuffer.isView(i)?i.buffer:i,u=Math.min(i?i.byteLength:r,or.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(u):n===0&&r===i.byteLength?this.debugData=a.slice(0,u):this.debugData=a.slice(n,n+u)}};k(or,"defaultProps",{...Pi.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),k(or,"MAP_READ",1),k(or,"MAP_WRITE",2),k(or,"COPY_SRC",4),k(or,"COPY_DST",8),k(or,"INDEX",16),k(or,"VERTEX",32),k(or,"UNIFORM",64),k(or,"STORAGE",128),k(or,"INDIRECT",256),k(or,"QUERY_RESOLVE",512),k(or,"DEBUG_DATA_MAX_LENGTH",32);let Zi=or;function WR(t){const e=tS[t],i=AU(e),n=t.includes("norm"),r=!n&&!t.startsWith("float"),a=t.startsWith("s");return{dataType:tS[t],byteLength:i,integer:r,signed:a,normalized:n}}function AU(t){return TU[t]}const tS={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},TU={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},EU=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],SU=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function CU(t){return EU.some(e=>t.startsWith(e))}function XR(t){const e=SU.exec(t);if(e){const[,i,n,r,a,u]=e;if(i){const l=`${r}${n}`,_=WR(l);return{format:i,components:i.length,srgb:a==="-srgb",unsized:u==="-unsized",webgl:u==="-webgl",..._}}}return RU(t)}const IU={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function RU(t){var i;const e=IU[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((i=e.format)==null?void 0:i.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class PU{}class MU{constructor(e=[],i){k(this,"features");k(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=i||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const dp=class dp{constructor(e){k(this,"id");k(this,"props");k(this,"userData",{});k(this,"statsManager",nw);k(this,"_lumaData",{});k(this,"timestamp",0);this.props={...dp.defaultProps,...e},this.id=this.props.id||Jl(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return CU(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,i){throw new Error("not implemented")}readPixelsToBufferWebGL(e,i){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,i){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const i={...e};return(e.usage||0)&Zi.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?i.indexType="uint32":e.data instanceof Uint16Array?i.indexType="uint16":qe.warn("indices buffer content must be of integer type")()),i}};k(dp,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!qe.get("debug"),spector:!!(qe.get("spector")||qe.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>qe.error(e.message)}),k(dp,"VERSION",xU);let Xh=dp;function fi(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const xf=new Map,Oh=class Oh{static registerDevices(e){for(const i of e)fi(i.type&&i.isSupported&&i.create),xf.set(i.type,i)}static getAvailableDevices(){return Array.from(xf).map(e=>e.type)}static getSupportedDevices(){return Array.from(xf).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(Xh.defaultProps,e)}static async attachDevice(e){const i=iS(e.devices)||xf;if(e.handle instanceof WebGL2RenderingContext){const n=i.get("webgl");if(n)return await n.attach(e.handle)}if(e.handle===null){const n=i.get("unknown");if(n)return await n.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var a,u;e={...Oh.defaultProps,...e},e.gl&&(e.type="webgl");const i=iS(e.devices)||xf;let n,r;switch(e.type){case"webgpu":if(n=i.get("webgpu"),n)return await n.create(e);break;case"webgl":if(r=i.get("webgl"),r)return await r.create(e);break;case"unknown":const l=i.get("unknown");if(l)return await l.create(e);break;case"best-available":if(n=i.get("webgpu"),(a=n==null?void 0:n.isSupported)!=null&&a.call(n))return await n.create(e);if(r=i.get("webgl"),(u=r==null?void 0:r.isSupported)!=null&&u.call(r))return await r.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const i=HTMLCanvasElement.prototype;if(!e&&i.originalGetContext){i.getContext=i.originalGetContext,i.originalGetContext=void 0;return}i.originalGetContext=i.getContext,i.getContext=function(n,r){return n==="webgl"||n==="experimental-webgl"?this.originalGetContext("webgl2",r):this.originalGetContext(n,r)}}};k(Oh,"defaultProps",{...Xh.defaultProps,type:"best-available",devices:void 0}),k(Oh,"stats",nw),k(Oh,"log",qe);let Fh=Oh;function iS(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const i of t)e.set(i.type,i);return e}const BU=Yl()&&typeof document<"u",Fy=()=>BU&&document.readyState==="complete",DU={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class rw{constructor(e){k(this,"id");k(this,"props");k(this,"canvas");k(this,"htmlCanvas");k(this,"offscreenCanvas");k(this,"type");k(this,"width",1);k(this,"height",1);k(this,"resizeObserver");k(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...DU,...e},e=this.props,!Yl()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=FU(e.canvas):this.canvas=e.canvas;else{const i=NU(e),n=kU((e==null?void 0:e.container)||null);n.insertBefore(i,n.firstChild),this.canvas=i,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(i=>{for(const n of i)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return Fy()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),i=this.canvas;return i.parentElement?[i.clientWidth*e,i.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,i]=this.getPixelSize();return e/i}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:i}=this._canvasSizeInfo;return i?e/i:1}catch{return 1}}cssToDevicePixels(e,i=!0){const n=this.cssToDeviceRatio(),[r,a]=this.getDrawingBufferSize();return LU(e,n,r,a,i)}setDevicePixelRatio(e,i={}){if(!this.htmlCanvas)return;let n="width"in i?i.width:this.htmlCanvas.clientWidth,r="height"in i?i.height:this.htmlCanvas.clientHeight;(!n||!r)&&(qe.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,r=this.htmlCanvas.height||1);const a=this._canvasSizeInfo;if(a.clientWidth!==n||a.clientHeight!==r||a.devicePixelRatio!==e){let u=e;const l=Math.floor(n*u),_=Math.floor(r*u);this.htmlCanvas.width=l,this.htmlCanvas.height=_;const[w,E]=this.getDrawingBufferSize();(w!==l||E!==_)&&(u=Math.min(w/n,E/r),this.htmlCanvas.width=Math.floor(n*u),this.htmlCanvas.height=Math.floor(r*u),qe.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=r,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var i;((i=this.htmlCanvas)==null?void 0:i.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}k(rw,"pageLoaded",OU());function OU(){return Fy()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function kU(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!Fy())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function FU(t){const e=document.getElementById(t);if(!e&&!Fy())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function NU(t){const{width:e,height:i}=t,n=document.createElement("canvas");return n.id="lumagl-auto-created-canvas",n.width=e||1,n.height=i||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(i)?`${i}px`:"100%",n}function LU(t,e,i,n,r){const a=t,u=nS(a[0],e,i);let l=rS(a[1],e,n,r),_=nS(a[0]+1,e,i);const w=_===i-1?_:_-1;_=rS(a[1]+1,e,n,r);let E;return r?(_=_===0?_:_+1,E=l,l=_):E=_===n-1?_:_-1,{x:u,y:l,width:Math.max(w-u+1,1),height:Math.max(E-l+1,1)}}function nS(t,e,i){return Math.min(Math.round(t*e),i-1)}function rS(t,e,i,n){return n?Math.max(0,i-1-Math.round(t*e)):Math.min(Math.round(t*e),i-1)}const Ta=class Ta extends Pi{constructor(i,n,r=Ta.defaultProps){super(i,n,r);k(this,"dimension");k(this,"format");k(this,"width");k(this,"height");k(this,"depth");k(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=i.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};k(Ta,"defaultProps",{...Pi.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),k(Ta,"COPY_SRC",1),k(Ta,"COPY_DST",2),k(Ta,"TEXTURE_BINDING",4),k(Ta,"STORAGE_BINDING",8),k(Ta,"RENDER_ATTACHMENT",16);let Es=Ta;const my=class my extends Pi{get[Symbol.toStringTag](){return"TextureView"}constructor(e,i){super(e,i,my.defaultProps)}};k(my,"defaultProps",{...Pi.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let E_=my;function UU(t,e,i){let n="";const r=e.split(/\r?\n/),a=t.slice().sort((u,l)=>u.lineNum-l.lineNum);switch((i==null?void 0:i.showSourceCode)||"no"){case"all":let u=0;for(let l=1;l<=r.length;l++)for(n+=qR(r[l-1],l,i);a.length>u&&a[u].lineNum===l;){const _=a[u++];n+=sS(_,r,_.lineNum,{...i,inlineSource:!1})}return n;case"issues":case"no":for(const l of t)n+=sS(l,r,l.lineNum,{inlineSource:(i==null?void 0:i.showSourceCode)!=="no"});return n}}function sS(t,e,i,n){if(n!=null&&n.inlineSource){const r=zU(e,i),a=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${r}${a}${t.type.toUpperCase()}: ${t.message}

`}return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function zU(t,e,i){let n="";for(let r=e-2;r<=e;r++){const a=t[r-1];a!==void 0&&(n+=qR(a,e,i))}return n}function qR(t,e,i){const n=i!=null&&i.html?jU(t):t;return`${VU(String(e),4)}: ${n}${i!=null&&i.html?"<br/>":`
`}`}function VU(t,e){let i="";for(let n=t.length;n<e;++n)i+=" ";return i+t}function jU(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function KR(t,e){return{name:HU(t,e),language:"glsl",version:$U(t)}}function HU(t,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return n?n[1]:e}function $U(t){let e=100;const i=t.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const n=parseInt(i[1],10);Number.isFinite(n)&&(e=n)}return e}const gy=class gy extends Pi{constructor(i,n){super(i,{id:GU(n),...n},gy.defaultProps);k(this,"stage");k(this,"source");k(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(i=this.props.debug){switch(i){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();this.props.debug==="warnings"&&(n==null?void 0:n.length)===0||this._displayShaderLog(n)}_displayShaderLog(i){var w;if(typeof document>"u"||!(document!=null&&document.createElement))return;const n=KR(this.source).name,r=`${this.stage} ${n}`;let a=UU(i,this.source,{showSourceCode:"all",html:!0});const u=this.getTranslatedSource();u&&(a+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${u}</pre></code>`);const l=document.createElement("Button");l.innerHTML=`
<h1>Shader Compilation Error in ${r}</h1><br /><br />
<code style="user-select:text;"><pre>
${a}
</pre></code>`,l.style.top="10px",l.style.left="10px",l.style.position="absolute",l.style.zIndex="9999",l.style.width="100%",l.style.textAlign="left",document.body.appendChild(l);const _=document.getElementsByClassName("luma-compiler-log-error");(w=_[0])!=null&&w.scrollIntoView&&_[0].scrollIntoView(),l.onclick=()=>{const E=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(E)}}};k(gy,"defaultProps",{...Pi.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let S_=gy;function GU(t){return KR(t.source).name||t.id||Jl(`unnamed ${t.stage}-shader`)}const _y=class _y extends Pi{get[Symbol.toStringTag](){return"Sampler"}constructor(e,i){super(e,i,_y.defaultProps)}};k(_y,"defaultProps",{...Pi.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let C_=_y;const yy=class yy extends Pi{constructor(i,n={}){super(i,n,yy.defaultProps);k(this,"width");k(this,"height");k(this,"colorAttachments",[]);k(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(i){let n=!i;if(i){const[r,a]=Array.isArray(i)?i:[i.width,i.height];n=n||a!==this.height||r!==this.width,this.width=r,this.height=a}n&&(qe.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(n=>{if(typeof n=="string"){const r=this.createColorTexture(n);return this.attachResource(r),r.view}return n instanceof Es?n.view:n});const i=this.props.depthStencilAttachment;if(i)if(typeof i=="string"){const n=this.createDepthStencilTexture(i);this.attachResource(n),this.depthStencilAttachment=n.view}else i instanceof Es?this.depthStencilAttachment=i.view:this.depthStencilAttachment=i}createColorTexture(i){return this.device.createTexture({id:"color-attachment",usage:Es.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height})}createDepthStencilTexture(i){return this.device.createTexture({id:"depth-stencil-attachment",usage:Es.RENDER_ATTACHMENT,format:i,width:this.width,height:this.height})}resizeAttachments(i,n){for(let r=0;r<this.colorAttachments.length;++r)if(this.colorAttachments[r]){const a=this.device._createTexture({...this.colorAttachments[r].props,width:i,height:n});this.destroyAttachedResource(this.colorAttachments[r]),this.colorAttachments[r]=a.view,this.attachResource(a.view)}if(this.depthStencilAttachment){const r=this.device._createTexture({...this.depthStencilAttachment.props,width:i,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=r.view,this.attachResource(r)}}};k(yy,"defaultProps",{...Pi.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let I_=yy;const vy=class vy extends Pi{constructor(i,n){super(i,n,vy.defaultProps);k(this,"shaderLayout");k(this,"bufferLayout");k(this,"linkStatus","pending");k(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(i){throw new Error("Use uniform blocks")}};k(vy,"defaultProps",{...Pi.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let qh=vy;const xy=class xy extends Pi{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,i){super(e,i,xy.defaultProps)}};k(xy,"defaultProps",{...Pi.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let rx=xy;const by=class by extends Pi{constructor(i,n){super(i,n,by.defaultProps);k(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};k(by,"defaultProps",{...Pi.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let R_=by;const wy=class wy extends Pi{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,i){super(e,i,wy.defaultProps)}};k(wy,"defaultProps",{...Pi.defaultProps,measureExecutionTime:void 0});let sx=wy;const Ay=class Ay extends Pi{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,i){super(e,i,Ay.defaultProps)}};k(Ay,"defaultProps",{...Pi.defaultProps});let ox=Ay;function WU(t){const[e,i]=qU[t],n=e==="i32"||e==="u32",r=e!=="u32",a=KU[e]*i,u=XU(e,i);return{dataType:e,components:i,defaultVertexFormat:u,byteLength:a,integer:n,signed:r}}function XU(t,e){let i;switch(t){case"f32":i="float32";break;case"i32":i="sint32";break;case"u32":i="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?i:`${i}x${e}`}const qU={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},KU={f32:4,f16:2,i32:4,u32:4};function ZR(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[i,n]=t.split("x"),r=i,a=n?parseInt(n):1,u=WR(r),l={type:r,components:a,byteLength:u.byteLength*a,integer:u.integer,signed:u.signed,normalized:u.normalized};return e&&(l.webglOnly=!0),l}function YR(t,e){const i={};for(const n of t.attributes)i[n.name]=YU(t,e,n.name);return i}function ZU(t,e,i=16){const n=YR(t,e),r=new Array(i).fill(null);for(const a of Object.values(n))r[a.location]=a;return r}function YU(t,e,i){const n=JU(t,i),r=QU(e,i);if(!n)return null;const a=WU(n.type),u=(r==null?void 0:r.vertexFormat)||a.defaultVertexFormat,l=ZR(u);return{attributeName:(r==null?void 0:r.attributeName)||n.name,bufferName:(r==null?void 0:r.bufferName)||n.name,location:n.location,shaderType:n.type,shaderDataType:a.dataType,shaderComponents:a.components,vertexFormat:u,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:a.integer,stepMode:(r==null?void 0:r.stepMode)||n.stepMode,byteOffset:(r==null?void 0:r.byteOffset)||0,byteStride:(r==null?void 0:r.byteStride)||0}}function JU(t,e){const i=t.attributes.find(n=>n.name===e);return i||qe.warn(`shader layout attribute "${e}" not present in shader`),i||null}function QU(t,e){e4(t);let i=t4(t,e);return i||(i=i4(t,e),i)?i:(qe.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function e4(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&qe.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function t4(t,e){for(const i of t)if(i.format&&i.name===e)return{attributeName:i.name,bufferName:e,stepMode:i.stepMode,vertexFormat:i.format,byteOffset:0,byteStride:i.byteStride||0};return null}function i4(t,e){var i;for(const n of t){let r=n.byteStride;if(typeof n.byteStride!="number")for(const u of n.attributes||[]){const l=ZR(u.format);r+=l.byteLength}const a=(i=n.attributes)==null?void 0:i.find(u=>u.attribute===e);if(a)return{attributeName:a.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:a.format,byteOffset:a.byteOffset,byteStride:r}}return null}function n4(t,e){const i={...t,attributes:t.attributes.map(n=>({...n}))};for(const n of(e==null?void 0:e.attributes)||[]){const r=i.attributes.find(a=>a.name===n.name);r?(r.type=n.type||r.type,r.stepMode=n.stepMode||r.stepMode):qe.warn(`shader layout attribute ${n.name} not present in shader`)}return i}const Ty=class Ty extends Pi{constructor(i,n){super(i,n,Ty.defaultProps);k(this,"maxVertexAttributes");k(this,"attributeInfos");k(this,"indexBuffer",null);k(this,"attributes");this.maxVertexAttributes=i.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=ZU(n.renderPipeline.shaderLayout,n.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(i,n){throw new Error("constant attributes not supported")}};k(Ty,"defaultProps",{...Pi.defaultProps,renderPipeline:null});let ax=Ty;const Ey=class Ey extends Pi{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,i){super(e,i,Ey.defaultProps)}};k(Ey,"defaultProps",{...Pi.defaultProps,layout:void 0,buffers:{}});let lx=Ey;const Sy=class Sy extends Pi{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,i){super(e,i,Sy.defaultProps)}};k(Sy,"defaultProps",{...Pi.defaultProps,type:void 0,count:void 0});let cx=Sy;const r4={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function s4(t){const e=r4[t];return fi(t),e}function o4(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let og;function JR(t){return(!og||og.byteLength<t)&&(og=new ArrayBuffer(t)),og}function a4(t,e){const i=JR(t.BYTES_PER_ELEMENT*e);return new t(i,0,e)}function l4(t){const{target:e,source:i,start:n=0,count:r=1}=t,a=i.length,u=r*a;let l=0;for(let _=n;l<a;l++)e[_++]=i[l];for(;l<u;)l<u-l?(e.copyWithin(n+l,n,n+l),l*=2):(e.copyWithin(n+l,n,n+u-l),l=u);return t.target}const oS=1024;class c4{constructor(e){k(this,"layout",{});k(this,"byteLength");let i=0;for(const[r,a]of Object.entries(e)){const u=s4(a),{type:l,components:_}=u;i=o4(i,_);const w=i;i+=_,this.layout[r]={type:l,size:_,offset:w}}i+=(4-i%4)%4;const n=i*4;this.byteLength=Math.max(n,oS)}getData(e){const i=Math.max(this.byteLength,oS),n=JR(i),r={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[a,u]of Object.entries(e)){const l=this.layout[a];if(!l){qe.warn(`Supplied uniform value ${a} not present in uniform block layout`)();continue}const{type:_,size:w,offset:E}=l,I=r[_];if(w===1){if(typeof u!="number"&&typeof u!="boolean"){qe.warn(`Supplied value for single component uniform ${a} is not a number: ${u}`)();continue}I[E]=Number(u)}else{const R=pp(u);if(!R){qe.warn(`Supplied value for multi component / array uniform ${a} is not a numeric array: ${u}`)();continue}I.set(R,E)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function u4(t,e,i=16){if(t!==e)return!1;const n=pp(t);if(!n)return!1;const r=pp(e);if(r&&n.length===r.length){for(let a=0;a<n.length;++a)if(r[a]!==n[a])return!1}return!0}function h4(t){const e=pp(t);return e?e.slice():t}class d4{constructor(e){k(this,"name");k(this,"uniforms",{});k(this,"modifiedUniforms",{});k(this,"modified",!0);k(this,"bindingLayout",{});k(this,"needsRedraw","initialized");var i;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const n=(i=e==null?void 0:e.shaderLayout.bindings)==null?void 0:i.find(a=>a.type==="uniform"&&a.name===(e==null?void 0:e.name));if(!n)throw new Error(e==null?void 0:e.name);const r=n;for(const a of r.uniforms||[])this.bindingLayout[a.name]=a}}setUniforms(e){for(const[i,n]of Object.entries(e))this._setUniform(i,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${i}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,i){u4(this.uniforms[e],i)||(this.uniforms[e]=h4(i),this.modifiedUniforms[e]=!0,this.modified=!0)}}class f4{constructor(e){k(this,"uniformBlocks",new Map);k(this,"uniformBufferLayouts",new Map);k(this,"uniformBuffers",new Map);for(const[i,n]of Object.entries(e)){const r=i,a=new c4(n.uniformTypes||{});this.uniformBufferLayouts.set(r,a);const u=new d4({name:i});u.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(r,u)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[i,n]of Object.entries(e))this.uniformBlocks.get(i).setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const i=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(i)}createUniformBuffer(e,i,n){n&&this.setUniforms(n);const r=this.getUniformBufferByteLength(i),a=e.createBuffer({usage:Zi.UNIFORM|Zi.COPY_DST,byteLength:r}),u=this.getUniformBufferData(i);return a.write(u),a}getManagedUniformBuffer(e,i){if(!this.uniformBuffers.get(i)){const n=this.getUniformBufferByteLength(i),r=e.createBuffer({usage:Zi.UNIFORM|Zi.COPY_DST,byteLength:n});this.uniformBuffers.set(i,r)}return this.uniformBuffers.get(i)}updateUniformBuffers(){let e=!1;for(const i of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(i);e||(e=n)}return e&&qe.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const i=this.uniformBlocks.get(e),n=this.uniformBuffers.get(e);let r=!1;if(n&&i.needsRedraw){r||(r=i.needsRedraw);const a=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(a);const l=this.uniformBlocks.get(e).getAllUniforms();qe.log(4,`Writing to uniform buffer ${String(e)}`,a,l)()}return r}}function QR(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function eP(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function p4(t,e,i){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let r=QR(t);if(r==="uint8"&&i&&n===1)return"unorm8-webgl";if(r==="uint8"&&i&&n===3)return"unorm8x3-webgl";if(r==="uint8"||r==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return i&&(r=r.replace("int","norm")),`${r}x${n}`}if(r==="uint16"||r==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return i&&(r=r.replace("int","norm")),`${r}x${n}`}return n===1?r:`${r}x${n}`}function m4(t){return pp(t)!==null||typeof t=="number"||typeof t=="boolean"}function sw(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(i=>{const n=t[i];m4(n)?e.uniforms[i]=n:e.bindings[i]=n}),e}function g4(t,e,i){const{removedProps:n={},deprecatedProps:r={},replacedProps:a={}}=i;for(const l in n)if(l in e){const w=n[l]?`${t}.${n[l]}`:"N/A";qe.removed(`${t}.${l}`,w)()}for(const l in r)if(l in e){const _=r[l];qe.deprecated(`${t}.${l}`,`${t}.${_}`)()}let u=null;for(const[l,_]of Object.entries(a))l in e&&(qe.deprecated(`${t}.${l}`,`${t}.${_}`)(),u=u||Object.assign({},e),u[_]=e[l],delete u[l]);return u||e}let _4="";async function y4(t,e){return await new Promise((i,n)=>{try{const r=new Image;r.onload=()=>i(r),r.onerror=()=>n(new Error(`Could not load image ${t}.`)),r.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",r.src=t.startsWith("http")?t:_4+t}catch(r){n(r)}})}async function tP(t,e){const i=document.getElementsByTagName("head")[0];if(!i)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",t),new Promise((r,a)=>{n.onload=r,n.onerror=u=>a(new Error(`Unable to load script '${t}': ${u}`)),i.appendChild(n)})}function ux(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!ux(t[n],e[n],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const a of n)if(!e.hasOwnProperty(a)||!ux(t[a],e[a],i-1))return!1;return!0}return!1}function v4(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function x4(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class b4{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Ua{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,i){if(e){i(P_.instance);for(const n of e)n instanceof Array?this.searchBlock(n,i):n.search(i);i(M_.instance)}}}class P_ extends Ua{}P_.instance=new P_;class M_ extends Ua{}M_.instance=new M_;class Yi extends Ua{constructor(){super()}}class hx extends Yi{constructor(e,i,n,r,a,u){super(),this.calls=new Set,this.name=e,this.args=i,this.returnType=n,this.body=r,this.startLine=a,this.endLine=u}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class w4 extends Yi{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class A4 extends Yi{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class T4 extends Yi{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class E4 extends Yi{constructor(e,i,n,r){super(),this.init=e,this.condition=i,this.increment=n,this.body=r}get astNodeType(){return"for"}search(e){var i,n,r;(i=this.init)===null||i===void 0||i.search(e),(n=this.condition)===null||n===void 0||n.search(e),(r=this.increment)===null||r===void 0||r.search(e),this.searchBlock(this.body,e)}}class kc extends Yi{constructor(e,i,n,r,a){super(),this.name=e,this.type=i,this.storage=n,this.access=r,this.value=a}get astNodeType(){return"var"}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}class iP extends Yi{constructor(e,i,n){super(),this.name=e,this.type=i,this.value=n}get astNodeType(){return"override"}search(e){var i;(i=this.value)===null||i===void 0||i.search(e)}}class dx extends Yi{constructor(e,i,n,r,a){super(),this.name=e,this.type=i,this.storage=n,this.access=r,this.value=a}get astNodeType(){return"let"}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}class aS extends Yi{constructor(e,i,n,r,a){super(),this.name=e,this.type=i,this.storage=n,this.access=r,this.value=a}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var i;e(this),(i=this.value)===null||i===void 0||i.search(e)}}var Kh;(function(t){t.increment="++",t.decrement="--"})(Kh||(Kh={}));(function(t){function e(i){const n=i;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}t.parse=e})(Kh||(Kh={}));class S4 extends Yi{constructor(e,i){super(),this.operator=e,this.variable=i}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var mp;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(mp||(mp={}));(function(t){function e(i){const n=i;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}t.parse=e})(mp||(mp={}));class C4 extends Yi{constructor(e,i,n){super(),this.operator=e,this.variable=i,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class nP extends Yi{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"call"}search(e){for(const i of this.args)i.search(e);e(this)}}class I4 extends Yi{constructor(e,i){super(),this.body=e,this.continuing=i}get astNodeType(){return"loop"}}class R4 extends Yi{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"body"}}let P4=class extends Yi{constructor(e,i,n,r){super(),this.condition=e,this.body=i,this.elseif=n,this.else=r}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}};class M4 extends Yi{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var i;(i=this.value)===null||i===void 0||i.search(e)}}class B4 extends Yi{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class D4 extends Yi{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class O4 extends Yi{constructor(e,i){super(),this.severity=e,this.rule=i}get astNodeType(){return"diagnostic"}}class rP extends Yi{constructor(e,i){super(),this.name=e,this.type=i}get astNodeType(){return"alias"}}class k4 extends Yi{constructor(){super()}get astNodeType(){return"discard"}}class F4 extends Yi{constructor(){super()}get astNodeType(){return"break"}}class N4 extends Yi{constructor(){super()}get astNodeType(){return"continue"}}class au extends Yi{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Bc extends au{constructor(e,i,n,r){super(e),this.members=i,this.startLine=n,this.endLine=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let i=0;i<this.members.length;i++)if(this.members[i].name==e)return i;return-1}}class sP extends au{constructor(e,i,n){super(e),this.format=i,this.access=n}get astNodeType(){return"template"}}class L4 extends au{constructor(e,i,n,r){super(e),this.storage=i,this.type=n,this.access=r}get astNodeType(){return"pointer"}}class oP extends au{constructor(e,i,n,r){super(e),this.attributes=i,this.format=n,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class zf extends au{constructor(e,i,n){super(e),this.format=i,this.access=n}get astNodeType(){return"sampler"}}class So extends Ua{constructor(){super()}}class lS extends So{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class ph extends So{constructor(e,i){super(),this.type=e,this.args=i}get astNodeType(){return"createExpr"}search(e){e(this);for(const i of this.args)i.search(e)}}class aP extends So{constructor(e,i){super(),this.name=e,this.args=i}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const i of this.args)i.search(e);e(this)}}class fx extends So{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const i=e.constants.get(this.name);if(!i)throw new Error("Cannot evaluate node");return i.evaluate(e)}}class cS extends So{constructor(e,i){super(),this.name=e,this.initializer=i}get astNodeType(){return"constExpr"}evaluate(e){var i,n;if(this.initializer instanceof ph){const r=(i=this.postfix)===null||i===void 0?void 0:i.evaluateString(e),a=(n=this.initializer.type)===null||n===void 0?void 0:n.name,u=e.structs.get(a),l=u==null?void 0:u.getMemberIndex(r);if(l!=-1)return this.initializer.args[l].evaluate(e);console.log(l)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class uS extends So{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class U4 extends So{constructor(e,i){super(),this.type=e,this.value=i}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class z4 extends So{constructor(e,i){super(),this.type=e,this.args=i}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}search(e){this.searchBlock(this.args,e)}}class hS extends So{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class V4 extends So{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class lP extends So{constructor(){super()}}class j4 extends lP{constructor(e,i){super(),this.operator=e,this.right=i}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class zo extends lP{constructor(e,i,n){super(),this.operator=e,this.left=i,this.right=n}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class cP extends Ua{constructor(){super()}}class H4 extends cP{constructor(e,i){super(),this.selector=e,this.body=i}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class $4 extends cP{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class G4 extends Ua{constructor(e,i,n){super(),this.name=e,this.type=i,this.attributes=n}get astNodeType(){return"argument"}}class W4 extends Ua{constructor(e,i){super(),this.condition=e,this.body=i}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class X4 extends Ua{constructor(e,i,n){super(),this.name=e,this.type=i,this.attributes=n}get astNodeType(){return"member"}}let q4=class extends Ua{constructor(e,i){super(),this.name=e,this.value=i}get astNodeType(){return"attribute"}};var Re,we;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(we||(we={}));class Ae{constructor(e,i,n){this.name=e,this.type=i,this.rule=n}toString(){return this.name}}class ie{}Re=ie;ie.none=new Ae("",we.reserved,"");ie.eof=new Ae("EOF",we.token,"");ie.reserved={asm:new Ae("asm",we.reserved,"asm"),bf16:new Ae("bf16",we.reserved,"bf16"),do:new Ae("do",we.reserved,"do"),enum:new Ae("enum",we.reserved,"enum"),f16:new Ae("f16",we.reserved,"f16"),f64:new Ae("f64",we.reserved,"f64"),handle:new Ae("handle",we.reserved,"handle"),i8:new Ae("i8",we.reserved,"i8"),i16:new Ae("i16",we.reserved,"i16"),i64:new Ae("i64",we.reserved,"i64"),mat:new Ae("mat",we.reserved,"mat"),premerge:new Ae("premerge",we.reserved,"premerge"),regardless:new Ae("regardless",we.reserved,"regardless"),typedef:new Ae("typedef",we.reserved,"typedef"),u8:new Ae("u8",we.reserved,"u8"),u16:new Ae("u16",we.reserved,"u16"),u64:new Ae("u64",we.reserved,"u64"),unless:new Ae("unless",we.reserved,"unless"),using:new Ae("using",we.reserved,"using"),vec:new Ae("vec",we.reserved,"vec"),void:new Ae("void",we.reserved,"void")};ie.keywords={array:new Ae("array",we.keyword,"array"),atomic:new Ae("atomic",we.keyword,"atomic"),bool:new Ae("bool",we.keyword,"bool"),f32:new Ae("f32",we.keyword,"f32"),i32:new Ae("i32",we.keyword,"i32"),mat2x2:new Ae("mat2x2",we.keyword,"mat2x2"),mat2x3:new Ae("mat2x3",we.keyword,"mat2x3"),mat2x4:new Ae("mat2x4",we.keyword,"mat2x4"),mat3x2:new Ae("mat3x2",we.keyword,"mat3x2"),mat3x3:new Ae("mat3x3",we.keyword,"mat3x3"),mat3x4:new Ae("mat3x4",we.keyword,"mat3x4"),mat4x2:new Ae("mat4x2",we.keyword,"mat4x2"),mat4x3:new Ae("mat4x3",we.keyword,"mat4x3"),mat4x4:new Ae("mat4x4",we.keyword,"mat4x4"),ptr:new Ae("ptr",we.keyword,"ptr"),sampler:new Ae("sampler",we.keyword,"sampler"),sampler_comparison:new Ae("sampler_comparison",we.keyword,"sampler_comparison"),struct:new Ae("struct",we.keyword,"struct"),texture_1d:new Ae("texture_1d",we.keyword,"texture_1d"),texture_2d:new Ae("texture_2d",we.keyword,"texture_2d"),texture_2d_array:new Ae("texture_2d_array",we.keyword,"texture_2d_array"),texture_3d:new Ae("texture_3d",we.keyword,"texture_3d"),texture_cube:new Ae("texture_cube",we.keyword,"texture_cube"),texture_cube_array:new Ae("texture_cube_array",we.keyword,"texture_cube_array"),texture_multisampled_2d:new Ae("texture_multisampled_2d",we.keyword,"texture_multisampled_2d"),texture_storage_1d:new Ae("texture_storage_1d",we.keyword,"texture_storage_1d"),texture_storage_2d:new Ae("texture_storage_2d",we.keyword,"texture_storage_2d"),texture_storage_2d_array:new Ae("texture_storage_2d_array",we.keyword,"texture_storage_2d_array"),texture_storage_3d:new Ae("texture_storage_3d",we.keyword,"texture_storage_3d"),texture_depth_2d:new Ae("texture_depth_2d",we.keyword,"texture_depth_2d"),texture_depth_2d_array:new Ae("texture_depth_2d_array",we.keyword,"texture_depth_2d_array"),texture_depth_cube:new Ae("texture_depth_cube",we.keyword,"texture_depth_cube"),texture_depth_cube_array:new Ae("texture_depth_cube_array",we.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Ae("texture_depth_multisampled_2d",we.keyword,"texture_depth_multisampled_2d"),texture_external:new Ae("texture_external",we.keyword,"texture_external"),u32:new Ae("u32",we.keyword,"u32"),vec2:new Ae("vec2",we.keyword,"vec2"),vec3:new Ae("vec3",we.keyword,"vec3"),vec4:new Ae("vec4",we.keyword,"vec4"),bitcast:new Ae("bitcast",we.keyword,"bitcast"),block:new Ae("block",we.keyword,"block"),break:new Ae("break",we.keyword,"break"),case:new Ae("case",we.keyword,"case"),continue:new Ae("continue",we.keyword,"continue"),continuing:new Ae("continuing",we.keyword,"continuing"),default:new Ae("default",we.keyword,"default"),diagnostic:new Ae("diagnostic",we.keyword,"diagnostic"),discard:new Ae("discard",we.keyword,"discard"),else:new Ae("else",we.keyword,"else"),enable:new Ae("enable",we.keyword,"enable"),fallthrough:new Ae("fallthrough",we.keyword,"fallthrough"),false:new Ae("false",we.keyword,"false"),fn:new Ae("fn",we.keyword,"fn"),for:new Ae("for",we.keyword,"for"),function:new Ae("function",we.keyword,"function"),if:new Ae("if",we.keyword,"if"),let:new Ae("let",we.keyword,"let"),const:new Ae("const",we.keyword,"const"),loop:new Ae("loop",we.keyword,"loop"),while:new Ae("while",we.keyword,"while"),private:new Ae("private",we.keyword,"private"),read:new Ae("read",we.keyword,"read"),read_write:new Ae("read_write",we.keyword,"read_write"),return:new Ae("return",we.keyword,"return"),requires:new Ae("requires",we.keyword,"requires"),storage:new Ae("storage",we.keyword,"storage"),switch:new Ae("switch",we.keyword,"switch"),true:new Ae("true",we.keyword,"true"),alias:new Ae("alias",we.keyword,"alias"),type:new Ae("type",we.keyword,"type"),uniform:new Ae("uniform",we.keyword,"uniform"),var:new Ae("var",we.keyword,"var"),override:new Ae("override",we.keyword,"override"),workgroup:new Ae("workgroup",we.keyword,"workgroup"),write:new Ae("write",we.keyword,"write"),r8unorm:new Ae("r8unorm",we.keyword,"r8unorm"),r8snorm:new Ae("r8snorm",we.keyword,"r8snorm"),r8uint:new Ae("r8uint",we.keyword,"r8uint"),r8sint:new Ae("r8sint",we.keyword,"r8sint"),r16uint:new Ae("r16uint",we.keyword,"r16uint"),r16sint:new Ae("r16sint",we.keyword,"r16sint"),r16float:new Ae("r16float",we.keyword,"r16float"),rg8unorm:new Ae("rg8unorm",we.keyword,"rg8unorm"),rg8snorm:new Ae("rg8snorm",we.keyword,"rg8snorm"),rg8uint:new Ae("rg8uint",we.keyword,"rg8uint"),rg8sint:new Ae("rg8sint",we.keyword,"rg8sint"),r32uint:new Ae("r32uint",we.keyword,"r32uint"),r32sint:new Ae("r32sint",we.keyword,"r32sint"),r32float:new Ae("r32float",we.keyword,"r32float"),rg16uint:new Ae("rg16uint",we.keyword,"rg16uint"),rg16sint:new Ae("rg16sint",we.keyword,"rg16sint"),rg16float:new Ae("rg16float",we.keyword,"rg16float"),rgba8unorm:new Ae("rgba8unorm",we.keyword,"rgba8unorm"),rgba8unorm_srgb:new Ae("rgba8unorm_srgb",we.keyword,"rgba8unorm_srgb"),rgba8snorm:new Ae("rgba8snorm",we.keyword,"rgba8snorm"),rgba8uint:new Ae("rgba8uint",we.keyword,"rgba8uint"),rgba8sint:new Ae("rgba8sint",we.keyword,"rgba8sint"),bgra8unorm:new Ae("bgra8unorm",we.keyword,"bgra8unorm"),bgra8unorm_srgb:new Ae("bgra8unorm_srgb",we.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Ae("rgb10a2unorm",we.keyword,"rgb10a2unorm"),rg11b10float:new Ae("rg11b10float",we.keyword,"rg11b10float"),rg32uint:new Ae("rg32uint",we.keyword,"rg32uint"),rg32sint:new Ae("rg32sint",we.keyword,"rg32sint"),rg32float:new Ae("rg32float",we.keyword,"rg32float"),rgba16uint:new Ae("rgba16uint",we.keyword,"rgba16uint"),rgba16sint:new Ae("rgba16sint",we.keyword,"rgba16sint"),rgba16float:new Ae("rgba16float",we.keyword,"rgba16float"),rgba32uint:new Ae("rgba32uint",we.keyword,"rgba32uint"),rgba32sint:new Ae("rgba32sint",we.keyword,"rgba32sint"),rgba32float:new Ae("rgba32float",we.keyword,"rgba32float"),static_assert:new Ae("static_assert",we.keyword,"static_assert")};ie.tokens={decimal_float_literal:new Ae("decimal_float_literal",we.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new Ae("hex_float_literal",we.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new Ae("int_literal",we.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Ae("uint_literal",we.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new Ae("ident",we.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Ae("and",we.token,"&"),and_and:new Ae("and_and",we.token,"&&"),arrow:new Ae("arrow ",we.token,"->"),attr:new Ae("attr",we.token,"@"),forward_slash:new Ae("forward_slash",we.token,"/"),bang:new Ae("bang",we.token,"!"),bracket_left:new Ae("bracket_left",we.token,"["),bracket_right:new Ae("bracket_right",we.token,"]"),brace_left:new Ae("brace_left",we.token,"{"),brace_right:new Ae("brace_right",we.token,"}"),colon:new Ae("colon",we.token,":"),comma:new Ae("comma",we.token,","),equal:new Ae("equal",we.token,"="),equal_equal:new Ae("equal_equal",we.token,"=="),not_equal:new Ae("not_equal",we.token,"!="),greater_than:new Ae("greater_than",we.token,">"),greater_than_equal:new Ae("greater_than_equal",we.token,">="),shift_right:new Ae("shift_right",we.token,">>"),less_than:new Ae("less_than",we.token,"<"),less_than_equal:new Ae("less_than_equal",we.token,"<="),shift_left:new Ae("shift_left",we.token,"<<"),modulo:new Ae("modulo",we.token,"%"),minus:new Ae("minus",we.token,"-"),minus_minus:new Ae("minus_minus",we.token,"--"),period:new Ae("period",we.token,"."),plus:new Ae("plus",we.token,"+"),plus_plus:new Ae("plus_plus",we.token,"++"),or:new Ae("or",we.token,"|"),or_or:new Ae("or_or",we.token,"||"),paren_left:new Ae("paren_left",we.token,"("),paren_right:new Ae("paren_right",we.token,")"),semicolon:new Ae("semicolon",we.token,";"),star:new Ae("star",we.token,"*"),tilde:new Ae("tilde",we.token,"~"),underscore:new Ae("underscore",we.token,"_"),xor:new Ae("xor",we.token,"^"),plus_equal:new Ae("plus_equal",we.token,"+="),minus_equal:new Ae("minus_equal",we.token,"-="),times_equal:new Ae("times_equal",we.token,"*="),division_equal:new Ae("division_equal",we.token,"/="),modulo_equal:new Ae("modulo_equal",we.token,"%="),and_equal:new Ae("and_equal",we.token,"&="),or_equal:new Ae("or_equal",we.token,"|="),xor_equal:new Ae("xor_equal",we.token,"^="),shift_right_equal:new Ae("shift_right_equal",we.token,">>="),shift_left_equal:new Ae("shift_left_equal",we.token,"<<=")};ie.simpleTokens={"@":Re.tokens.attr,"{":Re.tokens.brace_left,"}":Re.tokens.brace_right,":":Re.tokens.colon,",":Re.tokens.comma,"(":Re.tokens.paren_left,")":Re.tokens.paren_right,";":Re.tokens.semicolon};ie.literalTokens={"&":Re.tokens.and,"&&":Re.tokens.and_and,"->":Re.tokens.arrow,"/":Re.tokens.forward_slash,"!":Re.tokens.bang,"[":Re.tokens.bracket_left,"]":Re.tokens.bracket_right,"=":Re.tokens.equal,"==":Re.tokens.equal_equal,"!=":Re.tokens.not_equal,">":Re.tokens.greater_than,">=":Re.tokens.greater_than_equal,">>":Re.tokens.shift_right,"<":Re.tokens.less_than,"<=":Re.tokens.less_than_equal,"<<":Re.tokens.shift_left,"%":Re.tokens.modulo,"-":Re.tokens.minus,"--":Re.tokens.minus_minus,".":Re.tokens.period,"+":Re.tokens.plus,"++":Re.tokens.plus_plus,"|":Re.tokens.or,"||":Re.tokens.or_or,"*":Re.tokens.star,"~":Re.tokens.tilde,_:Re.tokens.underscore,"^":Re.tokens.xor,"+=":Re.tokens.plus_equal,"-=":Re.tokens.minus_equal,"*=":Re.tokens.times_equal,"/=":Re.tokens.division_equal,"%=":Re.tokens.modulo_equal,"&=":Re.tokens.and_equal,"|=":Re.tokens.or_equal,"^=":Re.tokens.xor_equal,">>=":Re.tokens.shift_right_equal,"<<=":Re.tokens.shift_left_equal};ie.regexTokens={decimal_float_literal:Re.tokens.decimal_float_literal,hex_float_literal:Re.tokens.hex_float_literal,int_literal:Re.tokens.int_literal,uint_literal:Re.tokens.uint_literal,ident:Re.tokens.ident};ie.storage_class=[Re.keywords.function,Re.keywords.private,Re.keywords.workgroup,Re.keywords.uniform,Re.keywords.storage];ie.access_mode=[Re.keywords.read,Re.keywords.write,Re.keywords.read_write];ie.sampler_type=[Re.keywords.sampler,Re.keywords.sampler_comparison];ie.sampled_texture_type=[Re.keywords.texture_1d,Re.keywords.texture_2d,Re.keywords.texture_2d_array,Re.keywords.texture_3d,Re.keywords.texture_cube,Re.keywords.texture_cube_array];ie.multisampled_texture_type=[Re.keywords.texture_multisampled_2d];ie.storage_texture_type=[Re.keywords.texture_storage_1d,Re.keywords.texture_storage_2d,Re.keywords.texture_storage_2d_array,Re.keywords.texture_storage_3d];ie.depth_texture_type=[Re.keywords.texture_depth_2d,Re.keywords.texture_depth_2d_array,Re.keywords.texture_depth_cube,Re.keywords.texture_depth_cube_array,Re.keywords.texture_depth_multisampled_2d];ie.texture_external_type=[Re.keywords.texture_external];ie.any_texture_type=[...Re.sampled_texture_type,...Re.multisampled_texture_type,...Re.storage_texture_type,...Re.depth_texture_type,...Re.texture_external_type];ie.texel_format=[Re.keywords.r8unorm,Re.keywords.r8snorm,Re.keywords.r8uint,Re.keywords.r8sint,Re.keywords.r16uint,Re.keywords.r16sint,Re.keywords.r16float,Re.keywords.rg8unorm,Re.keywords.rg8snorm,Re.keywords.rg8uint,Re.keywords.rg8sint,Re.keywords.r32uint,Re.keywords.r32sint,Re.keywords.r32float,Re.keywords.rg16uint,Re.keywords.rg16sint,Re.keywords.rg16float,Re.keywords.rgba8unorm,Re.keywords.rgba8unorm_srgb,Re.keywords.rgba8snorm,Re.keywords.rgba8uint,Re.keywords.rgba8sint,Re.keywords.bgra8unorm,Re.keywords.bgra8unorm_srgb,Re.keywords.rgb10a2unorm,Re.keywords.rg11b10float,Re.keywords.rg32uint,Re.keywords.rg32sint,Re.keywords.rg32float,Re.keywords.rgba16uint,Re.keywords.rgba16sint,Re.keywords.rgba16float,Re.keywords.rgba32uint,Re.keywords.rgba32sint,Re.keywords.rgba32float];ie.const_literal=[Re.tokens.int_literal,Re.tokens.uint_literal,Re.tokens.decimal_float_literal,Re.tokens.hex_float_literal,Re.keywords.true,Re.keywords.false];ie.literal_or_ident=[Re.tokens.ident,Re.tokens.int_literal,Re.tokens.uint_literal,Re.tokens.decimal_float_literal,Re.tokens.hex_float_literal];ie.element_count_expression=[Re.tokens.int_literal,Re.tokens.uint_literal,Re.tokens.ident];ie.template_types=[Re.keywords.vec2,Re.keywords.vec3,Re.keywords.vec4,Re.keywords.mat2x2,Re.keywords.mat2x3,Re.keywords.mat2x4,Re.keywords.mat3x2,Re.keywords.mat3x3,Re.keywords.mat3x4,Re.keywords.mat4x2,Re.keywords.mat4x3,Re.keywords.mat4x4,Re.keywords.atomic,Re.keywords.bitcast,...Re.any_texture_type];ie.attribute_name=[Re.tokens.ident,Re.keywords.block,Re.keywords.diagnostic];ie.assignment_operators=[Re.tokens.equal,Re.tokens.plus_equal,Re.tokens.minus_equal,Re.tokens.times_equal,Re.tokens.division_equal,Re.tokens.modulo_equal,Re.tokens.and_equal,Re.tokens.or_equal,Re.tokens.xor_equal,Re.tokens.shift_right_equal,Re.tokens.shift_left_equal];ie.increment_operators=[Re.tokens.plus_plus,Re.tokens.minus_minus];class dS{constructor(e,i,n){this.type=e,this.lexeme=i,this.line=n}toString(){return this.lexeme}isTemplateType(){return ie.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==ie.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class K4{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new dS(ie.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let u=1;for(;u>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),u--,u==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),u++)}return!0}}const i=ie.simpleTokens[e];if(i)return this._addToken(i),!0;let n=ie.none;const r=this._isAlpha(e),a=e==="_";if(this._isAlphaNumeric(e)){let u=this._peekAhead();for(;this._isAlphaNumeric(u);)e+=this._advance(),u=this._peekAhead()}if(r){const u=ie.keywords[e];if(u)return this._addToken(u),!0}if(r||a)return this._addToken(ie.tokens.ident),!0;for(;;){let u=this._findType(e);const l=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(l=="=")return this._current++,e+=l,this._addToken(ie.tokens.minus_equal),!0;if(l=="-")return this._current++,e+=l,this._addToken(ie.tokens.minus_minus),!0;const _=this._tokens.length-1;if((ie.literal_or_ident.indexOf(this._tokens[_].type)!=-1||this._tokens[_].type==ie.tokens.paren_right)&&l!=">")return this._addToken(u),!0}if(e==">"&&(l==">"||l=="=")){let _=!1,w=this._tokens.length-1;for(let E=0;E<5&&w>=0&&ie.assignment_operators.indexOf(this._tokens[w].type)===-1;++E,--w)if(this._tokens[w].type===ie.tokens.less_than){w>0&&this._tokens[w-1].isArrayOrTemplateType()&&(_=!0);break}if(_)return this._addToken(u),!0}if(u===ie.none){let _=e,w=0;const E=2;for(let I=0;I<E;++I)if(_+=this._peekAhead(I),u=this._findType(_),u!==ie.none){w=I;break}if(u===ie.none)return n===ie.none?!1:(this._current--,this._addToken(n),!0);e=_,this._current+=w+1}if(n=u,this._isAtEnd())break;e+=this._advance()}return n===ie.none?!1:(this._addToken(n),!0)}_findType(e){for(const n in ie.regexTokens){const r=ie.regexTokens[n];if(this._match(e,r.rule))return r}const i=ie.literalTokens[e];return i||ie.none}_match(e,i){const n=i.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let i=this._source[this._current];return e=e||0,e++,this._current+=e,i}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const i=this._source.substring(this._start,this._current);this._tokens.push(new dS(e,i,this._line))}}class Z4{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new b4,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const i=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;i.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const r=n.arrayType,a=n.countNode;if(a instanceof fx){const l=a.name,_=this._context.constants.get(l);if(_)try{const w=_.evaluate(this._context);r.count=w}catch{}}}this._deferArrayCountEval.length=0}return i}_initialize(e){if(e)if(typeof e=="string"){const i=new K4(e);this._tokens=i.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,i){return{token:e,message:i,toString:function(){return`${i}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ie.eof}_match(e){if(e instanceof Ae)return this._check(e)?(this._advance(),!0):!1;for(let i=0,n=e.length;i<n;++i){const r=e[i];if(this._check(r))return this._advance(),!0}return!1}_consume(e,i){if(this._check(e))return this._advance();throw this._error(this._peek(),i)}_check(e){if(this._isAtEnd())return!1;const i=this._peek();if(e instanceof Array){const n=i.type;return e.indexOf(n)!=-1}return i.type==e}_advance(){var e,i;return this._currentLine=(i=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&i!==void 0?i:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ie.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ie.keywords.alias)){const i=this._type_alias();return this._consume(ie.tokens.semicolon,"Expected ';'"),i}if(this._match(ie.keywords.diagnostic)){const i=this._diagnostic();return this._consume(ie.tokens.semicolon,"Expected ';'"),i}if(this._match(ie.keywords.requires)){const i=this._requires_directive();return this._consume(ie.tokens.semicolon,"Expected ';'"),i}if(this._match(ie.keywords.enable)){const i=this._enable_directive();return this._consume(ie.tokens.semicolon,"Expected ';'"),i}const e=this._attribute();if(this._check(ie.keywords.var)){const i=this._global_variable_decl();return i!=null&&(i.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),i}if(this._check(ie.keywords.override)){const i=this._override_variable_decl();return i!=null&&(i.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),i}if(this._check(ie.keywords.let)){const i=this._global_let_decl();return i!=null&&(i.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),i}if(this._check(ie.keywords.const)){const i=this._global_const_decl();return i!=null&&(i.attributes=e),this._consume(ie.tokens.semicolon,"Expected ';'."),i}if(this._check(ie.keywords.struct)){const i=this._struct_decl();return i!=null&&(i.attributes=e),i}if(this._check(ie.keywords.fn)){const i=this._function_decl();return i!=null&&(i.attributes=e),i}return null}_function_decl(){if(!this._match(ie.keywords.fn))return null;const e=this._currentLine,i=this._consume(ie.tokens.ident,"Expected function name.").toString();this._consume(ie.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(ie.tokens.paren_right))do{if(this._check(ie.tokens.paren_right))break;const l=this._attribute(),_=this._consume(ie.tokens.ident,"Expected argument name.").toString();this._consume(ie.tokens.colon,"Expected ':' for argument type.");const w=this._attribute(),E=this._type_decl();E!=null&&(E.attributes=w,n.push(new G4(_,E,l)))}while(this._match(ie.tokens.comma));this._consume(ie.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(ie.tokens.arrow)){const l=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=l)}const a=this._compound_statement(),u=this._currentLine;return new hx(i,n,r,a,e,u)}_compound_statement(){const e=[];for(this._consume(ie.tokens.brace_left,"Expected '{' for block.");!this._check(ie.tokens.brace_right);){const i=this._statement();i!==null&&e.push(i)}return this._consume(ie.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ie.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ie.tokens.attr)&&this._attribute(),this._check(ie.keywords.if))return this._if_statement();if(this._check(ie.keywords.switch))return this._switch_statement();if(this._check(ie.keywords.loop))return this._loop_statement();if(this._check(ie.keywords.for))return this._for_statement();if(this._check(ie.keywords.while))return this._while_statement();if(this._check(ie.keywords.continuing))return this._continuing_statement();if(this._check(ie.keywords.static_assert))return this._static_assert_statement();if(this._check(ie.tokens.brace_left))return this._compound_statement();let e=null;return this._check(ie.keywords.return)?e=this._return_statement():this._check([ie.keywords.var,ie.keywords.let,ie.keywords.const])?e=this._variable_statement():this._match(ie.keywords.discard)?e=new k4:this._match(ie.keywords.break)?e=new F4:this._match(ie.keywords.continue)?e=new N4:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(ie.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ie.keywords.static_assert))return null;const e=this._optional_paren_expression();return new w4(e)}_while_statement(){if(!this._match(ie.keywords.while))return null;const e=this._optional_paren_expression();this._check(ie.tokens.attr)&&this._attribute();const i=this._compound_statement();return new A4(e,i)}_continuing_statement(){if(!this._match(ie.keywords.continuing))return null;const e=this._compound_statement();return new T4(e)}_for_statement(){if(!this._match(ie.keywords.for))return null;this._consume(ie.tokens.paren_left,"Expected '('.");const e=this._check(ie.tokens.semicolon)?null:this._for_init();this._consume(ie.tokens.semicolon,"Expected ';'.");const i=this._check(ie.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(ie.tokens.semicolon,"Expected ';'.");const n=this._check(ie.tokens.paren_right)?null:this._for_increment();this._consume(ie.tokens.paren_right,"Expected ')'."),this._check(ie.tokens.attr)&&this._attribute();const r=this._compound_statement();return new E4(e,i,n,r)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ie.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let i=null;return this._match(ie.tokens.equal)&&(i=this._short_circuit_or_expression()),new kc(e.name,e.type,e.storage,e.access,i)}if(this._match(ie.keywords.let)){const e=this._consume(ie.tokens.ident,"Expected name for let.").toString();let i=null;if(this._match(ie.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}this._consume(ie.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new dx(e,i,null,null,n)}if(this._match(ie.keywords.const)){const e=this._consume(ie.tokens.ident,"Expected name for const.").toString();let i=null;if(this._match(ie.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}this._consume(ie.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new aS(e,i,null,null,n)}return null}_increment_decrement_statement(){const e=this._current,i=this._unary_expression();if(i==null)return null;if(!this._check(ie.increment_operators))return this._current=e,null;const n=this._consume(ie.increment_operators,"Expected increment operator");return new S4(n.type===ie.tokens.plus_plus?Kh.increment:Kh.decrement,i)}_assignment_statement(){let e=null;if(this._check(ie.tokens.brace_right))return null;let i=this._match(ie.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const n=this._consume(ie.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return new C4(mp.parse(n.lexeme),e,r)}_func_call_statement(){if(!this._check(ie.tokens.ident))return null;const e=this._current,i=this._consume(ie.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=e,null):new nP(i.lexeme,n)}_loop_statement(){if(!this._match(ie.keywords.loop))return null;this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Expected '{' for loop.");const e=[];let i=this._statement();for(;i!==null;){if(Array.isArray(i))for(let r of i)e.push(r);else e.push(i);i=this._statement()}let n=null;return this._match(ie.keywords.continuing)&&(n=this._compound_statement()),this._consume(ie.tokens.brace_right,"Expected '}' for loop."),new I4(e,n)}_switch_statement(){if(!this._match(ie.keywords.switch))return null;const e=this._optional_paren_expression();this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Expected '{' for switch.");const i=this._switch_body();if(i==null||i.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ie.tokens.brace_right,"Expected '}' for switch."),new R4(e,i)}_switch_body(){const e=[];if(this._match(ie.keywords.case)){const i=this._case_selectors();this._match(ie.tokens.colon),this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(ie.tokens.brace_right,"Exected '}' for switch case."),e.push(new H4(i,n))}if(this._match(ie.keywords.default)){this._match(ie.tokens.colon),this._check(ie.tokens.attr)&&this._attribute(),this._consume(ie.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(ie.tokens.brace_right,"Exected '}' for switch default."),e.push(new $4(i))}if(this._check([ie.keywords.default,ie.keywords.case])){const i=this._switch_body();e.push(i[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(ie.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(ie.keywords.fallthrough))return this._consume(ie.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const i=this._case_body();return i.length==0?e:[...e,i[0]]}_if_statement(){if(!this._match(ie.keywords.if))return null;const e=this._optional_paren_expression();this._check(ie.tokens.attr)&&this._attribute();const i=this._compound_statement();let n=[];this._match_elseif()&&(this._check(ie.tokens.attr)&&this._attribute(),n=this._elseif_statement(n));let r=null;return this._match(ie.keywords.else)&&(this._check(ie.tokens.attr)&&this._attribute(),r=this._compound_statement()),new P4(e,i,n,r)}_match_elseif(){return this._tokens[this._current].type===ie.keywords.else&&this._tokens[this._current+1].type===ie.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const i=this._optional_paren_expression(),n=this._compound_statement();return e.push(new W4(i,n)),this._match_elseif()&&(this._check(ie.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(ie.keywords.return))return null;const e=this._short_circuit_or_expression();return new M4(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ie.tokens.or_or);)e=new zo(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ie.tokens.and_and);)e=new zo(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ie.tokens.or);)e=new zo(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ie.tokens.xor);)e=new zo(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(ie.tokens.and);)e=new zo(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([ie.tokens.equal_equal,ie.tokens.not_equal])?new zo(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ie.tokens.less_than,ie.tokens.greater_than,ie.tokens.less_than_equal,ie.tokens.greater_than_equal]);)e=new zo(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ie.tokens.shift_left,ie.tokens.shift_right]);)e=new zo(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ie.tokens.plus,ie.tokens.minus]);)e=new zo(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ie.tokens.star,ie.tokens.forward_slash,ie.tokens.modulo]);)e=new zo(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([ie.tokens.minus,ie.tokens.bang,ie.tokens.tilde,ie.tokens.star,ie.tokens.and])?new j4(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),i=this._postfix_expression();return i&&(e.postfix=i),e}_postfix_expression(){if(this._match(ie.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ie.tokens.bracket_right,"Expected ']'.");const i=new V4(e),n=this._postfix_expression();return n&&(i.postfix=n),i}if(this._match(ie.tokens.period)){const e=this._consume(ie.tokens.ident,"Expected member name."),i=this._postfix_expression(),n=new lS(e.lexeme);return i&&(n.postfix=i),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(ie.tokens.ident)){const n=this._previous().toString();if(this._check(ie.tokens.paren_left)){const r=this._argument_expression_list(),a=this._getStruct(n);return a!=null?new ph(a,r):new aP(n,r)}if(this._context.constants.has(n)){const r=this._context.constants.get(n);return new cS(n,r.value)}return new fx(n)}if(this._match(ie.const_literal))return new uS(parseFloat(this._previous().toString()));if(this._check(ie.tokens.paren_left))return this._paren_expression();if(this._match(ie.keywords.bitcast)){this._consume(ie.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(ie.tokens.greater_than,"Expected '>'.");const r=this._paren_expression();return new U4(n,r)}const e=this._type_decl(),i=this._argument_expression_list();return new z4(e,i)}_argument_expression_list(){if(!this._match(ie.tokens.paren_left))return null;const e=[];do{if(this._check(ie.tokens.paren_right))break;const i=this._short_circuit_or_expression();e.push(i)}while(this._match(ie.tokens.comma));return this._consume(ie.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ie.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ie.tokens.paren_right),new hS([e])}_paren_expression(){this._consume(ie.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ie.tokens.paren_right,"Expected ')'."),new hS([e])}_struct_decl(){if(!this._match(ie.keywords.struct))return null;const e=this._currentLine,i=this._consume(ie.tokens.ident,"Expected name for struct.").toString();this._consume(ie.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(ie.tokens.brace_right);){const u=this._attribute(),l=this._consume(ie.tokens.ident,"Expected variable name.").toString();this._consume(ie.tokens.colon,"Expected ':' for struct member type.");const _=this._attribute(),w=this._type_decl();w!=null&&(w.attributes=_),this._check(ie.tokens.brace_right)?this._match(ie.tokens.comma):this._consume(ie.tokens.comma,"Expected ',' for struct member."),n.push(new X4(l,w,u))}this._consume(ie.tokens.brace_right,"Expected '}' after struct body.");const r=this._currentLine,a=new Bc(i,n,e,r);return this._context.structs.set(i,a),a}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(ie.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ie.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(ie.keywords.const))return null;const e=this._consume(ie.tokens.ident,"Expected variable name");let i=null;if(this._match(ie.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}let n=null;if(this._match(ie.tokens.equal)){const a=this._short_circuit_or_expression();if(a instanceof ph)n=a;else if(a instanceof cS&&a.initializer instanceof ph)n=a.initializer;else try{const u=a.evaluate(this._context);n=new uS(u)}catch{n=a}}const r=new aS(e.toString(),i,"","",n);return this._context.constants.set(r.name,r),r}_global_let_decl(){if(!this._match(ie.keywords.let))return null;const e=this._consume(ie.tokens.ident,"Expected variable name");let i=null;if(this._match(ie.tokens.colon)){const r=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=r)}let n=null;return this._match(ie.tokens.equal)&&(n=this._const_expression()),new dx(e.toString(),i,"","",n)}_const_expression(){if(this._match(ie.const_literal))return new lS(this._previous().toString());const e=this._type_decl();this._consume(ie.tokens.paren_left,"Expected '('.");let i=[];for(;!this._check(ie.tokens.paren_right)&&(i.push(this._const_expression()),!!this._check(ie.tokens.comma));)this._advance();return this._consume(ie.tokens.paren_right,"Expected ')'."),new ph(e,i)}_variable_decl(){if(!this._match(ie.keywords.var))return null;let e="",i="";this._match(ie.tokens.less_than)&&(e=this._consume(ie.storage_class,"Expected storage_class.").toString(),this._match(ie.tokens.comma)&&(i=this._consume(ie.access_mode,"Expected access_mode.").toString()),this._consume(ie.tokens.greater_than,"Expected '>'."));const n=this._consume(ie.tokens.ident,"Expected variable name");let r=null;if(this._match(ie.tokens.colon)){const a=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=a)}return new kc(n.toString(),r,e,i,null)}_override_decl(){if(!this._match(ie.keywords.override))return null;const e=this._consume(ie.tokens.ident,"Expected variable name");let i=null;if(this._match(ie.tokens.colon)){const n=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=n)}return new iP(e.toString(),i,null)}_diagnostic(){this._consume(ie.tokens.paren_left,"Expected '('");const e=this._consume(ie.tokens.ident,"Expected severity control name.");this._consume(ie.tokens.comma,"Expected ','");const i=this._consume(ie.tokens.ident,"Expected diagnostic rule name.");return this._consume(ie.tokens.paren_right,"Expected ')'"),new O4(e.toString(),i.toString())}_enable_directive(){const e=this._consume(ie.tokens.ident,"identity expected.");return new B4(e.toString())}_requires_directive(){const e=[this._consume(ie.tokens.ident,"identity expected.").toString()];for(;this._match(ie.tokens.comma);){const i=this._consume(ie.tokens.ident,"identity expected.");e.push(i.toString())}return new D4(e)}_type_alias(){const e=this._consume(ie.tokens.ident,"identity expected.");this._consume(ie.tokens.equal,"Expected '=' for type alias.");let i=this._type_decl();if(i===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);const n=new rP(e.toString(),i);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([ie.tokens.ident,...ie.texel_format,ie.keywords.bool,ie.keywords.f32,ie.keywords.i32,ie.keywords.u32])){const n=this._advance(),r=n.toString();return this._context.structs.has(r)?this._context.structs.get(r):this._context.aliases.has(r)?this._context.aliases.get(r).type:new au(n.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(ie.template_types)){let n=this._advance().toString(),r=null,a=null;return this._match(ie.tokens.less_than)&&(r=this._type_decl(),a=null,this._match(ie.tokens.comma)&&(a=this._consume(ie.access_mode,"Expected access_mode for pointer").toString()),this._consume(ie.tokens.greater_than,"Expected '>' for type.")),new sP(n,r,a)}if(this._match(ie.keywords.ptr)){let n=this._previous().toString();this._consume(ie.tokens.less_than,"Expected '<' for pointer.");const r=this._consume(ie.storage_class,"Expected storage_class for pointer");this._consume(ie.tokens.comma,"Expected ',' for pointer.");const a=this._type_decl();let u=null;return this._match(ie.tokens.comma)&&(u=this._consume(ie.access_mode,"Expected access_mode for pointer").toString()),this._consume(ie.tokens.greater_than,"Expected '>' for pointer."),new L4(n,r.toString(),a,u)}const i=this._attribute();if(this._match(ie.keywords.array)){let n=null,r=-1;const a=this._previous();let u=null;if(this._match(ie.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let _="";if(this._match(ie.tokens.comma)){u=this._shift_expression();try{_=u.evaluate(this._context).toString(),u=null}catch{_="1"}}this._consume(ie.tokens.greater_than,"Expected '>' for array."),r=_?parseInt(_):0}const l=new oP(a.toString(),i,n,r);return u&&this._deferArrayCountEval.push({arrayType:l,countNode:u}),l}return null}_texture_sampler_types(){if(this._match(ie.sampler_type))return new zf(this._previous().toString(),null,null);if(this._match(ie.depth_texture_type))return new zf(this._previous().toString(),null,null);if(this._match(ie.sampled_texture_type)||this._match(ie.multisampled_texture_type)){const e=this._previous();this._consume(ie.tokens.less_than,"Expected '<' for sampler type.");const i=this._type_decl();return this._consume(ie.tokens.greater_than,"Expected '>' for sampler type."),new zf(e.toString(),i,null)}if(this._match(ie.storage_texture_type)){const e=this._previous();this._consume(ie.tokens.less_than,"Expected '<' for sampler type.");const i=this._consume(ie.texel_format,"Invalid texel format.").toString();this._consume(ie.tokens.comma,"Expected ',' after texel format.");const n=this._consume(ie.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ie.tokens.greater_than,"Expected '>' for sampler type."),new zf(e.toString(),i,n)}return null}_attribute(){let e=[];for(;this._match(ie.tokens.attr);){const i=this._consume(ie.attribute_name,"Expected attribute name"),n=new q4(i.toString(),null);if(this._match(ie.tokens.paren_left)){if(n.value=this._consume(ie.literal_or_ident,"Expected attribute value").toString(),this._check(ie.tokens.comma)){this._advance();do{const r=this._consume(ie.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(r)}while(this._match(ie.tokens.comma))}this._consume(ie.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class Nh{constructor(e,i){this.name=e,this.attributes=i,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class fS{constructor(e,i,n){this.name=e,this.type=i,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ag extends Nh{constructor(e,i){super(e,i),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Pv extends Nh{constructor(e,i){super(e,i),this.count=0,this.stride=0}get isArray(){return!0}}class pS extends Nh{constructor(e,i,n,r){super(e,n),this.format=i,this.access=r}get isTemplate(){return!0}}var El;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(El||(El={}));class lg{constructor(e,i,n,r,a,u,l){this.name=e,this.type=i,this.group=n,this.binding=r,this.attributes=a,this.resourceType=u,this.access=l}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Y4{constructor(e,i){this.name=e,this.type=i}}class cg{constructor(e,i){this.align=e,this.size=i}}class J4{constructor(e,i,n,r){this.name=e,this.type=i,this.locationType=n,this.location=r,this.interpolation=null}}class mS{constructor(e,i,n,r){this.name=e,this.type=i,this.locationType=n,this.location=r}}class Q4{constructor(e,i=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=i}}class ez{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class tz{constructor(e,i,n,r){this.name=e,this.type=i,this.attributes=n,this.id=r}}class iz{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Sa{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new ez,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const n=new Z4().parse(e);for(const r of n)r instanceof hx&&this._functions.set(r.name,new iz(r));for(const r of n)if(r instanceof Bc){const a=this._getTypeInfo(r,null);a instanceof ag&&this.structs.push(a)}for(const r of n){if(r instanceof rP){this.aliases.push(this._getAliasInfo(r));continue}if(r instanceof iP){const a=r,u=this._getAttributeNum(a.attributes,"id",0),l=a.type!=null?this._getTypeInfo(a.type,a.attributes):null;this.overrides.push(new tz(a.name,l,a.attributes,u));continue}if(this._isUniformVar(r)){const a=r,u=this._getAttributeNum(a.attributes,"group",0),l=this._getAttributeNum(a.attributes,"binding",0),_=this._getTypeInfo(a.type,a.attributes),w=new lg(a.name,_,u,l,a.attributes,El.Uniform,a.access);this.uniforms.push(w);continue}if(this._isStorageVar(r)){const a=r,u=this._getAttributeNum(a.attributes,"group",0),l=this._getAttributeNum(a.attributes,"binding",0),_=this._getTypeInfo(a.type,a.attributes),w=this._isStorageTexture(_),E=new lg(a.name,_,u,l,a.attributes,w?El.StorageTexture:El.Storage,a.access);this.storage.push(E);continue}if(this._isTextureVar(r)){const a=r,u=this._getAttributeNum(a.attributes,"group",0),l=this._getAttributeNum(a.attributes,"binding",0),_=this._getTypeInfo(a.type,a.attributes),w=this._isStorageTexture(_),E=new lg(a.name,_,u,l,a.attributes,w?El.StorageTexture:El.Texture,a.access);w?this.storage.push(E):this.textures.push(E);continue}if(this._isSamplerVar(r)){const a=r,u=this._getAttributeNum(a.attributes,"group",0),l=this._getAttributeNum(a.attributes,"binding",0),_=this._getTypeInfo(a.type,a.attributes),w=new lg(a.name,_,u,l,a.attributes,El.Sampler,a.access);this.samplers.push(w);continue}if(r instanceof hx){const a=this._getAttribute(r,"vertex"),u=this._getAttribute(r,"fragment"),l=this._getAttribute(r,"compute"),_=a||u||l,w=new Q4(r.name,_==null?void 0:_.name);w.startLine=r.startLine,w.endLine=r.endLine,this.functions.push(w),this._functions.get(r.name).info=w,_&&(this._functions.get(r.name).inUse=!0,w.inUse=!0,w.resources=this._findResources(r,!!_),w.inputs=this._getInputs(r.args),w.outputs=this._getOutputs(r.returnType),this.entry[_.name].push(w));continue}}for(const r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(const r of this.uniforms)this._markStructsInUse(r.type);for(const r of this.storage)this._markStructsInUse(r.type)}_markStructsInUse(e){if(e.isStruct){e.inUse=!0;for(const i of e.members)this._markStructsInUse(i.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)this._markStructsInUse(e.format);else{const i=this._getAlias(e.name);i&&this._markStructsInUse(i)}}_addCalls(e,i){var n;for(const r of e.calls){const a=(n=this._functions.get(r.name))===null||n===void 0?void 0:n.info;a&&i.add(a)}}findResource(e,i){for(const n of this.uniforms)if(n.group==e&&n.binding==i)return n;for(const n of this.storage)if(n.group==e&&n.binding==i)return n;for(const n of this.textures)if(n.group==e&&n.binding==i)return n;for(const n of this.samplers)if(n.group==e&&n.binding==i)return n;return null}_findResource(e){for(const i of this.uniforms)if(i.name==e)return i;for(const i of this.storage)if(i.name==e)return i;for(const i of this.textures)if(i.name==e)return i;for(const i of this.samplers)if(i.name==e)return i;return null}_markStructsFromAST(e){const i=this._getTypeInfo(e,null);this._markStructsInUse(i)}_findResources(e,i){const n=[],r=this,a=[];return e.search(u=>{if(u instanceof P_)a.push({});else if(u instanceof M_)a.pop();else if(u instanceof kc){const l=u;i&&l.type!==null&&this._markStructsFromAST(l.type),a.length>0&&(a[a.length-1][l.name]=l)}else if(u instanceof ph){const l=u;i&&l.type!==null&&this._markStructsFromAST(l.type)}else if(u instanceof dx){const l=u;i&&l.type!==null&&this._markStructsFromAST(l.type),a.length>0&&(a[a.length-1][l.name]=l)}else if(u instanceof fx){const l=u;if(a.length>0&&a[a.length-1][l.name])return;const _=r._findResource(l.name);_&&n.push(_)}else if(u instanceof aP){const l=u,_=r._functions.get(l.name);_&&(i&&(_.inUse=!0),e.calls.add(_.node),_.resources===null&&(_.resources=r._findResources(_.node,i)),n.push(..._.resources))}else if(u instanceof nP){const l=u,_=r._functions.get(l.name);_&&(i&&(_.inUse=!0),e.calls.add(_.node),_.resources===null&&(_.resources=r._findResources(_.node,i)),n.push(..._.resources))}}),[...new Map(n.map(u=>[u.name,u])).values()]}getBindGroups(){const e=[];function i(n,r){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),r>=e[n].length&&(e[n].length=r+1)}for(const n of this.uniforms){i(n.group,n.binding);const r=e[n.group];r[n.binding]=n}for(const n of this.storage){i(n.group,n.binding);const r=e[n.group];r[n.binding]=n}for(const n of this.textures){i(n.group,n.binding);const r=e[n.group];r[n.binding]=n}for(const n of this.samplers){i(n.group,n.binding);const r=e[n.group];r[n.binding]=n}return e}_getOutputs(e,i=void 0){if(i===void 0&&(i=[]),e instanceof Bc)this._getStructOutputs(e,i);else{const n=this._getOutputInfo(e);n!==null&&i.push(n)}return i}_getStructOutputs(e,i){for(const n of e.members)if(n.type instanceof Bc)this._getStructOutputs(n.type,i);else{const r=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(r!==null){const a=this._getTypeInfo(n.type,n.type.attributes),u=this._parseInt(r.value),l=new mS(n.name,a,r.name,u);i.push(l)}}}_getOutputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const n=this._getTypeInfo(e,e.attributes),r=this._parseInt(i.value);return new mS("",n,i.name,r)}return null}_getInputs(e,i=void 0){i===void 0&&(i=[]);for(const n of e)if(n.type instanceof Bc)this._getStructInputs(n.type,i);else{const r=this._getInputInfo(n);r!==null&&i.push(r)}return i}_getStructInputs(e,i){for(const n of e.members)if(n.type instanceof Bc)this._getStructInputs(n.type,i);else{const r=this._getInputInfo(n);r!==null&&i.push(r)}}_getInputInfo(e){const i=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(i!==null){const n=this._getAttribute(e,"interpolation"),r=this._getTypeInfo(e.type,e.attributes),a=this._parseInt(i.value),u=new J4(e.name,r,i.name,a);return n!==null&&(u.interpolation=this._parseString(n.value)),u}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const i=parseInt(e);return isNaN(i)?e:i}_getAlias(e){for(const i of this.aliases)if(i.name==e)return i.type;return null}_getAliasInfo(e){return new Y4(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,i){if(this._types.has(e))return this._types.get(e);if(e instanceof oP){const r=e,a=this._getTypeInfo(r.format,r.attributes),u=new Pv(r.name,i);return u.format=a,u.count=r.count,this._types.set(e,u),this._updateTypeInfo(u),u}if(e instanceof Bc){const r=e,a=new ag(r.name,i);a.startLine=r.startLine,a.endLine=r.endLine;for(const u of r.members){const l=this._getTypeInfo(u.type,u.attributes);a.members.push(new fS(u.name,l,u.attributes))}return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof zf){const r=e,a=r.format instanceof au,u=r.format?a?this._getTypeInfo(r.format,null):new Nh(r.format,null):null,l=new pS(r.name,u,i,r.access);return this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof sP){const r=e,a=r.format?this._getTypeInfo(r.format,null):null,u=new pS(r.name,a,i,r.access);return this._types.set(e,u),this._updateTypeInfo(u),u}const n=new Nh(e.name,i);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var i,n;const r=this._getTypeSize(e);if(e.size=(i=r==null?void 0:r.size)!==null&&i!==void 0?i:0,e instanceof Pv){const a=this._getTypeSize(e.format);e.stride=(n=a==null?void 0:a.size)!==null&&n!==void 0?n:0,this._updateTypeInfo(e.format)}e instanceof ag&&this._updateStructInfo(e)}_updateStructInfo(e){var i;let n=0,r=0,a=0,u=0;for(let l=0,_=e.members.length;l<_;++l){const w=e.members[l],E=this._getTypeSize(w);if(!E)continue;(i=this._getAlias(w.type.name))!==null&&i!==void 0||w.type;const I=E.align,R=E.size;n=this._roundUp(I,n+r),r=R,a=n,u=Math.max(u,I),w.offset=n,w.size=R,this._updateTypeInfo(w.type)}e.size=this._roundUp(u,a+r),e.align=u}_getTypeSize(e){var i,n;if(e==null)return null;const r=this._getAttributeNum(e.attributes,"size",0),a=this._getAttributeNum(e.attributes,"align",0);if(e instanceof fS&&(e=e.type),e instanceof Nh){const u=this._getAlias(e.name);u!==null&&(e=u)}{const u=Sa._typeInfo[e.name];if(u!==void 0){const l=((i=e.format)===null||i===void 0?void 0:i.name)==="f16"?2:1;return new cg(Math.max(a,u.align/l),Math.max(r,u.size/l))}}{const u=Sa._typeInfo[e.name.substring(0,e.name.length-1)];if(u){const l=e.name[e.name.length-1]==="h"?2:1;return new cg(Math.max(a,u.align/l),Math.max(r,u.size/l))}}if(e instanceof Pv){let u=e,l=8,_=8;const w=this._getTypeSize(u.format);w!==null&&(_=w.size,l=w.align);const E=u.count,I=this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(l,_));return _=E*I,r&&(_=r),new cg(Math.max(a,l),Math.max(r,_))}if(e instanceof ag){let u=0,l=0,_=0,w=0,E=0;for(const I of e.members){const R=this._getTypeSize(I.type);R!==null&&(u=Math.max(R.align,u),_=this._roundUp(R.align,_+w),w=R.size,E=_)}return l=this._roundUp(u,E+w),new cg(Math.max(a,u),Math.max(r,l))}return null}_isUniformVar(e){return e instanceof kc&&e.storage=="uniform"}_isStorageVar(e){return e instanceof kc&&e.storage=="storage"}_isTextureVar(e){return e instanceof kc&&e.type!==null&&Sa._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof kc&&e.type!==null&&Sa._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,i){const n=e;if(!n||!n.attributes)return null;const r=n.attributes;for(let a of r)if(a.name==i)return a;return null}_getAttributeNum(e,i,n){if(e===null)return n;for(let r of e)if(r.name==i){let a=r!==null&&r.value!==null?r.value:n;return a instanceof Array&&(a=a[0]),typeof a=="number"?a:typeof a=="string"?parseInt(a):n}return n}_roundUp(e,i){return Math.ceil(i/e)*e}}Sa._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};Sa._textureTypes=ie.any_texture_type.map(t=>t.name);Sa._samplerTypes=ie.sampler_type.map(t=>t.name);function nz(t){var a;const e={attributes:[],bindings:[]};let i;try{i=rz(t)}catch(u){return qe.error(u.message)(),e}for(const u of i.uniforms){const l=[];for(const _ of((a=u.type)==null?void 0:a.members)||[])l.push({name:_.name,type:gS(_.type)});e.bindings.push({type:"uniform",name:u.name,location:u.binding,group:u.group,members:l})}const n=i.entry.vertex[0],r=(n==null?void 0:n.inputs.length)||0;for(let u=0;u<r;u++){const l=n.inputs[u];if(l.locationType==="location"){const _=gS(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:_})}}return e}function gS(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function rz(t){try{return new Sa(t)}catch(e){if(e instanceof Error)throw e;let i="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(i+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(i+=e.token.line||""),new Error(i,{cause:e})}}const sz=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,oz={name:"fp32",vs:sz},az=[0,1,1,1],lz=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,cz=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,_S={name:"picking",vs:lz,fs:cz,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:az},getUniforms:uz};function uz(t={},e){const i={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)i.isHighlightActive=!1;else{i.isHighlightActive=!0;const n=t.highlightedObjectColor.slice(0,3);i.highlightedObjectColor=n}if(t.highlightColor){const n=Array.from(t.highlightColor,r=>r/255);Number.isFinite(n[3])||(n[3]=1),i.highlightColor=n}return t.isActive!==void 0&&(i.isActive=!!t.isActive,i.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(i.useFloatColors=!!t.useFloatColors),i}function uP(t,e=[],i=0){const n=Math.fround(t),r=t-n;return e[i]=n,e[i+1]=r,e}function hz(t){return t-Math.fround(t)}function dz(t){const e=new Float32Array(32);for(let i=0;i<4;++i)for(let n=0;n<4;++n){const r=i*4+n;uP(t[n*4+i],e,r*2)}return e}const fz=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,pz={ONE:1};function mz(){return pz}const gz={name:"fp64-arithmetic",vs:fz,getUniforms:mz,fp64ify:uP,fp64LowPart:hz,fp64ifyMatrix4:dz},_z=1/Math.PI*180,yz=1/180*Math.PI,vz={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...vz}};const Bn=globalThis.mathgl.config;function xz(t,{precision:e=Bn.precision}={}){return t=Tz(t),`${parseFloat(t.toPrecision(e))}`}function Xl(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function bz(t){return Az(t)}function wz(t){return fo(t)}function Az(t,e){return ow(t,i=>i*yz,e)}function fo(t,e){return ow(t,i=>i*_z,e)}function Ca(t,e,i){return ow(t,n=>Math.max(e,Math.min(i,n)))}function B_(t,e,i){return Xl(t)?t.map((n,r)=>B_(n,e[r],i)):i*e+(1-i)*t}function xo(t,e,i){const n=Bn.EPSILON;i&&(Bn.EPSILON=i);try{if(t===e)return!0;if(Xl(t)&&Xl(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!xo(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Bn.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Bn.EPSILON=n}}function Tz(t){return Math.round(t/Bn.EPSILON)*Bn.EPSILON}function Ez(t){return t.clone?t.clone():new Array(t.length)}function ow(t,e,i){if(Xl(t)){const n=t;i=i||Ez(n);for(let r=0;r<i.length&&r<n.length;++r){const a=typeof t=="number"?t:t[r];i[r]=e(a,r,i)}return i}return e(t)}class aw extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,i=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+i];return this.check()}toArray(e=[],i=0){for(let n=0;n<this.ELEMENTS;++n)e[i+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Xl(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Bn)}formatString(e){let i="";for(let n=0;n<this.ELEMENTS;++n)i+=(n>0?", ":"")+xz(this[n],e);return`${e.printTypes?this.constructor.name:""}[${i}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!xo(this[i],e[i]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==e[i])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,i,n){if(n===void 0)return this.lerp(this,e,i);for(let r=0;r<this.ELEMENTS;++r){const a=e[r],u=typeof i=="number"?i:i[r];this[r]=a+n*(u-a)}return this.check()}min(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(e[i],this[i]);return this.check()}max(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(e[i],this[i]);return this.check()}clamp(e,i){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),i[n]);return this.check()}add(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=i[n];return this.check()}subtract(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=i[n];return this.check()}scale(e){if(typeof e=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;else for(let i=0;i<this.ELEMENTS&&i<e.length;++i)this[i]*=e[i];return this.check()}multiplyByScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}check(){if(Bn.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)e=e&&Number.isFinite(this[i]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]=e;return this.check()}addScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let i=0;i<this.ELEMENTS;++i)this[i]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,i){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),i);return this.check()}get elements(){return this}}function Sz(t,e){if(t.length!==e)return!1;for(let i=0;i<t.length;++i)if(!Number.isFinite(t[i]))return!1;return!0}function di(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Yf(t,e,i=""){if(Bn.debug&&!Sz(t,e))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return t}function mo(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class lw extends aw{get x(){return this[0]}set x(e){this[0]=di(e)}get y(){return this[1]}set y(e){this[1]=di(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*this[i];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let i=0;for(let n=0;n<this.ELEMENTS;++n){const r=this[n]-e[n];i+=r*r}return di(i)}dot(e){let i=0;for(let n=0;n<this.ELEMENTS;++n)i+=this[n]*e[n];return di(i)}normalize(){const e=this.magnitude();if(e!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e;return this.check()}multiply(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=i[n];return this.check()}divide(...e){for(const i of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=i[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return mo(e>=0&&e<this.ELEMENTS,"index is out of range"),di(this[e])}setComponent(e,i){return mo(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=i,this.check()}addVectors(e,i){return this.copy(e).add(i)}subVectors(e,i){return this.copy(e).subtract(i)}multiplyVectors(e,i){return this.copy(e).multiply(i)}addScaledVector(e,i){return this.add(new this.constructor(e).multiplyScalar(i))}}const Jf=1e-6;let To=typeof Float32Array<"u"?Float32Array:Array;function Cz(){const t=new To(2);return To!=Float32Array&&(t[0]=0,t[1]=0),t}function yS(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Iz(t,e){return t[0]=-e[0],t[1]=-e[1],t}function hP(t,e,i,n){const r=e[0],a=e[1];return t[0]=r+n*(i[0]-r),t[1]=a+n*(i[1]-a),t}function Rz(t,e,i){const n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r,t[1]=i[1]*n+i[3]*r,t}function Pz(t,e,i){const n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r+i[4],t[1]=i[1]*n+i[3]*r+i[5],t}function dP(t,e,i){const n=e[0],r=e[1];return t[0]=i[0]*n+i[3]*r+i[6],t[1]=i[1]*n+i[4]*r+i[7],t}function fP(t,e,i){const n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t}(function(){const t=Cz();return function(e,i,n,r,a,u){let l,_;for(i||(i=2),n||(n=0),r?_=Math.min(r*i+n,e.length):_=e.length,l=n;l<_;l+=i)t[0]=e[l],t[1]=e[l+1],a(t,t,u),e[l]=t[0],e[l+1]=t[1];return e}})();function pP(t,e,i){const n=e[0],r=e[1],a=i[3]*n+i[7]*r||1;return t[0]=(i[0]*n+i[4]*r)/a,t[1]=(i[1]*n+i[5]*r)/a,t}function mP(t,e,i){const n=e[0],r=e[1],a=e[2],u=i[3]*n+i[7]*r+i[11]*a||1;return t[0]=(i[0]*n+i[4]*r+i[8]*a)/u,t[1]=(i[1]*n+i[5]*r+i[9]*a)/u,t[2]=(i[2]*n+i[6]*r+i[10]*a)/u,t}function Mz(t,e,i){const n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r,t[1]=i[1]*n+i[3]*r,t[2]=e[2],t}function Bz(t,e,i){const n=e[0],r=e[1];return t[0]=i[0]*n+i[2]*r,t[1]=i[1]*n+i[3]*r,t[2]=e[2],t[3]=e[3],t}function gP(t,e,i){const n=e[0],r=e[1],a=e[2];return t[0]=i[0]*n+i[3]*r+i[6]*a,t[1]=i[1]*n+i[4]*r+i[7]*a,t[2]=i[2]*n+i[5]*r+i[8]*a,t[3]=e[3],t}class cw extends lw{constructor(e=0,i=0){super(2),Xl(e)&&arguments.length===1?this.copy(e):(Bn.debug&&(di(e),di(i)),this[0]=e,this[1]=i)}set(e,i){return this[0]=e,this[1]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Bn.debug&&(di(e.x),di(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return fP(this,this,e),this.check()}transformAsVector(e){return pP(this,this,e),this.check()}transformByMatrix3(e){return dP(this,this,e),this.check()}transformByMatrix2x3(e){return Pz(this,this,e),this.check()}transformByMatrix2(e){return Rz(this,this,e),this.check()}}function _P(){const t=new To(3);return To!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function yP(t){const e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)}function vS(t,e,i){const n=new To(3);return n[0]=t,n[1]=e,n[2]=i,n}function Dz(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Oz(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function kz(t,e){const i=e[0],n=e[1],r=e[2];let a=i*i+n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function uw(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function i_(t,e,i){const n=e[0],r=e[1],a=e[2],u=i[0],l=i[1],_=i[2];return t[0]=r*_-a*l,t[1]=a*u-n*_,t[2]=n*l-r*u,t}function hw(t,e,i){const n=e[0],r=e[1],a=e[2];let u=i[3]*n+i[7]*r+i[11]*a+i[15];return u=u||1,t[0]=(i[0]*n+i[4]*r+i[8]*a+i[12])/u,t[1]=(i[1]*n+i[5]*r+i[9]*a+i[13])/u,t[2]=(i[2]*n+i[6]*r+i[10]*a+i[14])/u,t}function vP(t,e,i){const n=e[0],r=e[1],a=e[2];return t[0]=n*i[0]+r*i[3]+a*i[6],t[1]=n*i[1]+r*i[4]+a*i[7],t[2]=n*i[2]+r*i[5]+a*i[8],t}function xP(t,e,i){const n=i[0],r=i[1],a=i[2],u=i[3],l=e[0],_=e[1],w=e[2];let E=r*w-a*_,I=a*l-n*w,R=n*_-r*l,L=r*R-a*I,W=a*E-n*R,K=n*I-r*E;const fe=u*2;return E*=fe,I*=fe,R*=fe,L*=2,W*=2,K*=2,t[0]=l+E+L,t[1]=_+I+W,t[2]=w+R+K,t}function Fz(t,e,i,n){const r=[],a=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],a[0]=r[0],a[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),a[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t}function Nz(t,e,i,n){const r=[],a=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],a[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),a[1]=r[1],a[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t}function Lz(t,e,i,n){const r=[],a=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],a[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),a[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),a[2]=r[2],t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t}function Uz(t,e){const i=t[0],n=t[1],r=t[2],a=e[0],u=e[1],l=e[2],_=Math.sqrt((i*i+n*n+r*r)*(a*a+u*u+l*l)),w=_&&uw(t,e)/_;return Math.acos(Math.min(Math.max(w,-1),1))}const zz=Dz,Vz=yP;(function(){const t=_P();return function(e,i,n,r,a,u){let l,_;for(i||(i=3),n||(n=0),r?_=Math.min(r*i+n,e.length):_=e.length,l=n;l<_;l+=i)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],a(t,t,u),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const Mv=[0,0,0];let ug;class Ie extends lw{static get ZERO(){return ug||(ug=new Ie(0,0,0),Object.freeze(ug)),ug}constructor(e=0,i=0,n=0){super(-0,-0,-0),arguments.length===1&&Xl(e)?this.copy(e):(Bn.debug&&(di(e),di(i),di(n)),this[0]=e,this[1]=i,this[2]=n)}set(e,i,n){return this[0]=e,this[1]=i,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Bn.debug&&(di(e.x),di(e.y),di(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=di(e)}angle(e){return Uz(this,e)}cross(e){return i_(this,this,e),this.check()}rotateX({radians:e,origin:i=Mv}){return Fz(this,this,i,e),this.check()}rotateY({radians:e,origin:i=Mv}){return Nz(this,this,i,e),this.check()}rotateZ({radians:e,origin:i=Mv}){return Lz(this,this,i,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return hw(this,this,e),this.check()}transformAsVector(e){return mP(this,this,e),this.check()}transformByMatrix3(e){return vP(this,this,e),this.check()}transformByMatrix2(e){return Mz(this,this,e),this.check()}transformByQuaternion(e){return xP(this,this,e),this.check()}}let hg;class dw extends lw{static get ZERO(){return hg||(hg=new dw(0,0,0,0),Object.freeze(hg)),hg}constructor(e=0,i=0,n=0,r=0){super(-0,-0,-0,-0),Xl(e)&&arguments.length===1?this.copy(e):(Bn.debug&&(di(e),di(i),di(n),di(r)),this[0]=e,this[1]=i,this[2]=n,this[3]=r)}set(e,i,n,r){return this[0]=e,this[1]=i,this[2]=n,this[3]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Bn.debug&&(di(e.x),di(e.y),di(e.z),di(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=di(e)}get w(){return this[3]}set w(e){this[3]=di(e)}transform(e){return hw(this,this,e),this.check()}transformByMatrix3(e){return gP(this,this,e),this.check()}transformByMatrix2(e){return Bz(this,this,e),this.check()}transformByQuaternion(e){return xP(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class bP extends aw{toString(){let e="[";if(Bn.printRowMajor){e+="row-major:";for(let i=0;i<this.RANK;++i)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+i]}`}else{e+="column-major:";for(let i=0;i<this.ELEMENTS;++i)e+=` ${this[i]}`}return e+="]",e}getElementIndex(e,i){return i*this.RANK+e}getElement(e,i){return this[i*this.RANK+e]}setElement(e,i,n){return this[i*this.RANK+e]=di(n),this}getColumn(e,i=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let r=0;r<this.RANK;++r)i[r]=this[n+r];return i}setColumn(e,i){const n=e*this.RANK;for(let r=0;r<this.RANK;++r)this[n+r]=i[r];return this}}function jz(){const t=new To(9);return To!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Hz(t,e){if(t===e){const i=e[1],n=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function $z(t,e){const i=e[0],n=e[1],r=e[2],a=e[3],u=e[4],l=e[5],_=e[6],w=e[7],E=e[8],I=E*u-l*w,R=-E*a+l*_,L=w*a-u*_;let W=i*I+n*R+r*L;return W?(W=1/W,t[0]=I*W,t[1]=(-E*n+r*w)*W,t[2]=(l*n-r*u)*W,t[3]=R*W,t[4]=(E*i-r*_)*W,t[5]=(-l*i+r*a)*W,t[6]=L*W,t[7]=(-w*i+n*_)*W,t[8]=(u*i-n*a)*W,t):null}function Gz(t){const e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],u=t[5],l=t[6],_=t[7],w=t[8];return e*(w*a-u*_)+i*(-w*r+u*l)+n*(_*r-a*l)}function xS(t,e,i){const n=e[0],r=e[1],a=e[2],u=e[3],l=e[4],_=e[5],w=e[6],E=e[7],I=e[8],R=i[0],L=i[1],W=i[2],K=i[3],fe=i[4],X=i[5],$=i[6],Q=i[7],me=i[8];return t[0]=R*n+L*u+W*w,t[1]=R*r+L*l+W*E,t[2]=R*a+L*_+W*I,t[3]=K*n+fe*u+X*w,t[4]=K*r+fe*l+X*E,t[5]=K*a+fe*_+X*I,t[6]=$*n+Q*u+me*w,t[7]=$*r+Q*l+me*E,t[8]=$*a+Q*_+me*I,t}function Wz(t,e,i){const n=e[0],r=e[1],a=e[2],u=e[3],l=e[4],_=e[5],w=e[6],E=e[7],I=e[8],R=i[0],L=i[1];return t[0]=n,t[1]=r,t[2]=a,t[3]=u,t[4]=l,t[5]=_,t[6]=R*n+L*u+w,t[7]=R*r+L*l+E,t[8]=R*a+L*_+I,t}function Xz(t,e,i){const n=e[0],r=e[1],a=e[2],u=e[3],l=e[4],_=e[5],w=e[6],E=e[7],I=e[8],R=Math.sin(i),L=Math.cos(i);return t[0]=L*n+R*u,t[1]=L*r+R*l,t[2]=L*a+R*_,t[3]=L*u-R*n,t[4]=L*l-R*r,t[5]=L*_-R*a,t[6]=w,t[7]=E,t[8]=I,t}function bS(t,e,i){const n=i[0],r=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function qz(t,e){const i=e[0],n=e[1],r=e[2],a=e[3],u=i+i,l=n+n,_=r+r,w=i*u,E=n*u,I=n*l,R=r*u,L=r*l,W=r*_,K=a*u,fe=a*l,X=a*_;return t[0]=1-I-W,t[3]=E-X,t[6]=R+fe,t[1]=E+X,t[4]=1-w-W,t[7]=L-K,t[2]=R-fe,t[5]=L+K,t[8]=1-w-I,t}var px;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(px||(px={}));const Kz=Object.freeze([1,0,0,0,1,0,0,0,1]);class hn extends bP{static get IDENTITY(){return Yz()}static get ZERO(){return Zz()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return px}constructor(e,...i){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):i.length>0?this.copy([e,...i]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(Kz)}fromObject(e){return this.check()}fromQuaternion(e){return qz(this,e),this.check()}set(e,i,n,r,a,u,l,_,w){return this[0]=e,this[1]=i,this[2]=n,this[3]=r,this[4]=a,this[5]=u,this[6]=l,this[7]=_,this[8]=w,this.check()}setRowMajor(e,i,n,r,a,u,l,_,w){return this[0]=e,this[1]=r,this[2]=l,this[3]=i,this[4]=a,this[5]=_,this[6]=n,this[7]=u,this[8]=w,this.check()}determinant(){return Gz(this)}transpose(){return Hz(this,this),this.check()}invert(){return $z(this,this),this.check()}multiplyLeft(e){return xS(this,e,this),this.check()}multiplyRight(e){return xS(this,this,e),this.check()}rotate(e){return Xz(this,this,e),this.check()}scale(e){return Array.isArray(e)?bS(this,this,e):bS(this,this,[e,e]),this.check()}translate(e){return Wz(this,this,e),this.check()}transform(e,i){let n;switch(e.length){case 2:n=dP(i||[-0,-0],e,this);break;case 3:n=vP(i||[-0,-0,-0],e,this);break;case 4:n=gP(i||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Yf(n,e.length),n}transformVector(e,i){return this.transform(e,i)}transformVector2(e,i){return this.transform(e,i)}transformVector3(e,i){return this.transform(e,i)}}let dg,fg=null;function Zz(){return dg||(dg=new hn([0,0,0,0,0,0,0,0,0]),Object.freeze(dg)),dg}function Yz(){return fg||(fg=new hn,Object.freeze(fg)),fg}function Jz(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qz(t,e){if(t===e){const i=e[1],n=e[2],r=e[3],a=e[6],u=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=r,t[13]=u,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function mx(t,e){const i=e[0],n=e[1],r=e[2],a=e[3],u=e[4],l=e[5],_=e[6],w=e[7],E=e[8],I=e[9],R=e[10],L=e[11],W=e[12],K=e[13],fe=e[14],X=e[15],$=i*l-n*u,Q=i*_-r*u,me=i*w-a*u,Ce=n*_-r*l,Be=n*w-a*l,Fe=r*w-a*_,ze=E*K-I*W,Ve=E*fe-R*W,je=E*X-L*W,Ke=I*fe-R*K,Lt=I*X-L*K,Pt=R*X-L*fe;let bt=$*Pt-Q*Lt+me*Ke+Ce*je-Be*Ve+Fe*ze;return bt?(bt=1/bt,t[0]=(l*Pt-_*Lt+w*Ke)*bt,t[1]=(r*Lt-n*Pt-a*Ke)*bt,t[2]=(K*Fe-fe*Be+X*Ce)*bt,t[3]=(R*Be-I*Fe-L*Ce)*bt,t[4]=(_*je-u*Pt-w*Ve)*bt,t[5]=(i*Pt-r*je+a*Ve)*bt,t[6]=(fe*me-W*Fe-X*Q)*bt,t[7]=(E*Fe-R*me+L*Q)*bt,t[8]=(u*Lt-l*je+w*ze)*bt,t[9]=(n*je-i*Lt-a*ze)*bt,t[10]=(W*Be-K*me+X*$)*bt,t[11]=(I*me-E*Be-L*$)*bt,t[12]=(l*Ve-u*Ke-_*ze)*bt,t[13]=(i*Ke-n*Ve+r*ze)*bt,t[14]=(K*Q-W*Ce-fe*$)*bt,t[15]=(E*Ce-I*Q+R*$)*bt,t):null}function e6(t){const e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],u=t[5],l=t[6],_=t[7],w=t[8],E=t[9],I=t[10],R=t[11],L=t[12],W=t[13],K=t[14],fe=t[15],X=e*u-i*a,$=e*l-n*a,Q=i*l-n*u,me=w*W-E*L,Ce=w*K-I*L,Be=E*K-I*W,Fe=e*Be-i*Ce+n*me,ze=a*Be-u*Ce+l*me,Ve=w*Q-E*$+I*X,je=L*Q-W*$+K*X;return _*Fe-r*ze+fe*Ve-R*je}function Wc(t,e,i){const n=e[0],r=e[1],a=e[2],u=e[3],l=e[4],_=e[5],w=e[6],E=e[7],I=e[8],R=e[9],L=e[10],W=e[11],K=e[12],fe=e[13],X=e[14],$=e[15];let Q=i[0],me=i[1],Ce=i[2],Be=i[3];return t[0]=Q*n+me*l+Ce*I+Be*K,t[1]=Q*r+me*_+Ce*R+Be*fe,t[2]=Q*a+me*w+Ce*L+Be*X,t[3]=Q*u+me*E+Ce*W+Be*$,Q=i[4],me=i[5],Ce=i[6],Be=i[7],t[4]=Q*n+me*l+Ce*I+Be*K,t[5]=Q*r+me*_+Ce*R+Be*fe,t[6]=Q*a+me*w+Ce*L+Be*X,t[7]=Q*u+me*E+Ce*W+Be*$,Q=i[8],me=i[9],Ce=i[10],Be=i[11],t[8]=Q*n+me*l+Ce*I+Be*K,t[9]=Q*r+me*_+Ce*R+Be*fe,t[10]=Q*a+me*w+Ce*L+Be*X,t[11]=Q*u+me*E+Ce*W+Be*$,Q=i[12],me=i[13],Ce=i[14],Be=i[15],t[12]=Q*n+me*l+Ce*I+Be*K,t[13]=Q*r+me*_+Ce*R+Be*fe,t[14]=Q*a+me*w+Ce*L+Be*X,t[15]=Q*u+me*E+Ce*W+Be*$,t}function D_(t,e,i){const n=i[0],r=i[1],a=i[2];let u,l,_,w,E,I,R,L,W,K,fe,X;return e===t?(t[12]=e[0]*n+e[4]*r+e[8]*a+e[12],t[13]=e[1]*n+e[5]*r+e[9]*a+e[13],t[14]=e[2]*n+e[6]*r+e[10]*a+e[14],t[15]=e[3]*n+e[7]*r+e[11]*a+e[15]):(u=e[0],l=e[1],_=e[2],w=e[3],E=e[4],I=e[5],R=e[6],L=e[7],W=e[8],K=e[9],fe=e[10],X=e[11],t[0]=u,t[1]=l,t[2]=_,t[3]=w,t[4]=E,t[5]=I,t[6]=R,t[7]=L,t[8]=W,t[9]=K,t[10]=fe,t[11]=X,t[12]=u*n+E*r+W*a+e[12],t[13]=l*n+I*r+K*a+e[13],t[14]=_*n+R*r+fe*a+e[14],t[15]=w*n+L*r+X*a+e[15]),t}function fw(t,e,i){const n=i[0],r=i[1],a=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function t6(t,e,i,n){let r=n[0],a=n[1],u=n[2],l=Math.sqrt(r*r+a*a+u*u),_,w,E,I,R,L,W,K,fe,X,$,Q,me,Ce,Be,Fe,ze,Ve,je,Ke,Lt,Pt,bt,_i;return l<Jf?null:(l=1/l,r*=l,a*=l,u*=l,w=Math.sin(i),_=Math.cos(i),E=1-_,I=e[0],R=e[1],L=e[2],W=e[3],K=e[4],fe=e[5],X=e[6],$=e[7],Q=e[8],me=e[9],Ce=e[10],Be=e[11],Fe=r*r*E+_,ze=a*r*E+u*w,Ve=u*r*E-a*w,je=r*a*E-u*w,Ke=a*a*E+_,Lt=u*a*E+r*w,Pt=r*u*E+a*w,bt=a*u*E-r*w,_i=u*u*E+_,t[0]=I*Fe+K*ze+Q*Ve,t[1]=R*Fe+fe*ze+me*Ve,t[2]=L*Fe+X*ze+Ce*Ve,t[3]=W*Fe+$*ze+Be*Ve,t[4]=I*je+K*Ke+Q*Lt,t[5]=R*je+fe*Ke+me*Lt,t[6]=L*je+X*Ke+Ce*Lt,t[7]=W*je+$*Ke+Be*Lt,t[8]=I*Pt+K*bt+Q*_i,t[9]=R*Pt+fe*bt+me*_i,t[10]=L*Pt+X*bt+Ce*_i,t[11]=W*Pt+$*bt+Be*_i,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function wP(t,e,i){const n=Math.sin(i),r=Math.cos(i),a=e[4],u=e[5],l=e[6],_=e[7],w=e[8],E=e[9],I=e[10],R=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+w*n,t[5]=u*r+E*n,t[6]=l*r+I*n,t[7]=_*r+R*n,t[8]=w*r-a*n,t[9]=E*r-u*n,t[10]=I*r-l*n,t[11]=R*r-_*n,t}function i6(t,e,i){const n=Math.sin(i),r=Math.cos(i),a=e[0],u=e[1],l=e[2],_=e[3],w=e[8],E=e[9],I=e[10],R=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r-w*n,t[1]=u*r-E*n,t[2]=l*r-I*n,t[3]=_*r-R*n,t[8]=a*n+w*r,t[9]=u*n+E*r,t[10]=l*n+I*r,t[11]=_*n+R*r,t}function AP(t,e,i){const n=Math.sin(i),r=Math.cos(i),a=e[0],u=e[1],l=e[2],_=e[3],w=e[4],E=e[5],I=e[6],R=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+w*n,t[1]=u*r+E*n,t[2]=l*r+I*n,t[3]=_*r+R*n,t[4]=w*r-a*n,t[5]=E*r-u*n,t[6]=I*r-l*n,t[7]=R*r-_*n,t}function n6(t,e){const i=e[0],n=e[1],r=e[2],a=e[4],u=e[5],l=e[6],_=e[8],w=e[9],E=e[10];return t[0]=Math.sqrt(i*i+n*n+r*r),t[1]=Math.sqrt(a*a+u*u+l*l),t[2]=Math.sqrt(_*_+w*w+E*E),t}function r6(t,e){const i=e[0],n=e[1],r=e[2],a=e[3],u=i+i,l=n+n,_=r+r,w=i*u,E=n*u,I=n*l,R=r*u,L=r*l,W=r*_,K=a*u,fe=a*l,X=a*_;return t[0]=1-I-W,t[1]=E+X,t[2]=R-fe,t[3]=0,t[4]=E-X,t[5]=1-w-W,t[6]=L+K,t[7]=0,t[8]=R+fe,t[9]=L-K,t[10]=1-w-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function s6(t,e,i,n,r,a,u){const l=1/(i-e),_=1/(r-n),w=1/(a-u);return t[0]=a*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*_,t[6]=0,t[7]=0,t[8]=(i+e)*l,t[9]=(r+n)*_,t[10]=(u+a)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=u*a*2*w,t[15]=0,t}function o6(t,e,i,n,r){const a=1/Math.tan(e/2);if(t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0){const u=1/(n-r);t[10]=(r+n)*u,t[14]=2*r*n*u}else t[10]=-1,t[14]=-2*n;return t}const a6=o6;function l6(t,e,i,n,r,a,u){const l=1/(e-i),_=1/(n-r),w=1/(a-u);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+i)*l,t[13]=(r+n)*_,t[14]=(u+a)*w,t[15]=1,t}const c6=l6;function u6(t,e,i,n){let r,a,u,l,_,w,E,I,R,L;const W=e[0],K=e[1],fe=e[2],X=n[0],$=n[1],Q=n[2],me=i[0],Ce=i[1],Be=i[2];return Math.abs(W-me)<Jf&&Math.abs(K-Ce)<Jf&&Math.abs(fe-Be)<Jf?Jz(t):(I=W-me,R=K-Ce,L=fe-Be,r=1/Math.sqrt(I*I+R*R+L*L),I*=r,R*=r,L*=r,a=$*L-Q*R,u=Q*I-X*L,l=X*R-$*I,r=Math.sqrt(a*a+u*u+l*l),r?(r=1/r,a*=r,u*=r,l*=r):(a=0,u=0,l=0),_=R*l-L*u,w=L*a-I*l,E=I*u-R*a,r=Math.sqrt(_*_+w*w+E*E),r?(r=1/r,_*=r,w*=r,E*=r):(_=0,w=0,E=0),t[0]=a,t[1]=_,t[2]=I,t[3]=0,t[4]=u,t[5]=w,t[6]=R,t[7]=0,t[8]=l,t[9]=E,t[10]=L,t[11]=0,t[12]=-(a*W+u*K+l*fe),t[13]=-(_*W+w*K+E*fe),t[14]=-(I*W+R*K+L*fe),t[15]=1,t)}function h6(){const t=new To(4);return To!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function d6(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function TP(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function f6(t){const e=t[0],i=t[1],n=t[2],r=t[3];return Math.sqrt(e*e+i*i+n*n+r*r)}function p6(t){const e=t[0],i=t[1],n=t[2],r=t[3];return e*e+i*i+n*n+r*r}function m6(t,e){const i=e[0],n=e[1],r=e[2],a=e[3];let u=i*i+n*n+r*r+a*a;return u>0&&(u=1/Math.sqrt(u)),t[0]=i*u,t[1]=n*u,t[2]=r*u,t[3]=a*u,t}function g6(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function _6(t,e,i,n){const r=e[0],a=e[1],u=e[2],l=e[3];return t[0]=r+n*(i[0]-r),t[1]=a+n*(i[1]-a),t[2]=u+n*(i[2]-u),t[3]=l+n*(i[3]-l),t}function Wp(t,e,i){const n=e[0],r=e[1],a=e[2],u=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*a+i[12]*u,t[1]=i[1]*n+i[5]*r+i[9]*a+i[13]*u,t[2]=i[2]*n+i[6]*r+i[10]*a+i[14]*u,t[3]=i[3]*n+i[7]*r+i[11]*a+i[15]*u,t}function y6(t,e,i){const n=e[0],r=e[1],a=e[2],u=i[0],l=i[1],_=i[2],w=i[3],E=w*n+l*a-_*r,I=w*r+_*n-u*a,R=w*a+u*r-l*n,L=-u*n-l*r-_*a;return t[0]=E*w+L*-u+I*-_-R*-l,t[1]=I*w+L*-l+R*-u-E*-_,t[2]=R*w+L*-_+E*-l-I*-u,t[3]=e[3],t}(function(){const t=h6();return function(e,i,n,r,a,u){let l,_;for(i||(i=4),n||(n=0),r?_=Math.min(r*i+n,e.length):_=e.length,l=n;l<_;l+=i)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],a(t,t,u),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var gx;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(gx||(gx={}));const v6=45*Math.PI/180,x6=1,Bv=.1,Dv=500,b6=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ti extends bP{static get IDENTITY(){return A6()}static get ZERO(){return w6()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return gx}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,i,n,r,a,u,l,_,w,E,I,R,L,W,K,fe){return this[0]=e,this[1]=i,this[2]=n,this[3]=r,this[4]=a,this[5]=u,this[6]=l,this[7]=_,this[8]=w,this[9]=E,this[10]=I,this[11]=R,this[12]=L,this[13]=W,this[14]=K,this[15]=fe,this.check()}setRowMajor(e,i,n,r,a,u,l,_,w,E,I,R,L,W,K,fe){return this[0]=e,this[1]=a,this[2]=w,this[3]=L,this[4]=i,this[5]=u,this[6]=E,this[7]=W,this[8]=n,this[9]=l,this[10]=I,this[11]=K,this[12]=r,this[13]=_,this[14]=R,this[15]=fe,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(b6)}fromObject(e){return this.check()}fromQuaternion(e){return r6(this,e),this.check()}frustum(e){const{left:i,right:n,bottom:r,top:a,near:u=Bv,far:l=Dv}=e;return l===1/0?T6(this,i,n,r,a,u):s6(this,i,n,r,a,u,l),this.check()}lookAt(e){const{eye:i,center:n=[0,0,0],up:r=[0,1,0]}=e;return u6(this,i,n,r),this.check()}ortho(e){const{left:i,right:n,bottom:r,top:a,near:u=Bv,far:l=Dv}=e;return c6(this,i,n,r,a,u,l),this.check()}orthographic(e){const{fovy:i=v6,aspect:n=x6,focalDistance:r=1,near:a=Bv,far:u=Dv}=e;wS(i);const l=i/2,_=r*Math.tan(l),w=_*n;return this.ortho({left:-w,right:w,bottom:-_,top:_,near:a,far:u})}perspective(e){const{fovy:i=45*Math.PI/180,aspect:n=1,near:r=.1,far:a=500}=e;return wS(i),a6(this,i,n,r,a),this.check()}determinant(){return e6(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const n=this.getScale(i),r=1/n[0],a=1/n[1],u=1/n[2];return e[0]=this[0]*r,e[1]=this[1]*a,e[2]=this[2]*u,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*a,e[6]=this[6]*u,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*a,e[10]=this[10]*u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,i){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const n=this.getScale(i),r=1/n[0],a=1/n[1],u=1/n[2];return e[0]=this[0]*r,e[1]=this[1]*a,e[2]=this[2]*u,e[3]=this[4]*r,e[4]=this[5]*a,e[5]=this[6]*u,e[6]=this[8]*r,e[7]=this[9]*a,e[8]=this[10]*u,e}transpose(){return Qz(this,this),this.check()}invert(){return mx(this,this),this.check()}multiplyLeft(e){return Wc(this,e,this),this.check()}multiplyRight(e){return Wc(this,this,e),this.check()}rotateX(e){return wP(this,this,e),this.check()}rotateY(e){return i6(this,this,e),this.check()}rotateZ(e){return AP(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,i){return t6(this,this,e,i),this.check()}scale(e){return fw(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return D_(this,this,e),this.check()}transform(e,i){return e.length===4?(i=Wp(i||[-0,-0,-0,-0],e,this),Yf(i,4),i):this.transformAsPoint(e,i)}transformAsPoint(e,i){const{length:n}=e;let r;switch(n){case 2:r=fP(i||[-0,-0],e,this);break;case 3:r=hw(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Yf(r,e.length),r}transformAsVector(e,i){let n;switch(e.length){case 2:n=pP(i||[-0,-0],e,this);break;case 3:n=mP(i||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Yf(n,e.length),n}transformPoint(e,i){return this.transformAsPoint(e,i)}transformVector(e,i){return this.transformAsPoint(e,i)}transformDirection(e,i){return this.transformAsVector(e,i)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,i,n){return this.identity().translate([e,i,n])}}let pg,mg;function w6(){return pg||(pg=new ti([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(pg)),pg}function A6(){return mg||(mg=new ti,Object.freeze(mg)),mg}function wS(t){if(t>Math.PI*2)throw Error("expected radians")}function T6(t,e,i,n,r,a){const u=2*a/(i-e),l=2*a/(r-n),_=(i+e)/(i-e),w=(r+n)/(r-n),E=-1,I=-1,R=-2*a;return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=_,t[9]=w,t[10]=E,t[11]=I,t[12]=0,t[13]=0,t[14]=R,t[15]=0,t}function AS(){const t=new To(4);return To!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function E6(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function EP(t,e,i){i=i*.5;const n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t}function TS(t,e,i){const n=e[0],r=e[1],a=e[2],u=e[3],l=i[0],_=i[1],w=i[2],E=i[3];return t[0]=n*E+u*l+r*w-a*_,t[1]=r*E+u*_+a*l-n*w,t[2]=a*E+u*w+n*_-r*l,t[3]=u*E-n*l-r*_-a*w,t}function S6(t,e,i){i*=.5;const n=e[0],r=e[1],a=e[2],u=e[3],l=Math.sin(i),_=Math.cos(i);return t[0]=n*_+u*l,t[1]=r*_+a*l,t[2]=a*_-r*l,t[3]=u*_-n*l,t}function C6(t,e,i){i*=.5;const n=e[0],r=e[1],a=e[2],u=e[3],l=Math.sin(i),_=Math.cos(i);return t[0]=n*_-a*l,t[1]=r*_+u*l,t[2]=a*_+n*l,t[3]=u*_-r*l,t}function I6(t,e,i){i*=.5;const n=e[0],r=e[1],a=e[2],u=e[3],l=Math.sin(i),_=Math.cos(i);return t[0]=n*_+r*l,t[1]=r*_-n*l,t[2]=a*_+u*l,t[3]=u*_-a*l,t}function R6(t,e){const i=e[0],n=e[1],r=e[2];return t[0]=i,t[1]=n,t[2]=r,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r)),t}function n_(t,e,i,n){const r=e[0],a=e[1],u=e[2],l=e[3];let _=i[0],w=i[1],E=i[2],I=i[3],R,L,W,K,fe;return R=r*_+a*w+u*E+l*I,R<0&&(R=-R,_=-_,w=-w,E=-E,I=-I),1-R>Jf?(L=Math.acos(R),fe=Math.sin(L),W=Math.sin((1-n)*L)/fe,K=Math.sin(n*L)/fe):(W=1-n,K=n),t[0]=W*r+K*_,t[1]=W*a+K*w,t[2]=W*u+K*E,t[3]=W*l+K*I,t}function P6(t,e){const i=e[0],n=e[1],r=e[2],a=e[3],u=i*i+n*n+r*r+a*a,l=u?1/u:0;return t[0]=-i*l,t[1]=-n*l,t[2]=-r*l,t[3]=a*l,t}function M6(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function SP(t,e){const i=e[0]+e[4]+e[8];let n;if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);const a=(r+1)%3,u=(r+2)%3;n=Math.sqrt(e[r*3+r]-e[a*3+a]-e[u*3+u]+1),t[r]=.5*n,n=.5/n,t[3]=(e[a*3+u]-e[u*3+a])*n,t[a]=(e[a*3+r]+e[r*3+a])*n,t[u]=(e[u*3+r]+e[r*3+u])*n}return t}const B6=d6,D6=TP,O6=g6,k6=_6,F6=f6,N6=p6,CP=m6,L6=function(){const t=_P(),e=vS(1,0,0),i=vS(0,1,0);return function(n,r,a){const u=uw(r,a);return u<-.999999?(i_(t,e,r),Vz(t)<1e-6&&i_(t,i,r),kz(t,t),EP(n,t,Math.PI),n):u>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(i_(t,r,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+u,CP(n,n))}}();(function(){const t=AS(),e=AS();return function(i,n,r,a,u,l){return n_(t,n,u,l),n_(e,r,a,l),n_(i,t,e,2*l*(1-l)),i}})();(function(){const t=jz();return function(e,i,n,r){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],CP(e,SP(e,t))}})();const U6=[0,0,0,1];class gp extends aw{constructor(e=0,i=0,n=0,r=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,i,n,r)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,i,n,r){return this[0]=e,this[1]=i,this[2]=n,this[3]=r,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return SP(this,e),this.check()}fromAxisRotation(e,i){return EP(this,e,i),this.check()}identity(){return E6(this),this.check()}setAxisAngle(e,i){return this.fromAxisRotation(e,i)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=di(e)}get y(){return this[1]}set y(e){this[1]=di(e)}get z(){return this[2]}set z(e){this[2]=di(e)}get w(){return this[3]}set w(e){this[3]=di(e)}len(){return F6(this)}lengthSquared(){return N6(this)}dot(e){return O6(this,e)}rotationTo(e,i){return L6(this,e,i),this.check()}add(e){return B6(this,this,e),this.check()}calculateW(){return R6(this,this),this.check()}conjugate(){return M6(this,this),this.check()}invert(){return P6(this,this),this.check()}lerp(e,i,n){return n===void 0?this.lerp(this,e,i):(k6(this,e,i,n),this.check())}multiplyRight(e){return TS(this,this,e),this.check()}multiplyLeft(e){return TS(this,e,this),this.check()}normalize(){const e=this.len(),i=e>0?1/e:0;return this[0]=this[0]*i,this[1]=this[1]*i,this[2]=this[2]*i,this[3]=this[3]*i,e===0&&(this[3]=1),this.check()}rotateX(e){return S6(this,this,e),this.check()}rotateY(e){return C6(this,this,e),this.check()}rotateZ(e){return I6(this,this,e),this.check()}scale(e){return D6(this,this,e),this.check()}slerp(e,i,n){let r,a,u;switch(arguments.length){case 1:({start:r=U6,target:a,ratio:u}=e);break;case 2:r=this,a=e,u=i;break;default:r=e,a=i,u=n}return n_(this,r,a,u),this.check()}transformVector4(e,i=new dw){return y6(i,e,this),Yf(i,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,i){return this.setAxisAngle(e,i)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const z6=.1,V6=1e-12,IP=1e-15,j6=1e-20,ES=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,H6={lightSources:{}};function Ov(t={}){const{color:e=[0,0,0],intensity:i=1}=t;return e.map(n=>n*i/255)}function $6({ambientLight:t,pointLights:e=[],directionalLights:i=[]}){const n={};return t?n["lighting_uAmbientLight.color"]=Ov(t):n["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((r,a)=>{n[`lighting_uPointLight[${a}].color`]=Ov(r),n[`lighting_uPointLight[${a}].position`]=r.position,n[`lighting_uPointLight[${a}].attenuation`]=r.attenuation||[1,0,0]}),n.lighting_uPointLightCount=e.length,i.forEach((r,a)=>{n[`lighting_uDirectionalLight[${a}].color`]=Ov(r),n[`lighting_uDirectionalLight[${a}].direction`]=r.direction}),n.lighting_uDirectionalLightCount=i.length,n}function RP(t=H6){var e,i;if("lightSources"in t){const{ambientLight:n,pointLights:r,directionalLights:a}=t.lightSources||{};return n||r&&r.length>0||a&&a.length>0?Object.assign({},$6({ambientLight:n,pointLights:r,directionalLights:a}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const n={pointLights:[],directionalLights:[]};for(const r of t.lights||[])switch(r.type){case"ambient":n.ambientLight=r;break;case"directional":(e=n.directionalLights)==null||e.push(r);break;case"point":(i=n.pointLights)==null||i.push(r);break}return RP({lightSources:n})}return{}}const pw={name:"lights",vs:ES,fs:ES,getUniforms:RP,defines:{MAX_LIGHTS:3}},PP=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,G6={};function W6(t){const{ambient:e=.35,diffuse:i=.6,shininess:n=32,specularColor:r=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:n,lighting_uSpecularColor:r.map(a=>a/255)}}function MP(t=G6){if(!("material"in t))return{};const{material:e}=t;return e?W6(e):{lighting_uEnabled:!1}}const X6={name:"gouraud-lighting",dependencies:[pw],vs:PP,defines:{LIGHTING_VERTEX:1},getUniforms:MP},q6={name:"phong-lighting",dependencies:[pw],fs:PP,defines:{LIGHTING_FRAGMENT:1},getUniforms:MP},K6=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;
out vec3 pbr_vPosition;
out vec2 pbr_vUV;
#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif
void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
vec4 pos = u_ModelMatrix * position;
pbr_vPosition = vec3(pos.xyz) / pos.w;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0.,0.);
#endif
}
`,Z6=`precision highp float;
uniform bool pbr_uUnlit;
#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif
#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif
#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif
uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;
uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif
in vec3 pbr_vPosition;
in vec2 pbr_vUV;
#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif
struct PBRInfo
{
float NdotL;
float NdotV;
float NdotH;
float LdotH;
float VdotH;
float perceptualRoughness;
float metalness;
vec3 reflectance0;
vec3 reflectance90;
float alphaRoughness;
vec3 diffuseColor;
vec3 specularColor;
vec3 n;
vec3 v;
};
const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;
vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
return vec4(linOut,srgbIn.w);;
#else
return srgbIn;
#endif
}
vec3 getNormal()
{
#ifndef HAS_TANGENTS
vec3 pos_dx = dFdx(pbr_vPosition);
vec3 pos_dy = dFdy(pbr_vPosition);
vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
#ifdef HAS_NORMALS
vec3 ng = normalize(pbr_vNormal);
#else
vec3 ng = cross(pos_dx, pos_dy);
#endif
t = normalize(t - ng * dot(ng, t));
vec3 b = normalize(cross(ng, t));
mat3 tbn = mat3(t, b, ng);
#else
mat3 tbn = pbr_vTBN;
#endif
#ifdef HAS_NORMALMAP
vec3 n = texture(u_NormalSampler, pbr_vUV).rgb;
n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
vec3 n = normalize(tbn[2].xyz);
#endif
return n;
}
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
float mipCount = 9.0;
float lod = (pbrInputs.perceptualRoughness * mipCount);
vec3 brdf = SRGBtoLINEAR(texture(u_brdfLUT,
vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;
#ifdef USE_TEX_LOD
vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif
vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
diffuse *= u_ScaleIBLAmbient.x;
specular *= u_ScaleIBLAmbient.y;
return diffuse + specular;
}
#endif
vec3 diffuse(PBRInfo pbrInputs)
{
return pbrInputs.diffuseColor / M_PI;
}
vec3 specularReflection(PBRInfo pbrInputs)
{
return pbrInputs.reflectance0 +
(pbrInputs.reflectance90 - pbrInputs.reflectance0) *
pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}
float geometricOcclusion(PBRInfo pbrInputs)
{
float NdotL = pbrInputs.NdotL;
float NdotV = pbrInputs.NdotV;
float r = pbrInputs.alphaRoughness;
float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
return attenuationL * attenuationV;
}
float microfacetDistribution(PBRInfo pbrInputs)
{
float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
return roughnessSq / (M_PI * f * f);
}
void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
pbrInputs.NdotL = 1.0;
pbrInputs.NdotH = 0.0;
pbrInputs.LdotH = 0.0;
pbrInputs.VdotH = 1.0;
}
void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
vec3 n = pbrInputs.n;
vec3 v = pbrInputs.v;
vec3 l = normalize(lightDirection);
vec3 h = normalize(l+v);
pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}
void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}
vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
vec3 F = specularReflection(pbrInputs);
float G = geometricOcclusion(pbrInputs);
float D = microfacetDistribution(pbrInputs);
vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}
vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
vec4 baseColor = SRGBtoLINEAR(texture(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
vec4 baseColor = u_BaseColorFactor;
#endif
#ifdef ALPHA_CUTOFF
if (baseColor.a < u_AlphaCutoff) {
discard;
}
#endif
vec3 color = vec3(0, 0, 0);
if(pbr_uUnlit){
color.rgb = baseColor.rgb;
}
else{
float perceptualRoughness = u_MetallicRoughnessValues.y;
float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
vec4 mrSample = texture(u_MetallicRoughnessSampler, pbr_vUV);
perceptualRoughness = mrSample.g * perceptualRoughness;
metallic = mrSample.b * metallic;
#endif
perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
metallic = clamp(metallic, 0.0, 1.0);
float alphaRoughness = perceptualRoughness * perceptualRoughness;
vec3 f0 = vec3(0.04);
vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
diffuseColor *= 1.0 - metallic;
vec3 specularColor = mix(f0, baseColor.rgb, metallic);
float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);
float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
vec3 specularEnvironmentR0 = specularColor.rgb;
vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;
vec3 n = getNormal();
vec3 v = normalize(u_Camera - pbr_vPosition);
float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
vec3 reflection = -normalize(reflect(v, n));
PBRInfo pbrInputs = PBRInfo(
0.0,
NdotV,
0.0,
0.0,
0.0,
perceptualRoughness,
metallic,
specularEnvironmentR0,
specularEnvironmentR90,
alphaRoughness,
diffuseColor,
specularColor,
n,
v
);
#ifdef USE_LIGHTS
PBRInfo_setAmbientLight(pbrInputs);
color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
for(int i = 0; i < lighting_uDirectionalLightCount; i++) {
if (i < lighting_uDirectionalLightCount) {
PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
}
}
for(int i = 0; i < lighting_uPointLightCount; i++) {
if (i < lighting_uPointLightCount) {
PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
}
}
#endif
#ifdef USE_IBL
color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
float ao = texture(u_OcclusionSampler, pbr_vUV).r;
color = mix(color, color * ao, u_OcclusionStrength);
#endif
#ifdef HAS_EMISSIVEMAP
vec3 emissive = SRGBtoLINEAR(texture(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
color += emissive;
#endif
#ifdef PBR_DEBUG
color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif
}
return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,mw={name:"pbr",vs:K6,fs:Z6,defines:{LIGHTING_FRAGMENT:1},dependencies:[pw]},BP="#define SMOOTH_EDGE_RADIUS 0.5",Y6=`
${BP}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,J6=`
${BP}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Q6={name:"geometry",vs:Y6,fs:J6},ii={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ii,"IDENTITY",{get:()=>(ai.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Jo={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Zh={common:0,meters:1,pixels:2},_x={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},e5=Object.keys(ii).map(t=>`const int COORDINATE_SYSTEM_${t} = ${ii[t]};`).join(""),t5=Object.keys(Jo).map(t=>`const int PROJECTION_MODE_${t} = ${Jo[t]};`).join(""),i5=Object.keys(Zh).map(t=>`const int UNIT_${t.toUpperCase()} = ${Zh[t]};`).join(""),n5=`${e5}
${t5}
${i5}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function r5(t,e){if(t===e)return!0;if(Array.isArray(t)){const i=t.length;if(!e||e.length!==i)return!1;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}return!1}function Xp(t){let e={},i;return n=>{for(const r in n)if(!r5(n[r],e[r])){i=t(n),e=n;break}return i}}const SS=[0,0,0,0],s5=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],DP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o5=[0,0,0],OP=[0,0,0],a5=Xp(u5);function kP(t,e,i=OP){i.length<3&&(i=[i[0],i[1],0]);let n=i,r,a=!0;switch(e===ii.LNGLAT_OFFSETS||e===ii.METER_OFFSETS?r=i:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Jo.WEB_MERCATOR:(e===ii.LNGLAT||e===ii.CARTESIAN)&&(r=[0,0,0],a=!1);break;case Jo.WEB_MERCATOR_AUTO_OFFSET:e===ii.LNGLAT?n=r:e===ii.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(n),n[0]-=i[0],n[1]-=i[1],n[2]-=i[2]);break;case Jo.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case Jo.GLOBE:a=!1,r=null;break;default:a=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:n,offsetMode:a}}function l5(t,e,i){const{viewMatrixUncentered:n,projectionMatrix:r}=t;let{viewMatrix:a,viewProjectionMatrix:u}=t,l=SS,_=SS,w=t.cameraPosition;const{geospatialOrigin:E,shaderCoordinateOrigin:I,offsetMode:R}=kP(t,e,i);return R&&(_=t.projectPosition(E||I),w=[w[0]-_[0],w[1]-_[1],w[2]-_[2]],_[3]=1,l=Wp([],_,u),a=n||a,u=Wc([],r,a),u=Wc([],u,s5)),{viewMatrix:a,viewProjectionMatrix:u,projectionCenter:l,originCommon:_,cameraPosCommon:w,shaderCoordinateOrigin:I,geospatialOrigin:E}}function c5({viewport:t,devicePixelRatio:e=1,modelMatrix:i=null,coordinateSystem:n=ii.DEFAULT,coordinateOrigin:r=OP,autoWrapLongitude:a=!1}){n===ii.DEFAULT&&(n=t.isGeospatial?ii.LNGLAT:ii.CARTESIAN);const u=a5({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r});return u.project_uWrapLongitude=a,u.project_uModelMatrix=i||DP,u}function u5({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:n}){const{projectionCenter:r,viewProjectionMatrix:a,originCommon:u,cameraPosCommon:l,shaderCoordinateOrigin:_,geospatialOrigin:w}=l5(t,i,n),E=t.getDistanceScales(),I=[t.width*e,t.height*e],R=Wp([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,L={project_uCoordinateSystem:i,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:_,project_uCommonOrigin:u.slice(0,3),project_uCenter:r,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:I,project_uDevicePixelRatio:e,project_uFocalDistance:R,project_uCommonUnitsPerMeter:E.unitsPerMeter,project_uCommonUnitsPerWorldUnit:E.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:o5,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:a,project_uModelMatrix:DP,project_uCameraPosition:l};if(w){const W=t.getDistanceScales(w);switch(i){case ii.METER_OFFSETS:L.project_uCommonUnitsPerWorldUnit=W.unitsPerMeter,L.project_uCommonUnitsPerWorldUnit2=W.unitsPerMeter2;break;case ii.LNGLAT:case ii.LNGLAT_OFFSETS:t._pseudoMeters||(L.project_uCommonUnitsPerMeter=W.unitsPerMeter),L.project_uCommonUnitsPerWorldUnit=W.unitsPerDegree,L.project_uCommonUnitsPerWorldUnit2=W.unitsPerDegree2;break;case ii.CARTESIAN:L.project_uCommonUnitsPerWorldUnit=[1,1,W.unitsPerMeter[2]],L.project_uCommonUnitsPerWorldUnit2=[0,0,W.unitsPerMeter2[2]];break}}return L}const h5={};function d5(t=h5){return"viewport"in t?c5(t):{}}const gw={name:"project",dependencies:[oz,Q6],vs:n5,getUniforms:d5},f5=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,qp={name:"project32",dependencies:[gw],vs:f5};function p5(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Lh(t,e){const i=Wp([],e,t);return TP(i,i,1/i[3]),i}function CS(t,e){const i=t%e;return i<0?e+i:i}function yx(t,e,i){return t<e?e:t>i?i:t}function m5(t){return Math.log(t)*Math.LOG2E}const _w=Math.log2||m5;function Oa(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const _o=Math.PI,FP=_o/4,Js=_o/180,vx=180/_o,Yh=512,O_=4003e4,gg=85.051129,g5=1.5;function _5(t){return _w(t)}function _p(t){const[e,i]=t;Oa(Number.isFinite(e)),Oa(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const n=e*Js,r=i*Js,a=Yh*(n+_o)/(2*_o),u=Yh*(_o+Math.log(Math.tan(FP+r*.5)))/(2*_o);return[a,u]}function Jh(t){const[e,i]=t,n=e/Yh*(2*_o)-_o,r=2*(Math.atan(Math.exp(i/Yh*(2*_o)-_o))-FP);return[n*vx,r*vx]}function y5(t){const{latitude:e}=t;Oa(Number.isFinite(e));const i=Math.cos(e*Js);return _5(O_*i)-9}function r_(t){const e=Math.cos(t*Js);return Yh/O_/e}function xx(t){const{latitude:e,longitude:i,highPrecision:n=!1}=t;Oa(Number.isFinite(e)&&Number.isFinite(i));const r=Yh,a=Math.cos(e*Js),u=r/360,l=u/a,_=r/O_/a,w={unitsPerMeter:[_,_,_],metersPerUnit:[1/_,1/_,1/_],unitsPerDegree:[u,l,_],degreesPerUnit:[1/u,1/l,1/_]};if(n){const E=Js*Math.tan(e*Js)/a,I=u*E/2,R=r/O_*E,L=R/l*_;w.unitsPerDegree2=[0,I,R],w.unitsPerMeter2=[L,0,L]}return w}function NP(t,e){const[i,n,r]=t,[a,u,l]=e,{unitsPerMeter:_,unitsPerMeter2:w}=xx({longitude:i,latitude:n,highPrecision:!0}),E=_p(t);E[0]+=a*(_[0]+w[0]*u),E[1]+=u*(_[1]+w[1]*u);const I=Jh(E),R=(r||0)+(l||0);return Number.isFinite(r)||Number.isFinite(l)?[I[0],I[1],R]:I}function v5(t){const{height:e,pitch:i,bearing:n,altitude:r,scale:a,center:u}=t,l=p5();D_(l,l,[0,0,-r]),wP(l,l,-i*Js),AP(l,l,n*Js);const _=a/e;return fw(l,l,[_,_,_]),u&&D_(l,l,Oz([],u)),l}function x5(t){const{width:e,height:i,altitude:n,pitch:r=0,offset:a,center:u,scale:l,nearZMultiplier:_=1,farZMultiplier:w=1}=t;let{fovy:E=k_(g5)}=t;n!==void 0&&(E=k_(n));const I=E*Js,R=r*Js,L=LP(E);let W=L;u&&(W+=u[2]*l/Math.cos(R)/i);const K=I*(.5+(a?a[1]:0)/i),fe=Math.sin(K)*W/Math.sin(yx(Math.PI/2-R-K,.01,Math.PI-.01)),X=Math.sin(R)*fe+W,$=W*10,Q=Math.min(X*w,$);return{fov:I,aspect:e/i,focalDistance:L,near:_,far:Q}}function k_(t){return 2*Math.atan(.5/t)*vx}function LP(t){return .5/Math.tan(.5*t*Js)}function UP(t,e){const[i,n,r=0]=t;return Oa(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(r)),Lh(e,[i,n,r,1])}function yw(t,e,i=0){const[n,r,a]=t;if(Oa(Number.isFinite(n)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(a))return Lh(e,[n,r,a,1]);const u=Lh(e,[n,r,0,1]),l=Lh(e,[n,r,1,1]),_=u[2],w=l[2],E=_===w?0:((i||0)-_)/(w-_);return hP([],u,l,E)}function b5(t){const{width:e,height:i,bounds:n,minExtent:r=0,maxZoom:a=24,offset:u=[0,0]}=t,[[l,_],[w,E]]=n,I=w5(t.padding),R=_p([l,yx(E,-gg,gg)]),L=_p([w,yx(_,-gg,gg)]),W=[Math.max(Math.abs(L[0]-R[0]),r),Math.max(Math.abs(L[1]-R[1]),r)],K=[e-I.left-I.right-Math.abs(u[0])*2,i-I.top-I.bottom-Math.abs(u[1])*2];Oa(K[0]>0&&K[1]>0);const fe=K[0]/W[0],X=K[1]/W[1],$=(I.right-I.left)/2/fe,Q=(I.top-I.bottom)/2/X,me=[(L[0]+R[0])/2+$,(L[1]+R[1])/2+Q],Ce=Jh(me),Be=Math.min(a,_w(Math.abs(Math.min(fe,X))));return Oa(Number.isFinite(Be)),{longitude:Ce[0],latitude:Ce[1],zoom:Be}}function w5(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Oa(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const IS=Math.PI/180;function A5(t,e=0){const{width:i,height:n,unproject:r}=t,a={targetZ:e},u=r([0,n],a),l=r([i,n],a);let _,w;const E=t.fovy?.5*t.fovy*IS:Math.atan(.5/t.altitude),I=(90-t.pitch)*IS;return E>I-.01?(_=RS(t,0,e),w=RS(t,i,e)):(_=r([0,0],a),w=r([i,0],a)),[u,l,w,_]}function RS(t,e,i){const{pixelUnprojectionMatrix:n}=t,r=Lh(n,[e,0,1,1]),a=Lh(n,[e,t.height,1,1]),l=(i*t.distanceScales.unitsPerMeter[2]-r[2])/(a[2]-r[2]),_=hP([],r,a,l),w=Jh(_);return w.push(i),w}const PS=512;function T5(t){const{width:e,height:i,pitch:n=0}=t;let{longitude:r,latitude:a,zoom:u,bearing:l=0}=t;(r<-180||r>180)&&(r=CS(r+180,360)-180),(l<-180||l>180)&&(l=CS(l+180,360)-180);const _=_w(i/PS);if(u<=_)u=_,a=0;else{const w=i/2/Math.pow(2,u),E=Jh([0,w])[1];if(a<E)a=E;else{const I=Jh([0,PS-w])[1];a>I&&(a=I)}}return{width:e,height:i,longitude:r,latitude:a,zoom:u,pitch:n,bearing:l}}const E5=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,S5=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,C5=Xp(B5),I5=Xp(D5),R5=[0,0,0,1],P5=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function M5(t,e){const[i,n,r]=t,a=yw([i,n,r],e);return Number.isFinite(r)?a:[a[0],a[1],0]}function B5({viewport:t,center:e}){return new ti(t.viewProjectionMatrix).invert().transform(e)}function D5({viewport:t,shadowMatrices:e}){const i=[],n=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,a=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(u=>M5(u,n));for(const u of e){const l=u.clone().translate(new Ie(t.center).negate()),_=a.map(E=>l.transform(E)),w=new ti().ortho({left:Math.min(..._.map(E=>E[0])),right:Math.max(..._.map(E=>E[0])),bottom:Math.min(..._.map(E=>E[1])),top:Math.max(..._.map(E=>E[1])),near:Math.min(..._.map(E=>-E[2])),far:Math.max(..._.map(E=>-E[2]))});i.push(w.multiplyRight(u))}return i}function O5(t,e){const{shadowEnabled:i=!0}=t;if(!i||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const n={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||R5,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=C5({viewport:t.viewport,center:e.project_uCenter}),a=[],u=I5({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<t.shadowMatrices.length;l++){const _=u[l],w=_.clone().translate(new Ie(t.viewport.center).negate());e.project_uCoordinateSystem===ii.LNGLAT&&e.project_uProjectionMode===Jo.WEB_MERCATOR?(u[l]=w,a[l]=r):(u[l]=_.clone().multiplyRight(P5),a[l]=w.transform(r))}for(let l=0;l<u.length;l++)n[`shadow_uViewProjectionMatrices[${l}]`]=u[l],n[`shadow_uProjectCenters[${l}]`]=a[l];for(let l=0;l<2;l++)n[`shadow_uShadowMap${l}`]=t.shadowMaps&&t.shadowMaps[l]||t.dummyShadowMap;return n}const MS={name:"shadow",dependencies:[gw],vs:E5,fs:S5,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?O5(t,e):{}},Kp={..._S,defaultUniforms:{..._S.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},k5=[gw],F5=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function N5(){const t=A_.getDefaultShaderAssembler();for(const e of k5)t.addDefaultModule(e);for(const e of F5)t.addShaderHook(e);return t}const L5=[255,255,255],U5=1;let z5=0;class V5{constructor(e={}){this.type="ambient";const{color:i=L5}=e,{intensity:n=U5}=e;this.id=e.id||`ambient-${z5++}`,this.color=i,this.intensity=n}}const j5=[255,255,255],H5=1,$5=[0,0,-1];let G5=0;class BS{constructor(e={}){this.type="directional";const{color:i=j5}=e,{intensity:n=H5}=e,{direction:r=$5}=e,{_shadow:a=!1}=e;this.id=e.id||`directional-${G5++}`,this.color=i,this.intensity=n,this.type="directional",this.direction=new Ie(r).normalize().toArray(),this.shadow=a}getProjectedLight(e){return this}}class W5{constructor(e,i={id:"pass"}){const{id:n}=i;this.id=n,this.device=e,this.props={...i}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class vw extends W5{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[i,n]=this.device.canvasContext.getDrawingBufferSize(),r=e.clearCanvas??!0,a=e.clearColor??(r?[0,0,0,0]:!1),u=r?1:!1,l=r?0:!1,_=e.colorMask??15,w={viewport:[0,0,i,n]};e.colorMask&&(w.colorMask=_),e.scissorRect&&(w.scissorRect=e.scissorRect);const E=this.device.beginRenderPass({framebuffer:e.target,parameters:w,clearColor:a,clearDepth:u,clearStencil:l});try{return this._drawLayers(E,e)}finally{E.end()}}_drawLayers(e,i){const{target:n,moduleParameters:r,viewports:a,views:u,onViewportActive:l,clearStack:_=!0}=i;i.pass=i.pass||"unknown",_&&(this._lastRenderIndex=-1);const w=[];for(const E of a){const I=u&&u[E.id];l==null||l(E);const R=this._getDrawLayerParams(E,i),L=E.subViewports||[E];for(const W of L){const K=this._drawLayersInViewport(e,{target:n,moduleParameters:r,viewport:W,view:I,pass:i.pass,layers:i.layers},R);w.push(K)}}return w}_getDrawLayerParams(e,{layers:i,pass:n,isPicking:r=!1,layerFilter:a,cullRect:u,effects:l,moduleParameters:_},w=!1){var W;const E=[],I=zP(this._lastRenderIndex+1),R={layer:i[0],viewport:e,isPicking:r,renderPass:n,cullRect:u},L={};for(let K=0;K<i.length;K++){const fe=i[K],X=this._shouldDrawLayer(fe,R,a,L),$={shouldDrawLayer:X};X&&!w&&($.layerRenderIndex=I(fe,X),$.moduleParameters=this._getModuleParameters(fe,l,n,_),$.layerParameters={...(W=fe.context.deck)==null?void 0:W.props.parameters,...this.getLayerParameters(fe,K,e)}),E[K]=$}return E}_drawLayersInViewport(e,{layers:i,moduleParameters:n,pass:r,target:a,viewport:u,view:l},_){const w=X5(this.device,{moduleParameters:n,target:a,viewport:u});if(l&&l.props.clear){const I=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:w},()=>this.device.clearWebGL(I))}const E={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:w});for(let I=0;I<i.length;I++){const R=i[I],{shouldDrawLayer:L,layerRenderIndex:W,moduleParameters:K,layerParameters:fe}=_[I];if(L&&R.props.pickable&&E.pickableCount++,R.isComposite)E.compositeCount++;else if(L){E.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,W),K.viewport=u,R.context.renderPass=e;try{R._drawLayer({renderPass:e,moduleParameters:K,uniforms:{layerIndex:W},parameters:fe})}catch(X){R.raiseError(X,`drawing ${R} to ${r}`)}}}return E}shouldDrawLayer(e){return!0}getModuleParameters(e,i){return null}getLayerParameters(e,i,n){return e.props.parameters}_shouldDrawLayer(e,i,n,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;i.layer=e;let u=e.parent;for(;u;){if(!u.props.visible||!u.filterSubLayer(i))return!1;i.layer=u,u=u.parent}if(n){const l=i.layer.id;if(l in r||(r[l]=n(i)),!r[l])return!1}return e.activateViewport(i.viewport),!0}_getModuleParameters(e,i,n,r){var l,_;const a=this.device.canvasContext.cssToDeviceRatio(),u=Object.assign(Object.create(((l=e.internalState)==null?void 0:l.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:a});if(i)for(const w of i)Object.assign(u,(_=w.getModuleParameters)==null?void 0:_.call(w,e));return Object.assign(u,this.getModuleParameters(e,i),r)}}function zP(t=0,e={}){const i={},n=(r,a)=>{const u=r.props._offset,l=r.id,_=r.parent&&r.parent.id;let w;if(_&&!(_ in e)&&n(r.parent,!1),_ in i){const E=i[_]=i[_]||zP(e[_],e);w=E(r,a),i[l]=E}else Number.isFinite(u)?(w=u+(e[_]||0),i[l]=null):w=t;return a&&w>=t&&(t=w+1),e[l]=w,w};return n}function X5(t,{moduleParameters:e,target:i,viewport:n}){const r=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,a]=t.canvasContext.getDrawingBufferSize(),u=i?i.height:a,l=n;return[l.x*r,u-(l.y+l.height)*r,l.width*r,l.height*r]}class q5 extends vw{constructor(e,i){super(e,i),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const i=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),r=e.viewports[0],a=r.width*n,u=r.height*n,l=[1,1,1,1];(a!==i.width||u!==i.height)&&i.resize({width:a,height:u}),super.render({...e,clearColor:l,target:i,pass:"shadow"})}getLayerParameters(e,i,n){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const K5={color:[255,255,255],intensity:1},DS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Z5=[0,0,0,200/255];class VP{constructor(e={}){this.id="lighting-effect",this.shadowColor=Z5,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:i,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(i),n._addDefaultShaderModule(MS),this.dummyShadowMap=i.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const i in e){const n=e[i];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:i,viewports:n,onViewportActive:r,views:a}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let u=0;u<this.shadowPasses.length;u++)this.shadowPasses[u].render({layers:e,layerFilter:i,viewports:n,onViewportActive:r,views:a,moduleParameters:{shadowLightId:u,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const i=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return i.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(n=>n.getProjectedLight({layer:e})),pointLights:this.pointLights.map(n=>n.getProjectedLight({layer:e}))},i}cleanup(e){for(const i of this.shadowPasses)i.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(MS))}_calculateMatrices(){const e=[];for(const i of this.directionalLights){const n=new ti().lookAt({eye:new Ie(i.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let i=0;i<this.directionalLights.length;i++){const n=new q5(e);this.shadowPasses[i]=n,this.shadowMaps[i]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:i,directionalLights:n}=this;!e&&i.length===0&&n.length===0&&(this.ambientLight=new V5(K5),this.directionalLights.push(new BS(DS[0]),new BS(DS[1])))}}class Y5{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,i,{size:n=1,type:r,padding:a=0,copy:u=!1,initialize:l=!1,maxCount:_}){const w=r||e&&e.constructor||Float32Array,E=i*n+a;if(ArrayBuffer.isView(e)){if(E<=e.length)return e;if(E*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new w(e.buffer,0,E)}let I=1/0;_&&(I=_*n+a);const R=this._allocate(w,E,l,I);return e&&u?R.set(e):l||R.fill(0,0,4),this._release(e),R}release(e){this._release(e)}_allocate(e,i,n,r){let a=Math.max(Math.ceil(i*this.opts.overAlloc),1);a>r&&(a=r);const u=this._pool,l=e.BYTES_PER_ELEMENT*a,_=u.findIndex(w=>w.byteLength>=l);if(_>=0){const w=new e(u.splice(_,1)[0],0,a);return n&&w.fill(0),w}return new e(a)}_release(e){if(!ArrayBuffer.isView(e))return;const i=this._pool,{buffer:n}=e,{byteLength:r}=n,a=i.findIndex(u=>u.byteLength>=r);a<0?i.push(n):(a>0||i.length<this.opts.poolSize)&&i.splice(a,0,n),i.length>this.opts.poolSize&&i.shift()}}const Qh=new Y5;function Vf(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function J5(t){return[t[12],t[13],t[14]]}function Q5(t){return{left:sh(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:sh(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:sh(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:sh(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:sh(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:sh(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const OS=new Ie;function sh(t,e,i,n){OS.set(t,e,i);const r=OS.len();return{distance:n/r,normal:new Ie(-t/r,-e/r,-i/r)}}function e8(t){return t-Math.fround(t)}let bf;function kv(t,e){const{size:i=1,startIndex:n=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,a=(r-n)/i;bf=Qh.allocate(bf,a,{type:Float32Array,size:i*2});let u=n,l=0;for(;u<r;){for(let _=0;_<i;_++){const w=t[u++];bf[l+_]=w,bf[l+_+i]=e8(w)}l+=i*2}return bf.subarray(0,a*i*2)}function t8(t){let e=null,i=!1;for(const n of t)n&&(e?(i||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],i=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const i8=Math.PI/180,n8=Vf(),kS=[0,0,0],r8={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function s8({width:t,height:e,orthographic:i,fovyRadians:n,focalDistance:r,padding:a,near:u,far:l}){const _=t/e,w=i?new ti().orthographic({fovy:n,aspect:_,focalDistance:r,near:u,far:l}):new ti().perspective({fovy:n,aspect:_,near:u,far:l});if(a){const{left:E=0,right:I=0,top:R=0,bottom:L=0}=a,W=Ca((E+t-I)/2,0,t)-t/2,K=Ca((R+e-L)/2,0,e)-e/2;w[8]-=W*2/t,w[9]+=K*2/e}return w}class Zp{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||r8,this.focalDistance=e.focalDistance||1,this.position=e.position||kS,this.modelMatrix=e.modelMatrix||null;const{longitude:i,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(i),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Jo.WEB_MERCATOR:Jo.WEB_MERCATOR_AUTO_OFFSET:Jo.IDENTITY}equals(e){return e instanceof Zp?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&xo(e.projectionMatrix,this.projectionMatrix)&&xo(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:i=!0}={}){const n=this.projectPosition(e),r=UP(n,this.pixelProjectionMatrix),[a,u]=r,l=i?u:this.height-u;return e.length===2?[a,l]:[a,l,r[2]]}unproject(e,{topLeft:i=!0,targetZ:n}={}){const[r,a,u]=e,l=i?a:this.height-a,_=n&&n*this.distanceScales.unitsPerMeter[2],w=yw([r,l,u],this.pixelUnprojectionMatrix,_),[E,I,R]=this.unprojectPosition(w);return Number.isFinite(u)?[E,I,R]:Number.isFinite(n)?[E,I,n]:[E,I]}projectPosition(e){const[i,n]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,n,r]}unprojectPosition(e){const[i,n]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[i,n,r]}projectFlat(e){if(this.isGeospatial){const i=_p(e);return i[1]=Ca(i[1],-318,830),i}return e}unprojectFlat(e){return this.isGeospatial?Jh(e):e}getBounds(e={}){const i={targetZ:e.z||0},n=this.unproject([0,0],i),r=this.unproject([this.width,0],i),a=this.unproject([0,this.height],i),u=this.unproject([this.width,this.height],i);return[Math.min(n[0],r[0],a[0],u[0]),Math.min(n[1],r[1],a[1],u[1]),Math.max(n[0],r[0],a[0],u[0]),Math.max(n[1],r[1],a[1],u[1])]}getDistanceScales(e){return e?xx({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:i,width:n=1,height:r=1}){return e<this.x+this.width&&this.x<e+n&&i<this.y+this.height&&this.y<i+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Q5(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,i){return null}_initProps(e){const i=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=y5({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||xx({latitude:n,longitude:i}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:a,modelMatrix:u}=e;let l=kS;if(a&&(l=u?new ti(u).transformAsVector(a,[]):a),this.isGeospatial){const _=this.projectPosition([i,n,0]);this.center=new Ie(l).scale(this.distanceScales.unitsPerMeter).add(_)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:i=n8,projectionMatrix:n=null,orthographic:r=!1,fovyRadians:a,fovy:u=75,near:l=.1,far:_=1e3,padding:w=null,focalDistance:E=1}=e;this.viewMatrixUncentered=i,this.viewMatrix=new ti().multiplyRight(i).translate(new Ie(this.center).negate()),this.projectionMatrix=n||s8({width:this.width,height:this.height,orthographic:r,fovyRadians:a||u*i8,focalDistance:E,padding:w,near:l,far:_});const I=Vf();Wc(I,I,this.projectionMatrix),Wc(I,I,this.viewMatrix),this.viewProjectionMatrix=I,this.viewMatrixInverse=mx([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=J5(this.viewMatrixInverse);const R=Vf(),L=Vf();fw(R,R,[this.width/2,-this.height/2,1]),D_(R,R,[1,-1,0]),Wc(L,R,this.viewProjectionMatrix),this.pixelProjectionMatrix=L,this.pixelUnprojectionMatrix=mx(Vf(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ai.warn("Pixel project matrix not invertible")()}}Zp.displayName="Viewport";class Zc extends Zp{constructor(e={}){const{latitude:i=0,longitude:n=0,zoom:r=0,pitch:a=0,bearing:u=0,nearZMultiplier:l=.1,farZMultiplier:_=1.01,nearZ:w,farZ:E,orthographic:I=!1,projectionMatrix:R,repeat:L=!1,worldOffset:W=0,position:K,padding:fe,legacyMeterSizes:X=!1}=e;let{width:$,height:Q,altitude:me=1.5}=e;const Ce=Math.pow(2,r);$=$||1,Q=Q||1;let Be,Fe=null;if(R)me=R[5]/2,Be=k_(me);else{e.fovy?(Be=e.fovy,me=LP(Be)):Be=k_(me);let Ve;if(fe){const{top:je=0,bottom:Ke=0}=fe;Ve=[0,Ca((je+Q-Ke)/2,0,Q)-Q/2]}Fe=x5({width:$,height:Q,scale:Ce,center:K&&[0,0,K[2]*r_(i)],offset:Ve,pitch:a,fovy:Be,nearZMultiplier:l,farZMultiplier:_}),Number.isFinite(w)&&(Fe.near=w),Number.isFinite(E)&&(Fe.far=E)}let ze=v5({height:Q,pitch:a,bearing:u,scale:Ce,altitude:me});W&&(ze=new ti().translate([512*W,0,0]).multiplyLeft(ze)),super({...e,width:$,height:Q,viewMatrix:ze,longitude:n,latitude:i,zoom:r,...Fe,fovy:Be,focalDistance:me}),this.latitude=i,this.longitude=n,this.zoom=r,this.pitch=a,this.bearing=u,this.altitude=me,this.fovy=Be,this.orthographic=I,this._subViewports=L?[]:null,this._pseudoMeters=X,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),i=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let r=i;r<=n;r++){const a=r?new Zc({...this,worldOffset:r}):this;this._subViewports.push(a)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[i,n]=this.projectFlat(e),r=(e[2]||0)*r_(e[1]);return[i,n,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[i,n]=this.unprojectFlat(e),r=(e[2]||0)/r_(n);return[i,n,r]}addMetersToLngLat(e,i){return NP(e,i)}panByPosition(e,i){const n=yw(i,this.pixelUnprojectionMatrix),r=this.projectFlat(e),a=yS([],r,Iz([],n)),u=yS([],this.center,a),[l,_]=this.unprojectFlat(u);return{longitude:l,latitude:_}}getBounds(e={}){const i=A5(this,e.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(e,i={}){const{width:n,height:r}=this,{longitude:a,latitude:u,zoom:l}=b5({width:n,height:r,bounds:e,...i});return new Zc({width:n,height:r,longitude:a,latitude:u,zoom:l})}}Zc.displayName="WebMercatorViewport";const FS=[0,0,0];function Fv(t,e,i=!1){const n=e.projectPosition(t);if(i&&e instanceof Zc){const[r,a,u=0]=t,l=e.getDistanceScales([r,a]);n[2]=u*l.unitsPerMeter[2]}return n}function o8(t){const{viewport:e,modelMatrix:i,coordinateOrigin:n}=t;let{coordinateSystem:r,fromCoordinateSystem:a,fromCoordinateOrigin:u}=t;return r===ii.DEFAULT&&(r=e.isGeospatial?ii.LNGLAT:ii.CARTESIAN),a===void 0&&(a=r),u===void 0&&(u=n),{viewport:e,coordinateSystem:r,coordinateOrigin:n,modelMatrix:i,fromCoordinateSystem:a,fromCoordinateOrigin:u}}function jP(t,{viewport:e,modelMatrix:i,coordinateSystem:n,coordinateOrigin:r,offsetMode:a}){let[u,l,_=0]=t;switch(i&&([u,l,_]=Wp([],[u,l,_,1],i)),n){case ii.LNGLAT:return Fv([u,l,_],e,a);case ii.LNGLAT_OFFSETS:return Fv([u+r[0],l+r[1],_+(r[2]||0)],e,a);case ii.METER_OFFSETS:return Fv(NP(r,[u,l,_]),e,a);case ii.CARTESIAN:default:return e.isGeospatial?[u+r[0],l+r[1],_+r[2]]:e.projectPosition([u,l,_])}}function a8(t,e){const{viewport:i,coordinateSystem:n,coordinateOrigin:r,modelMatrix:a,fromCoordinateSystem:u,fromCoordinateOrigin:l}=o8(e),{autoOffset:_=!0}=e,{geospatialOrigin:w=FS,shaderCoordinateOrigin:E=FS,offsetMode:I=!1}=_?kP(i,n,r):{},R=jP(t,{viewport:i,modelMatrix:a,coordinateSystem:u,coordinateOrigin:l,offsetMode:I});if(I){const L=i.projectPosition(w||E);zz(R,R,L)}return R}let l8=1,c8=1;class HP{constructor(){k(this,"time",0);k(this,"channels",new Map);k(this,"animations",new Map);k(this,"playing",!1);k(this,"lastEngineTime",-1)}addChannel(e){const{delay:i=0,duration:n=Number.POSITIVE_INFINITY,rate:r=1,repeat:a=1}=e,u=l8++,l={time:0,delay:i,duration:n,rate:r,repeat:a};return this._setChannelTime(l,this.time),this.channels.set(u,l),u}removeChannel(e){this.channels.delete(e);for(const[i,n]of this.animations)n.channel===e&&this.detachAnimation(i)}isFinished(e){const i=this.channels.get(e);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(e){if(e===void 0)return this.time;const i=this.channels.get(e);return i===void 0?-1:i.time}setTime(e){this.time=Math.max(0,e);const i=this.channels.values();for(const r of i)this._setChannelTime(r,this.time);const n=this.animations.values();for(const r of n){const{animation:a,channel:u}=r;a.setTime(this.getTime(u))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,i){const n=c8++;return this.animations.set(n,{animation:e,channel:i}),e.setTime(this.getTime(i)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,i){const n=i-e.delay,r=e.duration*e.repeat;n>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}let u8=0;const h8={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Fh.stats.get(`animation-loop-${u8++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class d8{constructor(e){k(this,"device",null);k(this,"canvas",null);k(this,"props");k(this,"animationProps",null);k(this,"timeline",null);k(this,"stats");k(this,"cpuTime");k(this,"gpuTime");k(this,"frameRate");k(this,"display");k(this,"needsRedraw","initialized");k(this,"_initialized",!1);k(this,"_running",!1);k(this,"_animationFrameId",null);k(this,"_nextFramePromise",null);k(this,"_resolveNextFrame",null);k(this,"_cpuStartTime",0);if(this.props={...h8,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:i=!0}=this.props;this.stats=e.stats||new fd({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:i}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const i=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(i),i}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=v4(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(x4(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,i;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(i=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:i.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:i,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=i,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(i);const n=this.props.onAddHTML(i);n&&(i.innerHTML=n)}}_getSizeAndAspect(){var a,u,l,_;if(!this.device)return{width:1,height:1,aspect:1};const[e,i]=((u=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:u.getPixelSize())||[1,1];let n=1;const r=(_=(l=this.device)==null?void 0:l.canvasContext)==null?void 0:_.canvas;return r&&r.clientHeight?n=r.clientWidth/r.clientHeight:e>0&&i>0&&(n=e/i),{width:e,height:i,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,i;this.props.autoResizeDrawingBuffer&&((i=(e=this.device)==null?void 0:e.canvasContext)==null||i.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class NS{constructor(e){k(this,"id");k(this,"userData",{});k(this,"topology");k(this,"bufferLayout",[]);k(this,"vertexCount");k(this,"indices");k(this,"attributes");this.id=e.id||Jl("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&fi(this.indices.usage===Zi.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const i of Object.values(this.attributes))i.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function f8(t,e){if(e instanceof NS)return e;const i=p8(t,e),{attributes:n,bufferLayout:r}=m8(t,e);return new NS({topology:e.topology||"triangle-list",bufferLayout:r,vertexCount:e.vertexCount,indices:i,attributes:n})}function p8(t,e){if(!e.indices)return;const i=e.indices.value;return t.createBuffer({usage:Zi.INDEX,data:i})}function m8(t,e){const i=[],n={};for(const[a,u]of Object.entries(e.attributes)){let l=a;switch(a){case"POSITION":l="positions";break;case"NORMAL":l="normals";break;case"TEXCOORD_0":l="texCoords";break;case"COLOR_0":l="colors";break}n[l]=t.createBuffer({data:u.value,id:`${a}-buffer`});const{value:_,size:w,normalized:E}=u;i.push({name:l,format:p4(_,w,E)})}const r=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:i,vertexCount:r}}class g8{constructor(e){k(this,"modules");k(this,"moduleUniforms");k(this,"moduleBindings");k(this,"moduleUniformsChanged");const i=ky(Object.values(e).filter(n=>n.dependencies));for(const n of i)e[n.name]=n;qe.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[n,r]of Object.entries(e)){const a=n;this.moduleUniforms[a]=r.defaultUniforms||{},this.moduleBindings[a]={}}}destroy(){}setProps(e){var i;for(const n of Object.keys(e)){const r=n,a=e[r],u=this.modules[r];if(!u){qe.warn(`Module ${n} not found`)();continue}const l=this.moduleUniforms[r],_=this.moduleBindings[r],w=((i=u.getUniforms)==null?void 0:i.call(u,a,l))||a,{uniforms:E,bindings:I}=sw(w);this.moduleUniforms[r]={...l,...E},this.moduleBindings[r]={..._,...I}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const i of Object.values(this.moduleBindings))Object.assign(e,i);return e}getDebugTable(){var i;const e={};for(const[n,r]of Object.entries(this.moduleUniforms))for(const[a,u]of Object.entries(r))e[`${n}.${a}`]={type:(i=this.modules[n].uniformTypes)==null?void 0:i[a],value:String(u)};return e}}const Cy=class Cy{constructor(e){k(this,"device");k(this,"_hashCounter",0);k(this,"_hashes",{});k(this,"_renderPipelineCache",{});k(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Cy(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const i={...qh.defaultProps,...e},n=this._hashRenderPipeline(i);if(!this._renderPipelineCache[n]){const r=this.device.createRenderPipeline({...i,id:i.id?`${i.id}-cached`:void 0});r.hash=n,this._renderPipelineCache[n]={pipeline:r,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const i={...R_.defaultProps,...e},n=this._hashComputePipeline(i);if(!this._computePipelineCache[n]){const r=this.device.createComputePipeline({...i,id:i.id?`${i.id}-cached`:void 0});r.hash=n,this._computePipelineCache[n]={pipeline:r,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const i=e.hash,n=e instanceof R_?this._computePipelineCache:this._renderPipelineCache;n[i].useCount--,n[i].useCount===0&&(n[i].pipeline.destroy(),delete n[i])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const i=this._getHash(e.vs.source),n=e.fs?this._getHash(e.fs.source):0,r="-",a=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${i}/${n}V${r}BL${a}`;default:const u=this._getHash(JSON.stringify(e.parameters));return`${i}/${n}V${r}T${e.topology}P${u}BL${a}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};k(Cy,"defaultProps",{...qh.defaultProps});let bx=Cy;const Iy=class Iy{constructor(e){k(this,"device");k(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var i;return(i=e._lumaData).defaultShaderFactory||(i.defaultShaderFactory=new Iy(e)),e._lumaData.defaultShaderFactory}createShader(e){const i=this._hashShader(e);let n=this._cache[i];if(!n){const r=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[i]=n={shader:r,useCount:0}}return n.useCount++,n.shader}release(e){const i=this._hashShader(e),n=this._cache[i];n&&(n.useCount--,n.useCount===0&&(delete this._cache[i],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};k(Iy,"defaultProps",{...S_.defaultProps});let wx=Iy;function _8(t,e){var r;const i={},n="Values";if(t.attributes.length===0&&!((r=t.varyings)!=null&&r.length))return{"No attributes or varyings":{[n]:"N/A"}};for(const a of t.attributes)if(a){const u=`${a.location} ${a.name}: ${a.type}`;i[`in ${u}`]={[n]:a.stepMode||"vertex"}}for(const a of t.varyings||[]){const u=`${a.location} ${a.name}`;i[`out ${u}`]={[n]:JSON.stringify(a.accessor)}}return i}let Xn=null,Nv=null;function y8(t,{id:e,minimap:i,opaque:n,top:r="0",left:a="0",rgbaScale:u=1}){Xn||(Xn=document.createElement("canvas"),Xn.id=e,Xn.title=e,Xn.style.zIndex="100",Xn.style.position="absolute",Xn.style.top=r,Xn.style.left=a,Xn.style.border="blue 1px solid",Xn.style.transform="scaleY(-1)",document.body.appendChild(Xn),Nv=Xn.getContext("2d")),(Xn.width!==t.width||Xn.height!==t.height)&&(Xn.width=t.width/2,Xn.height=t.height/2,Xn.style.width="400px",Xn.style.height="400px");const l=t.device.readPixelsToArrayWebGL(t),_=Nv.createImageData(t.width,t.height),w=0;for(let E=0;E<l.length;E+=4)_.data[w+E+0]=l[E+0]*u,_.data[w+E+1]=l[E+1]*u,_.data[w+E+2]=l[E+2]*u,_.data[w+E+3]=n?255:l[E+3]*u;Nv.putImageData(_,0,0)}const oh=2,v8=1e4,Ry=class Ry{constructor(e,i){k(this,"device");k(this,"id");k(this,"source");k(this,"vs");k(this,"fs");k(this,"pipelineFactory");k(this,"shaderFactory");k(this,"userData",{});k(this,"parameters");k(this,"topology");k(this,"bufferLayout");k(this,"isInstanced");k(this,"instanceCount",0);k(this,"vertexCount");k(this,"indexBuffer",null);k(this,"bufferAttributes",{});k(this,"constantAttributes",{});k(this,"bindings",{});k(this,"uniforms",{});k(this,"vertexArray");k(this,"transformFeedback",null);k(this,"pipeline");k(this,"shaderInputs");k(this,"_uniformStore");k(this,"_attributeInfos",{});k(this,"_gpuGeometry",null);k(this,"_getModuleUniforms");k(this,"props");k(this,"_pipelineNeedsUpdate","newly created");k(this,"_needsRedraw","initializing");k(this,"_destroyed",!1);k(this,"_lastDrawTimestamp",-1);k(this,"_lastLogTime",0);k(this,"_logOpen",!1);k(this,"_drawCount",0);var l,_,w,E;this.props={...Ry.defaultProps,...i},i=this.props,this.id=i.id||Jl("model"),this.device=e,Object.assign(this.userData,i.userData);const n=Object.fromEntries(((l=this.props.modules)==null?void 0:l.map(I=>[I.name,I]))||[]);this.setShaderInputs(i.shaderInputs||new g8(n));const r=x8(e),a=(((_=this.props.modules)==null?void 0:_.length)>0?this.props.modules:(w=this.shaderInputs)==null?void 0:w.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(E=this.props).shaderLayout||(E.shaderLayout=nz(this.props.source));const{source:I,getUniforms:R}=this.props.shaderAssembler.assembleShader({platformInfo:r,...this.props,modules:a});this.source=I,this._getModuleUniforms=R}else{const{vs:I,fs:R,getUniforms:L}=this.props.shaderAssembler.assembleShaderPair({platformInfo:r,...this.props,modules:a});this.vs=I,this.fs=R,this._getModuleUniforms=L}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,i.geometry&&this.setGeometry(i.geometry),this.pipelineFactory=i.pipelineFactory||bx.getDefaultPipelineFactory(this.device),this.shaderFactory=i.shaderFactory||wx.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in i&&(this.isInstanced=i.isInstanced),i.instanceCount&&this.setInstanceCount(i.instanceCount),i.vertexCount&&this.setVertexCount(i.vertexCount),i.indexBuffer&&this.setIndexBuffer(i.indexBuffer),i.attributes&&this.setAttributes(i.attributes),i.constantAttributes&&this.setConstantAttributes(i.constantAttributes),i.bindings&&this.setBindings(i.bindings),i.uniforms&&this.setUniforms(i.uniforms),i.moduleSettings&&this.updateModuleSettings(i.moduleSettings),i.transformFeedback&&(this.transformFeedback=i.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let i;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),T_(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:n}=this.vertexArray,r=n?n.byteLength/(n.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:r,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){var n;(n=this._gpuGeometry)==null||n.destroy();const i=e&&f8(this.device,e);i&&(this.setTopology(i.topology||"triangle-list"),this.bufferLayout=LS(i.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(i)),this._gpuGeometry=i}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?LS(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){ux(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new f4(this.shaderInputs.modules);for(const i of Object.keys(this.shaderInputs.modules)){const n=this._uniformStore.getManagedUniformBuffer(this.device,i);this.bindings[`${i}Uniforms`]=n}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,i){e.indices&&qe.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[n,r]of Object.entries(e)){const a=this.bufferLayout.find(_=>US(_).includes(n));if(!a){qe.warn(`Model(${this.id}): Missing layout for buffer "${n}".`)();continue}const u=US(a);let l=!1;for(const _ of u){const w=this._attributeInfos[_];w&&(this.vertexArray.setBuffer(w.location,r),l=!0)}!l&&!((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)&&qe.warn(`Model(${this.id}): Ignoring buffer "${r.id}" for unknown attribute "${n}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,i){for(const[n,r]of Object.entries(e)){const a=this._attributeInfos[n];a?this.vertexArray.setConstantWebGL(a.location,r):((i==null?void 0:i.disableWarnings)??this.props.disableWarnings)||qe.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){T_(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:i,uniforms:n}=sw(this._getModuleUniforms(e));Object.assign(this.bindings,i),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const i of Object.values(this.bindings))i instanceof E_?e=Math.max(e,i.texture.updateTimestamp):i instanceof Zi||i instanceof Es?e=Math.max(e,i.updateTimestamp):i instanceof C_||(e=Math.max(e,i.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const i={...e.attributes};for(const[n]of Object.entries(i))!this.pipeline.shaderLayout.attributes.find(r=>r.name===n)&&n!=="positions"&&delete i[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(i,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,i=null;this.pipeline&&(qe.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,i=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let r=null;this.source?r=n:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:n,fs:r}),this._attributeInfos=YR(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),i&&this.shaderFactory.release(i)}return this.pipeline}_logDrawCallStart(){const e=qe.level>3?0:v8;qe.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,qe.group(oh,`>>> DRAWING MODEL ${this.id}`,{collapsed:qe.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=_8(this.pipeline.shaderLayout,this.id);qe.table(oh,e)();const i=this.shaderInputs.getDebugTable();for(const[r,a]of Object.entries(this.uniforms))i[r]={value:a};qe.table(oh,i)();const n=this._getAttributeDebugTable();qe.table(oh,this._attributeInfos)(),qe.table(oh,n)(),qe.groupEnd(oh)(),this._logOpen=!1}}_logFramebuffer(e){const i=qe.get("framebuffer");if(this._drawCount++,!i||this._drawCount++>3&&this._drawCount%60)return;const n=e.props.framebuffer;n&&y8(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[i,n]of Object.entries(this._attributeInfos))e[n.location]={name:i,type:n.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[n.location],n.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:i}=this.vertexArray,n=i.indexType==="uint32"?new Uint32Array(i.debugData):new Uint16Array(i.debugData);e.indices={name:"indices",type:i.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,i){const n=eP(i);return(e instanceof Zi?new n(e.debugData):e).toString()}};k(Ry,"defaultProps",{...qh.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:A_.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let na=Ry;function LS(t,e){const i=[...t];for(const n of e){const r=i.findIndex(a=>a.name===n.name);r<0?i.push(n):i[r]=n}return i}function x8(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function US(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(i=>i.attribute):[t.name]}class yp{constructor(e,i=na.defaultProps){k(this,"device");k(this,"model");k(this,"transformFeedback");fi(yp.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new na(this.device,{id:i.id||"buffer-transform-model",fs:i.fs||mU(),topology:i.topology||"point-list",...i}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:i.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var i;return((i=e==null?void 0:e.info)==null?void 0:i.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const i=this.device.beginRenderPass(e);this.model.draw(i),i.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const i=this.getBuffer(e);if(i instanceof Zi)return i.readAsync();const{buffer:n,byteOffset:r=0,byteLength:a=n.byteLength}=i;return n.readAsync(r,a)}}class kl{constructor(e){k(this,"id");k(this,"topology");k(this,"vertexCount");k(this,"indices");k(this,"attributes");k(this,"userData",{});const{attributes:i={},indices:n=null,vertexCount:r=null}=e;this.id=e.id||Jl("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[a,u]of Object.entries(i)){const l=ArrayBuffer.isView(u)?{value:u}:u;fi(ArrayBuffer.isView(l.value),`${this._print(a)}: must be typed array or object with value as typed array`),(a==="POSITION"||a==="positions")&&!l.size&&(l.size=3),a==="indices"?(fi(!this.indices),this.indices=l):this.attributes[a]=l}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,i){return this}_calculateVertexCount(e,i){if(i)return i.value.length;let n=1/0;for(const r of Object.values(e)){const{value:a,size:u,constant:l}=r;!l&&a&&u>=1&&(n=Math.min(n,a.length/u))}return fi(Number.isFinite(n)),n}}class F_{constructor(e={}){k(this,"id");k(this,"matrix",new ti);k(this,"display",!0);k(this,"position",new Ie);k(this,"rotation",new Ie);k(this,"scale",new Ie(1,1,1));k(this,"userData",{});k(this,"props",{});const{id:i}=e;this.id=i||Jl(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return fi(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return fi(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return fi(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e,i=!0){i?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:i,rotation:n,scale:r,update:a=!0}=e;return i&&this.setPosition(i),n&&this.setRotation(n),r&&this.setScale(r),a&&this.updateMatrix(),this}updateMatrix(){const e=this.position,i=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(i),this.matrix.scale(n),this}update(e={}){const{position:i,rotation:n,scale:r}=e;return i&&this.setPosition(i),n&&this.setRotation(n),r&&this.setScale(r),this.updateMatrix(),this}getCoordinateUniforms(e,i){fi(e),i=i||this.matrix;const n=new ti(e).multiplyRight(i),r=n.invert(),a=r.transpose();return{viewMatrix:e,modelMatrix:i,objectMatrix:i,worldMatrix:n,worldInverseMatrix:r,worldInverseTransposeMatrix:a}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Uh extends F_{constructor(i={}){i=Array.isArray(i)?{children:i}:i;const{children:n=[]}=i;qe.assert(n.every(r=>r instanceof F_),"every child must an instance of ScenegraphNode");super(i);k(this,"children");this.children=n}getBounds(){const i=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((n,{worldMatrix:r})=>{const a=n.getBounds();if(!a)return;const[u,l]=a,_=new Ie(u).add(l).divide([2,2,2]);r.transformAsPoint(_,_);const w=new Ie(l).subtract(u).divide([2,2,2]);r.transformAsVector(w,w);for(let E=0;E<8;E++){const I=new Ie(E&1?-1:1,E&2?-1:1,E&4?-1:1).multiply(w).add(_);for(let R=0;R<3;R++)i[0][R]=Math.min(i[0][R],I[R]),i[1][R]=Math.max(i[1][R],I[R])}}),Number.isFinite(i[0][0])?i:null}destroy(){this.children.forEach(i=>i.destroy()),this.removeAll(),super.destroy()}add(...i){for(const n of i)Array.isArray(n)?this.add(...n):this.children.push(n);return this}remove(i){const n=this.children,r=n.indexOf(i);return r>-1&&n.splice(r,1),this}removeAll(){return this.children=[],this}traverse(i,{worldMatrix:n=new ti}={}){const r=new ti(n).multiplyRight(this.matrix);for(const a of this.children)a instanceof Uh?a.traverse(i,{worldMatrix:r}):i(a,{worldMatrix:r})}}class Ax extends F_{constructor(i){super(i);k(this,"model");k(this,"bounds",null);k(this,"managedResources");this.model=i.model,this.managedResources=i.managedResources||[],this.bounds=i.bounds||null,this.setProps(i)}getBounds(){return this.bounds}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(i=>i.destroy()),this.managedResources=[]}draw(i){return this.model.draw(i)}}const b8={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class $P extends vw{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:i,views:n,viewports:r,onViewportActive:a,pickingFBO:u,deviceRect:{x:l,y:_,width:w,height:E},cullRect:I,effects:R,pass:L="picking",pickZ:W,moduleParameters:K}){this.pickZ=W;const fe=this._resetColorEncoder(W),X=[l,_,w,E],$=super.render({target:u,layers:e,layerFilter:i,views:n,viewports:r,onViewportActive:a,cullRect:I,effects:R==null?void 0:R.filter(me=>me.useInPicking),pass:L,isPicking:!0,moduleParameters:K,clearColor:[0,0,0,0],colorMask:15,scissorRect:X});return this._colorEncoderState=null,{decodePickingColor:fe&&A8.bind(null,fe),stats:$}}shouldDrawLayer(e){const{pickable:i,operation:n}=e.props;return i&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,i,n){const r={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:a,operation:u}=e.props;return!this._colorEncoderState||u.includes("terrain")?r.blend=!1:a&&u.includes("draw")&&(Object.assign(r,b8),r.blend=!0,r.blendColor=w8(this._colorEncoderState,e,n)),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function w8(t,e,i){const{byLayer:n,byAlpha:r}=t;let a,u=n.get(e);return u?(u.viewports.push(i),a=u.a):(a=n.size+1,a<=255?(u={a,layer:e,viewports:[i]},n.set(e,u),r[a]=u):(ai.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function A8(t,e){const i=t.byAlpha[e[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(e)}}const dh={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},N_=Symbol.for("component"),Fl=Symbol.for("propTypes"),Lv=Symbol.for("deprecatedProps"),zh=Symbol.for("asyncPropDefaults"),Yc=Symbol.for("asyncPropOriginal"),Ml=Symbol.for("asyncPropResolved");function ed(t,e=()=>!0){return Array.isArray(t)?GP(t,e,[]):e(t)?[t]:[]}function GP(t,e,i){let n=-1;for(;++n<t.length;){const r=t[n];Array.isArray(r)?GP(r,e,i):e(r)&&i.push(r)}return i}function T8({target:t,source:e,start:i=0,count:n=1}){const r=e.length,a=n*r;let u=0;for(let l=i;u<r;u++)t[l++]=e[u];for(;u<a;)u<a-u?(t.copyWithin(i+u,i,i+u),u*=2):(t.copyWithin(i+u,i,i+a-u),u=a);return t}class E8{constructor(e,i,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(i)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,i){if(e===this._data&&!i)return;this._data=e;const n=++this._loadCount;let r=e;typeof e=="string"&&(r=Wl(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(a=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=a)}).catch(a=>{this._loadCount===n&&(this.isLoaded=!0,this._error=a||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const a of this._subscribers)a.onChange(this.getData())}}class S8{constructor(e){var i;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(i=e.device)==null?void 0:i.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:i,forceUpdate:n=!1,persistent:r=!0}){let a=this._resources[e];a?a.setData(i,n):(a=new E8(e,i,this._context),this._resources[e]=a),a.persistent=r}remove(e){const i=this._resources[e];i&&(i.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const i=this._consumers[e];if(i){for(const n in i){const r=i[n],a=this._resources[r.resourceId];a&&a.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:i,consumerId:n,requestId:r="default"}){const{_resources:a,protocol:u}=this;e.startsWith(u)&&(e=e.replace(u,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=a[e];if(this._track(n,r,l,i),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,i,n,r){const a=this._consumers,u=a[e]=a[e]||{};let l=u[i];const _=l&&l.resourceId&&this._resources[l.resourceId];_&&(_.unsubscribe(l),this.prune()),n&&(l?(l.onChange=r,l.resourceId=n.id):l={onChange:r,resourceId:n.id},u[i]=l,n.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const i=this._resources[e];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[e])}}}const C8="layerManager.setLayers",I8="layerManager.activateViewport";class R8{constructor(e,i){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=l=>{Tr(I8,this,l),l&&(this.context.viewport=l)};const{deck:n,stats:r,viewport:a,timeline:u}=i||{};this.layers=[],this.resourceManager=new S8({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:n,shaderAssembler:N5(),defaultShaderModules:[],renderPass:void 0,stats:r||new fd({id:"deck.gl"}),viewport:a||new Zp({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:u||new HP,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const r=n.getNeedsRedraw(e);i=i||r}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(i=>e.find(n=>i.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,i){Tr(C8,this,i,e),this._lastRenderedLayers=e;const n=ed(e,Boolean);for(const r of n)r.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:i}=this.context;i.find(n=>n.name===e.name)||(i.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:i}=this.context,n=i.findIndex(r=>r.name===e.name);n>=0&&(i.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,i,n){n.raiseError(i,`${e} of ${n}`)}_updateLayers(e,i){const n={};for(const u of e)n[u.id]?ai.warn(`Multiple old layers with same id ${u.id}`)():n[u.id]=u;if(this._defaultShaderModulesChanged){for(const u of e)u.setNeedsUpdate(),u.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const r=[];this._updateSublayersRecursively(i,n,r),this._finalizeOldLayers(n);let a=!1;for(const u of r)if(u.hasUniformTransition()){a=`Uniform transition in ${u}`;break}this._needsUpdate=a,this.layers=r}_updateSublayersRecursively(e,i,n){for(const r of e){r.context=this.context;const a=i[r.id];a===null&&ai.warn(`Multiple new layers with same id ${r.id}`)(),i[r.id]=null;let u=null;try{this._debug&&a!==r&&r.validateProps(),a?(this._transferLayerState(a,r),this._updateLayer(r)):this._initializeLayer(r),n.push(r),u=r.isComposite?r.getSubLayers():null}catch(l){this._handleError("matching",l,r)}u&&this._updateSublayersRecursively(u,i,n)}}_finalizeOldLayers(e){for(const i in e){const n=e[i];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=dh.INITIALIZED}catch(i){this._handleError("initialization",i,e)}}_transferLayerState(e,i){i._transferState(e),i.lifecycle=dh.MATCHED,i!==e&&(e.lifecycle=dh.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(i){this._handleError("update",i,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=dh.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=dh.FINALIZED}catch(i){this._handleError("finalization",i,e)}}}function yo(t,e,i){if(t===e)return!0;if(!i||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!yo(t[n],e[n],i-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const a of n)if(!e.hasOwnProperty(a)||!yo(t[a],e[a],i-1))return!1;return!0}return!1}class P8{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const i=this.controllers[e];i&&i.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const i=this.controllers[e];i&&i.updateTransition()}}getViewports(e){return e?this._viewports.filter(i=>i.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(i=>{e[i.id]=i}),e}getView(e){return this.views.find(i=>i.id===e)}getViewState(e){const i=typeof e=="string"?this.getView(e):e,n=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,i){const n=this.getViewports(),r={x:e[0],y:e[1]};for(let a=n.length-1;a>=0;--a){const u=n[a];if(u.containsPixel(r)){const l=e.slice();return l[0]-=u.x,l[1]-=u.y,u.unproject(l,i)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,i){(e!==this.width||i!==this.height)&&(this.width=e,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(e){e=ed(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!yo(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ai.warn("missing `viewState` or `initialViewState`")()}_createController(e,i){const n=i.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:a=>{var u;return(u=this.getView(e.id))==null?void 0:u.makeViewport({viewState:a,width:this.width,height:this.height})}})}_updateController(e,i,n,r){const a=e.controller;if(a&&n){const u={...i,...a,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!r||r.constructor!==a.type)&&(r=this._createController(e,u)),r&&r.setProps(u),r}return null}_rebuildViewports(){const{views:e}=this,i=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let r=e.length;r--;){const a=e[r],u=this.getViewState(a),l=a.makeViewport({viewState:u,width:this.width,height:this.height});let _=i[a.id];const w=!!a.controller;w&&!_&&(n=!0),(n||!w)&&_&&(_.finalize(),_=null),this.controllers[a.id]=this._updateController(a,u,l,_),l&&this._viewports.unshift(l)}for(const r in i){const a=i[r];a&&!this.controllers[r]&&a.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,i){return e.length!==i.length?!0:e.some((n,r)=>!e[r].equals(i[r]))}}const M8=/([0-9]+\.?[0-9]*)(%|px)/;function yl(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=M8.exec(t);if(e&&e.length>=3){const i=e[2]==="%",n=parseFloat(e[1]);return{position:i?n/100:n,relative:i}}default:throw new Error(`Could not parse position string ${t}`)}}function vl(t,e){return t.relative?Math.round(t.position*e):t.position}class B8{constructor(e){const{id:i,x:n=0,y:r=0,width:a="100%",height:u="100%",padding:l=null}=e;this.id=i||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=yl(n),this._y=yl(r),this._width=yl(a),this._height=yl(u),this._padding=l&&{left:yl(l.left||0),right:yl(l.right||0),top:yl(l.top||0),bottom:yl(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&yo(this.props,e.props,2)}makeViewport({width:e,height:i,viewState:n}){n=this.filterViewState(n);const r=this.getDimensions({width:e,height:i});return!r.height||!r.width?null:new this.ViewportType({...n,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...e};for(const n in this.props.viewState)n!=="id"&&(i[n]=this.props.viewState[n]);return i}return e}getDimensions({width:e,height:i}){const n={x:vl(this._x,e),y:vl(this._y,i),width:vl(this._width,e),height:vl(this._height,i)};return this._padding&&(n.padding={left:vl(this._padding.left,e),top:vl(this._padding.top,i),right:vl(this._padding.right,e),bottom:vl(this._padding.bottom,i)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Ny{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var i,n;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)==null||n.call(i,this)}end(){var e,i;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(i=(e=this.settings).onEnd)==null||i.call(e,this))}cancel(){var e,i;this._inProgress&&((i=(e=this.settings).onInterrupt)==null||i.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,i;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:r}=this;this._handle=n.addChannel({delay:n.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(i=(e=this.settings).onUpdate)==null||i.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const zS=()=>{},Tx={BREAK:1,SNAP_TO_END:2,IGNORE:3},D8=t=>t,O8=Tx.BREAK;class k8{constructor(e){this._onTransitionUpdate=i=>{const{time:n,settings:{interpolator:r,startProps:a,endProps:u,duration:l,easing:_}}=i,w=_(n/l),E=r.interpolateProps(a,u,w);this.propsInTransition=this.getControllerState({...this.props,...E}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Ny(e.timeline),this.onViewStateChange=e.onViewStateChange||zS,this.onStateChange=e.onStateChange||zS}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let i=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let r=n;if(this.transition.inProgress){const{interruption:a,endProps:u}=this.transition.settings;r={...n,...a===Tx.SNAP_TO_END?u:this.propsInTransition||n}}this._triggerTransition(r,e),i=!0}else this.transition.cancel();return i}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:i,transitionInterpolator:n}=e;return(i>0||i==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,i){return this.transition.inProgress?this.transition.settings.interruption===Tx.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(e,i):!0}_triggerTransition(e,i){const n=this.getControllerState(e),r=this.getControllerState(i).shortestPathFrom(n),a=i.transitionInterpolator,u=a.getDuration?a.getDuration(e,i):i.transitionDuration;if(u===0)return;const l=a.initializeProps(e,r);this.propsInTransition={};const _={duration:u,easing:i.transitionEasing||D8,interpolator:a,interruption:i.transitionInterruption||O8,startProps:l.start,endProps:l.end,onStart:i.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(i.onTransitionInterrupt),onEnd:this._onTransitionEnd(i.onTransitionEnd)};this.transition.start(_),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return i=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(i)}}}function Tn(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class F8{constructor(e){const{compare:i,extract:n,required:r}=e;this._propsToCompare=i,this._propsToExtract=n||i,this._requiredProps=r}arePropsEqual(e,i){for(const n of this._propsToCompare)if(!(n in e)||!(n in i)||!xo(e[n],i[n]))return!1;return!0}initializeProps(e,i){const n={},r={};for(const a of this._propsToExtract)(a in e||a in i)&&(n[a]=e[a],r[a]=i[a]);return this._checkRequiredProps(n),this._checkRequiredProps(r),{start:n,end:r}}getDuration(e,i){return i.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(i=>{const n=e[i];Tn(Number.isFinite(n)||Array.isArray(n),`${i} is required for transition`)})}}const N8=["longitude","latitude","zoom","bearing","pitch"],L8=["longitude","latitude","zoom"];class WP extends F8{constructor(e={}){const i=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(i)?{compare:i,required:i}:i||{compare:N8,required:L8},super(n.transitionProps),this.opts=n}initializeProps(e,i){const n=super.initializeProps(e,i),{makeViewport:r,around:a}=this.opts;if(r&&a){const u=r(e),l=r(i),_=u.unproject(a);n.start.around=a,Object.assign(n.end,{around:l.project(_),aroundPosition:_,width:i.width,height:i.height})}return n}interpolateProps(e,i,n){const r={};for(const a of this._propsToExtract)r[a]=B_(e[a]||0,i[a]||0,n);if(i.aroundPosition&&this.opts.makeViewport){const a=this.opts.makeViewport({...i,...r});Object.assign(r,a.panByPosition(i.aroundPosition,B_(e.around,i.around,n)))}return r}}const xl={transitionDuration:0},U8=300,_g=t=>1-(1-t)*(1-t),ah={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Rc={};class z8{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new k8({...e,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const i in this._events)this._events[i]&&((e=this.eventManager)==null||e.off(i,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const i=this._eventStartBlocked;switch(e.type){case"panstart":return i?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return i?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return i?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:i,y:n}=this.props,{offsetCenter:r}=e;return[r.x-i,r.y-n]}isPointInBounds(e,i){const{width:n,height:r}=this.props;if(i&&i.handled)return!1;const a=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=r;return a&&i&&i.stopPropagation(),a}isFunctionKeyPressed(e){const{srcEvent:i}=e;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=i}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:i}=e;this.inertia=Number.isFinite(i)?i:i===!0?U8:0;const{scrollZoom:n=!0,dragPan:r=!0,dragRotate:a=!0,doubleClickZoom:u=!0,touchZoom:l=!0,touchRotate:_=!1,keyboard:w=!0}=e,E=!!this.onViewStateChange;this.toggleEvents(ah.WHEEL,E&&n),this.toggleEvents(ah.PAN,E),this.toggleEvents(ah.PINCH,E&&(l||_)),this.toggleEvents(ah.TRIPLE_PAN,E&&_),this.toggleEvents(ah.DOUBLE_TAP,E&&u),this.toggleEvents(ah.KEYBOARD,E&&w),this.scrollZoom=n,this.dragPan=r,this.dragRotate=a,this.doubleClickZoom=u,this.touchZoom=l,this.touchRotate=_,this.keyboard=w}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,i){this.eventManager&&e.forEach(n=>{this._events[n]!==i&&(this._events[n]=i,i?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,i=null,n={}){const r={...e.getViewportProps(),...i},a=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),a){const u=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:u,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const r=this.controllerState[n?"panStart":"rotateStart"]({pos:i});return this._panMove=n,this.updateViewport(r,xl,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const i=this.getCenter(e),n=this.controllerState.pan({pos:i});return this.updateViewport(n,xl,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:i}=this;if(this.dragPan&&i&&e.velocity){const n=this.getCenter(e),r=[n[0]+e.velocityX*i/2,n[1]+e.velocityY*i/2],a=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:_g},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const i=this.getCenter(e),n=this.controllerState.rotate({pos:i});return this.updateViewport(n,xl,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:i}=this;if(this.dragRotate&&i&&e.velocity){const n=this.getCenter(e),r=[n[0]+e.velocityX*i/2,n[1]+e.velocityY*i/2],a=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:_g},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:a}=e;let u=2/(1+Math.exp(-Math.abs(a*n)));a<0&&u!==0&&(u=1/u);const l=this.controllerState.zoom({pos:i,scale:u});return this.updateViewport(l,{...this._getTransitionProps({around:i}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.controllerState.rotateStart({pos:i});return this.updateViewport(n,xl,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(e);i[0]-=e.deltaX;const n=this.controllerState.rotate({pos:i});return this.updateViewport(n,xl,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&e.velocityY){const n=this.getCenter(e),r=[n[0],n[1]+=e.velocityY*i/2],a=this.controllerState.rotate({pos:r});this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:_g},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return Rc._startPinchRotation=e.rotation,Rc._lastPinchEvent=e,this.updateViewport(n,xl,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:n}=e,r=this.getCenter(e);i=i.zoom({pos:r,scale:n})}if(this.touchRotate){const{rotation:n}=e;i=i.rotate({deltaAngleX:Rc._startPinchRotation-n})}return this.updateViewport(i,xl,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Rc._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:n}=Rc;if(this.touchZoom&&i&&n&&e.scale!==n.scale){const r=this.getCenter(e);let a=this.controllerState.rotateEnd();const u=Math.log2(e.scale),l=(u-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),_=Math.pow(2,u+l*i/2);a=a.zoom({pos:r,scale:_}).zoomEnd(),this.updateViewport(a,{...this._getTransitionProps({around:r}),transitionDuration:i,transitionEasing:_g},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Rc._startPinchRotation=null,Rc._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const i=this.getCenter(e);if(!this.isPointInBounds(i,e))return!1;const n=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:i,scale:n?.5:2});return this.updateViewport(r,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:r,rotateSpeedX:a,rotateSpeedY:u}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let _;const w={};switch(e.srcEvent.code){case"Minus":_=i?l.zoomOut(n).zoomOut(n):l.zoomOut(n),w.isZooming=!0;break;case"Equal":_=i?l.zoomIn(n).zoomIn(n):l.zoomIn(n),w.isZooming=!0;break;case"ArrowLeft":i?(_=l.rotateLeft(a),w.isRotating=!0):(_=l.moveLeft(r),w.isPanning=!0);break;case"ArrowRight":i?(_=l.rotateRight(a),w.isRotating=!0):(_=l.moveRight(r),w.isPanning=!0);break;case"ArrowUp":i?(_=l.rotateUp(u),w.isRotating=!0):(_=l.moveUp(r),w.isPanning=!0);break;case"ArrowDown":i?(_=l.rotateDown(u),w.isRotating=!0):(_=l.moveDown(r),w.isPanning=!0);break;default:return!1}return this.updateViewport(_,this._getTransitionProps(),w),!0}_getTransitionProps(e){const{transition:i}=this;return!i||!i.transitionInterpolator?xl:e?{...i,transitionInterpolator:new WP({...e,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class V8{constructor(e,i){this._viewportProps=this.applyConstraints(e),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const VS=5,j8=1.2;class H8 extends V8{constructor(e){const{width:i,height:n,latitude:r,longitude:a,zoom:u,bearing:l=0,pitch:_=0,altitude:w=1.5,position:E=[0,0,0],maxZoom:I=20,minZoom:R=0,maxPitch:L=60,minPitch:W=0,startPanLngLat:K,startZoomLngLat:fe,startRotatePos:X,startBearing:$,startPitch:Q,startZoom:me,normalize:Ce=!0}=e;Tn(Number.isFinite(a)),Tn(Number.isFinite(r)),Tn(Number.isFinite(u)),super({width:i,height:n,latitude:r,longitude:a,zoom:u,bearing:l,pitch:_,altitude:w,maxZoom:I,minZoom:R,maxPitch:L,minPitch:W,normalize:Ce,position:E},{startPanLngLat:K,startZoomLngLat:fe,startRotatePos:X,startBearing:$,startPitch:Q,startZoom:me}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:i}){const n=this.getState().startPanLngLat||this._unproject(i);if(!n)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:i=0,deltaAngleY:n=0}){const{startRotatePos:r,startBearing:a,startPitch:u}=this.getState();if(!r||a===void 0||u===void 0)return this;let l;return e?l=this._getNewRotation(e,r,u,a):l={bearing:a+i,pitch:u+n},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:i,scale:n}){let{startZoom:r,startZoomLngLat:a}=this.getState();if(a||(r=this.getViewportProps().zoom,a=this._unproject(i)||this._unproject(e)),!a)return this;const{maxZoom:u,minZoom:l}=this.getViewportProps();let _=r+Math.log2(n);_=Ca(_,l,u);const w=this.makeViewport({...this.getViewportProps(),zoom:_});return this._getUpdatedState({zoom:_,...w.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const i=e.getViewportProps(),n={...this.getViewportProps()},{bearing:r,longitude:a}=n;return Math.abs(r-i.bearing)>180&&(n.bearing=r<0?r+360:r-360),Math.abs(a-i.longitude)>180&&(n.longitude=a<0?a+360:a-360),n}applyConstraints(e){const{maxZoom:i,minZoom:n,zoom:r}=e;e.zoom=Ca(r,n,i);const{maxPitch:a,minPitch:u,pitch:l}=e;e.pitch=Ca(l,u,a);const{normalize:_=!0}=e;return _&&Object.assign(e,T5(e)),e}_zoomFromCenter(e){const{width:i,height:n}=this.getViewportProps();return this.zoom({pos:[i/2,n/2],scale:e})}_panFromCenter(e){const{width:i,height:n}=this.getViewportProps();return this.pan({startPos:[i/2,n/2],pos:[i/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const i=this.makeViewport(this.getViewportProps());return e&&i.unproject(e)}_getNewRotation(e,i,n,r){const a=e[0]-i[0],u=e[1]-i[1],l=e[1],_=i[1],{width:w,height:E}=this.getViewportProps(),I=a/w;let R=0;u>0?Math.abs(E-_)>VS&&(R=u/(_-E)*j8):u<0&&_>VS&&(R=1-l/_),R=Ca(R,-1,1);const{minPitch:L,maxPitch:W}=this.getViewportProps(),K=r+180*I;let fe=n;return R>0?fe=n+R*(W-n):R<0&&(fe=n-R*(L-n)),{pitch:fe,bearing:K}}}class $8 extends z8{constructor(){super(...arguments),this.ControllerState=H8,this.transition={transitionDuration:300,transitionInterpolator:new WP({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const i=this.props;super.setProps(e),(!i||i.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class xw extends B8{constructor(e={}){super(e)}get ViewportType(){return Zc}get ControllerType(){return $8}}xw.displayName="MapView";const G8=new VP;function W8(t,e){const i=t.order??1/0,n=e.order??1/0;return i-n}class X8{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const i=this._defaultEffects;if(!i.find(n=>n.id===e.id)){const n=i.findIndex(r=>W8(r,e)>0);n<0?i.push(e):i.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(yo(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._resolvedEffects}_setEffects(e){const i={};for(const r of this.effects)i[r.id]=r;const n=[];for(const r of e){const a=i[r.id];let u=r;a&&a!==r?a.setProps?(a.setProps(r.props),u=a):a.cleanup(this._context):a||r.setup(this._context),n.push(u),delete i[r.id]}for(const r in i)i[r].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(r=>r instanceof VP)||this._resolvedEffects.push(G8),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class q8 extends vw{shouldDrawLayer(e){const{operation:i}=e.props;return i.includes("draw")||i.includes("terrain")}}const K8="deckRenderer.renderLayers";class Z8{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new q8(e),this.pickLayersPass=new $P(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const r=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const a=i.render({...n,target:r});n.effects&&this._postRender(n.effects,n),this.renderCount++,Tr(K8,this,a,e)}needsRedraw(e={clearRedrawFlags:!1}){const i=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:e}=this;for(const i of e)i.delete();e.length=0}_preRender(e,i){this.lastPostProcessEffect=null,i.preRenderStats=i.preRenderStats||{};for(const n of e)i.preRenderStats[n.id]=n.preRender(i),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,i=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const r=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[r]}))});for(const n of e)n.resize(i)}_postRender(e,i){const{renderBuffers:n}=this,r={...i,inputBuffer:n[0],swapBuffer:n[1]};for(const a of e)if(a.postRender){r.target=a.id===this.lastPostProcessEffect?i.target:void 0;const u=a.postRender(r);r.inputBuffer=u,r.swapBuffer=u===n[0]?n[1]:n[0]}}}const Y8={pickedColor:null,pickedObjectIndex:-1};function J8({pickedColors:t,decodePickingColor:e,deviceX:i,deviceY:n,deviceRadius:r,deviceRect:a}){const{x:u,y:l,width:_,height:w}=a;let E=r*r,I=-1,R=0;for(let L=0;L<w;L++){const W=L+l-n,K=W*W;if(K>E)R+=4*_;else for(let fe=0;fe<_;fe++){if(t[R+3]-1>=0){const $=fe+u-i,Q=$*$+K;Q<=E&&(E=Q,I=R)}R+=4}}if(I>=0){const L=t.slice(I,I+4),W=e(L);if(W){const K=Math.floor(I/4/_),fe=I/4-K*_;return{...W,pickedColor:L,pickedX:u+fe,pickedY:l+K}}ai.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Y8}function Q8({pickedColors:t,decodePickingColor:e}){const i=new Map;if(t){for(let n=0;n<t.length;n+=4)if(t[n+3]-1>=0){const a=t.slice(n,n+4),u=a.join(",");if(!i.has(u)){const l=e(a);l?i.set(u,{...l,color:a}):ai.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function XP({pickInfo:t,viewports:e,pixelRatio:i,x:n,y:r,z:a}){let u=e[0];e.length>1&&(u=tV((t==null?void 0:t.pickedViewports)||e,{x:n,y:r}));let l;if(u){const _=[n-u.x,r-u.y];a!==void 0&&(_[2]=a),l=u.unproject(_)}return{color:null,layer:null,viewport:u,index:-1,picked:!1,x:n,y:r,pixel:[n,r],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:i}}function eV(t){const{pickInfo:e,lastPickedInfo:i,mode:n,layers:r}=t,{pickedColor:a,pickedLayer:u,pickedObjectIndex:l}=e,_=u?[u]:[];if(n==="hover"){const I=i.index,R=i.layerId,L=u?u.props.id:null;if(L!==R||l!==I){if(L!==R){const W=r.find(K=>K.props.id===R);W&&_.unshift(W)}i.layerId=L,i.index=l,i.info=null}}const w=XP(t),E=new Map;return E.set(null,w),_.forEach(I=>{let R={...w};I===u&&(R.color=a,R.index=l,R.picked=!0),R=qP({layer:I,info:R,mode:n});const L=R.layer;I===u&&n==="hover"&&(i.info=R),E.set(L.id,R),n==="hover"&&L.updateAutoHighlight(R)}),E}function qP({layer:t,info:e,mode:i}){for(;t&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=t,e=t.getPickingInfo({info:e,mode:i,sourceLayer:n}),t=t.parent}return e}function tV(t,e){for(let i=t.length-1;i>=0;i--){const n=t[i];if(n.containsPixel(e))return n}return t[0]}class iV{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new $P(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:i,layers:n,viewports:r},a=this.lastPickedInfo.info){const u=a&&a.layer&&a.layer.id,l=a&&a.viewport&&a.viewport.id,_=u?n.find(R=>R.id===u):null,w=l&&r.find(R=>R.id===l)||r[0],E=w&&w.unproject([e-w.x,i-w.y]);return{...a,...{x:e,y:i,viewport:w,coordinate:E,layer:_}}}_resizeBuffer(){var i,n;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}const{canvas:e}=this.device.getCanvasContext();(i=this.pickingFBO)==null||i.resize({width:e.width,height:e.height}),(n=this.depthFBO)==null||n.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const i=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return i.length?i:null}_pickClosestObject({layers:e,views:i,viewports:n,x:r,y:a,radius:u=0,depth:l=1,mode:_="query",unproject3D:w,onViewportActive:E,effects:I}){const R=this.device.canvasContext.cssToDeviceRatio(),L=this._getPickable(e);if(!L||n.length===0)return{result:[],emptyInfo:XP({viewports:n,x:r,y:a,pixelRatio:R})};this._resizeBuffer();const W=this.device.canvasContext.cssToDevicePixels([r,a],!0),K=[W.x+Math.floor(W.width/2),W.y+Math.floor(W.height/2)],fe=Math.round(u*R),{width:X,height:$}=this.pickingFBO,Q=this._getPickingRect({deviceX:K[0],deviceY:K[1],deviceRadius:fe,deviceWidth:X,deviceHeight:$}),me={x:r-u,y:a-u,width:u*2+1,height:u*2+1};let Ce;const Be=[],Fe=new Set;for(let ze=0;ze<l;ze++){let Ve;if(Q){const Ke=this._drawAndSample({layers:L,views:i,viewports:n,onViewportActive:E,deviceRect:Q,cullRect:me,effects:I,pass:`picking:${_}`});Ve=J8({...Ke,deviceX:K[0],deviceY:K[1],deviceRadius:fe,deviceRect:Q})}else Ve={pickedColor:null,pickedObjectIndex:-1};let je;if(Ve.pickedLayer&&w&&this.depthFBO){const{pickedColors:Ke}=this._drawAndSample({layers:[Ve.pickedLayer],views:i,viewports:n,onViewportActive:E,deviceRect:{x:Ve.pickedX,y:Ve.pickedY,width:1,height:1},cullRect:me,effects:I,pass:`picking:${_}:z`},!0);Ke[3]&&(je=Ke[0])}Ve.pickedLayer&&ze+1<l&&(Fe.add(Ve.pickedLayer),Ve.pickedLayer.disablePickingIndex(Ve.pickedObjectIndex)),Ce=eV({pickInfo:Ve,lastPickedInfo:this.lastPickedInfo,mode:_,layers:L,viewports:n,x:r,y:a,z:je,pixelRatio:R});for(const Ke of Ce.values())Ke.layer&&Be.push(Ke);if(!Ve.pickedColor)break}for(const ze of Fe)ze.restorePickingColors();return{result:Be,emptyInfo:Ce.get(null)}}_pickVisibleObjects({layers:e,views:i,viewports:n,x:r,y:a,width:u=1,height:l=1,mode:_="query",maxObjects:w=null,onViewportActive:E,effects:I}){const R=this._getPickable(e);if(!R||n.length===0)return[];this._resizeBuffer();const L=this.device.canvasContext.cssToDeviceRatio(),W=this.device.canvasContext.cssToDevicePixels([r,a],!0),K=W.x,fe=W.y+W.height,X=this.device.canvasContext.cssToDevicePixels([r+u,a+l],!0),$=X.x+X.width,Q=X.y,me={x:K,y:Q,width:$-K,height:fe-Q},Ce=this._drawAndSample({layers:R,views:i,viewports:n,onViewportActive:E,deviceRect:me,cullRect:{x:r,y:a,width:u,height:l},effects:I,pass:`picking:${_}`}),Be=Q8(Ce),Fe=new Map,ze=[],Ve=Number.isFinite(w);for(let je=0;je<Be.length&&!(Ve&&ze.length>=w);je++){const Ke=Be[je];let Lt={color:Ke.pickedColor,layer:null,index:Ke.pickedObjectIndex,picked:!0,x:r,y:a,pixelRatio:L};Lt=qP({layer:Ke.pickedLayer,info:Lt,mode:_});const Pt=Lt.layer.id;Fe.has(Pt)||Fe.set(Pt,new Set);const bt=Fe.get(Pt),_i=Lt.object??Lt.index;bt.has(_i)||(bt.add(_i),ze.push(Lt))}return ze}_drawAndSample({layers:e,views:i,viewports:n,onViewportActive:r,deviceRect:a,cullRect:u,effects:l,pass:_},w=!1){const E=w?this.depthFBO:this.pickingFBO,I={layers:e,layerFilter:this.layerFilter,views:i,viewports:n,onViewportActive:r,pickingFBO:E,deviceRect:a,cullRect:u,effects:l,pass:_,pickZ:w,preRenderStats:{}};for(const $ of l)$.useInPicking&&(I.preRenderStats[$.id]=$.preRender(I));const{decodePickingColor:R}=this.pickLayersPass.render(I),{x:L,y:W,width:K,height:fe}=a,X=new(w?Float32Array:Uint8Array)(K*fe*4);return this.device.readPixelsToArrayWebGL(E,{sourceX:L,sourceY:W,sourceWidth:K,sourceHeight:fe,target:X}),{pickedColors:X,decodePickingColor:R}}_getPickingRect({deviceX:e,deviceY:i,deviceRadius:n,deviceWidth:r,deviceHeight:a}){const u=Math.max(0,e-n),l=Math.max(0,i-n),_=Math.min(r,e+n+1)-u,w=Math.min(a,i+n+1)-l;return _<=0||w<=0?null:{x:u,y:l,width:_,height:w}}}const nV={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},rV="top-left",jS="__root";class sV{constructor({deck:e,parentElement:i}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=i}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!yo(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(i=>i.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const i={};for(const n of this.resolvedWidgets)i[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)i[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const r=i[n.id];r?r.viewId!==n.viewId||r.placement!==n.placement?(this._remove(r),this._add(n)):n!==r&&(r.setProps(n.props),n=r):this._add(n),i[n.id]=null,this.resolvedWidgets.push(n)}for(const n in i){const r=i[n];r&&this._remove(r)}this.widgets=e}_add(e){const{viewId:i=null,placement:n=rV}=e,r=e.onAdd({deck:this.deck,viewId:i});r&&this._getContainer(i,n).append(r),e._element=r}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,i){var u;const n=e||jS;let r=this.containers[n];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",(u=this.parentElement)==null||u.append(r),this.containers[n]=r);let a=r.querySelector(`.${i}`);return a||(a=document.createElement("div"),a.className=i,a.style.position="absolute",a.style.zIndex="2",Object.assign(a.style,nV[i]),r.append(a)),a}_updateContainers(){const e=this.deck.width,i=this.deck.height;for(const n in this.containers){const r=this.lastViewports[n]||null,a=n===jS||r,u=this.containers[n];a?(u.style.display="block",u.style.left=`${r?r.x:0}px`,u.style.top=`${r?r.y:0}px`,u.style.width=`${r?r.width:e}px`,u.style.height=`${r?r.height:i}px`):u.style.display="none"}}onRedraw({viewports:e,layers:i}){var a,u;const n=e.reduce((l,_)=>(l[_.id]=_,l),{}),{lastViewports:r}=this;for(const l of this.getWidgets()){const{viewId:_}=l;if(_){const w=n[_];w&&(l.onViewportChange&&!w.equals(r[_])&&l.onViewportChange(w),(a=l.onRedraw)==null||a.call(l,{viewports:[w],layers:i}))}else{if(l.onViewportChange)for(const w of e)w.equals(r[w.id])||l.onViewportChange(w);(u=l.onRedraw)==null||u.call(l,{viewports:e,layers:i})}}this.lastViewports=n,this._updateContainers()}onHover(e,i){var n,r;for(const a of this.getWidgets()){const{viewId:u}=a;(!u||u===((n=e.viewport)==null?void 0:n.id))&&((r=a.onHover)==null||r.call(a,e,i))}}onEvent(e,i){var r,a;const n=_x[i.type];if(n)for(const u of this.getWidgets()){const{viewId:l}=u;(!l||l===((r=e.viewport)==null?void 0:r.id))&&((a=u[n.handler])==null||a.call(u,e,i))}}}const oV={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class aV{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const i=document.createElement("div");return i.className="deck-tooltip",Object.assign(i.style,oV),this.deck=e,this.element=i,i}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var i;this.isVisible&&e.id===((i=this.lastViewport)==null?void 0:i.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:i}=this,n=i&&i.props.getTooltip;if(!n)return;const r=n(e);this.lastViewport=e.viewport,this.setTooltip(r,e.x,e.y)}setTooltip(e,i,n){const r=this.element;if(r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${i}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(r.style,e.style)}}}var mh;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(mh||(mh={}));const bw={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},wn=(t,e,i)=>e?t.enable(i):t.disable(i),HS=(t,e,i)=>t.hint(i,e),xs=(t,e,i)=>t.pixelStorei(i,e),$S=(t,e,i)=>{const n=i===36006?36009:36008;return t.bindFramebuffer(n,e)},wf=(t,e,i)=>{const r={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[i];t.bindBuffer(r,e)};function Uv(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const lV={3042:wn,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:wn,2885:(t,e)=>t.cullFace(e),2929:wn,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:wn,35723:HS,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var i;return(i=t.bindTransformFeedback)==null?void 0:i.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:$S,36010:$S,34964:wf,36662:wf,36663:wf,35053:wf,35055:wf,2886:(t,e)=>t.frontFace(e),33170:HS,2849:(t,e)=>t.lineWidth(e),32823:wn,32824:"polygonOffset",10752:"polygonOffset",35977:wn,32926:wn,32928:wn,32938:"sampleCoverage",32939:"sampleCoverage",3089:wn,3088:(t,e)=>t.scissor(...e),2960:wn,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:wn,10754:wn,12288:wn,12289:wn,12290:wn,12291:wn,12292:wn,12293:wn,12294:wn,12295:wn,3333:xs,3317:xs,37440:xs,37441:xs,37443:xs,3330:xs,3332:xs,3331:xs,3314:xs,32878:xs,3316:xs,3315:xs,32877:xs,framebuffer:(t,e)=>{const i=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,i)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const i=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...i)},blendFunc:(t,e)=>{const i=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...i)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Uv(e)?e:[e,e];const[i,n]=e;t.stencilMaskSeparate(1028,i),t.stencilMaskSeparate(1029,n)},stencilFunc:(t,e)=>{e=Uv(e)&&e.length===3?[...e,...e]:e;const[i,n,r,a,u,l]=e;t.stencilFuncSeparate(1028,i,n,r),t.stencilFuncSeparate(1029,a,u,l)},stencilOp:(t,e)=>{e=Uv(e)&&e.length===3?[...e,...e]:e;const[i,n,r,a,u,l]=e;t.stencilOpSeparate(1028,i,n,r),t.stencilOpSeparate(1029,a,u,l)},viewport:(t,e)=>t.viewport(...e)};function cn(t,e,i){return e[t]!==void 0?e[t]:i[t]}const cV={blendEquation:(t,e,i)=>t.blendEquationSeparate(cn(32777,e,i),cn(34877,e,i)),blendFunc:(t,e,i)=>t.blendFuncSeparate(cn(32969,e,i),cn(32968,e,i),cn(32971,e,i),cn(32970,e,i)),polygonOffset:(t,e,i)=>t.polygonOffset(cn(32824,e,i),cn(10752,e,i)),sampleCoverage:(t,e,i)=>t.sampleCoverage(cn(32938,e,i),cn(32939,e,i)),stencilFuncFront:(t,e,i)=>t.stencilFuncSeparate(1028,cn(2962,e,i),cn(2967,e,i),cn(2963,e,i)),stencilFuncBack:(t,e,i)=>t.stencilFuncSeparate(1029,cn(34816,e,i),cn(36003,e,i),cn(36004,e,i)),stencilOpFront:(t,e,i)=>t.stencilOpSeparate(1028,cn(2964,e,i),cn(2965,e,i),cn(2966,e,i)),stencilOpBack:(t,e,i)=>t.stencilOpSeparate(1029,cn(34817,e,i),cn(34818,e,i),cn(34819,e,i))},GS={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,i)=>t({[e]:i}),hint:(t,e,i)=>t({[e]:i}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,i)=>t({36007:i}),bindTransformFeedback:(t,e,i)=>t({36389:i}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,i)=>{switch(e){case 36160:return t({36006:i,36010:i});case 36009:return t({36006:i});case 36008:return t({36010:i});default:return null}},bindBuffer:(t,e,i)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?t({[n]:i}):{valueChanged:!0}},blendColor:(t,e,i,n,r)=>t({32773:new Float32Array([e,i,n,r])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,i)=>t({32777:e,34877:i}),blendFunc:(t,e,i)=>t({32969:e,32968:i,32971:e,32970:i}),blendFuncSeparate:(t,e,i,n,r)=>t({32969:e,32968:i,32971:n,32970:r}),clearColor:(t,e,i,n,r)=>t({3106:new Float32Array([e,i,n,r])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,i,n,r)=>t({3107:[e,i,n,r]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,i)=>t({2928:new Float32Array([e,i])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,i)=>t({32824:e,10752:i}),sampleCoverage:(t,e,i)=>t({32938:e,32939:i}),scissor:(t,e,i,n,r)=>t({3088:new Int32Array([e,i,n,r])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,i)=>t({[e===1028?2968:36005]:i}),stencilFunc:(t,e,i,n)=>t({2962:e,2967:i,2963:n,34816:e,36003:i,36004:n}),stencilFuncSeparate:(t,e,i,n,r)=>t({[e===1028?2962:34816]:i,[e===1028?2967:36003]:n,[e===1028?2963:36004]:r}),stencilOp:(t,e,i,n)=>t({2964:e,2965:i,2966:n,34817:e,34818:i,34819:n}),stencilOpSeparate:(t,e,i,n,r)=>t({[e===1028?2964:34817]:i,[e===1028?2965:34818]:n,[e===1028?2966:34819]:r}),viewport:(t,e,i,n,r)=>t({2978:[e,i,n,r]})},Vo=(t,e)=>t.isEnabled(e),WS={3042:Vo,2884:Vo,2929:Vo,3024:Vo,32823:Vo,32926:Vo,32928:Vo,3089:Vo,2960:Vo,35977:Vo},uV=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function pd(t,e){if(dV(e))return;const i={};for(const r in e){const a=Number(r),u=lV[r];u&&(typeof u=="string"?i[u]=!0:u(t,e[r],a))}const n=t.state&&t.state.cache;if(n)for(const r in i){const a=cV[r];a(t,e,n)}}function KP(t,e=bw){if(typeof e=="number"){const r=e,a=WS[r];return a?a(t,r):t.getParameter(r)}const i=Array.isArray(e)?e:Object.keys(e),n={};for(const r of i){const a=WS[r];n[r]=a?a(t,Number(r)):t.getParameter(Number(r))}return n}function hV(t){pd(t,bw)}function dV(t){for(const e in t)return!1;return!0}function fV(t,e){if(t===e)return!0;const i=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(e)||ArrayBuffer.isView(e);if(i&&n&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}class pV{constructor(e,{copyState:i=!1,log:n=()=>{}}={}){k(this,"gl");k(this,"program",null);k(this,"stateStack",[]);k(this,"enable",!0);k(this,"cache");k(this,"log");this.gl=e,this.cache=i?KP(e):Object.assign({},bw),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){fi(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];pd(this.gl,e),this.stateStack.pop()}_updateCache(e){let i=!1,n;const r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const a in e){fi(a!==void 0);const u=e[a],l=this.cache[a];fV(u,l)||(i=!0,n=l,r&&!(a in r)&&(r[a]=l),this.cache[a]=u)}return{valueChanged:i,oldValue:n}}}function Jc(t){return t.state}function ZP(t,e){const{enable:i=!0,copyState:n}=e;if(fi(n!==void 0),!t.state){t.state=new pV(t,{copyState:n}),gV(t);for(const a in GS){const u=GS[a];mV(t,a,u)}XS(t,"getParameter"),XS(t,"isEnabled")}const r=Jc(t);return r.enable=i,t}function Ly(t){let e=Jc(t);e||(ZP(t,{copyState:!1}),e=Jc(t)),e.push()}function vp(t){const e=Jc(t);fi(e),e.pop()}function XS(t,e){const i=t[e].bind(t);t[e]=function(r){if(r===void 0||uV.has(r))return i(r);const a=Jc(t);return r in a.cache||(a.cache[r]=i(r)),a.enable?a.cache[r]:i(r)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function mV(t,e,i){if(!t[e])return;const n=t[e].bind(t);t[e]=function(...a){const u=Jc(t),{valueChanged:l,oldValue:_}=i(u._updateCache,...a);return l&&n(...a),_},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function gV(t){const e=t.useProgram.bind(t);t.useProgram=function(n){const r=Jc(t);r.program!==n&&(e(n),r.program=n)}}const _V={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function yV(t,e){e={..._V,...e};let i=null;const n=a=>i=a.statusMessage||i;t.addEventListener("webglcontextcreationerror",n,!1);let r=null;if(r||(r=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",n,!1),!r)throw new Error(`Failed to create WebGL context: ${i||"Unknown error"}`);if(e.onContextLost){const{onContextLost:a}=e;t.addEventListener("webglcontextlost",u=>a(u),!1)}if(e.onContextRestored){const{onContextRestored:a}=e;t.addEventListener("webglcontextrestored",u=>a(u),!1)}return r}function ql(t,e,i){return i[e]===void 0&&(i[e]=t.getExtension(e)||null),i[e]}function vV(t,e){const i=t.getParameter(7936),n=t.getParameter(7937);ql(t,"WEBGL_debug_renderer_info",e);const r=e.WEBGL_debug_renderer_info,a=t.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936),u=t.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937),l=a||i,_=u||n,w=t.getParameter(7938),E=YP(l,_),I=xV(l,_),R=bV(l,_);return{type:"webgl",gpu:E,gpuType:R,gpuBackend:I,vendor:l,renderer:_,version:w,shadingLanguage:"glsl",shadingLanguageVersion:300}}function YP(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function xV(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function bV(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(YP(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function JP(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const br="texture-compression-bc",Ii="texture-compression-astc",jo="texture-compression-etc2",wV="texture-compression-etc1-webgl",yg="texture-compression-pvrtc-webgl",zv="texture-compression-atc-webgl",Af="float32-renderable-webgl",Vv="float16-renderable-webgl",AV="rgb9e5ufloat_renderable-webgl",jv="snorm8-renderable-webgl",Tf="norm16-renderable-webgl",Hv="snorm16-renderable-webgl",vg="float32-filterable",qS="float16-filterable-webgl",jf="WEBGL_compressed_texture_s3tc",Hf="WEBGL_compressed_texture_s3tc_srgb",gh="EXT_texture_compression_rgtc",_h="EXT_texture_compression_bptc",TV="WEBGL_compressed_texture_etc",EV="WEBGL_compressed_texture_astc",SV="WEBGL_compressed_texture_etc1",CV="WEBGL_compressed_texture_pvrtc",IV="WEBGL_compressed_texture_atc",KS="EXT_texture_norm16",ZS="EXT_render_snorm",RV="EXT_color_buffer_float",ww={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[ZS],"norm16-renderable-webgl":[KS],"snorm16-renderable-webgl":[KS,ZS],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[jf,Hf,gh,_h],"texture-compression-bc5-webgl":[gh],"texture-compression-bc7-webgl":[_h],"texture-compression-etc2":[TV],"texture-compression-astc":[EV],"texture-compression-etc1-webgl":[SV],"texture-compression-pvrtc-webgl":[CV],"texture-compression-atc-webgl":[IV]};function PV(t){return t in ww}function MV(t,e,i){return(ww[e]||[]).every(r=>ql(t,r,i))}const Uy={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:jv},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:jv},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:Vv,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:Tf,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:Hv},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:jv},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:Vv,filter:qS,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:Tf},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:Hv},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:Af,filter:vg},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:AV},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:Af,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:Tf},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:Tf},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:Af,filter:vg,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:Vv,filter:qS},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:Tf,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:Hv},"rgb32float-webgl":{gl:34837,render:Af,filter:vg,gl2ext:RV,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:Af,filter:vg,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:jf,f:br},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Hf,f:br},"bc1-rgba-unorm":{gl:33777,x:jf,f:br},"bc1-rgba-unorm-srgb":{gl:35916,x:Hf,f:br},"bc2-rgba-unorm":{gl:33778,x:jf,f:br},"bc2-rgba-unorm-srgb":{gl:35918,x:Hf,f:br},"bc3-rgba-unorm":{gl:33779,x:jf,f:br},"bc3-rgba-unorm-srgb":{gl:35919,x:Hf,f:br},"bc4-r-unorm":{gl:36283,x:gh,f:br},"bc4-r-snorm":{gl:36284,x:gh,f:br},"bc5-rg-unorm":{gl:36285,x:gh,f:br},"bc5-rg-snorm":{gl:36286,x:gh,f:br},"bc6h-rgb-ufloat":{gl:36495,x:_h,f:br},"bc6h-rgb-float":{gl:36494,x:_h,f:br},"bc7-rgba-unorm":{gl:36492,x:_h,f:br},"bc7-rgba-unorm-srgb":{gl:36493,x:_h,f:br},"etc2-rgb8unorm":{gl:37492,f:jo},"etc2-rgb8unorm-srgb":{gl:37494,f:jo},"etc2-rgb8a1unorm":{gl:37496,f:jo},"etc2-rgb8a1unorm-srgb":{gl:37497,f:jo},"etc2-rgba8unorm":{gl:37493,f:jo},"etc2-rgba8unorm-srgb":{gl:37495,f:jo},"eac-r11unorm":{gl:37488,f:jo},"eac-r11snorm":{gl:37489,f:jo},"eac-rg11unorm":{gl:37490,f:jo},"eac-rg11snorm":{gl:37491,f:jo},"astc-4x4-unorm":{gl:37808,f:Ii},"astc-4x4-unorm-srgb":{gl:37840,f:Ii},"astc-5x4-unorm":{gl:37809,f:Ii},"astc-5x4-unorm-srgb":{gl:37841,f:Ii},"astc-5x5-unorm":{gl:37810,f:Ii},"astc-5x5-unorm-srgb":{gl:37842,f:Ii},"astc-6x5-unorm":{gl:37811,f:Ii},"astc-6x5-unorm-srgb":{gl:37843,f:Ii},"astc-6x6-unorm":{gl:37812,f:Ii},"astc-6x6-unorm-srgb":{gl:37844,f:Ii},"astc-8x5-unorm":{gl:37813,f:Ii},"astc-8x5-unorm-srgb":{gl:37845,f:Ii},"astc-8x6-unorm":{gl:37814,f:Ii},"astc-8x6-unorm-srgb":{gl:37846,f:Ii},"astc-8x8-unorm":{gl:37815,f:Ii},"astc-8x8-unorm-srgb":{gl:37847,f:Ii},"astc-10x5-unorm":{gl:37819,f:Ii},"astc-10x5-unorm-srgb":{gl:37851,f:Ii},"astc-10x6-unorm":{gl:37817,f:Ii},"astc-10x6-unorm-srgb":{gl:37849,f:Ii},"astc-10x8-unorm":{gl:37818,f:Ii},"astc-10x8-unorm-srgb":{gl:37850,f:Ii},"astc-10x10-unorm":{gl:37819,f:Ii},"astc-10x10-unorm-srgb":{gl:37851,f:Ii},"astc-12x10-unorm":{gl:37820,f:Ii},"astc-12x10-unorm-srgb":{gl:37852,f:Ii},"astc-12x12-unorm":{gl:37821,f:Ii},"astc-12x12-unorm-srgb":{gl:37853,f:Ii},"pvrtc-rgb4unorm-webgl":{gl:35840,f:yg},"pvrtc-rgba4unorm-webgl":{gl:35842,f:yg},"pvrtc-rbg2unorm-webgl":{gl:35841,f:yg},"pvrtc-rgba2unorm-webgl":{gl:35843,f:yg},"etc1-rbg-unorm-webgl":{gl:36196,f:wV},"atc-rgb-unorm-webgl":{gl:35986,f:zv},"atc-rgba-unorm-webgl":{gl:35986,f:zv},"atc-rgbai-unorm-webgl":{gl:34798,f:zv}},BV={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},DV={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Aw(t,e,i){const n=Uy[e];if(!n||n.gl===void 0)return!1;const r=n.x||n.gl2ext;return r?!!ql(t,r,i):!0}function QP(t){const e=Uy[t],i=e==null?void 0:e.gl;if(i===void 0)throw new Error(`Unsupported texture format ${t}`);return i}function OV(t,e,i){if(!Aw(t,e,i)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(XR(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!ql(t,"OES_texture_float_linear, extensions",i):e.endsWith("16float")?!!ql(t,"OES_texture_half_float_linear, extensions",i):!0}function kV(t,e,i){return!(!Aw(t,e,i)||typeof e=="number")}function L_(t){var r;const e=Uy[t],i=QP(t),n=XR(t);return{format:i,dataFormat:(e==null?void 0:e.dataFormat)||NV(n.format,n.integer,n.normalized,i),type:n.dataType?JP(n.dataType):((r=e==null?void 0:e.types)==null?void 0:r[0])||5121,compressed:n.compressed}}function FV(t){const e=Uy[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function YS(t){const e=L_(t),i=BV[e.dataFormat]||4,n=DV[e.type]||1;return i*n}function NV(t,e,i,n){if(n===6408||n===6407)return n;switch(t){case"r":return e&&!i?36244:6403;case"rg":return e&&!i?33320:33319;case"rgb":return e&&!i?36248:6407;case"rgba":return e&&!i?36249:6408;default:return 6408}}const JS={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class LV extends MU{constructor(i,n,r){super([],r);k(this,"gl");k(this,"extensions");k(this,"testedFeatures",new Set);this.gl=i,this.extensions=n,ql(i,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const i=this.getFeatures();for(const n of i)this.has(n)&&(yield n);return[]}has(i){return this.disabledFeatures[i]?!1:(this.testedFeatures.has(i)||(this.testedFeatures.add(i),PV(i)&&MV(this.gl,i,this.extensions)&&this.features.add(i),this.getWebGLFeature(i)&&this.features.add(i)),this.features.has(i))}initializeFeatures(){const i=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of i)this.has(n)}getFeatures(){return[...Object.keys(JS),...Object.keys(ww)]}getWebGLFeature(i){const n=JS[i];return typeof n=="string"?!!ql(this.gl,n,this.extensions):!!n}}class UV extends PU{constructor(i){super();k(this,"gl");k(this,"limits",{});this.gl=i}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(i){return this.limits[i]===void 0&&(this.limits[i]=this.gl.getParameter(i)),this.limits[i]}}function Bl(t,e,i){if(zV(e))return i(t);const{nocatch:n=!0}=e;Ly(t),pd(t,e);let r;if(n)r=i(t),vp(t);else try{r=i(t)}finally{vp(t)}return r}function zV(t){for(const e in t)return!1;return!0}function VV(t,e,i,n){if(T_(e))return n(t);const r=t;Ly(r.gl);try{return jV(t,e),pd(r.gl,i),n(t)}finally{vp(r.gl)}}function jV(t,e){const i=t,{gl:n}=i;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(Xc("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const a=i.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,u=Xc("provokingVertex",e.provokingVertex,{first:36429,last:36430});a==null||a.provokingVertexWEBGL(u)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const a=i.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,u=Xc("polygonMode",e.polygonMode,{fill:6914,line:6913});a==null||a.polygonModeWEBGL(1028,u),a==null||a.polygonModeWEBGL(1029,u)}e.polygonOffsetLine&&n.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask($V("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(Ex("depthCompare",e.depthCompare))),e.stencilWriteMask){const r=e.stencilWriteMask;n.stencilMaskSeparate(1028,r),n.stencilMaskSeparate(1029,r)}if(e.stencilReadMask&&qe.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const r=e.stencilReadMask||4294967295,a=Ex("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,a,0,r),n.stencilFuncSeparate(1029,a,0,r)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const r=$v("stencilPassOperation",e.stencilPassOperation),a=$v("stencilFailOperation",e.stencilFailOperation),u=$v("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,a,u,r),n.stencilOpSeparate(1029,a,u,r)}if(e.blendColorOperation||e.blendAlphaOperation){n.enable(3042);const r=QS("blendColorOperation",e.blendColorOperation||"add"),a=QS("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(r,a);const u=xg("blendColorSrcFactor",e.blendColorSrcFactor||"one"),l=xg("blendColorDstFactor",e.blendColorDstFactor||"zero"),_=xg("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),w=xg("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(u,l,_,w)}}function Ex(t,e){return Xc(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function $v(t,e){return Xc(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function QS(t,e){return Xc(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function xg(t,e){return Xc(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function HV(t,e){return`Illegal parameter ${e} for ${t}`}function Xc(t,e,i){if(!(e in i))throw new Error(HV(t,e));return i[e]}function $V(t,e){return e}function eM(t){const e={};return t.addressModeU&&(e[10242]=Gv(t.addressModeU)),t.addressModeV&&(e[10243]=Gv(t.addressModeV)),t.addressModeW&&(e[32882]=Gv(t.addressModeW)),t.magFilter&&(e[10240]=tM(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=GV(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Ex("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function Gv(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function tM(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function GV(t,e){if(!e)return tM(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class Nl extends Zi{constructor(i,n={}){super(i,n);k(this,"device");k(this,"gl");k(this,"handle");k(this,"glTarget");k(this,"glUsage");k(this,"glIndexType",5123);k(this,"byteLength");k(this,"bytesUsed");this.device=i,this.gl=this.device.gl;const r=typeof n=="object"?n.handle:void 0;this.handle=r||this.gl.createBuffer(),i.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=WV(this.props.usage),this.glUsage=XV(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(i,n=0,r=i.byteLength+n){const a=this.glTarget;this.gl.bindBuffer(a,this.handle),this.gl.bufferData(a,r,this.glUsage),this.gl.bufferSubData(a,n,i),this.gl.bindBuffer(a,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(i,n,r),this.trackAllocatedMemory(r)}_initWithByteLength(i){fi(i>=0);let n=i;i===0&&(n=new Float32Array(0));const r=this.glTarget;return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,n,this.glUsage),this.gl.bindBuffer(r,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(null,0,i),this.trackAllocatedMemory(i),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(i,n=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,n,i),this.gl.bindBuffer(36663,null),this._setDebugData(i,n,i.byteLength)}async readAsync(i=0,n){return this.readSyncWebGL(i,n)}readSyncWebGL(i=0,n){n=n??this.byteLength-i;const r=new Uint8Array(n),a=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,i,r,a,n),this.gl.bindBuffer(36662,null),this._setDebugData(r,i,n),r}}function WV(t){return t&Zi.INDEX?34963:t&Zi.VERTEX?34962:t&Zi.UNIFORM?35345:34962}function XV(t){return t&Zi.INDEX||t&Zi.VERTEX?35044:t&Zi.UNIFORM?35048:35044}class Sx extends C_{constructor(i,n){super(i,n);k(this,"device");k(this,"handle");k(this,"parameters");this.device=i,this.parameters=eM(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(i){for(const[n,r]of Object.entries(i)){const a=Number(n);switch(a){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,a,r);break;default:this.device.gl.samplerParameteri(this.handle,a,r);break}}}}class yh extends E_{constructor(i,n){super(i,{...Es.defaultProps,...n});k(this,"device");k(this,"gl");k(this,"handle");k(this,"texture");this.device=i,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const qV={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},fp=class fp extends Es{constructor(i,n){var r;super(i,{...qV,format:"rgba8unorm",...n});k(this,"MAX_ATTRIBUTES");k(this,"device");k(this,"gl");k(this,"handle");k(this,"sampler");k(this,"view");k(this,"glFormat");k(this,"type");k(this,"dataFormat");k(this,"mipmaps");k(this,"target");k(this,"textureUnit");k(this,"loaded",!1);k(this,"_video");this.device=i,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=KV(this.props),this.loaded=!1,typeof((r=this.props)==null?void 0:r.data)=="string"&&Object.assign(this.props,{data:y4(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(i){return new yh(this.device,{...i,texture:this})}initialize(i={}){if(this.props.dimension==="cube")return this.initializeCube(i);let n=i.data;if(n instanceof Promise)return n.then(X=>this.initialize(Object.assign({},i,{pixels:X,data:X}))),this;const r=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(r&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(i)),this;const{parameters:a={}}=i,{pixels:u=null,pixelStore:l={},textureUnit:_=void 0,mipmaps:w=!0}=i;n||(n=u);let{width:E,height:I,dataFormat:R,type:L,compressed:W=!1}=i;const{depth:K=0}=i,fe=QP(i.format);return{width:E,height:I,compressed:W,dataFormat:R,type:L}=this._deduceParameters({format:i.format,type:L,dataFormat:R,compressed:W,data:n,width:E,height:I}),this.width=E,this.height=I,this.glFormat=fe,this.type=L,this.dataFormat=R,this.textureUnit=_,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=w,this.setImageData({data:n,width:E,height:I,depth:K,format:i.format,type:L,dataFormat:R,parameters:l,compressed:W}),this.setSampler(i.sampler),this._setSamplerParameters(a),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),w&&this.device.isTextureFormatFilterable(i.format)&&this.generateMipmap(),r&&(this._video={video:n,parameters:a,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}initializeCube(i){const{mipmaps:n=!0,parameters:r={}}=i;return this.setCubeMapImageData(i).then(()=>{this.loaded=!0,n&&this.generateMipmap(i),this.setSampler(i.sampler),this._setSamplerParameters(r)}),this}setSampler(i={}){let n;i instanceof Sx?(this.sampler=i,n=i.props):(this.sampler=new Sx(this.device,i),n=i);const r=eM(n);return this._setSamplerParameters(r),this}resize(i){const{height:n,width:r,mipmaps:a=!1}=i;return r!==this.width||n!==this.height?this.initialize({width:r,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:a}):this}update(){if(this._video){const{video:i,parameters:n,lastTime:r}=this._video;if(r===i.currentTime||i.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:i,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=i.currentTime}}generateMipmap(i={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Bl(this.gl,i,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(i){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(i);this.trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:r=null,level:a=0,glFormat:u=this.glFormat,offset:l=0,parameters:_={}}=i;let{data:w=null,type:E=this.type,width:I=this.width,height:R=this.height,dataFormat:L=this.dataFormat,compressed:W=!1}=i;w||(w=r),{type:E,dataFormat:L,compressed:W,width:I,height:R}=this._deduceParameters({format:this.props.format,type:E,dataFormat:L,compressed:W,data:w,width:I,height:R});const{gl:K}=this;K.bindTexture(this.target,this.handle);let fe=null;if({data:w,dataType:fe}=this._getDataType({data:w,compressed:W}),Bl(this.gl,_,()=>{switch(fe){case"null":K.texImage2D(n,a,u,I,R,0,L,E,w);break;case"typed-array":K.texImage2D(n,a,u,I,R,0,L,E,w,l);break;case"buffer":this.device.gl.bindBuffer(35052,w.handle||w),this.device.gl.texImage2D(n,a,u,I,R,0,L,E,l),this.device.gl.bindBuffer(35052,null);break;case"browser-object":K.texImage2D(n,a,u,I,R,0,L,E,w);break;case"compressed":for(const[X,$]of w.entries())K.compressedTexImage2D(n,X,$.format,$.width,$.height,0,$.data);break;default:fi(!1,"Unknown image data type")}}),w&&w.byteLength)this.trackAllocatedMemory(w.byteLength,"Texture");else{const X=YS(this.props.format);this.trackAllocatedMemory(this.width*this.height*X,"Texture")}return this.loaded=!0,this}setSubImageData({target:i=this.target,pixels:n=null,data:r=null,x:a=0,y:u=0,width:l=this.width,height:_=this.height,level:w=0,glFormat:E=this.glFormat,type:I=this.type,dataFormat:R=this.dataFormat,compressed:L=!1,offset:W=0,parameters:K={}}){if({type:I,dataFormat:R,compressed:L,width:l,height:_}=this._deduceParameters({format:this.props.format,type:I,dataFormat:R,compressed:L,data:r,width:l,height:_}),fi(this.depth===1,"texSubImage not supported for 3D textures"),r||(r=n),r&&r.data){const fe=r;r=fe.data,l=fe.shape[0],_=fe.shape[1]}r instanceof Nl&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),Bl(this.gl,K,()=>{L?this.gl.compressedTexSubImage2D(i,w,a,u,l,_,E,r):r===null?this.gl.texSubImage2D(i,w,a,u,l,_,R,I,null):ArrayBuffer.isView(r)?this.gl.texSubImage2D(i,w,a,u,l,_,R,I,r,W):typeof WebGLBuffer<"u"&&r instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,r),this.device.gl.texSubImage2D(i,w,a,u,l,_,R,I,W),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(i,w,a,u,l,_,R,I,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(i={}){return qe.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(i=this.textureUnit){const{gl:n}=this;return i!==void 0&&(this.textureUnit=i,n.activeTexture(33984+i)),n.bindTexture(this.target,this.handle),i}unbind(i=this.textureUnit){const{gl:n}=this;return i!==void 0&&(this.textureUnit=i,n.activeTexture(33984+i)),n.bindTexture(this.target,null),i}_getDataType({data:i,compressed:n=!1}){return n?{data:i,dataType:"compressed"}:i===null?{data:i,dataType:"null"}:ArrayBuffer.isView(i)?{data:i,dataType:"typed-array"}:i instanceof Nl?{data:i.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?{data:i,dataType:"buffer"}:{data:i,dataType:"browser-object"}}_deduceParameters(i){const{format:n,data:r}=i;let{width:a,height:u,dataFormat:l,type:_,compressed:w}=i;const E=L_(n);return l=l||E.dataFormat,_=_||E.type,w=w||E.compressed,{width:a,height:u}=this._deduceImageSize(r,a,u),{dataFormat:l,type:_,compressed:w,width:a,height:u,format:n,data:r}}_deduceImageSize(i,n,r){let a;return typeof ImageData<"u"&&i instanceof ImageData?a={width:i.width,height:i.height}:typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement?a={width:i.naturalWidth,height:i.naturalHeight}:typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement?a={width:i.width,height:i.height}:typeof ImageBitmap<"u"&&i instanceof ImageBitmap?a={width:i.width,height:i.height}:typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement?a={width:i.videoWidth,height:i.videoHeight}:i?a={width:n,height:r}:a={width:n>=0?n:1,height:r>=0?r:1},fi(a,"Could not deduced texture size"),fi(n===void 0||a.width===n,"Deduced texture width does not match supplied width"),fi(r===void 0||a.height===r,"Deduced texture height does not match supplied height"),a}async setCubeMapImageData(i){const{gl:n}=this,{width:r,height:a,pixels:u,data:l,format:_=6408,type:w=5121}=i,E=u||l,I=await Promise.all(fp.FACES.map(R=>{const L=E[R];return Promise.all(Array.isArray(L)?L:[L])}));this.bind(),fp.FACES.forEach((R,L)=>{I[L].length>1&&this.props.mipmaps!==!1&&qe.warn(`${this.id} has mipmap and multiple LODs.`)(),I[L].forEach((W,K)=>{r&&a?n.texImage2D(R,K,_,r,a,0,_,w,W):n.texImage2D(R,K,_,_,w,W)})}),this.unbind()}setImageDataForFace(i){const{face:n,width:r,height:a,pixels:u,data:l,format:_=6408,type:w=5121}=i,{gl:E}=this,I=u||l;return this.bind(),I instanceof Promise?I.then(R=>this.setImageDataForFace(Object.assign({},i,{face:n,data:R,pixels:R}))):this.width||this.height?E.texImage2D(n,0,_,r,a,0,_,w,I):E.texImage2D(n,0,_,_,w,I),this}setImageData3D(i){const{level:n=0,dataFormat:r,format:a,type:u,width:l,height:_,depth:w=1,offset:E=0,data:I,parameters:R={}}=i;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const L=L_(a);if(Bl(this.gl,R,()=>{ArrayBuffer.isView(I)&&this.gl.texImage3D(this.target,n,L.format,l,_,w,0,L.dataFormat,L.type,I),I instanceof Nl&&(this.gl.bindBuffer(35052,I.handle),this.gl.texImage3D(this.target,n,r,l,_,w,0,a,u,E))}),I&&I.byteLength)this.trackAllocatedMemory(I.byteLength,"Texture");else{const W=YS(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*W,"Texture")}return this.loaded=!0,this}_setSamplerParameters(i){if(!T_(i)){ZV(i),this.gl.bindTexture(this.target,this.handle);for(const[n,r]of Object.entries(i)){const a=Number(n),u=r;switch(a){case 33082:case 33083:this.gl.texParameterf(this.target,a,u);break;default:this.gl.texParameteri(this.target,a,u);break}}this.gl.bindTexture(this.target,null)}}};k(fp,"FACES",[34069,34070,34071,34072,34073,34074]);let Qo=fp;function KV(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function ZV(t){qe.log(1,"texture sampler parameters",t)()}class Qf extends I_{constructor(i,n){super(i,n);k(this,"device");k(this,"gl");k(this,"handle");const r=n.handle===null;if(this.device=i,this.gl=i.gl,this.handle=this.props.handle||r?this.props.handle:this.gl.createFramebuffer(),!r){i.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const a=this.gl.bindFramebuffer(36160,this.handle);for(let u=0;u<this.colorAttachments.length;++u){const l=this.colorAttachments[u],_=36064+u;l&&this._attachOne(_,l)}if(this.depthStencilAttachment&&this._attachOne(FV(this.depthStencilAttachment.props.format),this.depthStencilAttachment),n.check!==!1){const u=this.gl.checkFramebufferStatus(36160);if(u!==36053)throw new Error(`Framebuffer ${JV(u)}`)}this.gl.bindFramebuffer(36160,a)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(i){return new Qo(this.device,{id:`${this.id}-depth-stencil`,format:i,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(i,n){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;i===void 0&&(i=this.gl.drawingBufferWidth),n===void 0&&(n=this.gl.drawingBufferHeight);for(const r of this.colorAttachments)r.texture.resize({width:i,height:n});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:i,height:n}),this}_attachOne(i,n){if(Array.isArray(n)){const[r,a=0,u=0]=n;return this._attachTexture(i,r,a,u),r}if(n instanceof Qo)return this._attachTexture(i,n,0,0),n;if(n instanceof yh){const r=n;return this._attachTexture(i,r.texture,r.props.baseMipLevel,r.props.baseArrayLayer),n.texture}throw new Error("attach")}_attachTexture(i,n,r,a){const{gl:u}=this.device;switch(u.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:u.framebufferTextureLayer(36160,i,n.target,a,r);break;case 34067:const l=YV(r);u.framebufferTexture2D(36160,i,l,n.handle,a);break;case 3553:u.framebufferTexture2D(36160,i,3553,n.handle,a);break;default:fi(!1,"Illegal texture type")}u.bindTexture(n.target,null)}}function YV(t){return t<34069?t+34069:t}function JV(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class QV extends rw{constructor(i,n){super(n);k(this,"device");k(this,"presentationSize");k(this,"_framebuffer",null);this.device=i,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Qf(this.device,{handle:null}),this._framebuffer}update(){const i=this.getPixelSize();(i[0]!==this.presentationSize[0]||i[1]!==this.presentationSize[1])&&(this.presentationSize=i,this.resize())}resize(i){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(i==null?void 0:i.useDevicePixels);this.setDevicePixelRatio(n,i);return}}commit(){}}const e9={spector:qe.get("spector")||qe.get("spectorjs")},t9="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",i9=1;let Ri=null,eC=!1;async function n9(t){if(!globalThis.SPECTOR)try{await tP(t9)}catch(e){qe.warn(String(e))}}function r9(t){if(t={...e9,...t},!(t!=null&&t.spector)||(!Ri&&globalThis.SPECTOR&&(qe.probe(i9,"SPECTOR found and initialized")(),Ri=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=Ri)),!Ri))return null;if(eC||(eC=!0,Ri.spyCanvases(),Ri==null||Ri.onCaptureStarted.add(e=>qe.info("Spector capture started:",e)()),Ri==null||Ri.onCapture.add(e=>{qe.info("Spector capture complete:",e)(),Ri==null||Ri.getResultUI(),Ri==null||Ri.resultView.display(),Ri==null||Ri.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return Ri;Ri==null||Ri.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{qe.info("Spector capture stopped after 2 seconds")(),Ri==null||Ri.stopCapture()})}return Ri}const s9="https://unpkg.com/webgl-debug@2.0.1/index.js";function iM(t){return t.luma=t.luma||{},t.luma}async function o9(){Yl()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await tP(s9))}function a9(t,e={}){return t?e.debug?c9(t,e):l9(t):null}function l9(t){const e=iM(t);return e.realContext?e.realContext:t}function c9(t,e){if(!globalThis.WebGLDebugUtils)return qe.warn("webgl-debug not loaded")(),t;const i=iM(t);if(i.debugContext)return i.debugContext;globalThis.WebGLDebugUtils.init({...mh,...t});const n=globalThis.WebGLDebugUtils.makeDebugContext(t,u9.bind(null,e),h9.bind(null,e));for(const u in mh)!(u in n)&&typeof mh[u]=="number"&&(n[u]=mh[u]);class r{}Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.setPrototypeOf(r,n);const a=Object.create(r);return i.realContext=t,i.debugContext=a,a.debug=!0,a}function Wv(t,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let i=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return i=`${i.slice(0,100)}${i.length>100?"...":""}`,`gl.${t}(${i})`}function u9(t,e,i,n){n=Array.from(n).map(l=>l===void 0?"undefined":l);const r=globalThis.WebGLDebugUtils.glEnumToString(e),a=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,n),u=`${r} in gl.${i}(${a})`;qe.error(u)();debugger;if(t.throwOnError)throw new Error(u)}function h9(t,e,i){let n="";if(qe.level>=1&&(n=Wv(e,i),qe.log(1,n)()),t.break&&t.break.length>0&&(n=n||Wv(e,i),t.break.every(a=>n.indexOf(a)!==-1)))debugger;for(const r of i)if(r===void 0){if(n=n||Wv(e,i),t.throwOnError)throw new Error(`Undefined argument: ${n}`);qe.error(`Undefined argument: ${n}`)();debugger}}function d9(t){const e=t.split(/\r?\n/),i=[];for(const n of e){if(n.length<=1)continue;const r=n.split(":");if(r.length===2){const[I,R]=r;i.push({message:R.trim(),type:tC(I),lineNum:0,linePos:0});continue}const[a,u,l,..._]=r;let w=parseInt(l,10);isNaN(w)&&(w=0);let E=parseInt(u,10);isNaN(E)&&(E=0),i.push({message:_.join(":").trim(),type:tC(a),lineNum:w,linePos:E})}return i}function tC(t){const e=["warning","error","info"],i=t.toLowerCase();return e.includes(i)?i:"info"}class f9 extends S_{constructor(i,n){super(i,n);k(this,"device");k(this,"handle");switch(this.device=i,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const i=this.device.gl.getShaderInfoLog(this.handle);return d9(i)}getTranslatedSource(){const n=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return n==null?void 0:n.getTranslatedShaderSource(this.handle)}async _compile(i){i=(a=>a.startsWith("#version ")?a:`#version 100
${a}`)(i);const{gl:r}=this.device;if(r.shaderSource(this.handle,i),r.compileShader(this.handle),qe.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}qe.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),qe.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const i=async a=>await new Promise(u=>setTimeout(u,a));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:r}=this.device;for(;;){if(r.getShaderParameter(this.handle,37297))return;await i(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const p9=256,m9=1024,g9=16384,Xv=6144,_9=[1,2,4,8];class y9 extends rx{constructor(i,n){super(i,n);k(this,"device");k(this,"glParameters");this.device=i,Ly(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){vp(this.device.gl)}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}setParameters(i={}){const n={...this.glParameters};this.props.framebuffer&&(n.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,i.viewport&&(i.viewport.length>=6?(n.viewport=i.viewport.slice(0,4),n.depthRange=[i.viewport[4],i.viewport[5]]):n.viewport=i.viewport),i.scissorRect&&(n.scissorTest=!0,n.scissor=i.scissorRect),i.blendConstant&&(n.blendColor=i.blendConstant),i.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),i[2967]=i.stencilReference),i.colorMask&&(n.colorMask=_9.map(r=>!!(r&i.colorMask))),this.glParameters=n,pd(this.device.gl,n)}beginOcclusionQuery(i){const n=this.props.occlusionQuerySet;n==null||n.beginOcclusionQuery()}endOcclusionQuery(){const i=this.props.occlusionQuerySet;i==null||i.endOcclusionQuery()}clear(){const i={...this.glParameters};let n=0;this.props.clearColor!==!1&&(n|=g9,i.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=p9,i.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=m9,i.clearStencil=this.props.clearStencil),n!==0&&Bl(this.device.gl,i,()=>{this.device.gl.clear(n)})}clearColorBuffer(i=0,n=[0,0,0,0]){Bl(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int32Array:this.device.gl.clearBufferiv(Xv,i,n);break;case Uint32Array:this.device.gl.clearBufferuiv(Xv,i,n);break;case Float32Array:default:this.device.gl.clearBufferfv(Xv,i,n);break}})}}const v9="Failed to deduce GL constant from typed array";function x9(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(v9)}}function Cx(t,e){const{clamped:i=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const b9={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},w9={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ep{constructor(...e){k(this,"offset");k(this,"stride");k(this,"type");k(this,"size");k(this,"divisor");k(this,"normalized");k(this,"integer");k(this,"buffer");k(this,"index");e.forEach(i=>this._assign(i)),Object.freeze(this)}static getBytesPerElement(e){return Cx(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return fi(e.size),Cx(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new ep(b9,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ep.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ep.getBytesPerVertex(this)}_assign(e={}){return e=g4("Accessor",e,w9),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function A9(t){return T9.includes(t)}const T9=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],nM={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function rM(t){const e=nM[t];if(!e)throw new Error("uniform");const[i,n,,r]=e;return{format:r,components:n,glType:i}}function E9(t){const e=nM[t];if(!e)throw new Error("attribute");const[,i,,n,r]=e;return{attributeType:n,vertexFormat:r,components:i}}function S9(t,e){const i={attributes:[],bindings:[]};i.attributes=C9(t,e);const n=P9(t,e);for(const l of n){const _=l.uniforms.map(w=>({name:w.name,format:w.format,byteOffset:w.byteOffset,byteStride:w.byteStride,arrayLength:w.arrayLength}));i.bindings.push({type:"uniform",name:l.name,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:_})}const r=R9(t,e);let a=0;for(const l of r)if(A9(l.type)){const{viewDimension:_,sampleType:w}=B9(l.type);i.bindings.push({type:"texture",name:l.name,location:a,viewDimension:_,sampleType:w}),l.textureUnit=a,a+=1}r.length&&(i.uniforms=r);const u=I9(t,e);return u!=null&&u.length&&(i.varyings=u),i}function C9(t,e){const i=[],n=t.getProgramParameter(e,35721);for(let r=0;r<n;r++){const a=t.getActiveAttrib(e,r);if(!a)throw new Error("activeInfo");const{name:u,type:l}=a,_=t.getAttribLocation(e,u);if(_>=0){const{attributeType:w}=E9(l),E=/instance/i.test(u)?"instance":"vertex";i.push({name:u,location:_,stepMode:E,type:w})}}return i.sort((r,a)=>r.location-a.location),i}function I9(t,e){const i=[],n=t.getProgramParameter(e,35971);for(let r=0;r<n;r++){const a=t.getTransformFeedbackVarying(e,r);if(!a)throw new Error("activeInfo");const{name:u,type:l,size:_}=a,{glType:w,components:E}=rM(l),I=new ep({type:w,size:_*E}),R={location:r,name:u,accessor:I};i.push(R)}return i.sort((r,a)=>r.location-a.location),i}function R9(t,e){const i=[],n=t.getProgramParameter(e,35718);for(let r=0;r<n;r++){const a=t.getActiveUniform(e,r);if(!a)throw new Error("activeInfo");const{name:u,size:l,type:_}=a,{name:w,isArray:E}=D9(u);let I=t.getUniformLocation(e,w);const R={location:I,name:w,size:l,type:_,isArray:E};if(i.push(R),R.size>1)for(let L=0;L<R.size;L++){const W=`${w}[${L}]`;I=t.getUniformLocation(e,W);const K={...R,name:W,location:I};i.push(K)}}return i}function P9(t,e){const i=(a,u)=>t.getActiveUniformBlockParameter(e,a,u),n=[],r=t.getProgramParameter(e,35382);for(let a=0;a<r;a++){const u={name:t.getActiveUniformBlockName(e,a)||"",location:i(a,35391),byteLength:i(a,35392),vertex:i(a,35396),fragment:i(a,35398),uniformCount:i(a,35394),uniforms:[]},l=i(a,35395)||[],_=t.getActiveUniforms(e,l,35383),w=t.getActiveUniforms(e,l,35384),E=t.getActiveUniforms(e,l,35387),I=t.getActiveUniforms(e,l,35388);for(let R=0;R<u.uniformCount;++R){const L=t.getActiveUniform(e,l[R]);if(!L)throw new Error("activeInfo");u.uniforms.push({name:L.name,format:rM(_[R]).format,type:_[R],arrayLength:w[R],byteOffset:E[R],byteStride:I[R]})}n.push(u)}return n.sort((a,u)=>a.location-u.location),n}const M9={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function B9(t){const e=M9[t];if(!e)throw new Error("sampler");const[i,n]=e;return{viewDimension:i,sampleType:n}}function D9(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const i=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!i||i.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:i[1],length:i[2]?1:0,isArray:!!i[2]}}function O9(t,e,i,n){const r=t;let a=n;a===!0&&(a=1),a===!1&&(a=0);const u=typeof a=="number"?[a]:a;switch(i){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,n);case 5126:return t.uniform1fv(e,u);case 35664:return t.uniform2fv(e,u);case 35665:return t.uniform3fv(e,u);case 35666:return t.uniform4fv(e,u);case 5124:return t.uniform1iv(e,u);case 35667:return t.uniform2iv(e,u);case 35668:return t.uniform3iv(e,u);case 35669:return t.uniform4iv(e,u);case 35670:return t.uniform1iv(e,u);case 35671:return t.uniform2iv(e,u);case 35672:return t.uniform3iv(e,u);case 35673:return t.uniform4iv(e,u);case 5125:return r.uniform1uiv(e,u,1);case 36294:return r.uniform2uiv(e,u,2);case 36295:return r.uniform3uiv(e,u,3);case 36296:return r.uniform4uiv(e,u,4);case 35674:return t.uniformMatrix2fv(e,!1,u);case 35675:return t.uniformMatrix3fv(e,!1,u);case 35676:return t.uniformMatrix4fv(e,!1,u);case 35685:return r.uniformMatrix2x3fv(e,!1,u);case 35686:return r.uniformMatrix2x4fv(e,!1,u);case 35687:return r.uniformMatrix3x2fv(e,!1,u);case 35688:return r.uniformMatrix3x4fv(e,!1,u);case 35689:return r.uniformMatrix4x2fv(e,!1,u);case 35690:return r.uniformMatrix4x3fv(e,!1,u)}throw new Error("Illegal uniform")}function k9(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function F9(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const iC=4;class N9 extends qh{constructor(i,n){super(i,n);k(this,"device");k(this,"handle");k(this,"vs");k(this,"fs");k(this,"introspectedLayout");k(this,"uniforms",{});k(this,"bindings",{});k(this,"varyings",null);k(this,"_uniformCount",0);k(this,"_uniformSetters",{});this.device=i,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:r,bufferMode:a=35981}=n;switch(r&&r.length>0&&(this.varyings=r,this.device.gl.transformFeedbackVaryings(this.handle,r,a)),this._linkShaders(),qe.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=S9(this.device.gl,this.handle),qe.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=n4(this.introspectedLayout,n.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":qe.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(i,n){for(const[r,a]of Object.entries(i)){const u=this.shaderLayout.bindings.find(l=>l.name===r)||this.shaderLayout.bindings.find(l=>l.name===`${r}Uniforms`);if(!u){const l=this.shaderLayout.bindings.map(_=>`"${_.name}"`).join(", ");n!=null&&n.disableWarnings||qe.warn(`Unknown binding "${r}" in render pipeline "${this.id}", expected one of ${l}`)();continue}switch(a||qe.warn(`Unsetting binding "${r}" in render pipeline "${this.id}"`)(),u.type){case"uniform":if(!(a instanceof Nl)&&!(a.buffer instanceof Nl))throw new Error("buffer value");break;case"texture":if(!(a instanceof yh||a instanceof Qo||a instanceof Qf))throw new Error("texture value");break;case"sampler":qe.warn(`Ignoring sampler ${r}`)();break;default:throw new Error(u.type)}this.bindings[r]=a}}draw(i){var fe;const{renderPass:n,parameters:r=this.props.parameters,topology:a=this.props.topology,vertexArray:u,vertexCount:l,instanceCount:_,isInstanced:w=!1,firstVertex:E=0,transformFeedback:I}=i,R=k9(a),L=!!u.indexBuffer,W=(fe=u.indexBuffer)==null?void 0:fe.glIndexType;if(this.linkStatus!=="success")return qe.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||l===0)return qe.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(l===0)return qe.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),u.bindBeforeRender(n),I&&I.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const K=n;return VV(this.device,r,K.glParameters,()=>{L&&w?this.device.gl.drawElementsInstanced(R,l||0,W,E,_||0):L?this.device.gl.drawElements(R,l||0,W,E):w?this.device.gl.drawArraysInstanced(R,E,l||0,_||0):this.device.gl.drawArrays(R,E,l||0),I&&I.end()}),u.unbindAfterRender(n),!0}setUniformsWebGL(i){const{bindings:n}=sw(i);Object.keys(n).forEach(r=>{qe.warn(`Unsupported value "${JSON.stringify(n[r])}" used in setUniforms() for key ${r}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,i)}async _linkShaders(){const{gl:i}=this.device;if(i.attachShader(this.handle,this.vs.handle),i.attachShader(this.handle,this.fs.handle),qe.time(iC,`linkProgram for ${this.id}`)(),i.linkProgram(this.handle),qe.timeEnd(iC,`linkProgram for ${this.id}`)(),qe.level,!this.device.features.has("compilation-status-async-webgl")){const r=this._getLinkStatus();this._reportLinkStatus(r);return}qe.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),qe.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}_reportLinkStatus(i){var n;switch(i){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((n=this.fs)==null?void 0:n.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${i}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:i}=this.device;return i.getProgramParameter(this.handle,35714)?(i.validateProgram(this.handle),i.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const i=async a=>await new Promise(u=>setTimeout(u,a));if(!this.device.features.has("compilation-status-async-webgl")){await i(10);return}const{gl:r}=this.device;for(;;){if(r.getProgramParameter(this.handle,37297))return;await i(10)}}_areTexturesRenderable(){let i=!0;for(const[,n]of Object.entries(this.bindings))n instanceof Qo&&(n.update(),i=i&&n.loaded);return i}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:i}=this.device;i.useProgram(this.handle);let n=0,r=0;for(const a of this.shaderLayout.bindings){const u=this.bindings[a.name]||this.bindings[a.name.replace(/Uniforms$/,"")];if(!u)throw new Error(`No value for binding ${a.name} in ${this.id}`);switch(a.type){case"uniform":const{name:l}=a,_=i.getUniformBlockIndex(this.handle,l);if(_===4294967295)throw new Error(`Invalid uniform block name ${l}`);i.uniformBlockBinding(this.handle,r,_),u instanceof Nl?i.bindBufferBase(35345,r,u.handle):i.bindBufferRange(35345,r,u.buffer.handle,u.offset||0,u.size||u.buffer.byteLength-u.offset),r+=1;break;case"texture":if(!(u instanceof yh||u instanceof Qo||u instanceof Qf))throw new Error("texture");let w;if(u instanceof yh)w=u.texture;else if(u instanceof Qo)w=u;else if(u instanceof Qf&&u.colorAttachments[0]instanceof yh)qe.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),w=u.colorAttachments[0].texture;else throw new Error("No texture");i.activeTexture(33984+n),i.bindTexture(w.target,w.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${a.type}' not supported in WebGL`)}}}_applyUniforms(){for(const i of this.shaderLayout.uniforms||[]){const{name:n,location:r,type:a,textureUnit:u}=i,l=this.uniforms[n]??u;l!==void 0&&O9(this.device.gl,r,a,l)}}}class L9 extends ox{constructor(i){super(i,{});k(this,"device");k(this,"commands",[]);this.device=i}submitCommands(i=this.commands){for(const n of i)switch(n.name){case"copy-buffer-to-buffer":U9(this.device,n.options);break;case"copy-buffer-to-texture":z9(this.device,n.options);break;case"copy-texture-to-buffer":V9(this.device,n.options);break;case"copy-texture-to-texture":j9(this.device,n.options);break}}}function U9(t,e){const i=e.source,n=e.destination;t.gl.bindBuffer(36662,i.handle),t.gl.bindBuffer(36663,n.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function z9(t,e){throw new Error("Not implemented")}function V9(t,e){const{source:i,mipLevel:n=0,aspect:r="all",width:a=e.source.width,height:u=e.source.height,depthOrArrayLayers:l=0,origin:_=[0,0],destination:w,byteOffset:E=0,bytesPerRow:I,rowsPerImage:R}=e;if(r!=="all")throw new Error("not supported");if(n!==0||l!==0||I||R)throw new Error("not implemented");const{framebuffer:L,destroyFramebuffer:W}=sM(i);let K;try{const fe=w,X=a||L.width,$=u||L.height,Q=L_(L.texture.props.format),me=Q.dataFormat,Ce=Q.type;t.gl.bindBuffer(35051,fe.handle),K=t.gl.bindFramebuffer(36160,L.handle),t.gl.readPixels(_[0],_[1],X,$,me,Ce,E)}finally{t.gl.bindBuffer(35051,null),K!==void 0&&t.gl.bindFramebuffer(36160,K),W&&L.destroy()}}function j9(t,e){const{source:i,destinationMipLevel:n=0,origin:r=[0,0],destinationOrigin:a=[0,0],destination:u}=e;let{width:l=e.destination.width,height:_=e.destination.height}=e;const{framebuffer:w,destroyFramebuffer:E}=sM(i),[I,R]=r,[L,W,K]=a,fe=t.gl.bindFramebuffer(36160,w.handle);let X=null,$;if(u instanceof Qo)X=u,l=Number.isFinite(l)?l:X.width,_=Number.isFinite(_)?_:X.height,X.bind(0),$=X.target;else throw new Error("invalid destination");switch($){case 3553:case 34067:t.gl.copyTexSubImage2D($,n,L,W,I,R,l,_);break;case 35866:case 32879:t.gl.copyTexSubImage3D($,n,L,W,K,I,R,l,_);break}X&&X.unbind(),t.gl.bindFramebuffer(36160,fe),E&&w.destroy()}function sM(t){if(t instanceof Es){const{width:e,height:i,id:n}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:i,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class H9 extends sx{constructor(i,n){super(i,n);k(this,"device");k(this,"commandBuffer");this.device=i,this.commandBuffer=new L9(i)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(i){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:i})}copyBufferToTexture(i){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:i})}copyTextureToBuffer(i){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:i})}copyTextureToTexture(i){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:i})}pushDebugGroup(i){}popDebugGroup(){}insertDebugMarker(i){}resolveQuerySet(i,n,r){}}class Tw extends ax{constructor(i,n){super(i,n);k(this,"device");k(this,"handle");k(this,"buffer",null);k(this,"bufferValue",null);this.device=i,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(i){return eF()==="Chrome"}destroy(){var i;super.destroy(),this.buffer&&((i=this.buffer)==null||i.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(i){const n=i;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(i,n){const r=n;if(r.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:a,type:u,stride:l,offset:_,normalized:w,integer:E,divisor:I}=this._getAccessor(i);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,r.handle),E?this.device.gl.vertexAttribIPointer(i,a,u,l,_):this.device.gl.vertexAttribPointer(i,a,u,w,l,_),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(i),this.device.gl.vertexAttribDivisor(i,I||0),this.attributes[i]=r,this.device.gl.bindVertexArray(null)}setConstantWebGL(i,n){this._enable(i,!1),this.attributes[i]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let i=0;i<this.maxVertexAttributes;++i){const n=this.attributes[i];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(i,n)}}_getAccessor(i){const n=this.attributeInfos[i];if(!n)throw new Error(`Unknown attribute location ${i}`);const r=JP(n.bufferDataType);return{size:n.bufferComponents,type:r,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(i,n=!0){const a=Tw.isConstantAttributeZeroSupported(this.device)||i!==0;(n||a)&&(i=Number(i),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(i):this.device.gl.disableVertexAttribArray(i),this.device.gl.bindVertexArray(null))}getConstantBuffer(i,n){const r=$9(n),a=r.byteLength*i,u=r.length*i;if(this.buffer&&a!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${a} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:a}),l=l||!G9(r,this.bufferValue),l){const _=a4(n.constructor,u);l4({target:_,source:r,start:0,count:u}),this.buffer.write(_),this.bufferValue=n}return this.buffer}}function $9(t){return Array.isArray(t)?new Float32Array(t):t}function G9(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}class W9 extends lx{constructor(i,n){super(i,n);k(this,"device");k(this,"gl");k(this,"handle");k(this,"layout");k(this,"buffers",{});k(this,"unusedBuffers",{});k(this,"bindOnUse",!0);k(this,"_bound",!1);this.device=i,this.gl=i.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(i="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(F9(i))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(i){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in i)this.setBuffer(n,i[n])})}setBuffer(i,n){const r=this._getVaryingIndex(i),{buffer:a,byteLength:u,byteOffset:l}=this._getBufferRange(n);if(r<0){this.unusedBuffers[i]=a,qe.warn(`${this.id} unusedBuffers varying buffer ${i}`)();return}this.buffers[r]={buffer:a,byteLength:u,byteOffset:l},this.bindOnUse||this._bindBuffer(r,a,l,u)}getBuffer(i){if(nC(i))return this.buffers[i]||null;const n=this._getVaryingIndex(i);return n>=0?this.buffers[n]:null}bind(i=this.handle){if(typeof i!="function")return this.gl.bindTransformFeedback(36386,i),this;let n;return this._bound?n=i():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=i(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(i){if(i instanceof Nl)return{buffer:i,byteOffset:0,byteLength:i.byteLength};const{buffer:n,byteOffset:r=0,byteLength:a=i.buffer.byteLength}=i;return{buffer:n,byteOffset:r,byteLength:a}}_getVaryingIndex(i){if(nC(i))return Number(i);for(const n of this.layout.varyings)if(i===n.name)return n.location;return-1}_bindBuffers(){for(const i in this.buffers){const{buffer:n,byteLength:r,byteOffset:a}=this._getBufferRange(this.buffers[i]);this._bindBuffer(Number(i),n,a,r)}}_unbindBuffers(){for(const i in this.buffers)this.gl.bindBufferBase(35982,Number(i),null)}_bindBuffer(i,n,r=0,a){const u=n&&n.handle;!u||a===void 0?this.gl.bindBufferBase(35982,i,u):this.gl.bindBufferRange(35982,i,u,r,a)}}function nC(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class X9 extends cx{constructor(i,n){super(i,n);k(this,"device");k(this,"handle");k(this,"target",null);k(this,"_queryPending",!1);k(this,"_pollingPromise",null);if(this.device=i,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(i){return this._begin(i!=null&&i.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(i){this._queryPending||(this.target=i,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const i=this.device.gl.getQueryParameter(this.handle,34919);return i&&(this._queryPending=!1),i}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(i=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((r,a)=>{const u=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):n++>i?(a("Timed out"),this._pollingPromise=null):requestAnimationFrame(u)};requestAnimationFrame(u)}),this._pollingPromise}}function oM(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return fi(!1),0}}function q9(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return fi(!1),0}}function K9(t,e){var fe,X;const{sourceX:i=0,sourceY:n=0,sourceFormat:r=6408,sourceAttachment:a=36064}=e||{};let{target:u=null,sourceWidth:l,sourceHeight:_,sourceType:w}=e||{};const{framebuffer:E,deleteFramebuffer:I}=aM(t);fi(E);const{gl:R,handle:L}=E;l=l||E.width,_=_||E.height;const W=a-36064;w=w||((X=(fe=E.colorAttachments[W])==null?void 0:fe.texture)==null?void 0:X.type)||5121,u=J9(u,w,r,l,_),w=w||x9(u);const K=R.bindFramebuffer(36160,L);return R.readPixels(i,n,l,_,r,w,u),R.bindFramebuffer(36160,K||null),I&&E.destroy(),u}function Z9(t,e){const{target:i,sourceX:n=0,sourceY:r=0,sourceFormat:a=6408,targetByteOffset:u=0}=e||{};let{sourceWidth:l,sourceHeight:_,sourceType:w}=e||{};const{framebuffer:E,deleteFramebuffer:I}=aM(t);fi(E),l=l||E.width,_=_||E.height;const R=E;w=w||5121;let L=i;if(!L){const K=oM(a),fe=q9(w),X=u+l*_*K*fe;L=R.device.createBuffer({byteLength:X})}const W=t.device.createCommandEncoder();return W.copyTextureToBuffer({source:t,width:l,height:_,origin:[n,r],destination:L,byteOffset:u}),W.destroy(),I&&E.destroy(),L}function aM(t){return t instanceof I_?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Y9(t),deleteFramebuffer:!0}}function Y9(t,e){const{device:i,width:n,height:r,id:a}=t;return i.createFramebuffer({...e,id:`framebuffer-for-${a}`,width:n,height:r,colorAttachments:[t]})}function J9(t,e,i,n,r){if(t)return t;e=e||5121;const a=Cx(e,{clamped:!1}),u=oM(i);return new a(n*r*u)}const Q9=256,ej=1024,tj=16384,ij="clear: bad arguments";function nj(t,e){const{framebuffer:i=null,color:n=null,depth:r=null,stencil:a=null}=e||{},u={};i&&(u.framebuffer=i);let l=0;n&&(l|=tj,n!==!0&&(u.clearColor=n)),r&&(l|=Q9,r!==!0&&(u.clearDepth=r)),a&&(l|=ej,r!==!0&&(u.clearStencil=r)),fi(l!==0,ij);const _=t.gl;Bl(_,u,()=>{_.clear(l)})}const Ef=1,Nc=class Nc extends Xh{constructor(i){var _,w;super({...i,id:i.id||Jl("webgl-device")});k(this,"type","webgl");k(this,"handle");k(this,"features");k(this,"limits");k(this,"info");k(this,"canvasContext");k(this,"lost");k(this,"_resolveContextLost");k(this,"renderPass",null);k(this,"gl");k(this,"debug",!1);k(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});k(this,"_extensions",{});k(this,"_polyfilled",!1);k(this,"spectorJS");k(this,"_constants");const n=(_=i.gl)==null?void 0:_.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);const r=((w=i.gl)==null?void 0:w.canvas)||i.canvas;this.canvasContext=new QV(this,{...i,canvas:r}),this.lost=new Promise(E=>{this._resolveContextLost=E});let a=i.gl||null;if(a||(a=yV(this.canvasContext.canvas,{...i,onContextLost:E=>{var I;return(I=this._resolveContextLost)==null?void 0:I.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!a)throw new Error("WebGL context creation failed");this.handle=a,this.gl=a,this.gl.device=this,this.gl._version=2,i.spector&&(this.spectorJS=r9({...this.props,canvas:this.handle.canvas})),this.info=vV(this.gl,this._extensions),this.limits=new UV(this.gl),this.features=new LV(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:u=!0,copyState:l=!1}=i;ZP(this.gl,{enable:u,copyState:l,log:(...E)=>qe.log(1,...E)()}),i.debug&&(this.gl=a9(this.gl,{...i,throwOnError:!0}),this.debug=!0,qe.level=Math.max(qe.level,1),qe.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(i){if(i instanceof Nc)return i;if((i==null?void 0:i.device)instanceof Xh)return i.device;if(!rj(i))throw new Error("Invalid WebGL2RenderingContext");return new Nc({gl:i})}static async create(i={}){var l;qe.groupCollapsed(Ef,"WebGLDevice created")();const n=[];i.debug&&n.push(o9()),i.spector&&n.push(n9()),typeof i.canvas=="string"&&n.push(rw.pageLoaded);const r=await Promise.allSettled(n);for(const _ of r)_.status==="rejected"&&qe.error(`Failed to initialize debug libraries ${_.reason}`)();if(qe.probe(Ef+1,"DOM is loaded")(),(l=i.gl)!=null&&l.device)return qe.warn("reattaching existing device")(),Nc.attach(i.gl);const a=new Nc(i),u=`Created ${a.type}${a.debug?" debug":""} context: ${a.info.vendor}, ${a.info.renderer} for canvas: ${a.canvasContext.id}`;return qe.probe(Ef,u)(),qe.table(Ef,a.info)(),qe.groupEnd(Ef)(),a}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(i){return Aw(this.gl,i,this._extensions)}isTextureFormatFilterable(i){return OV(this.gl,i,this._extensions)}isTextureFormatRenderable(i){return kV(this.gl,i,this._extensions)}createCanvasContext(i){throw new Error("WebGL only supports a single canvas")}createBuffer(i){const n=this._getBufferProps(i);return new Nl(this,n)}_createTexture(i){return new Qo(this,i)}createExternalTexture(i){throw new Error("createExternalTexture() not implemented")}createSampler(i){return new Sx(this,i)}createShader(i){return new f9(this,i)}createFramebuffer(i){return new Qf(this,i)}createVertexArray(i){return new Tw(this,i)}createTransformFeedback(i){return new W9(this,i)}createQuerySet(i){return new X9(this,i)}createRenderPipeline(i){return new N9(this,i)}beginRenderPass(i){return new y9(this,i)}createComputePipeline(i){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(i){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(i){return new H9(this,i)}submit(){var i;(i=this.renderPass)==null||i.end(),this.renderPass=null}readPixelsToArrayWebGL(i,n){return K9(i,n)}readPixelsToBufferWebGL(i,n){return Z9(i,n)}setParametersWebGL(i){pd(this.gl,i)}getParametersWebGL(i){return KP(this.gl,i)}withParametersWebGL(i,n){return Bl(this.gl,i,n)}clearWebGL(i){nj(this,i)}resetWebGL(){qe.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),hV(this.gl)}loseDevice(){var a;let i=!1;const r=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return r&&(i=!0,r.loseContext()),(a=this._resolveContextLost)==null||a.call(this,{reason:"destroyed",message:"Application triggered context loss"}),i}pushState(){Ly(this.gl)}popState(){vp(this.gl)}setSpectorMetadata(i,n){i.__SPECTOR_Metadata=n}getGLKey(i,n){n=n||this.gl2||this.gl;const r=Number(i);for(const a in n)if(n[a]===r)return`GL.${a}`;return String(i)}setConstantAttributeWebGL(i,n){const r=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(r).fill(null);const a=this._constants[i];switch(a&&lj(a,n)&&qe.info(1,`setConstantAttributeWebGL(${i}) could have been skipped, value unchanged`)(),this._constants[i]=n,n.constructor){case Float32Array:sj(this,i,n);break;case Int32Array:oj(this,i,n);break;case Uint32Array:aj(this,i,n);break;default:fi(!1)}}getExtension(i){return ql(this.gl,i,this._extensions),this._extensions}};k(Nc,"type","webgl");let tp=Nc;function rj(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function sj(t,e,i){switch(i.length){case 1:t.gl.vertexAttrib1fv(e,i);break;case 2:t.gl.vertexAttrib2fv(e,i);break;case 3:t.gl.vertexAttrib3fv(e,i);break;case 4:t.gl.vertexAttrib4fv(e,i);break;default:fi(!1)}}function oj(t,e,i){t.gl.vertexAttribI4iv(e,i)}function aj(t,e,i){t.gl.vertexAttribI4uiv(e,i)}function lj(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}var lM={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,i,n,r){var a=["","webkit","Moz","MS","ms","o"],u=i.createElement("div"),l="function",_=Math.round,w=Math.abs,E=Date.now;function I(q,ee,de){return setTimeout(Q(q,de),ee)}function R(q,ee,de){return Array.isArray(q)?(L(q,de[ee],de),!0):!1}function L(q,ee,de){var De;if(q)if(q.forEach)q.forEach(ee,de);else if(q.length!==r)for(De=0;De<q.length;)ee.call(de,q[De],De,q),De++;else for(De in q)q.hasOwnProperty(De)&&ee.call(de,q[De],De,q)}function W(q,ee,de){var De="DEPRECATED METHOD: "+ee+`
`+de+` AT 
`;return function(){var $e=new Error("get-stack-trace"),ht=$e&&$e.stack?$e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Vt=e.console&&(e.console.warn||e.console.log);return Vt&&Vt.call(e.console,De,ht),q.apply(this,arguments)}}var K;typeof Object.assign!="function"?K=function(ee){if(ee===r||ee===null)throw new TypeError("Cannot convert undefined or null to object");for(var de=Object(ee),De=1;De<arguments.length;De++){var $e=arguments[De];if($e!==r&&$e!==null)for(var ht in $e)$e.hasOwnProperty(ht)&&(de[ht]=$e[ht])}return de}:K=Object.assign;var fe=W(function(ee,de,De){for(var $e=Object.keys(de),ht=0;ht<$e.length;)(!De||De&&ee[$e[ht]]===r)&&(ee[$e[ht]]=de[$e[ht]]),ht++;return ee},"extend","Use `assign`."),X=W(function(ee,de){return fe(ee,de,!0)},"merge","Use `assign`.");function $(q,ee,de){var De=ee.prototype,$e;$e=q.prototype=Object.create(De),$e.constructor=q,$e._super=De,de&&K($e,de)}function Q(q,ee){return function(){return q.apply(ee,arguments)}}function me(q,ee){return typeof q==l?q.apply(ee&&ee[0]||r,ee):q}function Ce(q,ee){return q===r?ee:q}function Be(q,ee,de){L(je(ee),function(De){q.addEventListener(De,de,!1)})}function Fe(q,ee,de){L(je(ee),function(De){q.removeEventListener(De,de,!1)})}function ze(q,ee){for(;q;){if(q==ee)return!0;q=q.parentNode}return!1}function Ve(q,ee){return q.indexOf(ee)>-1}function je(q){return q.trim().split(/\s+/g)}function Ke(q,ee,de){if(q.indexOf&&!de)return q.indexOf(ee);for(var De=0;De<q.length;){if(de&&q[De][de]==ee||!de&&q[De]===ee)return De;De++}return-1}function Lt(q){return Array.prototype.slice.call(q,0)}function Pt(q,ee,de){for(var De=[],$e=[],ht=0;ht<q.length;){var Vt=q[ht][ee];Ke($e,Vt)<0&&De.push(q[ht]),$e[ht]=Vt,ht++}return De=De.sort(function(an,In){return an[ee]>In[ee]}),De}function bt(q,ee){for(var de,De,$e=ee[0].toUpperCase()+ee.slice(1),ht=0;ht<a.length;){if(de=a[ht],De=de?de+$e:ee,De in q)return De;ht++}return r}var _i=1;function Zn(){return _i++}function sn(q){var ee=q.ownerDocument||q;return ee.defaultView||ee.parentWindow||e}var ut=/mobile|tablet|ip(ad|hone|od)|android/i,Et="ontouchstart"in e,At=bt(e,"PointerEvent")!==r,Ft=Et&&ut.test(navigator.userAgent),Ut="touch",Yn="pen",Ji="mouse",mn="kinect",On=25,Jt=1,dn=2,pi=4,$i=8,Bs=1,Jn=2,ur=4,hr=8,jr=16,Pe=Jn|ur,Qn=hr|jr,Io=Pe|Qn,Xt=["x","y"],mi=["clientX","clientY"];function gn(q,ee){var de=this;this.manager=q,this.callback=ee,this.element=q.element,this.target=q.options.inputTarget,this.domHandler=function(De){me(q.options.enable,[q])&&de.handler(De)},this.init()}gn.prototype={handler:function(){},init:function(){this.evEl&&Be(this.element,this.evEl,this.domHandler),this.evTarget&&Be(this.target,this.evTarget,this.domHandler),this.evWin&&Be(sn(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Fe(this.element,this.evEl,this.domHandler),this.evTarget&&Fe(this.target,this.evTarget,this.domHandler),this.evWin&&Fe(sn(this.element),this.evWin,this.domHandler)}};function Ds(q){var ee,de=q.options.inputClass;return de?ee=de:At?ee=ae:Ft?ee=he:Et?ee=Xe:ee=Ct,new ee(q,ls)}function ls(q,ee,de){var De=de.pointers.length,$e=de.changedPointers.length,ht=ee&Jt&&De-$e===0,Vt=ee&(pi|$i)&&De-$e===0;de.isFirst=!!ht,de.isFinal=!!Vt,ht&&(q.session={}),de.eventType=ee,Ro(q,de),q.emit("hammer.input",de),q.recognize(de),q.session.prevInput=de}function Ro(q,ee){var de=q.session,De=ee.pointers,$e=De.length;de.firstInput||(de.firstInput=Po(ee)),$e>1&&!de.firstMultiple?de.firstMultiple=Po(ee):$e===1&&(de.firstMultiple=!1);var ht=de.firstInput,Vt=de.firstMultiple,on=Vt?Vt.center:ht.center,an=ee.center=We(De);ee.timeStamp=E(),ee.deltaTime=ee.timeStamp-ht.timeStamp,ee.angle=Hr(on,an),ee.distance=er(on,an),dr(de,ee),ee.offsetDirection=_n(ee.deltaX,ee.deltaY);var In=Pr(ee.deltaTime,ee.deltaX,ee.deltaY);ee.overallVelocityX=In.x,ee.overallVelocityY=In.y,ee.overallVelocity=w(In.x)>w(In.y)?In.x:In.y,ee.scale=Vt?Ot(Vt.pointers,De):1,ee.rotation=Vt?Qe(Vt.pointers,De):0,ee.maxPointers=de.prevInput?ee.pointers.length>de.prevInput.maxPointers?ee.pointers.length:de.prevInput.maxPointers:ee.pointers.length,ra(de,ee);var yn=q.element;ze(ee.srcEvent.target,yn)&&(yn=ee.srcEvent.target),ee.target=yn}function dr(q,ee){var de=ee.center,De=q.offsetDelta||{},$e=q.prevDelta||{},ht=q.prevInput||{};(ee.eventType===Jt||ht.eventType===pi)&&($e=q.prevDelta={x:ht.deltaX||0,y:ht.deltaY||0},De=q.offsetDelta={x:de.x,y:de.y}),ee.deltaX=$e.x+(de.x-De.x),ee.deltaY=$e.y+(de.y-De.y)}function ra(q,ee){var de=q.lastInterval||ee,De=ee.timeStamp-de.timeStamp,$e,ht,Vt,on;if(ee.eventType!=$i&&(De>On||de.velocity===r)){var an=ee.deltaX-de.deltaX,In=ee.deltaY-de.deltaY,yn=Pr(De,an,In);ht=yn.x,Vt=yn.y,$e=w(yn.x)>w(yn.y)?yn.x:yn.y,on=_n(an,In),q.lastInterval=ee}else $e=de.velocity,ht=de.velocityX,Vt=de.velocityY,on=de.direction;ee.velocity=$e,ee.velocityX=ht,ee.velocityY=Vt,ee.direction=on}function Po(q){for(var ee=[],de=0;de<q.pointers.length;)ee[de]={clientX:_(q.pointers[de].clientX),clientY:_(q.pointers[de].clientY)},de++;return{timeStamp:E(),pointers:ee,center:We(ee),deltaX:q.deltaX,deltaY:q.deltaY}}function We(q){var ee=q.length;if(ee===1)return{x:_(q[0].clientX),y:_(q[0].clientY)};for(var de=0,De=0,$e=0;$e<ee;)de+=q[$e].clientX,De+=q[$e].clientY,$e++;return{x:_(de/ee),y:_(De/ee)}}function Pr(q,ee,de){return{x:ee/q||0,y:de/q||0}}function _n(q,ee){return q===ee?Bs:w(q)>=w(ee)?q<0?Jn:ur:ee<0?hr:jr}function er(q,ee,de){de||(de=Xt);var De=ee[de[0]]-q[de[0]],$e=ee[de[1]]-q[de[1]];return Math.sqrt(De*De+$e*$e)}function Hr(q,ee,de){de||(de=Xt);var De=ee[de[0]]-q[de[0]],$e=ee[de[1]]-q[de[1]];return Math.atan2($e,De)*180/Math.PI}function Qe(q,ee){return Hr(ee[1],ee[0],mi)+Hr(q[1],q[0],mi)}function Ot(q,ee){return er(ee[0],ee[1],mi)/er(q[0],q[1],mi)}var St={mousedown:Jt,mousemove:dn,mouseup:pi},kn="mousedown",Mr="mousemove mouseup";function Ct(){this.evEl=kn,this.evWin=Mr,this.pressed=!1,gn.apply(this,arguments)}$(Ct,gn,{handler:function(ee){var de=St[ee.type];de&Jt&&ee.button===0&&(this.pressed=!0),de&dn&&ee.which!==1&&(de=pi),this.pressed&&(de&pi&&(this.pressed=!1),this.callback(this.manager,de,{pointers:[ee],changedPointers:[ee],pointerType:Ji,srcEvent:ee}))}});var $r={pointerdown:Jt,pointermove:dn,pointerup:pi,pointercancel:$i,pointerout:$i},cs={2:Ut,3:Yn,4:Ji,5:mn},us="pointerdown",Br="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(us="MSPointerDown",Br="MSPointerMove MSPointerUp MSPointerCancel");function ae(){this.evEl=us,this.evWin=Br,gn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}$(ae,gn,{handler:function(ee){var de=this.store,De=!1,$e=ee.type.toLowerCase().replace("ms",""),ht=$r[$e],Vt=cs[ee.pointerType]||ee.pointerType,on=Vt==Ut,an=Ke(de,ee.pointerId,"pointerId");ht&Jt&&(ee.button===0||on)?an<0&&(de.push(ee),an=de.length-1):ht&(pi|$i)&&(De=!0),!(an<0)&&(de[an]=ee,this.callback(this.manager,ht,{pointers:de,changedPointers:[ee],pointerType:Vt,srcEvent:ee}),De&&de.splice(an,1))}});var V={touchstart:Jt,touchmove:dn,touchend:pi,touchcancel:$i},z="touchstart",Y="touchstart touchmove touchend touchcancel";function ne(){this.evTarget=z,this.evWin=Y,this.started=!1,gn.apply(this,arguments)}$(ne,gn,{handler:function(ee){var de=V[ee.type];if(de===Jt&&(this.started=!0),!!this.started){var De=ge.call(this,ee,de);de&(pi|$i)&&De[0].length-De[1].length===0&&(this.started=!1),this.callback(this.manager,de,{pointers:De[0],changedPointers:De[1],pointerType:Ut,srcEvent:ee})}}});function ge(q,ee){var de=Lt(q.touches),De=Lt(q.changedTouches);return ee&(pi|$i)&&(de=Pt(de.concat(De),"identifier")),[de,De]}var ve={touchstart:Jt,touchmove:dn,touchend:pi,touchcancel:$i},Te="touchstart touchmove touchend touchcancel";function he(){this.evTarget=Te,this.targetIds={},gn.apply(this,arguments)}$(he,gn,{handler:function(ee){var de=ve[ee.type],De=ke.call(this,ee,de);De&&this.callback(this.manager,de,{pointers:De[0],changedPointers:De[1],pointerType:Ut,srcEvent:ee})}});function ke(q,ee){var de=Lt(q.touches),De=this.targetIds;if(ee&(Jt|dn)&&de.length===1)return De[de[0].identifier]=!0,[de,de];var $e,ht,Vt=Lt(q.changedTouches),on=[],an=this.target;if(ht=de.filter(function(In){return ze(In.target,an)}),ee===Jt)for($e=0;$e<ht.length;)De[ht[$e].identifier]=!0,$e++;for($e=0;$e<Vt.length;)De[Vt[$e].identifier]&&on.push(Vt[$e]),ee&(pi|$i)&&delete De[Vt[$e].identifier],$e++;if(on.length)return[Pt(ht.concat(on),"identifier"),on]}var Ue=2500,Me=25;function Xe(){gn.apply(this,arguments);var q=Q(this.handler,this);this.touch=new he(this.manager,q),this.mouse=new Ct(this.manager,q),this.primaryTouch=null,this.lastTouches=[]}$(Xe,gn,{handler:function(ee,de,De){var $e=De.pointerType==Ut,ht=De.pointerType==Ji;if(!(ht&&De.sourceCapabilities&&De.sourceCapabilities.firesTouchEvents)){if($e)_t.call(this,de,De);else if(ht&&Wt.call(this,De))return;this.callback(ee,de,De)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function _t(q,ee){q&Jt?(this.primaryTouch=ee.changedPointers[0].identifier,xt.call(this,ee)):q&(pi|$i)&&xt.call(this,ee)}function xt(q){var ee=q.changedPointers[0];if(ee.identifier===this.primaryTouch){var de={x:ee.clientX,y:ee.clientY};this.lastTouches.push(de);var De=this.lastTouches,$e=function(){var ht=De.indexOf(de);ht>-1&&De.splice(ht,1)};setTimeout($e,Ue)}}function Wt(q){for(var ee=q.srcEvent.clientX,de=q.srcEvent.clientY,De=0;De<this.lastTouches.length;De++){var $e=this.lastTouches[De],ht=Math.abs(ee-$e.x),Vt=Math.abs(de-$e.y);if(ht<=Me&&Vt<=Me)return!0}return!1}var Bt=bt(u.style,"touchAction"),Ht=Bt!==r,Nt="compute",Fi="auto",yi="manipulation",Dt="none",qt="pan-x",ri="pan-y",Ni=Mo();function Qi(q,ee){this.manager=q,this.set(ee)}Qi.prototype={set:function(q){q==Nt&&(q=this.compute()),Ht&&this.manager.element.style&&Ni[q]&&(this.manager.element.style[Bt]=q),this.actions=q.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var q=[];return L(this.manager.recognizers,function(ee){me(ee.options.enable,[ee])&&(q=q.concat(ee.getTouchAction()))}),Sn(q.join(" "))},preventDefaults:function(q){var ee=q.srcEvent,de=q.offsetDirection;if(this.manager.session.prevented){ee.preventDefault();return}var De=this.actions,$e=Ve(De,Dt)&&!Ni[Dt],ht=Ve(De,ri)&&!Ni[ri],Vt=Ve(De,qt)&&!Ni[qt];if($e){var on=q.pointers.length===1,an=q.distance<2,In=q.deltaTime<250;if(on&&an&&In)return}if(!(Vt&&ht)&&($e||ht&&de&Pe||Vt&&de&Qn))return this.preventSrc(ee)},preventSrc:function(q){this.manager.session.prevented=!0,q.preventDefault()}};function Sn(q){if(Ve(q,Dt))return Dt;var ee=Ve(q,qt),de=Ve(q,ri);return ee&&de?Dt:ee||de?ee?qt:ri:Ve(q,yi)?yi:Fi}function Mo(){if(!Ht)return!1;var q={},ee=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(de){q[de]=ee?e.CSS.supports("touch-action",de):!0}),q}var Zt=1,Fn=2,Os=4,Gi=8,Li=Gi,sa=16,Ui=32;function zi(q){this.options=K({},this.defaults,q||{}),this.id=Zn(),this.manager=null,this.options.enable=Ce(this.options.enable,!0),this.state=Zt,this.simultaneous={},this.requireFail=[]}zi.prototype={defaults:{},set:function(q){return K(this.options,q),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(q){if(R(q,"recognizeWith",this))return this;var ee=this.simultaneous;return q=Mi(q,this),ee[q.id]||(ee[q.id]=q,q.recognizeWith(this)),this},dropRecognizeWith:function(q){return R(q,"dropRecognizeWith",this)?this:(q=Mi(q,this),delete this.simultaneous[q.id],this)},requireFailure:function(q){if(R(q,"requireFailure",this))return this;var ee=this.requireFail;return q=Mi(q,this),Ke(ee,q)===-1&&(ee.push(q),q.requireFailure(this)),this},dropRequireFailure:function(q){if(R(q,"dropRequireFailure",this))return this;q=Mi(q,this);var ee=Ke(this.requireFail,q);return ee>-1&&this.requireFail.splice(ee,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(q){return!!this.simultaneous[q.id]},emit:function(q){var ee=this,de=this.state;function De($e){ee.manager.emit($e,q)}de<Gi&&De(ee.options.event+io(de)),De(ee.options.event),q.additionalEvent&&De(q.additionalEvent),de>=Gi&&De(ee.options.event+io(de))},tryEmit:function(q){if(this.canEmit())return this.emit(q);this.state=Ui},canEmit:function(){for(var q=0;q<this.requireFail.length;){if(!(this.requireFail[q].state&(Ui|Zt)))return!1;q++}return!0},recognize:function(q){var ee=K({},q);if(!me(this.options.enable,[this,ee])){this.reset(),this.state=Ui;return}this.state&(Li|sa|Ui)&&(this.state=Zt),this.state=this.process(ee),this.state&(Fn|Os|Gi|sa)&&this.tryEmit(ee)},process:function(q){},getTouchAction:function(){},reset:function(){}};function io(q){return q&sa?"cancel":q&Gi?"end":q&Os?"move":q&Fn?"start":""}function ks(q){return q==jr?"down":q==hr?"up":q==Jn?"left":q==ur?"right":""}function Mi(q,ee){var de=ee.manager;return de?de.get(q):q}function Cn(){zi.apply(this,arguments)}$(Cn,zi,{defaults:{pointers:1},attrTest:function(q){var ee=this.options.pointers;return ee===0||q.pointers.length===ee},process:function(q){var ee=this.state,de=q.eventType,De=ee&(Fn|Os),$e=this.attrTest(q);return De&&(de&$i||!$e)?ee|sa:De||$e?de&pi?ee|Gi:ee&Fn?ee|Os:Fn:Ui}});function Nn(){Cn.apply(this,arguments),this.pX=null,this.pY=null}$(Nn,Cn,{defaults:{event:"pan",threshold:10,pointers:1,direction:Io},getTouchAction:function(){var q=this.options.direction,ee=[];return q&Pe&&ee.push(ri),q&Qn&&ee.push(qt),ee},directionTest:function(q){var ee=this.options,de=!0,De=q.distance,$e=q.direction,ht=q.deltaX,Vt=q.deltaY;return $e&ee.direction||(ee.direction&Pe?($e=ht===0?Bs:ht<0?Jn:ur,de=ht!=this.pX,De=Math.abs(q.deltaX)):($e=Vt===0?Bs:Vt<0?hr:jr,de=Vt!=this.pY,De=Math.abs(q.deltaY))),q.direction=$e,de&&De>ee.threshold&&$e&ee.direction},attrTest:function(q){return Cn.prototype.attrTest.call(this,q)&&(this.state&Fn||!(this.state&Fn)&&this.directionTest(q))},emit:function(q){this.pX=q.deltaX,this.pY=q.deltaY;var ee=ks(q.direction);ee&&(q.additionalEvent=this.options.event+ee),this._super.emit.call(this,q)}});function Bi(){Cn.apply(this,arguments)}$(Bi,Cn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Dt]},attrTest:function(q){return this._super.attrTest.call(this,q)&&(Math.abs(q.scale-1)>this.options.threshold||this.state&Fn)},emit:function(q){if(q.scale!==1){var ee=q.scale<1?"in":"out";q.additionalEvent=this.options.event+ee}this._super.emit.call(this,q)}});function Bo(){zi.apply(this,arguments),this._timer=null,this._input=null}$(Bo,zi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Fi]},process:function(q){var ee=this.options,de=q.pointers.length===ee.pointers,De=q.distance<ee.threshold,$e=q.deltaTime>ee.time;if(this._input=q,!De||!de||q.eventType&(pi|$i)&&!$e)this.reset();else if(q.eventType&Jt)this.reset(),this._timer=I(function(){this.state=Li,this.tryEmit()},ee.time,this);else if(q.eventType&pi)return Li;return Ui},reset:function(){clearTimeout(this._timer)},emit:function(q){this.state===Li&&(q&&q.eventType&pi?this.manager.emit(this.options.event+"up",q):(this._input.timeStamp=E(),this.manager.emit(this.options.event,this._input)))}});function tr(){Cn.apply(this,arguments)}$(tr,Cn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Dt]},attrTest:function(q){return this._super.attrTest.call(this,q)&&(Math.abs(q.rotation)>this.options.threshold||this.state&Fn)}});function oa(){Cn.apply(this,arguments)}$(oa,Cn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Pe|Qn,pointers:1},getTouchAction:function(){return Nn.prototype.getTouchAction.call(this)},attrTest:function(q){var ee=this.options.direction,de;return ee&(Pe|Qn)?de=q.overallVelocity:ee&Pe?de=q.overallVelocityX:ee&Qn&&(de=q.overallVelocityY),this._super.attrTest.call(this,q)&&ee&q.offsetDirection&&q.distance>this.options.threshold&&q.maxPointers==this.options.pointers&&w(de)>this.options.velocity&&q.eventType&pi},emit:function(q){var ee=ks(q.offsetDirection);ee&&this.manager.emit(this.options.event+ee,q),this.manager.emit(this.options.event,q)}});function Ln(){zi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}$(Ln,zi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[yi]},process:function(q){var ee=this.options,de=q.pointers.length===ee.pointers,De=q.distance<ee.threshold,$e=q.deltaTime<ee.time;if(this.reset(),q.eventType&Jt&&this.count===0)return this.failTimeout();if(De&&$e&&de){if(q.eventType!=pi)return this.failTimeout();var ht=this.pTime?q.timeStamp-this.pTime<ee.interval:!0,Vt=!this.pCenter||er(this.pCenter,q.center)<ee.posThreshold;this.pTime=q.timeStamp,this.pCenter=q.center,!Vt||!ht?this.count=1:this.count+=1,this._input=q;var on=this.count%ee.taps;if(on===0)return this.hasRequireFailures()?(this._timer=I(function(){this.state=Li,this.tryEmit()},ee.interval,this),Fn):Li}return Ui},failTimeout:function(){return this._timer=I(function(){this.state=Ui},this.options.interval,this),Ui},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Li&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Fs(q,ee){return ee=ee||{},ee.recognizers=Ce(ee.recognizers,Fs.defaults.preset),new Gr(q,ee)}Fs.VERSION="2.0.7",Fs.defaults={domEvents:!1,touchAction:Nt,enable:!0,inputTarget:null,inputClass:null,preset:[[tr,{enable:!1}],[Bi,{enable:!1},["rotate"]],[oa,{direction:Pe}],[Nn,{direction:Pe},["swipe"]],[Ln],[Ln,{event:"doubletap",taps:2},["tap"]],[Bo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Va=1,Ns=2;function Gr(q,ee){this.options=K({},Fs.defaults,ee||{}),this.options.inputTarget=this.options.inputTarget||q,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=q,this.input=Ds(this),this.touchAction=new Qi(this,this.options.touchAction),Kt(this,!0),L(this.options.recognizers,function(de){var De=this.add(new de[0](de[1]));de[2]&&De.recognizeWith(de[2]),de[3]&&De.requireFailure(de[3])},this)}Gr.prototype={set:function(q){return K(this.options,q),q.touchAction&&this.touchAction.update(),q.inputTarget&&(this.input.destroy(),this.input.target=q.inputTarget,this.input.init()),this},stop:function(q){this.session.stopped=q?Ns:Va},recognize:function(q){var ee=this.session;if(!ee.stopped){this.touchAction.preventDefaults(q);var de,De=this.recognizers,$e=ee.curRecognizer;(!$e||$e&&$e.state&Li)&&($e=ee.curRecognizer=null);for(var ht=0;ht<De.length;)de=De[ht],ee.stopped!==Ns&&(!$e||de==$e||de.canRecognizeWith($e))?de.recognize(q):de.reset(),!$e&&de.state&(Fn|Os|Gi)&&($e=ee.curRecognizer=de),ht++}},get:function(q){if(q instanceof zi)return q;for(var ee=this.recognizers,de=0;de<ee.length;de++)if(ee[de].options.event==q)return ee[de];return null},add:function(q){if(R(q,"add",this))return this;var ee=this.get(q.options.event);return ee&&this.remove(ee),this.recognizers.push(q),q.manager=this,this.touchAction.update(),q},remove:function(q){if(R(q,"remove",this))return this;if(q=this.get(q),q){var ee=this.recognizers,de=Ke(ee,q);de!==-1&&(ee.splice(de,1),this.touchAction.update())}return this},on:function(q,ee){if(q!==r&&ee!==r){var de=this.handlers;return L(je(q),function(De){de[De]=de[De]||[],de[De].push(ee)}),this}},off:function(q,ee){if(q!==r){var de=this.handlers;return L(je(q),function(De){ee?de[De]&&de[De].splice(Ke(de[De],ee),1):delete de[De]}),this}},emit:function(q,ee){this.options.domEvents&&nc(q,ee);var de=this.handlers[q]&&this.handlers[q].slice();if(!(!de||!de.length)){ee.type=q,ee.preventDefault=function(){ee.srcEvent.preventDefault()};for(var De=0;De<de.length;)de[De](ee),De++}},destroy:function(){this.element&&Kt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Kt(q,ee){var de=q.element;if(de.style){var De;L(q.options.cssProps,function($e,ht){De=bt(de.style,ht),ee?(q.oldCssProps[De]=de.style[De],de.style[De]=$e):de.style[De]=q.oldCssProps[De]||""}),ee||(q.oldCssProps={})}}function nc(q,ee){var de=i.createEvent("Event");de.initEvent(q,!0,!0),de.gesture=ee,ee.target.dispatchEvent(de)}K(Fs,{INPUT_START:Jt,INPUT_MOVE:dn,INPUT_END:pi,INPUT_CANCEL:$i,STATE_POSSIBLE:Zt,STATE_BEGAN:Fn,STATE_CHANGED:Os,STATE_ENDED:Gi,STATE_RECOGNIZED:Li,STATE_CANCELLED:sa,STATE_FAILED:Ui,DIRECTION_NONE:Bs,DIRECTION_LEFT:Jn,DIRECTION_RIGHT:ur,DIRECTION_UP:hr,DIRECTION_DOWN:jr,DIRECTION_HORIZONTAL:Pe,DIRECTION_VERTICAL:Qn,DIRECTION_ALL:Io,Manager:Gr,Input:gn,TouchAction:Qi,TouchInput:he,MouseInput:Ct,PointerEventInput:ae,TouchMouseInput:Xe,SingleTouchInput:ne,Recognizer:zi,AttrRecognizer:Cn,Tap:Ln,Pan:Nn,Swipe:oa,Pinch:Bi,Rotate:tr,Press:Bo,on:Be,off:Fe,each:L,merge:X,extend:fe,assign:K,inherit:$,bindFn:Q,prefixed:bt});var rc=typeof e<"u"?e:typeof self<"u"?self:{};rc.Hammer=Fs,t.exports?t.exports=Fs:e[n]=Fs})(window,document,"Hammer")})(lM);var Yp=lM.exports;const cj=Vb(Yp),Ho=Rk({__proto__:null,default:cj},[Yp]),cM=1,uM=2,Ix=4,uj={mousedown:cM,mousemove:uM,mouseup:Ix};function hj(t,e){for(let i=0;i<t.length;i++)if(e(t[i]))return!0;return!1}function dj(t){const e=t.prototype.handler;t.prototype.handler=function(n){const r=this.store;n.button>0&&n.type==="pointerdown"&&(hj(r,a=>a.pointerId===n.pointerId)||r.push(n)),e.call(this,n)}}function fj(t){t.prototype.handler=function(i){let n=uj[i.type];n&cM&&i.button>=0&&(this.pressed=!0),n&uM&&i.buttons===0&&(n=Ix),this.pressed&&(n&Ix&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[i],changedPointers:[i],pointerType:"mouse",srcEvent:i}))}}dj(Yp.PointerEventInput);fj(Yp.MouseInput);const pj=Yp.Manager;class zy{constructor(e,i,n){this.element=e,this.callback=i,this.options={enable:!0,...n}}}const mj=Ho?[[Ho.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Ho.Rotate,{enable:!1}],[Ho.Pinch,{enable:!1}],[Ho.Swipe,{enable:!1}],[Ho.Pan,{threshold:0,enable:!1}],[Ho.Press,{enable:!1}],[Ho.Tap,{event:"doubletap",taps:2,enable:!1}],[Ho.Tap,{event:"anytap",enable:!1}],[Ho.Tap,{enable:!1}]]:null,rC={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},gj={doubletap:["tap"]},_j={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Ew={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},yj={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},sC={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},vj=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",vh=typeof window<"u"?window:global;let Rx=!1;try{const t={get passive(){return Rx=!0,!0}};vh.addEventListener("test",null,t),vh.removeEventListener("test",null)}catch{Rx=!1}const xj=vj.indexOf("firefox")!==-1,{WHEEL_EVENTS:bj}=Ew,oC="wheel",aC=4.000244140625,wj=40,Aj=.25;class Tj extends zy{constructor(e,i,n){super(e,i,n),this.handleEvent=r=>{if(!this.options.enable)return;let a=r.deltaY;vh.WheelEvent&&(xj&&r.deltaMode===vh.WheelEvent.DOM_DELTA_PIXEL&&(a/=vh.devicePixelRatio),r.deltaMode===vh.WheelEvent.DOM_DELTA_LINE&&(a*=wj)),a!==0&&a%aC===0&&(a=Math.floor(a/aC)),r.shiftKey&&a&&(a=a*Aj),this.callback({type:oC,center:{x:r.clientX,y:r.clientY},delta:-a,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(bj),this.events.forEach(r=>e.addEventListener(r,this.handleEvent,Rx?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===oC&&(this.options.enable=i)}}const{MOUSE_EVENTS:Ej}=Ew,lC="pointermove",cC="pointerover",uC="pointerout",hC="pointerenter",dC="pointerleave";class Sj extends zy{constructor(e,i,n){super(e,i,n),this.handleEvent=a=>{this.handleOverEvent(a),this.handleOutEvent(a),this.handleEnterEvent(a),this.handleLeaveEvent(a),this.handleMoveEvent(a)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(Ej),this.events.forEach(a=>e.addEventListener(a,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===lC&&(this.enableMoveEvent=i),e===cC&&(this.enableOverEvent=i),e===uC&&(this.enableOutEvent=i),e===hC&&(this.enableEnterEvent=i),e===dC&&(this.enableLeaveEvent=i)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(cC,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(uC,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(hC,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(dC,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(lC,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,i){this.callback({type:e,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const{KEY_EVENTS:Cj}=Ew,fC="keydown",pC="keyup";class Ij extends zy{constructor(e,i,n){super(e,i,n),this.handleEvent=r=>{const a=r.target||r.srcElement;a.tagName==="INPUT"&&a.type==="text"||a.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:fC,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:pC,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(Cj),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,i){e===fC&&(this.enableDownEvent=i),e===pC&&(this.enableUpEvent=i)}}const mC="contextmenu";class Rj extends zy{constructor(e,i,n){super(e,i,n),this.handleEvent=r=>{this.options.enable&&this.callback({type:mC,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,i){e===mC&&(this.options.enable=i)}}const gC=1,Px=2,_C=4,Pj={pointerdown:gC,pointermove:Px,pointerup:_C,mousedown:gC,mousemove:Px,mouseup:_C},Mj=0,Bj=1,Dj=2,Oj=1,kj=2,Fj=4;function Nj(t){const e=Pj[t.srcEvent.type];if(!e)return null;const{buttons:i,button:n}=t.srcEvent;let r=!1,a=!1,u=!1;return e===Px?(r=!!(i&Oj),a=!!(i&Fj),u=!!(i&kj)):(r=n===Mj,a=n===Bj,u=n===Dj),{leftButton:r,middleButton:a,rightButton:u}}function Lj(t,e){const i=t.center;if(!i)return null;const n=e.getBoundingClientRect(),r=n.width/e.offsetWidth||1,a=n.height/e.offsetHeight||1,u={x:(i.x-n.left-e.clientLeft)/r,y:(i.y-n.top-e.clientTop)/a};return{center:i,offsetCenter:u}}const qv={srcElement:"root",priority:0};class Uj{constructor(e){this.handleEvent=i=>{if(this.isEmpty())return;const n=this._normalizeEvent(i);let r=i.srcEvent.target;for(;r&&r!==n.rootElement;){if(this._emit(n,r),n.handled)return;r=r.parentNode}this._emit(n,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,i,n,r=!1,a=!1){const{handlers:u,handlersByElement:l}=this;let _=qv;typeof n=="string"||n&&n.addEventListener?_={...qv,srcElement:n}:n&&(_={...qv,...n});let w=l.get(_.srcElement);w||(w=[],l.set(_.srcElement,w));const E={type:e,handler:i,srcElement:_.srcElement,priority:_.priority};r&&(E.once=!0),a&&(E.passive=!0),u.push(E),this._active=this._active||!E.passive;let I=w.length-1;for(;I>=0&&!(w[I].priority>=E.priority);)I--;w.splice(I+1,0,E)}remove(e,i){const{handlers:n,handlersByElement:r}=this;for(let a=n.length-1;a>=0;a--){const u=n[a];if(u.type===e&&u.handler===i){n.splice(a,1);const l=r.get(u.srcElement);l.splice(l.indexOf(u),1),l.length===0&&r.delete(u.srcElement)}}this._active=n.some(a=>!a.passive)}_emit(e,i){const n=this.handlersByElement.get(i);if(n){let r=!1;const a=()=>{e.handled=!0},u=()=>{e.handled=!0,r=!0},l=[];for(let _=0;_<n.length;_++){const{type:w,handler:E,once:I}=n[_];if(E({...e,type:w,stopPropagation:a,stopImmediatePropagation:u}),I&&l.push(n[_]),r)break}for(let _=0;_<l.length;_++){const{type:w,handler:E}=l[_];this.remove(w,E)}}}_normalizeEvent(e){const i=this.eventManager.getElement();return{...e,...Nj(e),...Lj(e,i),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}const zj={events:null,recognizers:null,recognizerOptions:{},Manager:pj,touchAction:"none",tabIndex:0};class Vj{constructor(e=null,i){this._onBasicInput=r=>{const{srcEvent:a}=r,u=_j[a.type];u&&this.manager.emit(u,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...zj,...i},this.events=new Map,this.setElement(e);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:i}=this,n=i.Manager;this.manager=new n(e,{touchAction:i.touchAction,recognizers:i.recognizers||mj}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(rC).forEach(r=>{const a=this.manager.get(r);a&&rC[r].forEach(u=>{a.recognizeWith(u)})});for(const r in i.recognizerOptions){const a=this.manager.get(r);if(a){const u=i.recognizerOptions[r];delete u.enable,a.set(u)}}this.wheelInput=new Tj(e,this._onOtherEvent,{enable:!1}),this.moveInput=new Sj(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Ij(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new Rj(e,this._onOtherEvent,{enable:!1});for(const[r,a]of this.events)a.isEmpty()||(this._toggleRecognizer(a.recognizerName,!0),this.manager.on(r,a.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,i,n){this._addEventHandler(e,i,n,!1)}once(e,i,n){this._addEventHandler(e,i,n,!0)}watch(e,i,n){this._addEventHandler(e,i,n,!1,!0)}off(e,i){this._removeEventHandler(e,i)}_toggleRecognizer(e,i){const{manager:n}=this;if(!n)return;const r=n.get(e);if(r&&r.options.enable!==i){r.set({enable:i});const a=gj[e];a&&!this.options.recognizers&&a.forEach(u=>{const l=n.get(u);i?(l.requireFailure(e),r.dropRequireFailure(u)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,i),this.moveInput.enableEventType(e,i),this.keyInput.enableEventType(e,i),this.contextmenuInput.enableEventType(e,i)}_addEventHandler(e,i,n,r,a){if(typeof e!="string"){n=i;for(const E in e)this._addEventHandler(E,e[E],n,r,a);return}const{manager:u,events:l}=this,_=sC[e]||e;let w=l.get(_);w||(w=new Uj(this),l.set(_,w),w.recognizerName=yj[_]||_,u&&u.on(_,w.handleEvent)),w.add(e,i,n,r,a),w.isEmpty()||this._toggleRecognizer(w.recognizerName,!0)}_removeEventHandler(e,i){if(typeof e!="string"){for(const u in e)this._removeEventHandler(u,e[u]);return}const{events:n}=this,r=sC[e]||e,a=n.get(r);if(a&&(a.remove(e,i),a.isEmpty())){const{recognizerName:u}=a;let l=!1;for(const _ of n.values())if(_.recognizerName===u&&!_.isEmpty()){l=!0;break}l||this._toggleRecognizer(u,!1)}}}function bl(){}const jj=({isDragging:t})=>t?"grabbing":"grab",hM={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:bl,onWebGLInitialized:bl,onResize:bl,onViewStateChange:bl,onInteractionStateChange:bl,onBeforeRender:bl,onAfterRender:bl,onLoad:bl,onError:t=>ai.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:jj,getTooltip:null,debug:!1,drawPickingColors:!1};class xp{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new fd({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:r}=this;if(n.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(n.leftButton||n.rightButton)return;{const a=n.offsetCenter;if(!a)return;r.x=a.x,r.y=a.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=n},this._onEvent=n=>{const r=_x[n.type],a=n.offsetCenter;if(!r||!a||!this.layerManager)return;const u=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:u,viewports:this.getViewports(a)},this._lastPointerDownInfo),{layer:_}=l,w=_&&(_[r.handler]||_.props[r.handler]),E=this.props[r.handler];let I=!1;w&&(I=w.call(_,l,n)),I||(E==null||E(l,n),this.widgetManager.onEvent(l,n))},this._onPointerDown=n=>{const r=n.offsetCenter,a=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=a.result[0]||a.emptyInfo},this.props={...hM,...e},e=this.props,e.viewState&&e.initialViewState&&ai.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&ai.error("WebGL1 context not supported.")(),this.device=tp.attach(e.gl));let i=this.device;i||(Fh.registerDevices([tp]),i=Fh.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(i,e),this.setProps(e),e._typedArrayManagerProps&&Qh.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,i,n,r,a,u,l,_,w,E;(e=this.animationLoop)==null||e.stop(),(i=this.animationLoop)==null||i.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)==null||n.finalize(),this.layerManager=null,(r=this.viewManager)==null||r.finalize(),this.viewManager=null,(a=this.effectManager)==null||a.finalize(),this.effectManager=null,(u=this.deckRenderer)==null||u.finalize(),this.deckRenderer=null,(l=this.deckPicker)==null||l.finalize(),this.deckPicker=null,(_=this.eventManager)==null||_.destroy(),this.eventManager=null,(w=this.widgetManager)==null||w.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((E=this.canvas.parentElement)==null||E.removeChild(this.canvas),this.canvas=null)}setProps(e){var n;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ai.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ai.removed("onLayerClick","onClick")(),e.initialViewState&&!yo(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const i=Object.create(this.props);Object.assign(i,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(n=this.animationLoop)==null||n.setProps(i),this.layerManager&&(this.viewManager.setProps(i),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(i),this.effectManager.setProps(i),this.deckRenderer.setProps(i),this.deckPicker.setProps(i),this.widgetManager.setProps(i)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),a=this.effectManager.needsRedraw(e),u=this.deckRenderer.needsRedraw(e);return i=i||n||r||a||u,i}redraw(e){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=e||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return Tn(this.viewManager),this.viewManager.views}getViewports(e){return Tn(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const i=this._pick("pickObject","pickObject Time",e).result;return i.length?i[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,i=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:i})}_removeResources(e){for(const i of e)this.layerManager.resourceManager.remove(i)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var i;(i=this.layerManager)==null||i.removeDefaultShaderModule(e)}_pick(e,i,n){Tn(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(i).timeStart();const a=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return r.get(i).timeEnd(),a}_createCanvas(e){let i=e.canvas;return typeof i=="string"&&(i=document.getElementById(i),Tn(i)),i||(i=document.createElement("canvas"),i.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(i)),Object.assign(i.style,e.style),i}_setCanvasSize(e){var r;if(!this.canvas)return;const{width:i,height:n}=e;if(i||i===0){const a=Number.isFinite(i)?`${i}px`:i;this.canvas.style.width=a}if(n||n===0){const a=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=((r=e.style)==null?void 0:r.position)||"absolute",this.canvas.style.height=a}}_updateCanvasSize(){var r,a;const{canvas:e}=this;if(!e)return;const i=e.clientWidth??e.width,n=e.clientHeight??e.height;(i!==this.width||n!==this.height)&&(this.width=i,this.height=n,(r=this.viewManager)==null||r.setProps({width:i,height:n}),(a=this.layerManager)==null||a.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:n}))}_createAnimationLoop(e,i){const{gl:n,onError:r,useDevicePixels:a}=i;return new d8({device:e,useDevicePixels:a,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:u=>this._setDevice(u.device),onRender:this._onRenderFrame.bind(this),onError:r})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,i=Array.isArray(e)?e:e?[e]:[new xw({id:"default-view"})];return i.length&&this.props.controller&&(i[0].props.controller=this.props.controller),i}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var i,n,r;const{_pickRequest:e}=this;if(e.event){const{result:a,emptyInfo:u}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=a.length>0;let l=u,_=!1;for(const w of a)l=w,_=((i=w.layer)==null?void 0:i.onHover(w,e.event))||_;_||((r=(n=this.props).onHover)==null||r.call(n,l,e.event),this.widgetManager.onHover(l,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var r,a;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(r=this.device.canvasContext)==null?void 0:r.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof tp&&this.props.onWebGLInitialized(this.device.gl);const i=new HP;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new Vj(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const u in _x)this.eventManager.on(u,this._onEvent);this.viewManager=new P8({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new R8(this.device,{deck:this,stats:this.stats,viewport:n,timeline:i}),this.effectManager=new X8({deck:this,device:this.device}),this.deckRenderer=new Z8(this.device),this.deckPicker=new iV(this.device),this.widgetManager=new sV({deck:this,parentElement:(a=this.canvas)==null?void 0:a.parentElement}),this.widgetManager.addDefault(new aV),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,i){var u;const{device:n,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:r});const a={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...i};(u=this.deckRenderer)==null||u.renderLayers(a),a.pass==="screen"&&this.widgetManager.onRedraw({viewports:a.viewports,layers:a.layers}),this.props.onAfterRender({device:n,gl:r})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ai.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const i=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const i=this.animationLoop.stats;e.get("GPU Time").addTime(i.get("GPU Time").lastTiming),e.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:i}=this;e.fps=i.get("frameRate").getHz(),e.setPropsTime=i.get("setProps Time").time,e.updateAttributesTime=i.get("Update Attributes").time,e.framesRedrawn=i.get("Redraw Count").count,e.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,e.pickCount=i.get("Pick Count").count,e.gpuTime=i.get("GPU Time").time,e.cpuTime=i.get("CPU Time").time,e.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const n=Fh.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}xp.defaultProps=hM;xp.VERSION=jL;function Hj(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return eP(t)}}const $j=QR;function bg(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function zc(t){return t.stride||t.size*t.bytesPerElement}function Gj(t,e){return t.type===e.type&&t.size===e.size&&zc(t)===zc(e)&&(t.offset||0)===(e.offset||0)}function Mx(t,e){e.offset&&ai.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=zc(t),n=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,a=n*i+r*t.bytesPerElement+(t.offset||0);return{...e,offset:a,stride:i}}function Wj(t,e){const i=Mx(t,e);return{high:i,low:{...i,offset:i.offset+t.size*4}}}class Xj{constructor(e,i,n){this._buffer=null,this.device=e,this.id=i.id||"",this.size=i.size||1;const r=i.logicalType||i.type,a=r==="float64";let{defaultValue:u}=i;u=Number.isFinite(u)?[u]:u||new Array(this.size).fill(0);let l;a?l="float32":!r&&i.isIndexed?l="uint32":l=r||"float32";let _=Hj(r||l);this.doublePrecision=a,a&&i.fp64===!1&&(_=Float32Array),this.value=null,this.settings={...i,defaultType:_,defaultValue:u,logicalType:r,type:l,normalized:l.includes("norm"),size:this.size,bytesPerElement:_.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*zc(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Qh.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,i=null){const n={};if(this.state.constant){const r=this.value;if(i){const a=Mx(this.getAccessor(),i),u=a.offset/r.BYTES_PER_ELEMENT,l=a.size||this.size;n[e]=r.subarray(u,u+l)}else n[e]=r}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,i=null){const n=this.getAccessor(),r=[],a={name:this.id,byteStride:zc(n),attributes:r};if(this.doublePrecision){const u=Wj(n,i||{});r.push(bg(e,{...n,...u.high}),bg(`${e}64Low`,{...n,...u.low}))}else if(i){const u=Mx(n,i);r.push(bg(e,{...n,...u}))}else r.push(bg(e,n));return a}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const i=Array.from(this.value);e=[i,i]}else{const{value:i,numInstances:n,size:r}=this,a=n*r;if(i&&a&&i.length>=a){const u=new Array(r).fill(1/0),l=new Array(r).fill(-1/0);for(let _=0;_<a;)for(let w=0;w<r;w++){const E=i[_++];E<u[w]&&(u[w]=E),E>l[w]&&(l[w]=E)}e=[u,l]}}return this.state.bounds=e,e}setData(e){const{state:i}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof Zi?n={buffer:e}:n=e;const r={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)r.type="float32";else{const u=$j(n.value);r.type=r.normalized?u.replace("int","norm"):u}r.bytesPerElement=n.value.BYTES_PER_ELEMENT,r.stride=zc(r)}if(i.bounds=null,n.constant){let a=n.value;if(a=this._normalizeValue(a,[],0),this.settings.normalized&&(a=this.normalizeConstant(a)),!(!i.constant||!this._areValuesEqual(a,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=ArrayBuffer.isView(a)?a:new Float32Array(a)}else if(n.buffer){const a=n.buffer;i.externalBuffer=a,i.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let a=n.value;i.externalBuffer=null,i.constant=!1,this.value=a;let{buffer:u}=this;const l=zc(r),_=(r.vertexOffset||0)*l;if(this.doublePrecision&&a instanceof Float64Array&&(a=kv(a,r)),this.settings.isIndexed){const E=this.settings.defaultType;a.constructor!==E&&(a=new E(a))}const w=a.byteLength+_+l*2;(!u||u.byteLength<w)&&(u=this._createBuffer(w)),u.write(a,_)}return this.setAccessor(r),!0}updateSubBuffer(e={}){this.state.bounds=null;const i=this.value,{startOffset:n=0,endOffset:r}=e;this.buffer.write(this.doublePrecision&&i instanceof Float64Array?kv(i,{size:this.size,startIndex:n,endIndex:r}):i.subarray(n,r),n*i.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,i=!1){const{state:n}=this,r=n.allocatedValue,a=Qh.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:i});this.value=a;const{byteOffset:u}=this;let{buffer:l}=this;return(!l||l.byteLength<a.byteLength+u)&&(l=this._createBuffer(a.byteLength+u),i&&r&&l.write(r instanceof Float64Array?kv(r,this):r,u)),n.allocatedValue=a,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:i}=e;if(!ArrayBuffer.isView(i))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=i.BYTES_PER_ELEMENT<4),r)throw new Error(`Attribute ${this.id} does not support ${i.constructor.name}`);!(i instanceof n)&&this.settings.normalized&&!("normalized"in e)&&ai.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(i=>(i+128)/255*2-1);case"snorm16":return new Float32Array(e).map(i=>(i+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(i=>i/255);case"unorm16":return new Float32Array(e).map(i=>i/65535);default:return e}}_normalizeValue(e,i,n){const{defaultValue:r,size:a}=this.settings;if(Number.isFinite(e))return i[n]=e,i;if(!e){let u=a;for(;--u>=0;)i[n+u]=r[u];return i}switch(a){case 4:i[n+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:i[n+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:i[n+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:i[n+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let u=a;for(;--u>=0;)i[n+u]=Number.isFinite(e[u])?e[u]:r[u]}return i}_areValuesEqual(e,i){if(!e||!i)return!1;const{size:n}=this;for(let r=0;r<n;r++)if(e[r]!==i[r])return!1;return!0}_createBuffer(e){var r;this._buffer&&this._buffer.destroy();const{isIndexed:i,type:n}=this.settings;return this._buffer=this.device.createBuffer({...(r=this._buffer)==null?void 0:r.props,id:this.id,usage:i?Zi.INDEX:Zi.VERTEX,indexType:i?n:void 0,byteLength:e}),this._buffer}}const yC=[],vC=[];function Sw(t,e=0,i=1/0){let n=yC;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&(vC.length=t.length,n=vC):n=yC,(e>0||Number.isFinite(i))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,i),r.index=e-1),{iterable:n,objectInfo:r}}function dM(t){return t&&t[Symbol.asyncIterator]}function fM(t,e){const{size:i,stride:n,offset:r,startIndices:a,nested:u}=e,l=t.BYTES_PER_ELEMENT,_=n?n/l:i,w=r?r/l:0,E=Math.floor((t.length-w)/_);return(I,{index:R,target:L})=>{if(!a){const X=R*_+w;for(let $=0;$<i;$++)L[$]=t[X+$];return L}const W=a[R],K=a[R+1]||E;let fe;if(u){fe=new Array(K-W);for(let X=W;X<K;X++){const $=X*_+w;L=new Array(i);for(let Q=0;Q<i;Q++)L[Q]=t[$+Q];fe[X-W]=L}}else if(_===i)fe=t.subarray(W*i+w,K*i+w);else{fe=new t.constructor((K-W)*i);let X=0;for(let $=W;$<K;$++){const Q=$*_+w;for(let me=0;me<i;me++)fe[X++]=t[Q+me]}}return fe}}const qj=[],s_=[[0,1/0]];function Kj(t,e){if(t===s_||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const i=[],n=t.length;let r=0;for(let a=0;a<n;a++){const u=t[a];u[1]<e[0]?(i.push(u),r=a+1):u[0]>e[1]?i.push(u):e=[Math.min(u[0],e[0]),Math.max(u[1],e[1])]}return i.splice(r,0,e),i}const Zj={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function pM(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const i=t.type||"interpolation";return{...Zj[i],...e,...t,type:i}}class mM extends Xj{constructor(e,i){super(e,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:s_}),this.constant=!1,this.settings.update=i.update||(i.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!e,i}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var i;(i=this.state).layoutChanged||(i.layoutChanged=!Gj(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:i}=this.settings,n=this.settings.transition,r=Array.isArray(i)?e[i.find(a=>e[a])]:e[i];return pM(r,n)}setNeedsUpdate(e=this.id,i){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),i){const{startRow:n=0,endRow:r=1/0}=i;this.state.updateRanges=Kj(this.state.updateRanges,[n,r])}else this.state.updateRanges=s_}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=qj}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:i,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,i.updateRanges!==s_),!0):!1}updateBuffer({numInstances:e,data:i,props:n,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:u,noAlloc:l}}=this;let _=!0;if(u){for(const[w,E]of a)u.call(r,this,{data:i,startRow:w,endRow:E,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[w,E]of a){const I=Number.isFinite(w)?this.getVertexOffset(w):0,R=Number.isFinite(E)?this.getVertexOffset(E):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:I,endOffset:R})}this._checkAttributeArray()}else _=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),_}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:i}=this;return e?(this.clearNeedsUpdate(),i.lastExternalBuffer===e||(i.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(i.lastExternalBuffer=null,!1)}setBinaryValue(e,i=null){const{state:n,settings:r}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),r.transform||i!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const u=e;Tn(ArrayBuffer.isView(u.value),`invalid ${r.accessor}`);const l=!!u.size&&u.size!==this.size;return n.binaryAccessor=fM(u.value,{size:u.size||this.size,stride:u.stride,offset:u.offset,startIndices:i,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:i}=this;return(i?e<i.length?i[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,i=super.getValue();if(!e)return i;for(const n in e)Object.assign(i,super.getValue(n,e[n]));return i}getBufferLayout(e){this.state.layoutChanged=!1;const i=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:r}=this.settings;if(r==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=r??"vertex",!i)return n;for(const a in i){const u=super._getBufferLayout(a,i[a]);n.attributes.push(...u.attributes)}return n}_autoUpdater(e,{data:i,startRow:n,endRow:r,props:a,numInstances:u}){if(e.constant)return;const{settings:l,state:_,value:w,size:E,startIndices:I}=e,{accessor:R,transform:L}=l,W=_.binaryAccessor||(typeof R=="function"?R:a[R]);Tn(typeof W=="function",`accessor "${R}" is not a function`);let K=e.getVertexOffset(n);const{iterable:fe,objectInfo:X}=Sw(i,n,r);for(const $ of fe){X.index++;let Q=W($,X);if(L&&(Q=L.call(this,Q)),I){const me=(X.index<I.length-1?I[X.index+1]:u)-I[X.index];if(Q&&Array.isArray(Q[0])){let Ce=K;for(const Be of Q)e._normalizeValue(Be,w,Ce),Ce+=E}else Q&&Q.length>E?w.set(Q,K):(e._normalizeValue(Q,X.target,0),T8({target:w,source:X.target,start:K,count:me}));K+=me*E}else e._normalizeValue(Q,w,K),K+=E}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,i=Math.min(4,this.size);if(e&&e.length>=i){let n=!0;switch(i){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Kv(t){const{source:e,target:i,start:n=0,size:r,getData:a}=t,u=t.end||i.length,l=e.length,_=u-n;if(l>_){i.set(e.subarray(0,_),n);return}if(i.set(e,n),!a)return;let w=l;for(;w<_;){const E=a(w,e);for(let I=0;I<r;I++)i[n+w]=E[I]||0,w++}}function Yj({source:t,target:e,size:i,getData:n,sourceStartIndices:r,targetStartIndices:a}){if(!r||!a)return Kv({source:t,target:e,size:i,getData:n}),e;let u=0,l=0;const _=n&&((E,I)=>n(E+l,I)),w=Math.min(r.length,a.length);for(let E=1;E<w;E++){const I=r[E]*i,R=a[E]*i;Kv({source:t.subarray(u,I),target:e,start:l,end:R,size:i,getData:_}),u=I,l=R}return l<e.length&&Kv({source:[],target:e,start:l,size:i,getData:_}),e}function Jj(t){const{device:e,settings:i,value:n}=t,r=new mM(e,i);return r.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),r}function gM(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function _M(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function yM(t){t.push(t.shift())}function Qj(t,e){const{doublePrecision:i,settings:n,value:r,size:a}=t,u=i&&r instanceof Float64Array?2:1;let l=0;const{shaderAttributes:_}=t.settings;if(_)for(const w of Object.values(_))l=Math.max(l,w.vertexOffset??0);return(n.noAlloc?r.length:(e+l)*a)*u}function vM({device:t,source:e,target:i}){return(!i||i.byteLength<e.byteLength)&&(i==null||i.destroy(),i=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),i}function xM({device:t,buffer:e,attribute:i,fromLength:n,toLength:r,fromStartIndices:a,getData:u=l=>l}){const l=i.doublePrecision&&i.value instanceof Float64Array?2:1,_=i.size*l,w=i.byteOffset,E=i.settings.bytesPerElement<4?w/i.settings.bytesPerElement*4:w,I=i.startIndices,R=a&&I,L=i.isConstant;if(!R&&e&&n>=r)return e;const W=i.value instanceof Float64Array?Float32Array:i.value.constructor,K=L?i.value:new W(i.getBuffer().readSyncWebGL(w,r*W.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!L){const Q=u;u=(me,Ce)=>i.normalizeConstant(Q(me,Ce))}const fe=L?(Q,me)=>u(K,me):(Q,me)=>u(K.subarray(Q+w,Q+w+_),me),X=e?new Float32Array(e.readSyncWebGL(E,n*4).buffer):new Float32Array(0),$=new Float32Array(r);return Yj({source:X,target:$,sourceStartIndices:a,targetStartIndices:I,size:_,getData:fe}),(!e||e.byteLength<$.byteLength+E)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:$.byteLength+E,usage:35050})),e.write($,E),e}class bM{constructor({device:e,attribute:i,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Ny(n),this.attribute=i,this.attributeInTransition=Jj(i),this.currentStartIndices=i.startIndices}get inProgress(){return this.transition.inProgress}start(e,i,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Qj(this.attribute,i),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class eH extends bM{constructor({device:e,attribute:i,timeline:n}){super({device:e,attribute:i,timeline:n}),this.type="interpolation",this.transform=nH(e,i)}start(e,i){const n=this.currentLength,r=this.currentStartIndices;if(super.start(e,i,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:a,attribute:u}=this;yM(a),a[0]=xM({device:this.device,buffer:a[0],attribute:u,fromLength:n,toLength:this.currentLength,fromStartIndices:r,getData:e.enter}),a[1]=vM({device:this.device,source:a[0],target:a[1]}),this.setBuffer(a[1]);const{transform:l}=this,_=l.model;let w=Math.floor(this.currentLength/u.size);wM(u)&&(w/=2),_.setVertexCount(w),u.isConstant?(_.setAttributes({aFrom:a[0]}),_.setConstantAttributes({aTo:u.value})):_.setAttributes({aFrom:a[0],aTo:u.getBuffer()}),l.transformFeedback.setBuffers({vCurrent:a[1]})}onUpdate(){const{duration:e,easing:i}=this.settings,{time:n}=this.transition;let r=n/e;i&&(r=i(r));const{model:a}=this.transform;a.setUniforms({time:r}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const tH=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,iH=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function wM(t){return t.doublePrecision&&t.value instanceof Float64Array}function nH(t,e){const i=e.size,n=gM(i),r=_M(i),a=e.getBufferLayout();return wM(e)?new yp(t,{vs:iH,bufferLayout:[{name:"aFrom",byteStride:8*i,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*i}]},{name:"aTo",byteStride:8*i,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*i}]}],modules:[gz],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:i},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new yp(t,{vs:tH,bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:a.attributes[0].format}],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class rH extends bM{constructor({device:e,attribute:i,timeline:n}){super({device:e,attribute:i,timeline:n}),this.type="spring",this.texture=lH(e),this.framebuffer=cH(e,this.texture),this.transform=aH(e,i)}start(e,i){const n=this.currentLength,r=this.currentStartIndices;super.start(e,i);const{buffers:a,attribute:u}=this;for(let _=0;_<2;_++)a[_]=xM({device:this.device,buffer:a[_],attribute:u,fromLength:n,toLength:this.currentLength,fromStartIndices:r,getData:e.enter});a[2]=vM({device:this.device,source:a[0],target:a[2]}),this.setBuffer(a[1]);const{model:l}=this.transform;l.setVertexCount(Math.floor(this.currentLength/u.size)),u.isConstant?l.setConstantAttributes({aTo:u.value}):l.setAttributes({aTo:u.getBuffer()})}onUpdate(){const{buffers:e,transform:i,framebuffer:n,transition:r}=this,a=this.settings;i.model.setAttributes({aPrev:e[0],aCur:e[1]}),i.transformFeedback.setBuffers({vNext:e[2]}),i.model.setUniforms({stiffness:a.stiffness,damping:a.damping}),i.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),yM(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const sH=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,oH=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function aH(t,e){const i=gM(e.size),n=_M(e.size);return new yp(t,{vs:sH,fs:oH,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function lH(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function cH(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const uH={interpolation:eH,spring:rH};class hH{constructor(e,{id:i,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=i,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:i,numInstances:n}){this.numInstances=n||1;for(const r in e){const a=e[r],u=a.getTransitionSetting(i);u&&this._updateAttribute(r,a,u)}for(const r in this.transitions){const a=e[r];(!a||!a.getTransitionSetting(i))&&this._removeTransition(r)}}hasAttribute(e){const i=this.transitions[e];return i&&i.inProgress}getAttributes(){const e={};for(const i in this.transitions){const n=this.transitions[i];n.inProgress&&(e[i]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const i in this.transitions)this.transitions[i].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,i,n){const r=this.transitions[e];let a=!r||r.type!==n.type;if(a){r&&this._removeTransition(e);const u=uH[n.type];u?this.transitions[e]=new u({attribute:i,timeline:this.timeline,device:this.device}):(ai.error(`unsupported transition type '${n.type}'`)(),a=!1)}(a||i.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const xC="attributeManager.invalidate",dH="attributeManager.updateStart",fH="attributeManager.updateEnd",pH="attribute.updateStart",mH="attribute.allocate",gH="attribute.updateEnd";class _H{constructor(e,{id:i="attribute-manager",stats:n,timeline:r}={}){this.mergeBoundsMemoized=Xp(t8),this.id=i,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new hH(e,{id:`${i}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const i=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,i&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const i of e)this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}invalidate(e,i){const n=this._invalidateTrigger(e,i);Tr(xC,this,e,n)}invalidateAll(e){for(const i in this.attributes)this.attributes[i].setNeedsUpdate(i,e);Tr(xC,this,"all")}update({data:e,numInstances:i,startIndices:n=null,transitions:r,props:a={},buffers:u={},context:l={}}){let _=!1;Tr(dH,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const w in this.attributes){const E=this.attributes[w],I=E.settings.accessor;E.startIndices=n,E.numInstances=i,a[w]&&ai.removed(`props.${w}`,`data.attributes.${w}`)(),E.setExternalBuffer(u[w])||E.setBinaryValue(typeof I=="string"?u[I]:void 0,e.startIndices)||typeof I=="string"&&!u[I]&&E.setConstantValue(a[I])||E.needsUpdate()&&(_=!0,this._updateAttribute({attribute:E,numInstances:i,data:e,props:a,context:l})),this.needsRedraw=this.needsRedraw||E.needsRedraw()}_&&Tr(fH,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,i=e.run();return this.needsRedraw=this.needsRedraw||i,i}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const i=e.map(n=>{var r;return(r=this.attributes[n])==null?void 0:r.getBounds()});return this.mergeBoundsMemoized(i)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:i,attributeTransitionManager:n}=this,r={...n.getAttributes()};for(const a in i){const u=i[a];u.needsRedraw(e)&&!n.hasAttribute(a)&&(r[a]=u)}return r}getBufferLayouts(e){return Object.values(this.getAttributes()).map(i=>i.getBufferLayout(e))}_add(e,i){for(const n in e){const r=e[n],a={...r,id:n,size:r.isIndexed&&1||r.size||1,...i};this.attributes[n]=new mM(this.device,a)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const i in this.attributes)this.attributes[i].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(i)});this.updateTriggers=e}_invalidateTrigger(e,i){const{attributes:n,updateTriggers:r}=this,a=r[e];return a&&a.forEach(u=>{const l=n[u];l&&l.setNeedsUpdate(l.id,i)}),a}_updateAttribute(e){const{attribute:i,numInstances:n}=e;if(Tr(pH,i),i.constant){i.setConstantValue(i.value);return}i.allocate(n)&&Tr(mH,i,n),i.updateBuffer(e)&&(this.needsRedraw=!0,Tr(gH,i,n))}}class yH extends Ny{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:i,toValue:n,duration:r,easing:a}}=this,u=a(e/r);this._value=B_(i,n,u)}}const bC=1e-5;function wC(t,e,i,n,r){const a=e-t,l=(i-e)*r,_=-a*n;return l+_+a+e}function vH(t,e,i,n,r){if(Array.isArray(i)){const a=[];for(let u=0;u<i.length;u++)a[u]=wC(t[u],e[u],i[u],n,r);return a}return wC(t,e,i,n,r)}function AC(t,e){if(Array.isArray(t)){let i=0;for(let n=0;n<t.length;n++){const r=t[n]-e[n];i+=r*r}return Math.sqrt(i)}return Math.abs(t-e)}class xH extends Ny{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:i,damping:n,stiffness:r}=this.settings,{_prevValue:a=e,_currValue:u=e}=this;let l=vH(a,u,i,n,r);const _=AC(l,i),w=AC(l,u);_<bC&&w<bC&&(l=i,this.end()),this._prevValue=u,this._currValue=l}}const bH={interpolation:yH,spring:xH};class wH{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,i,n,r){const{transitions:a}=this;if(a.has(e)){const _=a.get(e),{value:w=_.settings.fromValue}=_;i=w,this.remove(e)}if(r=pM(r),!r)return;const u=bH[r.type];if(!u){ai.error(`unsupported transition type '${r.type}'`)();return}const l=new u(this.timeline);l.start({...r,fromValue:i,toValue:n}),a.set(e,l)}remove(e){const{transitions:i}=this;i.has(e)&&(i.get(e).cancel(),i.delete(e))}update(){const e={};for(const[i,n]of this.transitions)n.update(),e[i]=n.value,n.inProgress||this.remove(i);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function AH(t){const e=t[Fl];for(const i in e){const n=e[i],{validate:r}=n;if(r&&!r(t[i],n))throw new Error(`Invalid prop ${i}: ${t[i]}`)}}function TH(t,e){const i=AM({newProps:t,oldProps:e,propTypes:t[Fl],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=SH(t,e);let r=!1;return n||(r=CH(t,e)),{dataChanged:n,propsChanged:i,updateTriggersChanged:r,extensionsChanged:IH(t,e),transitionsChanged:EH(t,e)}}function EH(t,e){if(!t.transitions)return!1;const i={},n=t[Fl];let r=!1;for(const a in t.transitions){const u=n[a],l=u&&u.type;(l==="number"||l==="color"||l==="array")&&Bx(t[a],e[a],u)&&(i[a]=!0,r=!0)}return r?i:!1}function AM({newProps:t,oldProps:e,ignoreProps:i={},propTypes:n={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${r} changed shallowly`;if(typeof e!="object"||e===null)return`${r} changed shallowly`;for(const a of Object.keys(t))if(!(a in i)){if(!(a in e))return`${r}.${a} added`;const u=Bx(t[a],e[a],n[a]);if(u)return`${r}.${a} ${u}`}for(const a of Object.keys(e))if(!(a in i)){if(!(a in t))return`${r}.${a} dropped`;if(!Object.hasOwnProperty.call(t,a)){const u=Bx(t[a],e[a],n[a]);if(u)return`${r}.${a} ${u}`}}return!1}function Bx(t,e,i){let n=i&&i.equal;return n&&!n(t,e,i)||!n&&(n=t&&e&&t.equals,n&&!n.call(t,e))?"changed deeply":!n&&e!==t?"changed shallowly":null}function SH(t,e){if(e===null)return"oldProps is null, initial diff";let i=!1;const{dataComparator:n,_dataDiff:r}=t;return n?n(t.data,e.data)||(i="Data comparator detected a change"):t.data!==e.data&&(i="A new data container was supplied"),i&&r&&(i=r(t.data,e.data)||i),i}function CH(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&TC(t,e,"all"))return{all:!0};const i={};let n=!1;for(const r in t.updateTriggers)r!=="all"&&TC(t,e,r)&&(i[r]=!0,n=!0);return n?i:!1}function IH(t,e){if(e===null)return!0;const i=e.extensions,{extensions:n}=t;if(n===i)return!1;if(!i||!n||n.length!==i.length)return!0;for(let r=0;r<n.length;r++)if(!n[r].equals(i[r]))return!0;return!1}function TC(t,e,i){let n=t.updateTriggers[i];n=n??{};let r=e.updateTriggers[i];return r=r??{},AM({oldProps:r,newProps:n,triggerName:i})}const RH="count(): argument not an object",PH="count(): argument not a container";function MH(t){if(!DH(t))throw new Error(RH);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(BH(t))return Object.keys(t).length;throw new Error(PH)}function BH(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function DH(t){return t!==null&&typeof t=="object"}function EC(t,e){if(!e)return t;const i={...t,...e};if("defines"in e&&(i.defines={...t.defines,...e.defines}),"modules"in e&&(i.modules=(t.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=i.modules.findIndex(r=>r.name==="project32");n>=0&&i.modules.splice(n,1)}if("inject"in e)if(!t.inject)i.inject=e.inject;else{const n={...t.inject};for(const r in e.inject)n[r]=(n[r]||"")+e.inject[r];i.inject=n}return i}const OH={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Dx={};function kH(t,e,i,n){if(i instanceof Es)return i;i.constructor&&i.constructor.name!=="Object"&&(i={data:i});let r=null;i.compressed&&(r={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});const a=e.createTexture({...i,sampler:{...OH,...r,...n}});return Dx[a.id]=t,a}function FH(t,e){!e||!(e instanceof Es)||Dx[e.id]===t&&(e.delete(),delete Dx[e.id])}const NH={boolean:{validate(t,e){return!0},equal(t,e,i){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Ox(t)&&(t.length===3||t.length===4)},equal(t,e,i){return yo(t,e,1)}},accessor:{validate(t,e){const i=U_(t);return i==="function"||i===U_(e.value)},equal(t,e,i){return typeof e=="function"?!0:yo(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Ox(t)},equal(t,e,i){const{compare:n}=i,r=Number.isInteger(n)?n:n?1:0;return n?yo(t,e,r):t===e}},object:{equal(t,e,i){if(i.ignore)return!0;const{compare:n}=i,r=Number.isInteger(n)?n:n?1:0;return n?yo(t,e,r):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,i){return!i.compare&&i.ignore!==!1||t===e}},data:{transform:(t,e,i)=>{if(!t)return t;const{dataTransform:n}=i.props;return n?n(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,i)=>{const n=i.context;return!n||!n.device?null:kH(i.id,n.device,t,{...e.parameters,...i.props.textureParameters})},release:(t,e,i)=>{FH(i.id,t)}}};function LH(t){const e={},i={},n={};for(const[r,a]of Object.entries(t)){const u=a==null?void 0:a.deprecatedFor;if(u)n[r]=Array.isArray(u)?u:[u];else{const l=UH(r,a);e[r]=l,i[r]=l.value}}return{propTypes:e,defaultProps:i,deprecatedProps:n}}function UH(t,e){switch(U_(e)){case"object":return Sf(t,e);case"array":return Sf(t,{type:"array",value:e,compare:!1});case"boolean":return Sf(t,{type:"boolean",value:e});case"number":return Sf(t,{type:"number",value:e});case"function":return Sf(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Sf(t,e){return"type"in e?{name:t,...NH[e.type],...e}:"value"in e?{name:t,type:U_(e.value),...e}:{name:t,type:"object",value:e}}function Ox(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function U_(t){return Ox(t)?"array":t===null?"null":typeof t}function zH(t,e){let i;for(let a=e.length-1;a>=0;a--){const u=e[a];"extensions"in u&&(i=u.extensions)}const n=kx(t.constructor,i),r=Object.create(n);r[N_]=t,r[Yc]={},r[Ml]={};for(let a=0;a<e.length;++a){const u=e[a];for(const l in u)r[l]=u[l]}return Object.freeze(r),r}const VH="_mergedDefaultProps";function kx(t,e){let i=VH;if(e)for(const r of e){const a=r.constructor;a&&(i+=`:${a.extensionName||a.name}`)}const n=TM(t,i);return n||(t[i]=jH(t,e||[]))}function jH(t,e){if(!t.prototype)return null;const n=Object.getPrototypeOf(t),r=kx(n),a=TM(t,"defaultProps")||{},u=LH(a),l=Object.assign(Object.create(null),r,u.defaultProps),_=Object.assign(Object.create(null),r==null?void 0:r[Fl],u.propTypes),w=Object.assign(Object.create(null),r==null?void 0:r[Lv],u.deprecatedProps);for(const E of e){const I=kx(E.constructor);I&&(Object.assign(l,I),Object.assign(_,I[Fl]),Object.assign(w,I[Lv]))}return HH(l,t),GH(l,_),$H(l,w),l[Fl]=_,l[Lv]=w,e.length===0&&!Cw(t,"_propTypes")&&(t._propTypes=_),l}function HH(t,e){const i=XH(e);Object.defineProperties(t,{id:{writable:!0,value:i}})}function $H(t,e){for(const i in e)Object.defineProperty(t,i,{enumerable:!1,set(n){const r=`${this.id}: ${i}`;for(const a of e[i])Cw(this,a)||(this[a]=n);ai.deprecated(r,e[i].join("/"))()}})}function GH(t,e){const i={},n={};for(const r in e){const a=e[r],{name:u,value:l}=a;a.async&&(i[u]=l,n[u]=WH(u))}t[zh]=i,t[Yc]={},Object.defineProperties(t,n)}function WH(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||dM(e)?this[Yc][t]=e:this[Ml][t]=e},get(){if(this[Ml]){if(t in this[Ml])return this[Ml][t]||this[zh][t];if(t in this[Yc]){const e=this[N_]&&this[N_].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[zh][t]}}return this[zh][t]}}}function Cw(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function TM(t,e){return Cw(t,e)&&t[e]}function XH(t){const e=t.componentName;return e||ai.warn(`${t.name}.componentName not specified`)(),e||t.name}let qH=0;class Iw{constructor(...e){this.props=zH(this,e),this.id=this.props.id,this.count=qH++}clone(e){const{props:i}=this,n={};for(const r in i[zh])r in i[Ml]?n[r]=i[Ml][r]:r in i[Yc]&&(n[r]=i[Yc][r]);return new this.constructor({...i,...n,...e})}}Iw.componentName="Component";Iw.defaultProps={};const KH=Object.freeze({});class ZH{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const i=this.asyncProps[e];i&&i.type&&i.type.release&&i.type.release(i.resolvedValue,i.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||KH}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const i=this.asyncProps[e];return i&&i.resolvedValue}isAsyncPropLoading(e){if(e){const i=this.asyncProps[e];return!!(i&&i.pendingLoadCount>0&&i.pendingLoadCount!==i.resolvedLoadCount)}for(const i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}reloadAsyncProp(e,i){this._watchPromise(e,Promise.resolve(i))}setAsyncProps(e){this.component=e[N_]||this.component;const i=e[Ml]||{},n=e[Yc]||e,r=e[zh]||{};for(const a in i){const u=i[a];this._createAsyncPropData(a,r[a]),this._updateAsyncProp(a,u),i[a]=this.getAsyncProp(a)}for(const a in n){const u=n[a];this._createAsyncPropData(a,r[a]),this._updateAsyncProp(a,u)}}_fetch(e,i){return null}_onResolve(e,i){}_onError(e,i){}_updateAsyncProp(e,i){if(this._didAsyncInputValueChange(e,i)){if(typeof i=="string"&&(i=this._fetch(e,i)),i instanceof Promise){this._watchPromise(e,i);return}if(dM(i)){this._resolveAsyncIterable(e,i);return}this._setPropValue(e,i)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,i){const n=this.asyncProps[e];return i===n.resolvedValue||i===n.lastValue?!1:(n.lastValue=i,!0)}_setPropValue(e,i){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(i=this._postProcessValue(n,i),n.resolvedValue=i,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,i,n){const r=this.asyncProps[e];r&&n>=r.resolvedLoadCount&&i!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=i,r.resolvedLoadCount=n,this.onAsyncPropUpdated(e,i))}_watchPromise(e,i){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const r=n.pendingLoadCount;i.then(a=>{this.component&&(a=this._postProcessValue(n,a),this._setAsyncPropValue(e,a,r),this._onResolve(e,a))}).catch(a=>{this._onError(e,a)})}}async _resolveAsyncIterable(e,i){if(e!=="data"){this._setPropValue(e,i);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const r=n.pendingLoadCount;let a=[],u=0;for await(const l of i){if(!this.component)return;const{dataTransform:_}=this.component.props;_?a=_(l,a):a=a.concat(l),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:u,endRow:a.length}]}),u=a.length,this._setAsyncPropValue(e,a,r)}this._onResolve(e,a)}_postProcessValue(e,i){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(i,n,this.component):i}_createAsyncPropData(e,i){if(!this.asyncProps[e]){const r=this.component&&this.component.props[Fl];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0}}}}class YH extends ZH{constructor({attributeManager:e,layer:i}){super(i),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,i){const n=this.layer,r=n==null?void 0:n.props.fetch;return r?r(i,{propName:e,layer:n}):super._fetch(e,i)}_onResolve(e,i){const n=this.layer;if(n){const r=n.props.onDataLoad;e==="data"&&r&&r(i,{propName:e,layer:n})}}_onError(e,i){const n=this.layer;n&&n.raiseError(i,`loading ${e} of ${this.layer}`)}}const JH="layer.changeFlag",QH="layer.initialize",e$="layer.update",t$="layer.finalize",i$="layer.matched",SC=2**24-1,n$=Object.freeze([]),r$=Xp(({oldViewport:t,viewport:e})=>t.equals(e));let $o=new Uint8ClampedArray(0);const s$={data:{type:"data",value:n$,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:i,loaders:n,loadOptions:r,signal:a})=>{const{resourceManager:u}=i.context;r=r||i.getLoadOptions(),n=n||i.props.loaders,a&&(r={...r,fetch:{...r==null?void 0:r.fetch,signal:a}});let l=u.contains(t);return!l&&!r&&(u.add({resourceId:t,data:Wl(t,n),persistent:!1}),l=!0),l?u.subscribe({resourceId:t,onChange:_=>{var w;return(w=i.internalState)==null?void 0:w.reloadAsyncProp(e,_)},consumerId:i.id,requestId:e}):Wl(t,n,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:ii.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Ql extends Iw{constructor(){super(...arguments),this.internalState=null,this.lifecycle=dh.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Tn(this.internalState);const i=this.internalState.viewport||this.context.viewport,n=jP(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,a,u]=UP(n,i.pixelProjectionMatrix);return e.length===2?[r,a]:[r,a,u]}unproject(e){return Tn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,i){Tn(this.internalState);const n=this.internalState.viewport||this.context.viewport;return a8(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...i})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const i of this.getModels())i.updateModuleSettings(e)}setShaderModuleProps(...e){for(const i of this.getModels())i.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===ii.DEFAULT||e===ii.LNGLAT||e===ii.CARTESIAN}onHover(e,i){return this.props.onHover&&this.props.onHover(e,i)||!1}onClick(e,i){return this.props.onClick&&this.props.onClick(e,i)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,i=[]){return i[0]=e+1&255,i[1]=e+1>>8&255,i[2]=e+1>>8>>8&255,i}decodePickingColor(e){Tn(e instanceof Uint8Array);const[i,n,r]=e;return i+n*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:MH(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=EC(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const i of this.props.extensions)e=EC(e,i.getShaders.call(this,i));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const i=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&i)if(Array.isArray(n))for(const r of n)i.invalidateAll(r);else i.invalidateAll();if(i){const{props:r}=e,a=this.internalState.hasPickingBuffer,u=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(a!==u){this.internalState.hasPickingBuffer=u;const{pickingColors:l,instancePickingColors:_}=i.attributes,w=l||_;w&&(u&&w.constant&&(w.constant=!1,i.invalidate(w.id)),!w.value&&!u&&(w.constant=!0,w.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const i=this.getAttributeManager();i&&i.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const i of this.getModels())i.draw(e)}getPickingInfo({info:e,mode:i,sourceLayer:n}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,i){var n,r,a,u;i&&(e=new Error(`${i}: ${e.message}`,{cause:e})),(r=(n=this.props).onError)!=null&&r.call(n,e)||(u=(a=this.context)==null?void 0:a.onError)==null||u.call(a,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const i=this.internalState.viewport;this.internalState.viewport=e,(!i||!r$({oldViewport:i,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const i=this.getAttributeManager();i&&(e==="all"?i.invalidateAll():i.invalidate(e))}updateAttributes(e){let i=!1;for(const n in e)e[n].layoutChanged()&&(i=!0);for(const n of this.getModels())this._setModelAttributes(n,e,i)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const i=this.props,n=this.getNumInstances(),r=this.getStartIndices();e.update({data:i.data,numInstances:n,startIndices:r,props:i,transitions:i.transitions,buffers:i.data.attributes,context:this});const a=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(a)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const i=e.update(),n=Object.create(this.props);for(const r in i)Object.defineProperty(n,r,{value:i[r]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:i}){if(e.constant)return;const n=Math.floor($o.length/4);if(this.internalState.usesPickingColorCache=!0,n<i){i>SC&&ai.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),$o=Qh.allocate($o,i,{size:4,copy:!0,maxCount:Math.max(i,SC)});const r=Math.floor($o.length/4),a=[];for(let u=n;u<r;u++)this.encodePickingColor(u,a),$o[u*4+0]=a[0],$o[u*4+1]=a[1],$o[u*4+2]=a[2]}e.value=$o.subarray(0,i*4)}_setModelAttributes(e,i,n=!1){var l;if(!Object.keys(i).length)return;if(n){const _=this.getAttributeManager();e.setBufferLayout(_.getBufferLayouts(e)),i=_.getAttributes()}const r=((l=e.userData)==null?void 0:l.excludeAttributes)||{},a={},u={};for(const _ in i){if(r[_])continue;const w=i[_].getValue();for(const E in w){const I=w[E];I instanceof Zi?i[_].settings.isIndexed?e.setIndexBuffer(I):a[E]=I:I&&(u[E]=I)}}e.setAttributes(a),e.setConstantAttributes(u)}disablePickingIndex(e){const i=this.props.data;if(!("attributes"in i)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,a=n||r,u=a&&i.attributes&&i.attributes[a.id];if(u&&u.value){const l=u.value,_=this.encodePickingColor(e);for(let w=0;w<i.length;w++){const E=a.getVertexOffset(w);l[E]===_[0]&&l[E+1]===_[1]&&l[E+2]===_[2]&&this._disablePickingIndex(w)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,r=i||n;if(!r)return;const a=r.getVertexOffset(e),u=r.getVertexOffset(e+1);r.buffer.write(new Uint8Array(u-a),a)}restorePickingColors(){const{pickingColors:e,instancePickingColors:i}=this.getAttributeManager().attributes,n=e||i;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==$o.buffer&&(n.value=$o.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Tn(!this.internalState),Tn(Number.isFinite(this.props.coordinateSystem)),Tr(QH,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new YH({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ai.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new wH(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const i of this.props.extensions)i.initializeState.call(this,this.context,i);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Tr(i$,this,this===e);const{state:i,internalState:n}=e;this!==e&&(this.internalState=n,this.state=i,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Tr(e$,this,e),!e)return;const i=this.props,n=this.context,r=this.internalState,a=n.viewport,u=this._updateUniformTransition();r.propsInTransition=u,n.viewport=r.viewport||a,this.props=u;try{const l=this._getUpdateParams(),_=this.getModels();if(n.device)this.updateState(l);else try{this.updateState(l)}catch{}for(const E of this.props.extensions)E.updateState.call(this,l,E);const w=this.getModels()[0]!==_[0];this._postUpdate(l,w)}finally{n.viewport=a,this.props=i,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){Tr(t$,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:i=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const a=this.props,u=this.context;this.props=this.internalState.propsInTransition||a;const l=this.props.opacity;n.opacity=Math.pow(l,1/2.2);try{if(i){const{isActive:E,isAttribute:I}=i.picking;this.setModuleParameters(i),this.setShaderModuleProps({picking:{isActive:E,isAttribute:I}})}const{getPolygonOffset:_}=this.props,w=_&&_(n)||[0,0];u.device.setParametersWebGL({polygonOffset:w});for(const E of this.getModels())E.setParameters(r);u.device.withParametersWebGL(r,()=>{const E={renderPass:e,moduleParameters:i,uniforms:n,parameters:r,context:u};for(const I of this.props.extensions)I.draw.call(this,E,I);this.draw(E)})}finally{this.props=a}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:i}=this.internalState;for(const r in e)if(e[r]){let a=!1;switch(r){case"dataChanged":const u=e[r],l=i[r];u&&Array.isArray(l)&&(i.dataChanged=Array.isArray(u)?l.concat(u):u,a=!0);default:i[r]||(i[r]=e[r],a=!0)}a&&Tr(JH,this,r,e)}const n=!!(i.dataChanged||i.updateTriggersChanged||i.propsChanged||i.extensionsChanged);i.propsOrDataChanged=n,i.somethingChanged=n||i.viewportChanged||i.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,i){var r;const n=TH(e,i);if(n.updateTriggersChanged)for(const a in n.updateTriggersChanged)n.updateTriggersChanged[a]&&this.invalidateAttribute(a);if(n.transitionsChanged)for(const a in n.transitionsChanged)this.internalState.uniformTransitions.add(a,i[a],e[a],(r=e.transitions)==null?void 0:r[a]);return this.setChangeFlags(n)}validateProps(){AH(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const i={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(i.highlightColor=n(e)),this.setShaderModuleProps({picking:i}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new _H(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,i){const{props:n,oldProps:r}=e;this.setNeedsRedraw(),this._updateAttributes();const a=this.state.model;a!=null&&a.isInstanced&&a.setInstanceCount(this.getNumInstances());const{autoHighlight:u,highlightedObjectIndex:l,highlightColor:_}=n;if(i||r.autoHighlight!==u||r.highlightedObjectIndex!==l||r.highlightColor!==_){const w={};Array.isArray(_)&&(w.highlightColor=_),(i||r.autoHighlight!==u||l!==r.highlightedObjectIndex)&&(w.highlightedObjectColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setShaderModuleProps({picking:w})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let i=!1;i=i||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),r=n?n.getNeedsRedraw(e):!1;if(i=i||r,i)for(const a of this.props.extensions)a.onNeedsRedraw.call(this,a);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,i}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Ql.defaultProps=s$;Ql.layerName="Layer";const o$="compositeLayer.renderLayers";class EM extends Ql{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:i}=e;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(e.object=i.__source.object,e.index=i.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,i){return i&&i.length}getSubLayerClass(e,i){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||i}getSubLayerRow(e,i,n){return e.__source={parent:this,object:i,index:n},e}getSubLayerAccessor(e){if(typeof e=="function"){const i={index:-1,data:this.props.data,target:[]};return(n,r)=>n&&n.__source?(i.index=n.__source.index,e(n.__source.object,i)):e(n,r)}return e}getSubLayerProps(e={}){var Fe;const{opacity:i,pickable:n,visible:r,parameters:a,getPolygonOffset:u,highlightedObjectIndex:l,autoHighlight:_,highlightColor:w,coordinateSystem:E,coordinateOrigin:I,wrapLongitude:R,positionFormat:L,modelMatrix:W,extensions:K,fetch:fe,operation:X,_subLayerProps:$}=this.props,Q={id:"",updateTriggers:{},opacity:i,pickable:n,visible:r,parameters:a,getPolygonOffset:u,highlightedObjectIndex:l,autoHighlight:_,highlightColor:w,coordinateSystem:E,coordinateOrigin:I,wrapLongitude:R,positionFormat:L,modelMatrix:W,extensions:K,fetch:fe,operation:X},me=$&&e.id&&$[e.id],Ce=me&&me.updateTriggers,Be=e.id||"sublayer";if(me){const ze=this.props[Fl],Ve=e.type?e.type._propTypes:{};for(const je in me){const Ke=Ve[je]||ze[je];Ke&&Ke.type==="accessor"&&(me[je]=this.getSubLayerAccessor(me[je]))}}Object.assign(Q,e,me),Q.id=`${this.props.id}-${Be}`,Q.updateTriggers={all:(Fe=this.props.updateTriggers)==null?void 0:Fe.all,...e.updateTriggers,...Ce};for(const ze of K){const Ve=ze.getSubLayerProps.call(this,ze);Ve&&Object.assign(Q,Ve,{updateTriggers:Object.assign(Q.updateTriggers,Ve.updateTriggers)})}return Q}_updateAutoHighlight(e){for(const i of this.getSubLayers())i.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,i){let n=this.internalState.subLayers;const r=!n||this.needsUpdate();if(r){const a=this.renderLayers();n=ed(a,Boolean),this.internalState.subLayers=n}Tr(o$,this,r,n);for(const a of n)a.parent=this}}EM.layerName="CompositeLayer";class a${constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:i={}}=e;this.typedArrayManager=Qh,this.attributes={},this._attributeDefs=i,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:i,buffers:n={},getGeometry:r,geometryBuffer:a,positionFormat:u,dataChanged:l,normalize:_=!0}=this.opts;if(this.data=i,this.getGeometry=r,this.positionSize=a&&a.size||(u==="XY"?2:3),this.buffers=n,this.normalize=_,a&&(Tn(i.startIndices),this.getGeometry=this.getGeometryFromBuffer(a),_||(n.vertexPositions=a)),this.geometryBuffer=n.vertexPositions,Array.isArray(l))for(const w of l)this._rebuildGeometry(w);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:i}){this._rebuildGeometry({startRow:e,endRow:i})}getGeometryFromBuffer(e){const i=e.value||e;return ArrayBuffer.isView(i)?fM(i,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,i){const{attributes:n,buffers:r,_attributeDefs:a,typedArrayManager:u}=this;for(const l in a)if(l in r)u.release(n[l]),n[l]=null;else{const _=a[l];_.copy=i,n[l]=u.allocate(n[l],e,_)}}_forEachGeometry(e,i,n){const{data:r,getGeometry:a}=this,{iterable:u,objectInfo:l}=Sw(r,i,n);for(const _ of u){l.index++;const w=a?a(_,l):null;e(w,l.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:i,vertexStarts:n,instanceCount:r}=this;const{data:a,geometryBuffer:u}=this,{startRow:l=0,endRow:_=1/0}=e||{},w={};if(e||(i=[0],n=[0]),this.normalize||!u)this._forEachGeometry((I,R)=>{const L=I&&this.normalizeGeometry(I);w[R]=L,n[R+1]=n[R]+(L?this.getGeometrySize(L):0)},l,_),r=n[n.length-1];else if(n=a.startIndices,r=n[a.length]||0,ArrayBuffer.isView(u))r=r||u.length/this.positionSize;else if(u instanceof Zi){const I=this.positionSize*4;r=r||u.byteLength/I}else if(u.buffer){const I=u.stride||this.positionSize*4;r=r||u.buffer.byteLength/I}else if(u.value){const I=u.value,R=u.stride/I.BYTES_PER_ELEMENT||this.positionSize;r=r||I.length/R}this._allocate(r,!!e),this.indexStarts=i,this.vertexStarts=n,this.instanceCount=r;const E={};this._forEachGeometry((I,R)=>{const L=w[R]||I;E.vertexStart=n[R],E.indexStart=i[R];const W=R<n.length-1?n[R+1]:r;E.geometrySize=W-n[R],E.geometryIndex=R,this.updateGeometryAttributes(L,E)},l,_),this.vertexCount=i[i.length-1]}}const l$=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,c$=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,SM=[0,0,0,255],CM=[0,0,1],u$={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:CM},getColor:{type:"accessor",value:SM},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function h$(t){const{header:e,attributes:i}=t;if(!(!e||!i)&&(t.length=e.vertexCount,i.POSITION&&(i.instancePositions=i.POSITION),i.NORMAL&&(i.instanceNormals=i.NORMAL),i.COLOR_0)){const{size:n,value:r}=i.COLOR_0;i.instanceColors={size:n,type:"unorm8",value:r}}}class Rw extends Ql{getShaders(){return super.getShaders({vs:l$,fs:c$,modules:[qp,X6,Kp]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:CM},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:SM}})}updateState(e){var r;const{changeFlags:i,props:n}=e;super.updateState(e),i.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),i.dataChanged&&h$(n.data)}draw({uniforms:e}){const{pointSize:i,sizeUnits:n}=this.props,r=this.state.model;r.setUniforms(e),r.setUniforms({sizeUnits:Zh[n],radiusPixels:i}),r.draw(this.context.renderPass)}_getModel(){const e=[];for(let i=0;i<3;i++){const n=i/3*Math.PI*2;e.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new na(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new kl({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}Rw.layerName="PointCloudLayer";Rw.defaultProps=u$;const d$=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,f$=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,CC=[0,0,0,255],p$={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:CC},getLineColor:{type:"accessor",value:CC},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Pw extends Ql{getShaders(){return super.getShaders({vs:d$,fs:f$,modules:[qp,Kp]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var i;super.updateState(e),e.changeFlags.extensionsChanged&&((i=this.state.model)==null||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:i,radiusScale:n,radiusMinPixels:r,radiusMaxPixels:a,stroked:u,filled:l,billboard:_,antialiasing:w,lineWidthUnits:E,lineWidthScale:I,lineWidthMinPixels:R,lineWidthMaxPixels:L}=this.props,W=this.state.model;W.setUniforms(e),W.setUniforms({stroked:u?1:0,filled:l,billboard:_,antialiasing:w,radiusUnits:Zh[i],radiusScale:n,radiusMinPixels:r,radiusMaxPixels:a,lineWidthUnits:Zh[E],lineWidthScale:I,lineWidthMinPixels:R,lineWidthMaxPixels:L}),W.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new na(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new kl({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Pw.defaultProps=p$;Pw.layerName="ScatterplotLayer";function wg(t,e){const i=e.length,n=t.length;if(n>0){let r=!0;for(let a=0;a<i;a++)if(t[n-i+a]!==e[a]){r=!1;break}if(r)return!1}for(let r=0;r<i;r++)t[n+r]=e[r];return!0}function IC(t,e){const i=e.length;for(let n=0;n<i;n++)t[n]=e[n]}function RC(t,e,i,n,r=[]){const a=n+e*i;for(let u=0;u<i;u++)r[u]=t[a+u];return r}function PC(t,e,i,n,r=[]){let a,u;if(i&8)a=(n[3]-t[1])/(e[1]-t[1]),u=3;else if(i&4)a=(n[1]-t[1])/(e[1]-t[1]),u=1;else if(i&2)a=(n[2]-t[0])/(e[0]-t[0]),u=2;else if(i&1)a=(n[0]-t[0])/(e[0]-t[0]),u=0;else return null;for(let l=0;l<t.length;l++)r[l]=(u&1)===l?n[u]:a*(e[l]-t[l])+t[l];return r}function Zv(t,e){let i=0;return t[0]<e[0]?i|=1:t[0]>e[2]&&(i|=2),t[1]<e[1]?i|=4:t[1]>e[3]&&(i|=8),i}function IM(t,e){const{size:i=2,broken:n=!1,gridResolution:r=10,gridOffset:a=[0,0],startIndex:u=0,endIndex:l=t.length}=e||{},_=(l-u)/i;let w=[];const E=[w],I=RC(t,0,i,u);let R,L;const W=m$(I,r,a,[]),K=[];wg(w,I);for(let fe=1;fe<_;fe++){for(R=RC(t,fe,i,u,R),L=Zv(R,W);L;){PC(I,R,L,W,K);const X=Zv(K,W);X&&(PC(I,K,X,W,K),L=X),wg(w,K),IC(I,K),g$(W,r,L),n&&w.length>i&&(w=[],E.push(w),wg(w,I)),L=Zv(R,W)}wg(w,R),IC(I,R)}return n?E:E[0]}function m$(t,e,i,n){const r=Math.floor((t[0]-i[0])/e)*e+i[0],a=Math.floor((t[1]-i[1])/e)*e+i[1];return n[0]=r,n[1]=a,n[2]=r+e,n[3]=a+e,n}function g$(t,e,i){i&8?(t[1]+=e,t[3]+=e):i&4?(t[1]-=e,t[3]-=e):i&2?(t[0]+=e,t[2]+=e):i&1&&(t[0]-=e,t[2]-=e)}function _$(t,e){const{size:i=2,startIndex:n=0,endIndex:r=t.length,normalize:a=!0}=e||{},u=t.slice(n,r);y$(u,i,0,r-n);const l=IM(u,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(a)for(const _ of l)v$(_,i);return l}function y$(t,e,i,n){let r=t[0],a;for(let u=i;u<n;u+=e){a=t[u];const l=a-r;(l>180||l<-180)&&(a-=Math.round(l/360)*360),t[u]=r=a}}function v$(t,e){let i;const n=t.length/e;for(let a=0;a<n&&(i=t[a*e],(i+180)%360===0);a++);const r=-Math.round(i/360)*360;if(r!==0)for(let a=0;a<n;a++)t[a*e]+=r}function x$(t,e,i,n){let r;if(Array.isArray(t[0])){const a=t.length*e;r=new Array(a);for(let u=0;u<t.length;u++)for(let l=0;l<e;l++)r[u*e+l]=t[u][l]||0}else r=t;return i?IM(r,{size:e,gridResolution:i}):n?_$(r,{size:e}):r}const b$=1,w$=2,Yv=4;class A$ extends a${constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?x$(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(MC(e)){let n=0;for(const r of e)n+=this.getGeometrySize(r);return n}const i=this.getPathLength(e);return i<2?0:this.isClosed(e)?i<3?0:i+2:i}updateGeometryAttributes(e,i){if(i.geometrySize!==0)if(e&&MC(e))for(const n of e){const r=this.getGeometrySize(n);i.geometrySize=r,this.updateGeometryAttributes(n,i),i.vertexStart+=r}else this._updateSegmentTypes(e,i),this._updatePositions(e,i)}_updateSegmentTypes(e,i){const n=this.attributes.segmentTypes,r=e?this.isClosed(e):!1,{vertexStart:a,geometrySize:u}=i;n.fill(0,a,a+u),r?(n[a]=Yv,n[a+u-2]=Yv):(n[a]+=b$,n[a+u-2]+=w$),n[a+u-1]=Yv}_updatePositions(e,i){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:r,geometrySize:a}=i,u=new Array(3);for(let l=r,_=0;_<a;l++,_++)this.getPointOnPath(e,_,u),n[l*3]=u[0],n[l*3+1]=u[1],n[l*3+2]=u[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,i,n=[]){const{positionSize:r}=this;i*r>=e.length&&(i+=1-e.length/r);const a=i*r;return n[0]=e[a],n[1]=e[a+1],n[2]=r===3&&e[a+2]||0,n}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:i}=this,n=e.length-i;return e[0]===e[n]&&e[1]===e[n+1]&&(i===2||e[2]===e[n+2])}}function MC(t){return Array.isArray(t[0])}const T$=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,E$=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,RM=[0,0,0,255],S$={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:RM},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Jv={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class z_ extends Ql{getShaders(){return super.getShaders({vs:T$,fs:E$,modules:[qp,Kp]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Jv,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Jv,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Jv,defaultValue:RM},instancePickingColors:{size:4,type:"uint8",accessor:(n,{index:r,target:a})=>this.encodePickingColor(n&&n.__source?n.__source.index:r,a)}}),this.setState({pathTesselator:new A$({fp64:this.use64bitPositions()})})}updateState(e){var u;super.updateState(e);const{props:i,changeFlags:n}=e,r=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:l}=this.state,_=i.data.attributes||{};l.updateGeometry({data:i.data,geometryBuffer:_.getPath,buffers:_,normalize:!i._pathType,loop:i._pathType==="loop",getGeometry:i.getPath,positionFormat:i.positionFormat,wrapLongitude:i.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:l.instanceCount,startIndices:l.vertexStarts}),n.dataChanged||r.invalidateAll()}n.extensionsChanged&&((u=this.state.model)==null||u.destroy(),this.state.model=this._getModel(),r.invalidateAll())}getPickingInfo(e){const i=super.getPickingInfo(e),{index:n}=i,r=this.props.data;return r[0]&&r[0].__source&&(i.object=r.find(a=>a.__source.index===n)),i}disablePickingIndex(e){const i=this.props.data;if(i[0]&&i[0].__source)for(let n=0;n<i.length;n++)i[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:i,capRounded:n,billboard:r,miterLimit:a,widthUnits:u,widthScale:l,widthMinPixels:_,widthMaxPixels:w}=this.props,E=this.state.model;E.setUniforms(e),E.setUniforms({jointType:Number(i),capType:Number(n),billboard:r,widthUnits:Zh[u],widthScale:l,miterLimit:a,widthMinPixels:_,widthMaxPixels:w}),E.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new na(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new kl({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("positions")}calculateSegmentTypes(e){const{pathTesselator:i}=this.state;e.startIndices=i.vertexStarts,e.value=i.get("segmentTypes")}}z_.defaultProps=S$;z_.layerName="PathLayer";const Qv=512,C$=Math.PI/180;function PM({map:t,gl:e,deck:i}){if(t.__deck)return t.__deck;const n=i==null?void 0:i.props._customRender,r=i==null?void 0:i.props.onLoad,a=BM({...i==null?void 0:i.props,_customRender:()=>{t.triggerRepaint(),n==null||n("")}});let u;return(!i||i.props.gl===e)&&(Object.assign(a,{gl:e,width:null,height:null,touchAction:"unset",viewState:bp(t)}),i!=null&&i.isInitialized?BC(i,t):a.onLoad=()=>{r==null||r(),BC(u,t)}),i?(u=i,i.setProps(a),i.userData.isExternal=!0):(u=new xp(a),t.on("remove",()=>{MM(t)})),u.userData.mapboxLayers=new Set,t.__deck=u,t.on("render",()=>{u.isInitialized&&D$(u,t)}),u}function BC(t,e){const i=()=>{t.isInitialized?O$(t,e):e.off("move",i)};e.on("move",i)}function MM(t){var e;(e=t.__deck)==null||e.finalize(),t.__deck=null}function BM(t){return{...t,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...t.parameters},views:t.views||[new xw({id:"mapbox"})]}}function I$(t,e){t.userData.mapboxLayers.add(e),Mw(t)}function R$(t,e){t.userData.mapboxLayers.delete(e),Mw(t)}function P$(t,e){Mw(t)}function M$(t,e,i){let{currentViewport:n}=t.userData,r=!1;n||(n=DM(t,e,!0),t.userData.currentViewport=n,r=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:({layer:a})=>i.id===a.id||a.props.operation.includes("terrain"),clearStack:r,clearCanvas:!1})}function bp(t){var r;const{lng:e,lat:i}=t.getCenter(),n={longitude:(e+540)%360-180,latitude:i,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return(r=t.getTerrain)!=null&&r.call(t)&&B$(t,n),n}function B$(t,e){if(t.getFreeCameraOptions){const{position:i}=t.getFreeCameraOptions();if(!i||i.z===void 0)return;const n=t.transform.height,{longitude:r,latitude:a,pitch:u}=e,l=i.x*Qv,_=(1-i.y)*Qv,w=i.z*Qv,E=_p([r,a]),I=l-E[0],R=_-E[1],L=Math.sqrt(I*I+R*R),W=u*C$,K=1.5*n,fe=W<.001?K*Math.cos(W)/w:K*Math.sin(W)/L;e.zoom=Math.log2(fe);const X=K*Math.cos(W)/fe,$=w-X;e.position=[0,0,$/r_(a)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function DM(t,e,i=!0){return new Zc({id:"mapbox",x:0,y:0,width:t.width,height:t.height,...bp(e),nearZMultiplier:i?.02:.1,nearZ:e.transform._nearZ/e.transform.height,farZ:e.transform._farZ/e.transform.height})}function D$(t,e){const{mapboxLayers:i,isExternal:n}=t.userData;if(n){const r=Array.from(i,E=>E.id),u=ed(t.props.layers,Boolean).some(E=>E&&!r.includes(E.id));let l=t.getViewports();const _=l.findIndex(E=>E.id==="mapbox"),w=l.length>1||_<0;(u||w)&&(_>=0&&(l=l.slice(),l[_]=DM(t,e,!1)),t._drawLayers("mapbox-repaint",{viewports:l,layerFilter:E=>(!t.props.layerFilter||t.props.layerFilter(E))&&(E.viewport.id!=="mapbox"||!r.includes(E.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function O$(t,e){t.setProps({viewState:bp(e)}),t.needsRedraw({clearRedrawFlags:!0})}function Mw(t){if(t.userData.isExternal)return;const e=[];t.userData.mapboxLayers.forEach(i=>{const n=i.props.type,r=new n(i.props);e.push(r)}),t.setProps({layers:e})}class k${constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,i){this.map=e,this.deck=PM({map:e,gl:i,deck:this.props.deck}),I$(this.deck,this)}onRemove(){this.deck&&R$(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&P$(this.deck)}render(){M$(this.deck,this.map,this)}}const e1="__UNDEFINED__";function Ag(t,e,i,n){if(!t||!e||!t.style||!t.style._loaded)return;const r=ed(n,Boolean);if(i!==n){const l=ed(i,Boolean),_=new Set(l.map(w=>w.id));for(const w of r)_.delete(w.id);for(const w of _)t.getLayer(w)&&t.removeLayer(w)}for(const l of r){const _=t.getLayer(l.id);_?(_.implementation||_).setProps(l.props):t.addLayer(new k$({id:l.id,deck:e}),l.props.beforeId)}const a=t.style._order,u={};for(const l of r){let{beforeId:_}=l.props;(!_||!a.includes(_))&&(_=e1),u[_]=u[_]||[],u[_].push(l.id)}for(const l in u){const _=u[l];let w=l===e1?a.length:a.indexOf(l),E=l===e1?void 0:l;for(let I=_.length-1;I>=0;I--){const R=_[I],L=a.indexOf(R);L!==w-1&&(t.moveLayer(R,E),L>w&&w++),w--,E=R}}}class F${constructor(e){this._handleStyleChange=()=>{Ag(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:r,clientHeight:a}=this._map.getContainer();Object.assign(this._container.style,{width:`${r}px`,height:`${a}px`})}},this._updateViewState=()=>{const r=this._deck;r&&(r.setProps({viewState:bp(this._map)}),r.isInitialized&&r.redraw())},this._handleMouseEvent=r=>{const a=this._deck;if(!a||!a.isInitialized)return;const u={type:r.type,offsetCenter:r.point,srcEvent:r},l=this._lastMouseDownPoint;switch(!r.point&&l&&(u.deltaX=r.originalEvent.clientX-l.clientX,u.deltaY=r.originalEvent.clientY-l.clientY,u.offsetCenter={x:l.x+u.deltaX,y:l.y+u.deltaY}),u.type){case"mousedown":a._onPointerDown(u),this._lastMouseDownPoint={...r.point,clientX:r.originalEvent.clientX,clientY:r.originalEvent.clientY};break;case"dragstart":u.type="panstart",a._onEvent(u);break;case"drag":u.type="panmove",a._onEvent(u);break;case"dragend":u.type="panend",a._onEvent(u);break;case"click":u.tapCount=1,a._onEvent(u);break;case"dblclick":u.type="click",u.tapCount=2,a._onEvent(u);break;case"mousemove":u.type="pointermove",a._onPointerMove(u);break;case"mouseout":u.type="pointerleave",a._onPointerMove(u);break;default:return}};const{interleaved:i=!1,...n}=e;this._interleaved=i,this._props=n}setProps(e){this._interleaved&&e.layers&&Ag(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._interleaved?BM(this._props):this._props)}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const i=document.createElement("div");return Object.assign(i.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=i,this._deck=new xp({...this._props,parent:i,viewState:bp(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),i}_onAddInterleaved(e){const i=e.painter.context.gl;return i instanceof WebGLRenderingContext&&ai.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=PM({map:e,gl:i,deck:new xp({...this._props,gl:i})}),e.on("styledata",this._handleStyleChange),Ag(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var i;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),(i=this._deck)==null||i.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),Ag(e,this._deck,this._props.layers,[]),MM(e)}getDefaultPosition(){return"top-left"}pickObject(e){return Tn(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return Tn(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return Tn(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const Ts={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new Ie;new Ie;const Cf=new Ie,DC=new Ie;class Jp{constructor(e=[0,0,0],i=0){this.radius=-0,this.center=new Ie,this.fromCenterRadius(e,i)}fromCenterRadius(e,i){return this.center.from(e),this.radius=i,this}fromCornerPoints(e,i){return i=Cf.from(i),this.center=new Ie().from(e).add(i).scale(.5),this.radius=this.center.distance(i),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Jp(this.center,this.radius)}union(e){const i=this.center,n=this.radius,r=e.center,a=e.radius,u=Cf.copy(r).subtract(i),l=u.magnitude();if(n>=l+a)return this.clone();if(a>=l+n)return e.clone();const _=(n+l+a)*.5;return DC.copy(u).scale((-n+_)/l).add(i),this.center.copy(DC),this.radius=_,this}expand(e){const n=Cf.from(e).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(e){this.center.transform(e);const i=n6(Cf,e);return this.radius=Math.max(i[0],Math.max(i[1],i[2]))*this.radius,this}distanceSquaredTo(e){const i=this.distanceTo(e);return i*i}distanceTo(e){const n=Cf.from(e).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(e){const i=this.center,n=this.radius,a=e.normal.dot(i)+e.distance;return a<-n?Ts.OUTSIDE:a<n?Ts.INTERSECTING:Ts.INSIDE}}const N$=new Ie,L$=new Ie,Tg=new Ie,Eg=new Ie,Sg=new Ie,U$=new Ie,z$=new Ie,ba={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Qp{constructor(e=[0,0,0],i=[0,0,0,0,0,0,0,0,0]){this.center=new Ie().from(e),this.halfAxes=new hn(i)}get halfSize(){const e=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new Ie(e).len(),new Ie(i).len(),new Ie(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),r=new Ie(e).normalize(),a=new Ie(i).normalize(),u=new Ie(n).normalize();return new gp().fromMatrix3(new hn([...r,...a,...u]))}fromCenterHalfSizeQuaternion(e,i,n){const r=new gp(n),a=new hn().fromQuaternion(r);return a[0]=a[0]*i[0],a[1]=a[1]*i[0],a[2]=a[2]*i[0],a[3]=a[3]*i[1],a[4]=a[4]*i[1],a[5]=a[5]*i[1],a[6]=a[6]*i[2],a[7]=a[7]*i[2],a[8]=a[8]*i[2],this.center=new Ie().from(e),this.halfAxes=a,this}clone(){return new Qp(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Jp){const i=this.halfAxes,n=i.getColumn(0,Tg),r=i.getColumn(1,Eg),a=i.getColumn(2,Sg),u=N$.copy(n).add(r).add(a);return e.center.copy(this.center),e.radius=u.magnitude(),e}intersectPlane(e){const i=this.center,n=e.normal,r=this.halfAxes,a=n.x,u=n.y,l=n.z,_=Math.abs(a*r[ba.COLUMN0ROW0]+u*r[ba.COLUMN0ROW1]+l*r[ba.COLUMN0ROW2])+Math.abs(a*r[ba.COLUMN1ROW0]+u*r[ba.COLUMN1ROW1]+l*r[ba.COLUMN1ROW2])+Math.abs(a*r[ba.COLUMN2ROW0]+u*r[ba.COLUMN2ROW1]+l*r[ba.COLUMN2ROW2]),w=n.dot(i)+e.distance;return w<=-_?Ts.OUTSIDE:w>=_?Ts.INSIDE:Ts.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const i=L$.from(e).subtract(this.center),n=this.halfAxes,r=n.getColumn(0,Tg),a=n.getColumn(1,Eg),u=n.getColumn(2,Sg),l=r.magnitude(),_=a.magnitude(),w=u.magnitude();r.normalize(),a.normalize(),u.normalize();let E=0,I;return I=Math.abs(i.dot(r))-l,I>0&&(E+=I*I),I=Math.abs(i.dot(a))-_,I>0&&(E+=I*I),I=Math.abs(i.dot(u))-w,I>0&&(E+=I*I),E}computePlaneDistances(e,i,n=[-0,-0]){let r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;const u=this.center,l=this.halfAxes,_=l.getColumn(0,Tg),w=l.getColumn(1,Eg),E=l.getColumn(2,Sg),I=U$.copy(_).add(w).add(E).add(u),R=z$.copy(I).subtract(e);let L=i.dot(R);return r=Math.min(L,r),a=Math.max(L,a),I.copy(u).add(_).add(w).subtract(E),R.copy(I).subtract(e),L=i.dot(R),r=Math.min(L,r),a=Math.max(L,a),I.copy(u).add(_).subtract(w).add(E),R.copy(I).subtract(e),L=i.dot(R),r=Math.min(L,r),a=Math.max(L,a),I.copy(u).add(_).subtract(w).subtract(E),R.copy(I).subtract(e),L=i.dot(R),r=Math.min(L,r),a=Math.max(L,a),u.copy(I).subtract(_).add(w).add(E),R.copy(I).subtract(e),L=i.dot(R),r=Math.min(L,r),a=Math.max(L,a),u.copy(I).subtract(_).add(w).subtract(E),R.copy(I).subtract(e),L=i.dot(R),r=Math.min(L,r),a=Math.max(L,a),u.copy(I).subtract(_).subtract(w).add(E),R.copy(I).subtract(e),L=i.dot(R),r=Math.min(L,r),a=Math.max(L,a),u.copy(I).subtract(_).subtract(w).subtract(E),R.copy(I).subtract(e),L=i.dot(R),r=Math.min(L,r),a=Math.max(L,a),n[0]=r,n[1]=a,n}transform(e){this.center.transformAsPoint(e);const i=this.halfAxes.getColumn(0,Tg);i.transformAsPoint(e);const n=this.halfAxes.getColumn(1,Eg);n.transformAsPoint(e);const r=this.halfAxes.getColumn(2,Sg);return r.transformAsPoint(e),this.halfAxes=new hn([...i,...n,...r]),this}getTransform(){throw new Error("not implemented")}}const OC=new Ie,kC=new Ie;class qo{constructor(e=[0,0,1],i=0){this.normal=new Ie,this.distance=-0,this.fromNormalDistance(e,i)}fromNormalDistance(e,i){return mo(Number.isFinite(i)),this.normal.from(e).normalize(),this.distance=i,this}fromPointNormal(e,i){e=OC.from(e),this.normal.from(i).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,i,n,r){return this.normal.set(e,i,n),mo(xo(this.normal.len(),1)),this.distance=r,this}clone(){return new qo(this.normal,this.distance)}equals(e){return xo(this.distance,e.distance)&&xo(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const i=kC.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,i)}projectPointOntoPlane(e,i=[0,0,0]){const n=OC.from(e),r=this.getPointDistance(n),a=kC.copy(this.normal).scale(r);return n.subtract(a).to(i)}}const FC=[new Ie([1,0,0]),new Ie([0,1,0]),new Ie([0,0,1])],NC=new Ie,V$=new Ie;class Xs{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*FC.length;const i=e.center,n=e.radius;let r=0;for(const a of FC){let u=this.planes[r],l=this.planes[r+1];u||(u=this.planes[r]=new qo),l||(l=this.planes[r+1]=new qo);const _=NC.copy(a).scale(-n).add(i);u.fromPointNormal(_,a);const w=NC.copy(a).scale(n).add(i),E=V$.copy(a).negate();l.fromPointNormal(w,E),r+=2}return this}computeVisibility(e){let i=Ts.INSIDE;for(const n of this.planes)switch(e.intersectPlane(n)){case Ts.OUTSIDE:return Ts.OUTSIDE;case Ts.INTERSECTING:i=Ts.INTERSECTING;break}return i}computeVisibilityWithPlaneMask(e,i){if(mo(Number.isFinite(i),"parentPlaneMask is required."),i===Xs.MASK_OUTSIDE||i===Xs.MASK_INSIDE)return i;let n=Xs.MASK_INSIDE;const r=this.planes;for(let a=0;a<this.planes.length;++a){const u=a<31?1<<a:0;if(a<31&&!(i&u))continue;const l=r[a],_=e.intersectPlane(l);if(_===Ts.OUTSIDE)return Xs.MASK_OUTSIDE;_===Ts.INTERSECTING&&(n|=u)}return n}}Xs.MASK_OUTSIDE=4294967295;Xs.MASK_INSIDE=0;Xs.MASK_INDETERMINATE=2147483647;new Ie;new Ie;new Ie;new Ie;new Ie;new Ie;new Ie;new Ie;new Ie;new Ie;new Ie;new Ie;new Ie;new Ie;new Ie;new Ie;new Ie;const Wo=new hn,j$=new hn,H$=new hn,Cg=new hn,LC=new hn;function $$(t,e={}){const i=j6,n=10;let r=0,a=0;const u=j$,l=H$;u.identity(),l.copy(t);const _=i*G$(l);for(;a<n&&W$(l)>_;)X$(l,Cg),LC.copy(Cg).transpose(),l.multiplyRight(Cg),l.multiplyLeft(LC),u.multiplyRight(Cg),++r>2&&(++a,r=0);return e.unitary=u.toTarget(e.unitary),e.diagonal=l.toTarget(e.diagonal),e}function G$(t){let e=0;for(let i=0;i<9;++i){const n=t[i];e+=n*n}return Math.sqrt(e)}const Fx=[1,0,0],Nx=[2,2,1];function W$(t){let e=0;for(let i=0;i<3;++i){const n=t[Wo.getElementIndex(Nx[i],Fx[i])];e+=2*n*n}return Math.sqrt(e)}function X$(t,e){const i=IP;let n=0,r=1;for(let w=0;w<3;++w){const E=Math.abs(t[Wo.getElementIndex(Nx[w],Fx[w])]);E>n&&(r=w,n=E)}const a=Fx[r],u=Nx[r];let l=1,_=0;if(Math.abs(t[Wo.getElementIndex(u,a)])>i){const w=t[Wo.getElementIndex(u,u)],E=t[Wo.getElementIndex(a,a)],I=t[Wo.getElementIndex(u,a)],R=(w-E)/2/I;let L;R<0?L=-1/(-R+Math.sqrt(1+R*R)):L=1/(R+Math.sqrt(1+R*R)),l=1/Math.sqrt(1+L*L),_=L*l}return hn.IDENTITY.to(e),e[Wo.getElementIndex(a,a)]=e[Wo.getElementIndex(u,u)]=l,e[Wo.getElementIndex(u,a)]=_,e[Wo.getElementIndex(a,u)]=-_,e}const wl=new Ie,q$=new Ie,K$=new Ie,Z$=new Ie,Y$=new Ie,J$=new hn,Q$={diagonal:new hn,unitary:new hn};function eG(t,e=new Qp){if(!t||t.length===0)return e.halfAxes=new hn([0,0,0,0,0,0,0,0,0]),e.center=new Ie,e;const i=t.length,n=new Ie(0,0,0);for(const Ve of t)n.add(Ve);const r=1/i;n.multiplyByScalar(r);let a=0,u=0,l=0,_=0,w=0,E=0;for(const Ve of t){const je=wl.copy(Ve).subtract(n);a+=je.x*je.x,u+=je.x*je.y,l+=je.x*je.z,_+=je.y*je.y,w+=je.y*je.z,E+=je.z*je.z}a*=r,u*=r,l*=r,_*=r,w*=r,E*=r;const I=J$;I[0]=a,I[1]=u,I[2]=l,I[3]=u,I[4]=_,I[5]=w,I[6]=l,I[7]=w,I[8]=E;const{unitary:R}=$$(I,Q$),L=e.halfAxes.copy(R);let W=L.getColumn(0,K$),K=L.getColumn(1,Z$),fe=L.getColumn(2,Y$),X=-Number.MAX_VALUE,$=-Number.MAX_VALUE,Q=-Number.MAX_VALUE,me=Number.MAX_VALUE,Ce=Number.MAX_VALUE,Be=Number.MAX_VALUE;for(const Ve of t)wl.copy(Ve),X=Math.max(wl.dot(W),X),$=Math.max(wl.dot(K),$),Q=Math.max(wl.dot(fe),Q),me=Math.min(wl.dot(W),me),Ce=Math.min(wl.dot(K),Ce),Be=Math.min(wl.dot(fe),Be);W=W.multiplyByScalar(.5*(me+X)),K=K.multiplyByScalar(.5*(Ce+$)),fe=fe.multiplyByScalar(.5*(Be+Q)),e.center.copy(W).add(K).add(fe);const Fe=q$.set(X-me,$-Ce,Q-Be).multiplyByScalar(.5),ze=new hn([Fe[0],0,0,0,Fe[1],0,0,0,Fe[2]]);return e.halfAxes.multiplyRight(ze),e}const t1=Math.PI/180,Ig=new Float32Array(16),UC=new Float32Array(12);function zC(t,e,i){const n=e[0]*t1,r=e[1]*t1,a=e[2]*t1,u=Math.sin(a),l=Math.sin(n),_=Math.sin(r),w=Math.cos(a),E=Math.cos(n),I=Math.cos(r),R=i[0],L=i[1],W=i[2];t[0]=R*I*E,t[1]=R*_*E,t[2]=R*-l,t[3]=L*(-_*w+I*l*u),t[4]=L*(I*w+_*l*u),t[5]=L*E*u,t[6]=W*(_*u+I*l*w),t[7]=W*(-I*u+_*l*w),t[8]=W*E*w}function VC(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const OM={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:i}){const{data:n,getOrientation:r,getScale:a,getTranslation:u,getTransformMatrix:l}=this.props,_=Array.isArray(l),w=_&&l.length===16,E=Array.isArray(a),I=Array.isArray(r),R=Array.isArray(u),L=w||!_&&!!l(n[0]);L?t.constant=w:t.constant=I&&E&&R;const W=t.value;if(t.constant){let K;L?(Ig.set(l),K=VC(Ig)):(K=UC,zC(K,r,a),K.set(u,9)),t.value=new Float32Array(K)}else{let K=e*t.size;const{iterable:fe,objectInfo:X}=Sw(n,e,i);for(const $ of fe){X.index++;let Q;if(L)Ig.set(w?l:l($,X)),Q=VC(Ig);else{Q=UC;const me=I?r:r($,X),Ce=E?a:a($,X);zC(Q,me,Ce),Q.set(R?u:u($,X),9)}W[K++]=Q[0],W[K++]=Q[1],W[K++]=Q[2],W[K++]=Q[3],W[K++]=Q[4],W[K++]=Q[5],W[K++]=Q[6],W[K++]=Q[7],W[K++]=Q[8],W[K++]=Q[9],W[K++]=Q[10],W[K++]=Q[11]}}}};function kM(t,e){return e===ii.CARTESIAN||e===ii.METER_OFFSETS||e===ii.DEFAULT&&!t.isGeospatial}const tG=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;
if (composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,iG=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
}
`;function i1(t){const e=t.positions||t.POSITION;ai.assert(e,'no "postions" or "POSITION" attribute in mesh');const i=e.value.length/e.size;let n=t.COLOR_0||t.colors;n||(n={size:3,value:new Float32Array(i*3).fill(1)});let r=t.NORMAL||t.normals;r||(r={size:3,value:new Float32Array(i*3).fill(0)});let a=t.TEXCOORD_0||t.texCoords;return a||(a={size:2,value:new Float32Array(i*2).fill(0)}),{positions:e,colors:n,normals:r,texCoords:a}}function jC(t){return t instanceof kl?(t.attributes=i1(t.attributes),t):t.attributes?new kl({...t,topology:"triangle-list",attributes:i1(t.attributes)}):new kl({topology:"triangle-list",attributes:i1(t)})}const nG=[0,0,0,255],rG={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:nG},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}},Py=class Py extends Ql{getShaders(){return super.getShaders({vs:tG,fs:iG,modules:[qp,q6,Kp]})}getBounds(){var n;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:i}=this.props;if(!i)return null;if(e=(n=i.header)==null?void 0:n.boundingBox,!e){const{attributes:r}=jC(i);r.POSITION=r.POSITION||r.positions,e=FR(r)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:OM}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){var a;super.updateState(e);const{props:i,oldProps:n,changeFlags:r}=e;if(i.mesh!==n.mesh||r.extensionsChanged){if(this.state.positionBounds=null,(a=this.state.model)==null||a.destroy(),i.mesh){this.state.model=this.getModel(i.mesh);const u=i.mesh.attributes||i.mesh;this.setState({hasNormals:!!(u.NORMAL||u.normals)})}this.getAttributeManager().invalidateAll()}i.texture!==n.texture&&i.texture instanceof Es&&this.setTexture(i.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:i}=this.state;if(!i)return;const{viewport:n,renderPass:r}=this.context,{sizeScale:a,coordinateSystem:u,_instanced:l}=this.props;i.setUniforms(e),i.setUniforms({sizeScale:a,composeModelMatrix:!l||kM(n,u),flatShading:!this.state.hasNormals}),i.draw(r)}get isLoaded(){var e;return!!((e=this.state)!=null&&e.model&&super.isLoaded)}getModel(e){const i=new na(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:jC(e),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:r}=this.state;return i.setBindings({sampler:n||r}),i.setUniforms({hasTexture:!!n}),i}setTexture(e){const{emptyTexture:i,model:n}=this.state;n&&(n.setBindings({sampler:e||i}),n.setUniforms({hasTexture:!!e}))}};Py.defaultProps=rG,Py.layerName="SimpleMeshLayer";let Lx=Py;var go;(function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.LINEAR=9729]="LINEAR",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(go||(go={}));function FM(t,e,i,n){const r={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};r.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:a}=n;return a&&(r.bindings.u_DiffuseEnvSampler=a.diffuseEnvSampler,r.bindings.u_SpecularEnvSampler=a.specularEnvSampler,r.bindings.u_brdfLUT=a.brdfLutTexture,r.uniforms.u_ScaleIBLAmbient=[1,1]),n!=null&&n.pbrDebug&&(r.defines.PBR_DEBUG=1,r.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],r.uniforms.u_ScaleFGDSpec=[0,0,0,0]),i.NORMAL&&(r.defines.HAS_NORMALS=1),i.TANGENT&&(n!=null&&n.useTangents)&&(r.defines.HAS_TANGENTS=1),i.TEXCOORD_0&&(r.defines.HAS_UV=1),n!=null&&n.imageBasedLightingEnvironment&&(r.defines.USE_IBL=1),n!=null&&n.lights&&(r.defines.USE_LIGHTS=1),e&&sG(t,e,r),r}function sG(t,e,i){if(i.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&oG(t,e.pbrMetallicRoughness,i),e.normalTexture){ip(t,e.normalTexture,"u_NormalSampler","HAS_NORMALMAP",i);const{scale:n=1}=e.normalTexture;i.uniforms.u_NormalScale=n}if(e.occlusionTexture){ip(t,e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP",i);const{strength:n=1}=e.occlusionTexture;i.uniforms.u_OcclusionStrength=n}switch(e.emissiveTexture&&(ip(t,e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP",i),i.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":const{alphaCutoff:n=.5}=e;i.defines.ALPHA_CUTOFF=1,i.uniforms.u_AlphaCutoff=n;break;case"BLEND":qe.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),i.parameters.blendColorOperation="add",i.parameters.blendColorSrcFactor="src-alpha",i.parameters.blendColorDstFactor="one-minus-src-alpha",i.parameters.blendAlphaOperation="add",i.parameters.blendAlphaSrcFactor="one",i.parameters.blendAlphaDstFactor="one-minus-src-alpha",i.glParameters.blend=!0,i.glParameters.blendEquation=go.FUNC_ADD,i.glParameters.blendFunc=[go.SRC_ALPHA,go.ONE_MINUS_SRC_ALPHA,go.ONE,go.ONE_MINUS_SRC_ALPHA];break}}function oG(t,e,i){e.baseColorTexture&&ip(t,e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP",i),i.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&ip(t,e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP",i);const{metallicFactor:n=1,roughnessFactor:r=1}=e;i.uniforms.u_MetallicRoughnessValues=[n,r]}function ip(t,e,i,n=null,r){var E,I;const a=((I=(E=e==null?void 0:e.texture)==null?void 0:E.sampler)==null?void 0:I.parameters)||{},u=e.texture.source.image;let l,_={};u.compressed?(l=u,_={[go.TEXTURE_MIN_FILTER]:u.data.length>1?go.LINEAR_MIPMAP_NEAREST:go.LINEAR}):l={data:u};const w=t.createTexture({id:e.uniformName||e.id,parameters:{...a,..._},pixelStore:{[go.UNPACK_FLIP_Y_WEBGL]:!1},...l});r.bindings[i]=w,n&&(r.defines[n]=1),r.generatedTextures.push(w)}const aG="4.2.2",V_={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let HC;async function $C(t){dF(t.modules);const e=fF("basis");return e||(HC||(HC=lG(t)),await HC)}async function lG(t){let e=null,i=null;return[e,i]=await Promise.all([await Gc(V_.TRANSCODER,"textures",t),await Gc(V_.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await cG(e,i)}function cG(t,e){const i={};return e&&(i.wasmBinary=e),new Promise(n=>{t(i).then(r=>{const{BasisFile:a,initializeBasis:u}=r;u(),n({BasisFile:a})})})}let n1;async function GC(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(n1=n1||uG(t),await n1)}async function uG(t){let e=null,i=null;return[e,i]=await Promise.all([await Gc(V_.ENCODER,"textures",t),await Gc(V_.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await hG(e,i)}function hG(t,e){const i={};return e&&(i.wasmBinary=e),new Promise(n=>{t(i).then(r=>{const{BasisFile:a,KTX2File:u,initializeBasis:l,BasisEncoder:_}=r;l(),n({BasisFile:a,KTX2File:u,BasisEncoder:_})})})}const lh={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},dG=["","WEBKIT_","MOZ_"],WC={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Rg=null;function fG(t){if(!Rg){t=t||pG()||void 0,Rg=new Set;for(const e of dG)for(const i in WC)if(t&&t.getExtension(`${e}${i}`)){const n=WC[i];Rg.add(n)}}return Rg}function pG(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var XC,qC,KC,ZC,YC,JC,QC,e2;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(XC||(XC={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(qC||(qC={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(KC||(KC={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(ZC||(ZC={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(YC||(YC={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(JC||(JC={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(QC||(QC={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(e2||(e2={}));const bs=[171,75,84,88,32,50,48,187,13,10,26,10];function mG(t){const e=new Uint8Array(t);return!(e.byteLength<bs.length||e[0]!==bs[0]||e[1]!==bs[1]||e[2]!==bs[2]||e[3]!==bs[3]||e[4]!==bs[4]||e[5]!==bs[5]||e[6]!==bs[6]||e[7]!==bs[7]||e[8]!==bs[8]||e[9]!==bs[9]||e[10]!==bs[10]||e[11]!==bs[11])}const gG={etc1:{basisFormat:0,compressed:!0,format:lh.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:lh.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:lh.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:lh.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:lh.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:lh.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function _G(t,e){if(e.basis.containerFormat==="auto"){if(mG(t)){const n=await GC(e);return t2(n.KTX2File,t,e)}const{BasisFile:i}=await $C(e);return r1(i,t,e)}switch(e.basis.module){case"encoder":const i=await GC(e);switch(e.basis.containerFormat){case"ktx2":return t2(i.KTX2File,t,e);case"basis":default:return r1(i.BasisFile,t,e)}case"transcoder":default:const{BasisFile:n}=await $C(e);return r1(n,t,e)}}function r1(t,e,i){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const r=n.getNumImages(),a=[];for(let u=0;u<r;u++){const l=n.getNumLevels(u),_=[];for(let w=0;w<l;w++)_.push(yG(n,u,w,i));a.push(_)}return a}finally{n.close(),n.delete()}}function yG(t,e,i,n){const r=t.getImageWidth(e,i),a=t.getImageHeight(e,i),u=t.getHasAlpha(),{compressed:l,format:_,basisFormat:w}=NM(n,u),E=t.getImageTranscodedSizeInBytes(e,i,w),I=new Uint8Array(E);if(!t.transcodeImage(I,e,i,w,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:a,data:I,compressed:l,format:_,hasAlpha:u}}function t2(t,e,i){const n=new t(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=n.getLevels(),a=[];for(let u=0;u<r;u++){a.push(vG(n,u,i));break}return[a]}finally{n.close(),n.delete()}}function vG(t,e,i){const{alphaFlag:n,height:r,width:a}=t.getImageLevelInfo(e,0,0),{compressed:u,format:l,basisFormat:_}=NM(i,n),w=t.getImageTranscodedSizeInBytes(e,0,0,_),E=new Uint8Array(w);if(!t.transcodeImage(E,e,0,0,_,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:a,height:r,data:E,compressed:u,levelSize:w,hasAlpha:n,format:l}}function NM(t,e){let i=t&&t.basis&&t.basis.format;return i==="auto"&&(i=LM()),typeof i=="object"&&(i=e?i.alpha:i.noAlpha),i=i.toLowerCase(),gG[i]}function LM(){const t=fG();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const xG={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:aG,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},bG={...xG,parse:_G},wG={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},AG={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class TG{constructor(e){k(this,"name");k(this,"startTime",0);k(this,"playing",!0);k(this,"speed",1);k(this,"channels",[]);Object.assign(this,e)}animate(e){if(!this.playing)return;const n=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:r,target:a,path:u})=>{MG(n,r,a,u),CG(a,a._node)})}}class EG{constructor(e){k(this,"animations");this.animations=e.animations.map((i,n)=>{const r=i.name||`Animation-${n}`,a=i.samplers.map(({input:l,interpolation:_="LINEAR",output:w})=>({input:i2(e.accessors[l]),interpolation:_,output:i2(e.accessors[w])})),u=i.channels.map(({sampler:l,target:_})=>({sampler:a[l],target:e.nodes[_.node],path:_.path}));return new TG({name:r,channels:u})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(i=>i.animate(e))}getAnimations(){return this.animations}}function i2(t){if(!t._animation){const e=AG[t.componentType],i=wG[t.type],n=i*t.count,{buffer:r,byteOffset:a}=t.bufferView.data,u=new e(r,a+(t.byteOffset||0),n);if(i===1)t._animation=Array.from(u);else{const l=[];for(let _=0;_<u.length;_+=i)l.push(Array.from(u.slice(_,_+i)));t._animation=l}}return t._animation}const SG=new ti;function CG(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const i=SG.fromQuaternion(t.rotation);e.matrix.multiplyRight(i)}t.scale&&e.matrix.scale(t.scale)}const s1=new gp;function IG(t,e,i,n,r){if(e==="rotation"){s1.slerp({start:i,target:n,ratio:r});for(let a=0;a<s1.length;a++)t[e][a]=s1[a]}else for(let a=0;a<i.length;a++)t[e][a]=r*n[a]+(1-r)*i[a]}function RG(t,e,{p0:i,outTangent0:n,inTangent1:r,p1:a,tDiff:u,ratio:l}){for(let _=0;_<t[e].length;_++){const w=n[_]*u,E=r[_]*u;t[e][_]=(2*Math.pow(l,3)-3*Math.pow(l,2)+1)*i[_]+(Math.pow(l,3)-2*Math.pow(l,2)+l)*w+(-2*Math.pow(l,3)+3*Math.pow(l,2))*a[_]+(Math.pow(l,3)-Math.pow(l,2))*E}}function PG(t,e,i){for(let n=0;n<i.length;n++)t[e][n]=i[n]}function MG(t,{input:e,interpolation:i,output:n},r,a){const u=e[e.length-1],l=t%u,_=e.findIndex(R=>R>=l),w=Math.max(0,_-1);if(!Array.isArray(r[a]))switch(a){case"translation":r[a]=[0,0,0];break;case"rotation":r[a]=[0,0,0,1];break;case"scale":r[a]=[1,1,1];break;default:qe.warn(`Bad animation path ${a}`)()}fi(r[a].length===n[w].length);const E=e[w],I=e[_];switch(i){case"STEP":PG(r,a,n[w]);break;case"LINEAR":if(I>E){const R=(l-E)/(I-E);IG(r,a,n[w],n[_],R)}break;case"CUBICSPLINE":if(I>E){const R=(l-E)/(I-E),L=I-E,W=n[3*w+1],K=n[3*w+2],fe=n[3*_+0],X=n[3*_+1];RG(r,a,{p0:W,outTangent0:K,inTangent1:fe,p1:X,tDiff:L,ratio:R})}break;default:qe.warn(`Interpolation ${i} not supported`)();break}}const BG=`
#pragma vscode_glsllint_stage: vert
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  // _attr vec4 POSITION;
  _attr vec4 positions;

  #ifdef HAS_NORMALS
    // _attr vec4 NORMAL;
    _attr vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // _attr vec2 TEXCOORD_0;
    _attr vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }
`,DG=`
#pragma vscode_glsllint_stage: frag
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function OG(t,e){const{id:i,geometry:n,material:r,vertexCount:a,materialOptions:u,modelOptions:l}=e,_=FM(t,r,n.attributes,u);qe.info(4,"createGLTFModel defines: ",_.defines)();const w=[],E={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},I={id:i,geometry:n,topology:n.topology,vertexCount:a,modules:[mw],vs:n2(t,BG),fs:n2(t,DG),...l,bindings:{..._.bindings,...l.bindings},defines:{..._.defines,...l.defines},parameters:{...E,..._.parameters,...l.parameters},uniforms:{..._.uniforms,...l.uniforms}},R=new na(t,I);return new Ax({managedResources:w,model:R})}function n2(t,e){return`#version 300 es
${e}`}const kG={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class FG{constructor(e,i={}){k(this,"device");k(this,"options");k(this,"gltf");this.device=e,this.options={...kG,...i}}instantiate(e){return this.gltf=e,(e.scenes||[]).map(n=>this.createScene(n))}createAnimator(){return Array.isArray(this.gltf.animations)?new EG(this.gltf):null}createScene(e){const n=(e.nodes||[]).map(a=>this.createNode(a));return new Uh({id:e.name||e.id,children:n})}createNode(e){if(!e._node){const n=(e.children||[]).map(a=>this.createNode(a));e.mesh&&n.push(this.createMesh(e.mesh));const r=new Uh({id:e.name||e.id,children:n});if(e.matrix)r.setMatrix(e.matrix);else{if(r.matrix.identity(),e.translation&&r.matrix.translate(e.translation),e.rotation){const a=new ti().fromQuaternion(e.rotation);r.matrix.multiplyRight(a)}e.scale&&r.matrix.scale(e.scale)}e._node=r}return e._node}createMesh(e){if(!e._mesh){const n=(e.primitives||[]).map((a,u)=>this.createPrimitive(a,u,e)),r=new Uh({id:e.name||e.id,children:n});e._mesh=r}return e._mesh}createPrimitive(e,i,n){const r=e.name||`${n.name||n.id}-primitive-${i}`,a=NG(e.mode||4),u=e.indices?e.indices.count:this.getVertexCount(e.attributes),l=OG(this.device,{id:r,geometry:this.createGeometry(r,e,a),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:u});return l.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],l}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,i,n){const r={};for(const[a,u]of Object.entries(i.attributes)){const{components:l,size:_,value:w}=u;r[a]={size:_??l,value:w}}return new kl({id:e,topology:n,indices:i.indices.value,attributes:r})}createBuffer(e,i){e.bufferView||(e.bufferView={});const{bufferView:n}=e;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[i]||(n.lumaBuffers[i]=this.device.createBuffer({id:`from-${n.id}`,data:n.data||e.value})),n.lumaBuffers[i]}createSampler(e){return e}needsPOT(){return!1}}var wa;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(wa||(wa={}));function NG(t){switch(t){case wa.POINTS:return"point-list";case wa.LINES:return"line-list";case wa.LINE_STRIP:return"line-strip";case wa.LINE_LOOP:return"line-loop-webgl";case wa.TRIANGLES:return"triangle-list";case wa.TRIANGLE_STRIP:return"triangle-strip";case wa.TRIANGLE_FAN:return"triangle-fan-webgl";default:throw new Error(t)}}function LG(t,e,i){const n=new FG(t,i),r=n.instantiate(e),a=n.createAnimator();return{scenes:r,animator:a}}function Ss(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const UM={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},zM={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},UG=1.33,r2=["SCALAR","VEC2","VEC3","VEC4"],zG=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],VG=new Map(zG),jG={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},HG={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},$G={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function VM(t){return r2[t-1]||r2[0]}function Bw(t){const e=VG.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function Dw(t,e){const i=$G[t.componentType],n=jG[t.type],r=HG[t.componentType],a=t.count*n,u=t.count*n*r;Ss(u>=0&&u<=e.byteLength);const l=zM[t.componentType],_=UM[t.type];return{ArrayType:i,length:a,byteLength:u,componentByteSize:l,numberOfComponentsInElement:_}}function jM(t){let{images:e,bufferViews:i}=t;e=e||[],i=i||[];const n=e.map(u=>u.bufferView);i=i.filter(u=>!n.includes(u));const r=i.reduce((u,l)=>u+l.byteLength,0),a=e.reduce((u,l)=>{const{width:_,height:w}=l.image;return u+_*w},0);return r+Math.ceil(4*a*UG)}function GG(t,e,i){const n=t.bufferViews[i];Ss(n);const r=n.buffer,a=e[r];Ss(a);const u=(n.byteOffset||0)+a.byteOffset;return new Uint8Array(a.arrayBuffer,u,n.byteLength)}function WG(t,e,i){var K,fe;const n=typeof i=="number"?(K=t.accessors)==null?void 0:K[i]:i;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(i)}`);const r=(fe=t.bufferViews)==null?void 0:fe[n.bufferView||0];if(!r)throw new Error(`No gltf buffer view for accessor ${r}`);const{arrayBuffer:a,byteOffset:u}=e[r.buffer],l=(u||0)+(n.byteOffset||0)+(r.byteOffset||0),{ArrayType:_,length:w,componentByteSize:E,numberOfComponentsInElement:I}=Dw(n,r),R=E*I,L=r.byteStride||R;if(typeof r.byteStride>"u"||r.byteStride===R)return new _(a,l,w);const W=new _(w);for(let X=0;X<n.count;X++){const $=new _(a,l+X*L,I);W.set($,X*I)}return W}function XG(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class Ir{constructor(e){k(this,"gltf");k(this,"sourceBuffers");k(this,"byteLength");this.gltf={json:(e==null?void 0:e.json)||XG(),buffers:(e==null?void 0:e.buffers)||[],images:(e==null?void 0:e.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const i=this.getUsedExtensions().find(r=>r===e),n=this.getRequiredExtensions().find(r=>r===e);return typeof i=="string"||typeof n=="string"}getExtension(e){const i=this.getUsedExtensions().find(r=>r===e),n=this.json.extensions||{};return i?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,i){return(e.extensions||{})[i]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,i){if(typeof i=="object")return i;const n=this.json[e]&&this.json[e][i];if(!n)throw new Error(`glTF file error: Could not find ${e}[${i}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const i=e.buffer,n=this.gltf.buffers[i];Ss(n);const r=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,r,e.byteLength)}getTypedArrayForAccessor(e){const i=this.getAccessor(e);return WG(this.gltf.json,this.gltf.buffers,i)}getTypedArrayForImageData(e){e=this.getAccessor(e);const i=this.getBufferView(e.bufferView),r=this.getBuffer(i.buffer).data,a=i.byteOffset||0;return new Uint8Array(r,a,i.byteLength)}addApplicationData(e,i){return this.json[e]=i,this}addExtraData(e,i){return this.json.extras=this.json.extras||{},this.json.extras[e]=i,this}addObjectExtension(e,i,n){return e.extensions=e.extensions||{},e.extensions[i]=n,this.registerUsedExtension(i),this}setObjectExtension(e,i,n){const r=e.extensions||{};r[i]=n}removeObjectExtension(e,i){const n=(e==null?void 0:e.extensions)||{};if(n[i]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(i)||r.push(i)}delete n[i]}addExtension(e,i={}){return Ss(i),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=i,this.registerUsedExtension(e),i}addRequiredExtension(e,i={}){return Ss(i),this.addExtension(e,i),this.registerRequiredExtension(e),i}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(i=>i===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(i=>i===e)||this.json.extensionsRequired.push(e)}removeExtension(e){var i;if((i=this.json.extensions)!=null&&i[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:i}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:i}),this.json.scenes.length-1}addNode(e){const{meshIndex:i,matrix:n}=e;this.json.nodes=this.json.nodes||[];const r={mesh:i};return n&&(r.matrix=n),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(e){const{attributes:i,indices:n,material:r,mode:a=4}=e,l={primitives:[{attributes:this._addAttributes(i),mode:a}]};if(n){const _=this._addIndices(n);l.primitives[0].indices=_}return Number.isFinite(r)&&(l.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(l),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,i){const n=tw(e),r=i||(n==null?void 0:n.mimeType),u={bufferView:this.addBufferView(e),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(u),this.json.images.length-1}addBufferView(e,i=0,n=this.byteLength){const r=e.byteLength;Ss(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const a={buffer:i,byteOffset:n,byteLength:r};return this.byteLength+=Hp(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(a),this.json.bufferViews.length-1}addAccessor(e,i){const n={bufferView:e,type:VM(i.size),componentType:i.componentType,count:i.count,max:i.max,min:i.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,i={size:3}){const n=this.addBufferView(e);let r={min:i.min,max:i.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(e,i.size));const a={size:i.size,componentType:Bw(e),count:Math.round(e.length/i.size),min:r.min,max:r.max};return this.addAccessor(n,Object.assign(a,i))}addTexture(e){const{imageIndex:i}=e,n={source:i};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var a,u;this.gltf.buffers=[];const e=this.byteLength,i=new ArrayBuffer(e),n=new Uint8Array(i);let r=0;for(const l of this.sourceBuffers||[])r=LF(l,n,r);(u=(a=this.json)==null?void 0:a.buffers)!=null&&u[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=i,this.sourceBuffers=[i]}_removeStringFromArray(e,i){let n=!0;for(;n;){const r=e.indexOf(i);r>-1?e.splice(r,1):n=!1}}_addAttributes(e={}){const i={};for(const n in e){const r=e[n],a=this._getGltfAttributeName(n),u=this.addBinaryBuffer(r.value,r);i[a]=u}return i}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,i){const n={min:null,max:null};if(e.length<i)return n;n.min=[],n.max=[];const r=e.subarray(0,i);for(const a of r)n.min.push(a),n.max.push(a);for(let a=i;a<e.length;a+=i)for(let u=0;u<i;u++)n.min[0+u]=Math.min(n.min[0+u],e[a+u]),n.max[0+u]=Math.max(n.max[0+u],e[a+u]);return n}}function s2(t){return(t%1+1)%1}const HM={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},qG={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},$M={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Ow(t,e){return $M[e]*HM[t]}function Vy(t,e,i,n){if(i!=="UINT8"&&i!=="UINT16"&&i!=="UINT32"&&i!=="UINT64")return null;const r=t.getTypedArrayForBufferView(e),a=jy(r,"SCALAR",i,n+1);return a instanceof BigInt64Array||a instanceof BigUint64Array?null:a}function jy(t,e,i,n=1){const r=HM[e],a=qG[i],u=$M[i],l=n*r,_=l*u;let w=t.buffer,E=t.byteOffset;return E%u!==0&&(w=new Uint8Array(w).slice(E,E+_).buffer,E=0),new a(w,E,l)}function kw(t,e,i){var w,E,I,R,L;const n=`TEXCOORD_${e.texCoord||0}`,r=i.attributes[n],a=t.getTypedArrayForAccessor(r),u=t.gltf.json,l=e.index,_=(E=(w=u.textures)==null?void 0:w[l])==null?void 0:E.source;if(typeof _<"u"){const W=(R=(I=u.images)==null?void 0:I[_])==null?void 0:R.mimeType,K=(L=t.gltf.images)==null?void 0:L[_];if(K&&typeof K.width<"u"){const fe=[];for(let X=0;X<a.length;X+=2){const $=KG(K,W,a,X,e.channels);fe.push($)}return fe}}return[]}function GM(t,e,i,n,r){if(!(i!=null&&i.length))return;const a=[];for(const E of i){let I=n.findIndex(R=>R===E);I===-1&&(I=n.push(E)-1),a.push(I)}const u=new Uint32Array(a),l=t.gltf.buffers.push({arrayBuffer:u.buffer,byteOffset:u.byteOffset,byteLength:u.byteLength})-1,_=t.addBufferView(u,l,0),w=t.addAccessor(_,{size:1,componentType:Bw(u),count:u.length});r.attributes[e]=w}function KG(t,e,i,n,r=[0]){const a={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},u=i[n],l=i[n+1];let _=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(_=4);const w=ZG(u,l,t,_);let E=0;for(const I of r){const R=typeof I=="number"?Object.values(a)[I]:a[I],L=w+R.offset,W=NR(t);if(W.data.length<=L)throw new Error(`${W.data.length} <= ${L}`);const K=W.data[L];E|=K<<R.shift}return E}function ZG(t,e,i,n=1){const r=i.width,a=s2(t)*(r-1),u=Math.round(a),l=i.height,_=s2(e)*(l-1),w=Math.round(_),E=i.components?i.components:n;return(w*r+u)*E}function WM(t,e,i,n,r){const a=[];for(let u=0;u<e;u++){const l=i[u],_=i[u+1]-i[u];if(_+l>n)break;const w=l/r,E=_/r;a.push(t.slice(w,w+E))}return a}function XM(t,e,i){const n=[];for(let r=0;r<e;r++){const a=r*i;n.push(t.slice(a,a+i))}return n}function qM(t,e,i,n){if(i)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const r=[],a=new TextDecoder("utf8");let u=0;for(let l=0;l<t;l++){const _=n[l+1]-n[l];if(_+u<=e.length){const w=e.subarray(u,_+u),E=a.decode(w);r.push(E),u+=_}}return r}return[]}const KM="EXT_mesh_features",YG=KM;async function JG(t,e){const i=new Ir(t);QG(i,e)}function QG(t,e){const i=t.gltf.json;if(i.meshes)for(const n of i.meshes)for(const r of n.primitives)e7(t,r,e)}function e7(t,e,i){var a,u,l;if(!((a=i==null?void 0:i.gltf)!=null&&a.loadBuffers))return;const n=(u=e.extensions)==null?void 0:u[KM],r=n==null?void 0:n.featureIds;if(r)for(const _ of r){let w;if(typeof _.attribute<"u"){const E=`_FEATURE_ID_${_.attribute}`,I=e.attributes[E];w=t.getTypedArrayForAccessor(I)}else typeof _.texture<"u"&&((l=i==null?void 0:i.gltf)!=null&&l.loadImages)?w=kw(t,_.texture,e):w=[];_.data=w}}const t7=Object.freeze(Object.defineProperty({__proto__:null,decode:JG,name:YG},Symbol.toStringTag,{value:"Module"})),Fw="EXT_structural_metadata",i7=Fw;async function n7(t,e){const i=new Ir(t);r7(i,e)}function r7(t,e){var n,r;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const i=t.getExtension(Fw);i&&((r=e.gltf)!=null&&r.loadImages&&s7(t,i),o7(t,i))}function s7(t,e){const i=e.propertyTextures,n=t.gltf.json;if(i&&n.meshes)for(const r of n.meshes)for(const a of r.primitives)l7(t,i,a,e)}function o7(t,e){const i=e.schema;if(!i)return;const n=i.classes,r=e.propertyTables;if(n&&r)for(const a in n){const u=a7(r,a);u&&u7(t,i,u)}}function a7(t,e){for(const i of t)if(i.class===e)return i;return null}function l7(t,e,i,n){var u;if(!e)return;const r=(u=i.extensions)==null?void 0:u[Fw],a=r==null?void 0:r.propertyTextures;if(a)for(const l of a){const _=e[l];c7(t,_,i,n)}}function c7(t,e,i,n){var a;if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const r=e.class;for(const u in e.properties){const l=`${r}_${u}`,_=(a=e.properties)==null?void 0:a[u];if(!_)continue;_.data||(_.data=[]);const w=_.data,E=kw(t,_,i);E!==null&&(GM(t,l,E,w,i),_.data=w,n.dataAttributeNames.push(l))}}function u7(t,e,i){var a,u;const n=(a=e.classes)==null?void 0:a[i.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const r=i.count;for(const l in n.properties){const _=n.properties[l],w=(u=i.properties)==null?void 0:u[l];if(w){const E=h7(t,e,_,r,w);w.data=E}}}function h7(t,e,i,n,r){let a=[];const u=r.values,l=t.getTypedArrayForBufferView(u),_=d7(t,i,r,n),w=f7(t,r,n);switch(i.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{a=p7(i,n,l,_);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${i.type}`);case"STRING":{a=qM(n,l,_,w);break}case"ENUM":{a=m7(e,i,n,l,_);break}default:throw new Error(`Unknown classProperty type ${i.type}`)}return a}function d7(t,e,i,n){return e.array&&typeof e.count>"u"&&typeof i.arrayOffsets<"u"?Vy(t,i.arrayOffsets,i.arrayOffsetType||"UINT32",n):null}function f7(t,e,i){return typeof e.stringOffsets<"u"?Vy(t,e.stringOffsets,e.stringOffsetType||"UINT32",i):null}function p7(t,e,i,n){const r=t.array,a=t.count,u=Ow(t.type,t.componentType),l=i.byteLength/u;let _;return t.componentType?_=jy(i,t.type,t.componentType,l):_=i,r?n?WM(_,e,n,i.length,u):a?XM(_,e,a):[]:_}function m7(t,e,i,n,r){var I;const a=e.enumType;if(!a)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const u=(I=t.enums)==null?void 0:I[a];if(!u)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${a}`);const l=u.valueType||"UINT16",_=Ow(e.type,l),w=n.byteLength/_;let E=jy(n,e.type,l,w);if(E||(E=n),e.array){if(r)return g7({valuesData:E,numberOfElements:i,arrayOffsets:r,valuesDataBytesLength:n.length,elementSize:_,enumEntry:u});const R=e.count;return R?_7(E,i,R,u):[]}return Nw(E,0,i,u)}function g7(t){const{valuesData:e,numberOfElements:i,arrayOffsets:n,valuesDataBytesLength:r,elementSize:a,enumEntry:u}=t,l=[];for(let _=0;_<i;_++){const w=n[_],E=n[_+1]-n[_];if(E+w>r)break;const I=w/a,R=E/a,L=Nw(e,I,R,u);l.push(L)}return l}function _7(t,e,i,n){const r=[];for(let a=0;a<e;a++){const u=i*a,l=Nw(t,u,i,n);r.push(l)}return r}function Nw(t,e,i,n){const r=[];for(let a=0;a<i;a++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)r.push("");else{const u=t[e+a],l=y7(n,u);l?r.push(l.name):r.push("")}return r}function y7(t,e){for(const i of t.values)if(i.value===e)return i;return null}const v7=Object.freeze(Object.defineProperty({__proto__:null,decode:n7,name:i7},Symbol.toStringTag,{value:"Module"})),ZM="EXT_feature_metadata",x7=ZM;async function b7(t,e){const i=new Ir(t);w7(i,e)}function w7(t,e){var n,r;if(!((n=e.gltf)!=null&&n.loadBuffers))return;const i=t.getExtension(ZM);i&&((r=e.gltf)!=null&&r.loadImages&&A7(t,i),T7(t,i))}function A7(t,e){const i=e.schema;if(!i)return;const n=i.classes,{featureTextures:r}=e;if(n&&r)for(const a in n){const u=n[a],l=S7(r,a);l&&I7(t,l,u)}}function T7(t,e){const i=e.schema;if(!i)return;const n=i.classes,r=e.featureTables;if(n&&r)for(const a in n){const u=E7(r,a);u&&C7(t,i,u)}}function E7(t,e){for(const i in t){const n=t[i];if(n.class===e)return n}return null}function S7(t,e){for(const i in t){const n=t[i];if(n.class===e)return n}return null}function C7(t,e,i){var a,u;if(!i.class)return;const n=(a=e.classes)==null?void 0:a[i.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const r=i.count;for(const l in n.properties){const _=n.properties[l],w=(u=i.properties)==null?void 0:u[l];if(w){const E=R7(t,e,_,r,w);w.data=E}}}function I7(t,e,i){var r;const n=e.class;for(const a in i.properties){const u=(r=e==null?void 0:e.properties)==null?void 0:r[a];if(u){const l=O7(t,u,n);u.data=l}}}function R7(t,e,i,n,r){let a=[];const u=r.bufferView,l=t.getTypedArrayForBufferView(u),_=P7(t,i,r,n),w=M7(t,i,r,n);return i.type==="STRING"||i.componentType==="STRING"?a=qM(n,l,_,w):B7(i)&&(a=D7(i,n,l,_)),a}function P7(t,e,i,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof i.arrayOffsetBufferView<"u"?Vy(t,i.arrayOffsetBufferView,i.offsetType||"UINT32",n):null}function M7(t,e,i,n){return typeof i.stringOffsetBufferView<"u"?Vy(t,i.stringOffsetBufferView,i.offsetType||"UINT32",n):null}function B7(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function D7(t,e,i,n){const r=t.type==="ARRAY",a=t.componentCount,u="SCALAR",l=t.componentType||t.type,_=Ow(u,l),w=i.byteLength/_,E=jy(i,u,l,w);return r?n?WM(E,e,n,i.length,_):a?XM(E,e,a):[]:E}function O7(t,e,i){const n=t.gltf.json;if(!n.meshes)return[];const r=[];for(const a of n.meshes)for(const u of a.primitives)k7(t,i,e,r,u);return r}function k7(t,e,i,n,r){const a={channels:i.channels,...i.texture},u=kw(t,a,r);u&&GM(t,e,u,n,r)}const F7=Object.freeze(Object.defineProperty({__proto__:null,decode:b7,name:x7},Symbol.toStringTag,{value:"Module"})),N7="4.2.2",td=!0,o2=1735152710,Lw=12,j_=8,L7=1313821514,U7=5130562,z7=0,V7=0,j7=1;function H7(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function $7(t,e=0,i={}){const n=new DataView(t),{magic:r=o2}=i,a=n.getUint32(e,!1);return a===r||a===o2}function G7(t,e,i=0,n={}){const r=new DataView(e),a=H7(r,i+0),u=r.getUint32(i+4,td),l=r.getUint32(i+8,td);switch(Object.assign(t,{header:{byteOffset:i,byteLength:l,hasBinChunk:!1},type:a,version:u,json:{},binChunks:[]}),i+=Lw,t.version){case 1:return W7(t,r,i);case 2:return X7(t,r,i,n={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function W7(t,e,i){Di(t.header.byteLength>Lw+j_);const n=e.getUint32(i+0,td),r=e.getUint32(i+4,td);return i+=j_,Di(r===z7),Ux(t,e,i,n),i+=n,i+=zx(t,e,i,t.header.byteLength),i}function X7(t,e,i,n){return Di(t.header.byteLength>Lw+j_),q7(t,e,i,n),i+t.header.byteLength}function q7(t,e,i,n){for(;i+8<=t.header.byteLength;){const r=e.getUint32(i+0,td),a=e.getUint32(i+4,td);switch(i+=j_,a){case L7:Ux(t,e,i,r);break;case U7:zx(t,e,i,r);break;case V7:n.strict||Ux(t,e,i,r);break;case j7:n.strict||zx(t,e,i,r);break}i+=Hp(r,4)}return i}function Ux(t,e,i,n){const r=new Uint8Array(e.buffer,i,n),u=new TextDecoder("utf8").decode(r);return t.json=JSON.parse(u),Hp(n,4)}function zx(t,e,i,n){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:i,byteLength:n,arrayBuffer:e.buffer}),Hp(n,4)}function YM(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return n.substr(0,n.lastIndexOf("/")+1)+t}const K7="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Z7="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Y7=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),J7=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Q7={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},eW={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function tW(t,e,i,n,r,a="NONE"){const u=await iW();sW(u,u.exports[eW[r]],t,e,i,n,u.exports[Q7[a||"NONE"]])}let o1;async function iW(){return o1||(o1=nW()),o1}async function nW(){let t=K7;WebAssembly.validate(Y7)&&(t=Z7,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(rW(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function rW(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n){const r=t.charCodeAt(n);e[n]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let i=0;for(let n=0;n<t.length;++n)e[i++]=e[n]<60?J7[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,i)}function sW(t,e,i,n,r,a,u){const l=t.exports.sbrk,_=n+3&-4,w=l(_*r),E=l(a.length),I=new Uint8Array(t.exports.memory.buffer);I.set(a,E);const R=e(w,n,r,E,a.length);if(R===0&&u&&u(w,_,r),i.set(I.subarray(w,w+n*r)),l(w-l(0)),R!==0)throw new Error(`Malformed buffer data: ${R}`)}const H_="EXT_meshopt_compression",oW=H_;async function aW(t,e){var r,a;const i=new Ir(t);if(!((r=e==null?void 0:e.gltf)!=null&&r.decompressMeshes)||!((a=e.gltf)!=null&&a.loadBuffers))return;const n=[];for(const u of t.json.bufferViews||[])n.push(lW(i,u));await Promise.all(n),i.removeExtension(H_)}async function lW(t,e){const i=t.getObjectExtension(e,H_);if(i){const{byteOffset:n=0,byteLength:r=0,byteStride:a,count:u,mode:l,filter:_="NONE",buffer:w}=i,E=t.gltf.buffers[w],I=new Uint8Array(E.arrayBuffer,E.byteOffset+n,r),R=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await tW(R,u,a,I,l,_),t.removeObjectExtension(e,H_)}}const cW=Object.freeze(Object.defineProperty({__proto__:null,decode:aW,name:oW},Symbol.toStringTag,{value:"Module"})),fh="EXT_texture_webp",uW=fh;function hW(t,e){const i=new Ir(t);if(!OL("image/webp")){if(i.getRequiredExtensions().includes(fh))throw new Error(`gltf: Required extension ${fh} not supported by browser`);return}const{json:n}=i;for(const r of n.textures||[]){const a=i.getObjectExtension(r,fh);a&&(r.source=a.source),i.removeObjectExtension(r,fh)}i.removeExtension(fh)}const dW=Object.freeze(Object.defineProperty({__proto__:null,name:uW,preprocess:hW},Symbol.toStringTag,{value:"Module"})),o_="KHR_texture_basisu",fW=o_;function pW(t,e){const i=new Ir(t),{json:n}=i;for(const r of n.textures||[]){const a=i.getObjectExtension(r,o_);a&&(r.source=a.source,i.removeObjectExtension(r,o_))}i.removeExtension(o_)}const mW=Object.freeze(Object.defineProperty({__proto__:null,name:fW,preprocess:pW},Symbol.toStringTag,{value:"Module"})),gW="4.2.2",_W={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:gW,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function yW(t,e,i){const n=JM(e.metadata),r=[],a=vW(e.attributes);for(const u in t){const l=t[u],_=a2(u,l,a[u]);r.push(_)}if(i){const u=a2("indices",i);r.push(u)}return{fields:r,metadata:n}}function vW(t){const e={};for(const i in t){const n=t[i];e[n.name||"undefined"]=n}return e}function a2(t,e,i){const n=i?JM(i.metadata):void 0;return eL(t,e,n)}function JM(t){Object.entries(t);const e={};for(const i in t)e[`${i}.string`]=JSON.stringify(t[i]);return e}const l2={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},xW={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},bW=4;class wW{constructor(e){k(this,"draco");k(this,"decoder");k(this,"metadataQuerier");this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,i={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(i);const r=this.decoder.GetEncodedGeometryType(n),a=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let u;switch(r){case this.draco.TRIANGULAR_MESH:u=this.decoder.DecodeBufferToMesh(n,a);break;case this.draco.POINT_CLOUD:u=this.decoder.DecodeBufferToPointCloud(n,a);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!u.ok()||!a.ptr){const R=`DRACO decompression failed: ${u.error_msg()}`;throw new Error(R)}const l=this._getDracoLoaderData(a,r,i),_=this._getMeshData(a,l,i),w=FR(_.attributes),E=yW(_.attributes,l,_.indices);return{loader:"draco",loaderData:l,header:{vertexCount:a.num_points(),boundingBox:w},..._,schema:E}}finally{this.draco.destroy(n),a&&this.draco.destroy(a)}}_getDracoLoaderData(e,i,n){const r=this._getTopLevelMetadata(e),a=this._getDracoAttributes(e,n);return{geometry_type:i,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:r,attributes:a}}_getDracoAttributes(e,i){const n={};for(let r=0;r<e.num_attributes();r++){const a=this.decoder.GetAttribute(e,r),u=this._getAttributeMetadata(e,r);n[a.unique_id()]={unique_id:a.unique_id(),attribute_type:a.attribute_type(),data_type:a.data_type(),num_components:a.num_components(),byte_offset:a.byte_offset(),byte_stride:a.byte_stride(),normalized:a.normalized(),attribute_index:r,metadata:u};const l=this._getQuantizationTransform(a,i);l&&(n[a.unique_id()].quantization_transform=l);const _=this._getOctahedronTransform(a,i);_&&(n[a.unique_id()].octahedron_transform=_)}return n}_getMeshData(e,i,n){const r=this._getMeshAttributes(i,e,n);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(e,i,n){const r={};for(const a of Object.values(e.attributes)){const u=this._deduceAttributeName(a,n);a.name=u;const l=this._getAttributeValues(i,a);if(l){const{value:_,size:w}=l;r[u]={value:_,size:w,byteOffset:a.byte_offset,byteStride:a.byte_stride,normalized:a.normalized}}}return r}_getTriangleListIndices(e){const n=e.num_faces()*3,r=n*bW,a=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,a),new Uint32Array(this.draco.HEAPF32.buffer,a,n).slice()}finally{this.draco._free(a)}}_getTriangleStripIndices(e){const i=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,i),EW(i)}finally{this.draco.destroy(i)}}_getAttributeValues(e,i){const n=xW[i.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${i.data_type}`),null;const r=i.num_components,u=e.num_points()*r,l=u*n.BYTES_PER_ELEMENT,_=AW(this.draco,n);let w;const E=this.draco._malloc(l);try{const I=this.decoder.GetAttribute(e,i.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,I,_,l,E),w=new n(this.draco.HEAPF32.buffer,E,u).slice()}finally{this.draco._free(E)}return{value:w,size:r}}_deduceAttributeName(e,i){const n=e.unique_id;for(const[u,l]of Object.entries(i.extraAttributes||{}))if(l===n)return u;const r=e.attribute_type;for(const u in l2)if(this.draco[u]===r)return l2[u];const a=i.attributeNameEntry||"name";return e.metadata[a]?e.metadata[a].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const i=this.decoder.GetMetadata(e);return this._getDracoMetadata(i)}_getAttributeMetadata(e,i){const n=this.decoder.GetAttributeMetadata(e,i);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const i={},n=this.metadataQuerier.NumEntries(e);for(let r=0;r<n;r++){const a=this.metadataQuerier.GetEntryName(e,r);i[a]=this._getDracoMetadataField(e,a)}return i}_getDracoMetadataField(e,i){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,i,n);const r=TW(n);return{int:this.metadataQuerier.GetIntEntry(e,i),string:this.metadataQuerier.GetStringEntry(e,i),double:this.metadataQuerier.GetDoubleEntry(e,i),intArray:r}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:i=[],octahedronAttributes:n=[]}=e,r=[...i,...n];for(const a of r)this.decoder.SkipAttributeTransform(this.draco[a])}_getQuantizationTransform(e,i){const{quantizedAttributes:n=[]}=i,r=e.attribute_type();if(n.map(u=>this.decoder[u]).includes(r)){const u=new this.draco.AttributeQuantizationTransform;try{if(u.InitFromAttribute(e))return{quantization_bits:u.quantization_bits(),range:u.range(),min_values:new Float32Array([1,2,3]).map(l=>u.min_value(l))}}finally{this.draco.destroy(u)}}return null}_getOctahedronTransform(e,i){const{octahedronAttributes:n=[]}=i,r=e.attribute_type();if(n.map(u=>this.decoder[u]).includes(r)){const u=new this.draco.AttributeQuantizationTransform;try{if(u.InitFromAttribute(e))return{quantization_bits:u.quantization_bits()}}finally{this.draco.destroy(u)}}return null}}function AW(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function TW(t){const e=t.size(),i=new Int32Array(e);for(let n=0;n<e;n++)i[n]=t.GetValue(n);return i}function EW(t){const e=t.size(),i=new Int32Array(e);for(let n=0;n<e;n++)i[n]=t.GetValue(n);return i}const SW="1.5.6",CW="1.4.1",a1=`https://www.gstatic.com/draco/versioned/decoders/${SW}`,ts={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},l1={[ts.DECODER]:`${a1}/${ts.DECODER}`,[ts.DECODER_WASM]:`${a1}/${ts.DECODER_WASM}`,[ts.FALLBACK_DECODER]:`${a1}/${ts.FALLBACK_DECODER}`,[ts.ENCODER]:`https://raw.githubusercontent.com/google/draco/${CW}/javascript/${ts.ENCODER}`};let c1;async function IW(t){const e=t.modules||{};return e.draco3d?c1||(c1=e.draco3d.createDecoderModule({}).then(i=>({draco:i}))):c1||(c1=RW(t)),await c1}async function RW(t){let e,i;switch(t.draco&&t.draco.decoderType){case"js":e=await Gc(l1[ts.FALLBACK_DECODER],"draco",t,ts.FALLBACK_DECODER);break;case"wasm":default:[e,i]=await Promise.all([await Gc(l1[ts.DECODER],"draco",t,ts.DECODER),await Gc(l1[ts.DECODER_WASM],"draco",t,ts.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await PW(e,i)}function PW(t,e){const i={};return e&&(i.wasmBinary=e),new Promise(n=>{t({...i,onModuleLoaded:r=>n({draco:r})})})}const QM={..._W,parse:MW};async function MW(t,e){const{draco:i}=await IW(e),n=new wW(i);try{return n.parseSync(t,e==null?void 0:e.draco)}finally{n.destroy()}}function BW(t){const e={};for(const i in t){const n=t[i];if(i!=="indices"){const r=e3(n);e[i]=r}}return e}function e3(t){const{buffer:e,size:i,count:n}=DW(t);return{value:e,size:i,byteOffset:0,count:n,type:VM(i),componentType:Bw(e)}}function DW(t){let e=t,i=1,n=0;return t&&t.value&&(e=t.value,i=t.size||1),e&&(ArrayBuffer.isView(e)||(e=OW(e,Float32Array)),n=e.length/i),{buffer:e,size:i,count:n}}function OW(t,e,i=!1){return t?Array.isArray(t)?new e(t):i&&!(t instanceof e)?new e(t):t:null}const Qc="KHR_draco_mesh_compression",kW=Qc;function FW(t,e,i){const n=new Ir(t);for(const r of t3(n))n.getObjectExtension(r,Qc)}async function NW(t,e,i){var a;if(!((a=e==null?void 0:e.gltf)!=null&&a.decompressMeshes))return;const n=new Ir(t),r=[];for(const u of t3(n))n.getObjectExtension(u,Qc)&&r.push(UW(n,u,e,i));await Promise.all(r),n.removeExtension(Qc)}function LW(t,e={}){const i=new Ir(t);for(const n of i.json.meshes||[])zW(),i.addRequiredExtension(Qc)}async function UW(t,e,i,n){const r=t.getObjectExtension(e,Qc);if(!r)return;const a=t.getTypedArrayForBufferView(r.bufferView),u=qb(a.buffer,a.byteOffset),l={...i};delete l["3d-tiles"];const _=await jp(u,QM,l,n),w=BW(_.attributes);for(const[E,I]of Object.entries(w))if(E in e.attributes){const R=e.attributes[E],L=t.getAccessor(R);L!=null&&L.min&&(L!=null&&L.max)&&(I.min=L.min,I.max=L.max)}e.attributes=w,_.indices&&(e.indices=e3(_.indices)),t.removeObjectExtension(e,Qc),VW(e)}function zW(t,e,i=4,n,r){if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided")}function VW(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*t3(t){for(const e of t.json.meshes||[])for(const i of e.primitives)yield i}const jW=Object.freeze(Object.defineProperty({__proto__:null,decode:NW,encode:LW,name:kW,preprocess:FW},Symbol.toStringTag,{value:"Module"})),Hy="KHR_texture_transform",HW=Hy,Pg=new Ie,$W=new hn,GW=new hn;async function WW(t,e){var a;if(!new Ir(t).hasExtension(Hy)||!((a=e.gltf)!=null&&a.loadBuffers))return;const r=t.json.materials||[];for(let u=0;u<r.length;u++)XW(u,t)}function XW(t,e){var a,u,l,_;const i=(a=e.json.materials)==null?void 0:a[t],n=[(u=i==null?void 0:i.pbrMetallicRoughness)==null?void 0:u.baseColorTexture,i==null?void 0:i.emissiveTexture,i==null?void 0:i.normalTexture,i==null?void 0:i.occlusionTexture,(l=i==null?void 0:i.pbrMetallicRoughness)==null?void 0:l.metallicRoughnessTexture],r=[];for(const w of n)w&&((_=w==null?void 0:w.extensions)!=null&&_[Hy])&&qW(e,t,w,r)}function qW(t,e,i,n){const r=KW(i,n);if(!r)return;const a=t.json.meshes||[];for(const u of a)for(const l of u.primitives){const _=l.material;Number.isFinite(_)&&e===_&&ZW(t,l,r)}}function KW(t,e){var u;const i=(u=t.extensions)==null?void 0:u[Hy],{texCoord:n=0}=t,{texCoord:r=n}=i;if(!(e.findIndex(([l,_])=>l===n&&_===r)!==-1)){const l=QW(i);return n!==r&&(t.texCoord=r),e.push([n,r]),{originalTexCoord:n,texCoord:r,matrix:l}}return null}function ZW(t,e,i){var l,_;const{originalTexCoord:n,texCoord:r,matrix:a}=i,u=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(u)){const w=(l=t.json.accessors)==null?void 0:l[u];if(w&&w.bufferView){const E=(_=t.json.bufferViews)==null?void 0:_[w.bufferView];if(E){const{arrayBuffer:I,byteOffset:R}=t.buffers[E.buffer],L=(R||0)+(w.byteOffset||0)+(E.byteOffset||0),{ArrayType:W,length:K}=Dw(w,E),fe=zM[w.componentType],X=UM[w.type],$=E.byteStride||fe*X,Q=new Float32Array(K);for(let me=0;me<w.count;me++){const Ce=new W(I,L+me*$,2);Pg.set(Ce[0],Ce[1],1),Pg.transformByMatrix3(a),Q.set([Pg[0],Pg[1]],me*X)}n===r?YW(w,E,t.buffers,Q):JW(r,w,e,t,Q)}}}}function YW(t,e,i,n){t.componentType=5126,i.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=i.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function JW(t,e,i,n,r){n.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const a=n.json.bufferViews;if(!a)return;a.push({buffer:n.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const u=n.json.accessors;u&&(u.push({bufferView:(a==null?void 0:a.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),i.attributes[`TEXCOORD_${t}`]=u.length-1)}function QW(t){const{offset:e=[0,0],rotation:i=0,scale:n=[1,1]}=t,r=new hn().set(1,0,0,0,1,0,e[0],e[1],1),a=$W.set(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0,0,0,1),u=GW.set(n[0],0,0,0,n[1],0,0,0,1);return r.multiplyRight(a).multiplyRight(u)}const eX=Object.freeze(Object.defineProperty({__proto__:null,decode:WW,name:HW},Symbol.toStringTag,{value:"Module"})),Vc="KHR_lights_punctual",tX=Vc;async function iX(t){const e=new Ir(t),{json:i}=e,n=e.getExtension(Vc);n&&(e.json.lights=n.lights,e.removeExtension(Vc));for(const r of i.nodes||[]){const a=e.getObjectExtension(r,Vc);a&&(r.light=a.light),e.removeObjectExtension(r,Vc)}}async function nX(t){const e=new Ir(t),{json:i}=e;if(i.lights){const n=e.addExtension(Vc);Ss(!n.lights),n.lights=i.lights,delete i.lights}if(e.json.lights){for(const n of e.json.lights){const r=n.node;e.addObjectExtension(r,Vc,n)}delete e.json.lights}}const rX=Object.freeze(Object.defineProperty({__proto__:null,decode:iX,encode:nX,name:tX},Symbol.toStringTag,{value:"Module"})),wp="KHR_materials_unlit",sX=wp;async function oX(t){const e=new Ir(t),{json:i}=e;for(const n of i.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,wp);e.removeExtension(wp)}function aX(t){const e=new Ir(t),{json:i}=e;if(e.materials)for(const n of i.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,wp,{}),e.addExtension(wp))}const lX=Object.freeze(Object.defineProperty({__proto__:null,decode:oX,encode:aX,name:sX},Symbol.toStringTag,{value:"Module"})),$f="KHR_techniques_webgl",cX=$f;async function uX(t){const e=new Ir(t),{json:i}=e,n=e.getExtension($f);if(n){const r=dX(n,e);for(const a of i.materials||[]){const u=e.getObjectExtension(a,$f);u&&(a.technique=Object.assign({},u,r[u.technique]),a.technique.values=fX(a.technique,e)),e.removeObjectExtension(a,$f)}e.removeExtension($f)}}async function hX(t,e){}function dX(t,e){const{programs:i=[],shaders:n=[],techniques:r=[]}=t,a=new TextDecoder;return n.forEach(u=>{if(Number.isFinite(u.bufferView))u.code=a.decode(e.getTypedArrayForBufferView(u.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),i.forEach(u=>{u.fragmentShader=n[u.fragmentShader],u.vertexShader=n[u.vertexShader]}),r.forEach(u=>{u.program=i[u.program]}),r}function fX(t,e){const i=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(n=>{t.uniforms[n].value&&!(n in i)&&(i[n]=t.uniforms[n].value)}),Object.keys(i).forEach(n=>{typeof i[n]=="object"&&i[n].index!==void 0&&(i[n].texture=e.getTexture(i[n].index))}),i}const pX=Object.freeze(Object.defineProperty({__proto__:null,decode:uX,encode:hX,name:cX},Symbol.toStringTag,{value:"Module"})),i3=[v7,t7,cW,dW,mW,jW,rX,lX,pX,eX,F7];function mX(t,e={},i){var r;const n=i3.filter(a=>n3(a.name,e));for(const a of n)(r=a.preprocess)==null||r.call(a,t,e,i)}async function gX(t,e={},i){var r;const n=i3.filter(a=>n3(a.name,e));for(const a of n)await((r=a.decode)==null?void 0:r.call(a,t,e,i))}function n3(t,e){var r;const i=((r=e==null?void 0:e.gltf)==null?void 0:r.excludeExtensions)||{};return!(t in i&&!i[t])}const u1="KHR_binary_glTF";function _X(t){const e=new Ir(t),{json:i}=e;for(const n of i.images||[]){const r=e.getObjectExtension(n,u1);r&&Object.assign(n,r),e.removeObjectExtension(n,u1)}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,e.removeExtension(u1)}const c2={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},yX={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class vX{constructor(){k(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});k(this,"json")}normalize(e,i){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!i.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),_X(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const i in c2)this._convertTopLevelObjectToArray(e,i)}_convertTopLevelObjectToArray(e,i){const n=e[i];if(!(!n||Array.isArray(n))){e[i]=[];for(const r in n){const a=n[r];a.id=a.id||r;const u=e[i].length;e[i].push(a),this.idToIndexMap[i][r]=u}}}_convertObjectIdsToArrayIndices(e){for(const i in c2)this._convertIdsToIndices(e,i);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const i of e.textures)this._convertTextureIds(i);for(const i of e.meshes)this._convertMeshIds(i);for(const i of e.nodes)this._convertNodeIds(i);for(const i of e.scenes)this._convertSceneIds(i)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const i of e.primitives){const{attributes:n,indices:r,material:a}=i;for(const u in n)n[u]=this._convertIdToIndex(n[u],"accessor");r&&(i.indices=this._convertIdToIndex(r,"accessor")),a&&(i.material=this._convertIdToIndex(a,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(i=>this._convertIdToIndex(i,"node"))),e.meshes&&(e.meshes=e.meshes.map(i=>this._convertIdToIndex(i,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(i=>this._convertIdToIndex(i,"node")))}_convertIdsToIndices(e,i){e[i]||(console.warn(`gltf v1: json doesn't contain attribute ${i}`),e[i]=[]);for(const n of e[i])for(const r in n){const a=n[r],u=this._convertIdToIndex(a,r);n[r]=u}}_convertIdToIndex(e,i){const n=yX[i];if(n in this.idToIndexMap){const r=this.idToIndexMap[n][e];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${i} with id ${e}`);return r}return e}_updateObjects(e){for(const i of this.json.buffers)delete i.type}_updateMaterial(e){var i,n,r;for(const a of e.materials){a.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const u=((i=a.values)==null?void 0:i.tex)||((n=a.values)==null?void 0:n.texture2d_0)||((r=a.values)==null?void 0:r.diffuseTex),l=e.textures.findIndex(_=>_.id===u);l!==-1&&(a.pbrMetallicRoughness.baseColorTexture={index:l})}}}function xX(t,e={}){return new vX().normalize(t,e)}async function bX(t,e,i=0,n,r){var a,u,l;return wX(t,e,i,n),xX(t,{normalize:(a=n==null?void 0:n.gltf)==null?void 0:a.normalize}),mX(t,n,r),(u=n==null?void 0:n.gltf)!=null&&u.loadBuffers&&t.json.buffers&&await AX(t,n,r),(l=n==null?void 0:n.gltf)!=null&&l.loadImages&&await TX(t,n,r),await gX(t,n,r),t}function wX(t,e,i,n){if(n.uri&&(t.baseUri=n.uri),e instanceof ArrayBuffer&&!$7(e,i,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=OF(e);else if(e instanceof ArrayBuffer){const u={};i=G7(u,e,i,n.glb),Ss(u.type==="glTF",`Invalid GLB magic string ${u.type}`),t._glb=u,t.json=u.json}else Ss(!1,"GLTF: must be ArrayBuffer or string");const r=t.json.buffers||[];if(t.buffers=new Array(r.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:u}=t._glb;t.buffers[0]={arrayBuffer:u[0].arrayBuffer,byteOffset:u[0].byteOffset,byteLength:u[0].byteLength}}const a=t.json.images||[];t.images=new Array(a.length).fill({})}async function AX(t,e,i){var r,a;const n=t.json.buffers||[];for(let u=0;u<n.length;++u){const l=n[u];if(l.uri){const{fetch:_}=i;Ss(_);const w=YM(l.uri,e),E=await((r=i==null?void 0:i.fetch)==null?void 0:r.call(i,w)),I=await((a=E==null?void 0:E.arrayBuffer)==null?void 0:a.call(E));t.buffers[u]={arrayBuffer:I,byteOffset:0,byteLength:I.byteLength},delete l.uri}else t.buffers[u]===null&&(t.buffers[u]={arrayBuffer:new ArrayBuffer(l.byteLength),byteOffset:0,byteLength:l.byteLength})}}async function TX(t,e,i){const n=EX(t),r=t.json.images||[],a=[];for(const u of n)a.push(SX(t,r[u],u,e,i));return await Promise.all(a)}function EX(t){const e=new Set,i=t.json.textures||[];for(const n of i)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function SX(t,e,i,n,r){let a;if(e.uri&&!e.hasOwnProperty("bufferView")){const l=YM(e.uri,n),{fetch:_}=r;a=await(await _(l)).arrayBuffer(),e.bufferView={data:a}}if(Number.isFinite(e.bufferView)){const l=GG(t.json,t.buffers,e.bufferView);a=qb(l.buffer,l.byteOffset,l.byteLength)}Ss(a,"glTF image has no data");let u=await jp(a,[zR,bG],{...n,mimeType:e.mimeType,basis:n.basis||{format:LM()}},r);u&&u[0]&&(u={compressed:!0,mipmaps:!1,width:u[0].width,height:u[0].height,data:u[0]}),t.images=t.images||[],t.images[i]=u}const Ap={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:N7,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:CX,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function CX(t,e={},i){e={...Ap.options,...e},e.gltf={...Ap.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await bX({},t,n,e,i)}const IX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},RX={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},$s={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},PX={magFilter:$s.TEXTURE_MAG_FILTER,minFilter:$s.TEXTURE_MIN_FILTER,wrapS:$s.TEXTURE_WRAP_S,wrapT:$s.TEXTURE_WRAP_T},MX={[$s.TEXTURE_MAG_FILTER]:$s.LINEAR,[$s.TEXTURE_MIN_FILTER]:$s.NEAREST_MIPMAP_LINEAR,[$s.TEXTURE_WRAP_S]:$s.REPEAT,[$s.TEXTURE_WRAP_T]:$s.REPEAT};function BX(){return{id:"default-sampler",parameters:MX}}function DX(t){return RX[t]}function OX(t){return IX[t]}class kX{constructor(){k(this,"baseUri","");k(this,"jsonUnprocessed");k(this,"json");k(this,"buffers",[]);k(this,"images",[])}postProcess(e,i={}){const{json:n,buffers:r=[],images:a=[]}=e,{baseUri:u=""}=e;return Ss(n),this.baseUri=u,this.buffers=r,this.images=a,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,i),this.json}_resolveTree(e,i={}){const n={...e};return this.json=n,e.bufferViews&&(n.bufferViews=e.bufferViews.map((r,a)=>this._resolveBufferView(r,a))),e.images&&(n.images=e.images.map((r,a)=>this._resolveImage(r,a))),e.samplers&&(n.samplers=e.samplers.map((r,a)=>this._resolveSampler(r,a))),e.textures&&(n.textures=e.textures.map((r,a)=>this._resolveTexture(r,a))),e.accessors&&(n.accessors=e.accessors.map((r,a)=>this._resolveAccessor(r,a))),e.materials&&(n.materials=e.materials.map((r,a)=>this._resolveMaterial(r,a))),e.meshes&&(n.meshes=e.meshes.map((r,a)=>this._resolveMesh(r,a))),e.nodes&&(n.nodes=e.nodes.map((r,a)=>this._resolveNode(r,a)),n.nodes=n.nodes.map((r,a)=>this._resolveNodeChildren(r))),e.skins&&(n.skins=e.skins.map((r,a)=>this._resolveSkin(r,a))),e.scenes&&(n.scenes=e.scenes.map((r,a)=>this._resolveScene(r,a))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,i){if(typeof i=="object")return i;const n=e&&e[i];return n||console.warn(`glTF file error: Could not find ${e}[${i}]`),n}_resolveScene(e,i){return{...e,id:e.id||`scene-${i}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,i){const n={...e,id:(e==null?void 0:e.id)||`node-${i}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((r,a)=>{const u=this.getMesh(a);return r.id=u.id,r.primitives=r.primitives.concat(u.primitives),r},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(i=>this.getNode(i))),e}_resolveSkin(e,i){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${i}`,inverseBindMatrices:n}}_resolveMesh(e,i){const n={...e,id:e.id||`mesh-${i}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(r=>{const a={...r,attributes:{},indices:void 0,material:void 0},u=r.attributes;for(const l in u)a.attributes[l]=this.getAccessor(u[l]);return r.indices!==void 0&&(a.indices=this.getAccessor(r.indices)),r.material!==void 0&&(a.material=this.getMaterial(r.material)),a})),n}_resolveMaterial(e,i){const n={...e,id:e.id||`material-${i}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const r=n.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,i){const n=DX(e.componentType),r=OX(e.type),a=n*r,u={...e,id:e.id||`accessor-${i}`,bytesPerComponent:n,components:r,bytesPerElement:a,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(u.bufferView=this.getBufferView(e.bufferView)),u.bufferView){const l=u.bufferView.buffer,{ArrayType:_,byteLength:w}=Dw(u,u.bufferView),E=(u.bufferView.byteOffset||0)+(u.byteOffset||0)+l.byteOffset;let I=l.arrayBuffer.slice(E,E+w);u.bufferView.byteStride&&(I=this._getValueFromInterleavedBuffer(l,E,u.bufferView.byteStride,u.bytesPerElement,u.count)),u.value=new _(I)}return u}_getValueFromInterleavedBuffer(e,i,n,r,a){const u=new Uint8Array(a*r);for(let l=0;l<a;l++){const _=i+l*n;u.set(new Uint8Array(e.arrayBuffer.slice(_,_+r)),l*r)}return u.buffer}_resolveTexture(e,i){return{...e,id:e.id||`texture-${i}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):BX(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,i){const n={id:e.id||`sampler-${i}`,...e,parameters:{}};for(const r in n){const a=this._enumSamplerParameter(r);a!==void 0&&(n.parameters[a]=n[r])}return n}_enumSamplerParameter(e){return PX[e]}_resolveImage(e,i){const n={...e,id:e.id||`image-${i}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},r=this.images[i];return r&&(n.image=r),n}_resolveBufferView(e,i){const n=e.buffer,r=this.buffers[n].arrayBuffer;let a=this.buffers[n].byteOffset||0;return e.byteOffset&&(a+=e.byteOffset),{id:`bufferView-${i}`,...e,buffer:this.buffers[n],data:new Uint8Array(r,a,e.byteLength)}}_resolveCamera(e,i){const n={...e,id:e.id||`camera-${i}`};return n.perspective,n.orthographic,n}}function Uw(t,e){return new kX().postProcess(t,e)}async function FX(t){const e=[];return t.scenes.forEach(i=>{i.traverse(n=>{Object.values(n.model.uniforms).forEach(r=>{r.loaded===!1&&e.push(r)})})}),await NX(()=>e.some(i=>!i.loaded))}async function NX(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const LX=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(MODULE_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef MODULE_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(sizeScale);
float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (sceneModelMatrix * vec4(positions, 1.0)).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,UX=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
uniform float opacity;
in vec4 vColor;
out vec4 fragColor;
#ifndef MODULE_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D u_BaseColorSampler;
#endif
#endif
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(u_BaseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,r3=[255,255,255,255],zX={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:r3},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Ap]},My=class My extends Ql{getShaders(){const e=[qp,Kp];return this.props._lighting==="pbr"&&e.push(mw),super.getShaders({vs:LX,fs:UX,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:r3,transition:!0},instanceModelMatrix:OM})}updateState(e){super.updateState(e);const{props:i,oldProps:n}=e;i.scenegraph!==n.scenegraph?this._updateScenegraph():i._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,i._animations)}finalizeState(e){var i;super.finalizeState(e),(i=this.state.scenegraph)==null||i.destroy()}get isLoaded(){var e;return!!((e=this.state)!=null&&e.scenegraph&&super.isLoaded)}_updateScenegraph(){var l;const e=this.props,{device:i}=this.context;let n=null;if(e.scenegraph instanceof F_)n={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const _=e.scenegraph,w=_.json?Uw(_):_,E=LG(i,w,this._getModelOptions());n={gltf:w,...E},FX(E).then(()=>{this.setNeedsRedraw()}).catch(I=>{this.raiseError(I,"loading glTF")})}const r={layer:this,device:this.context.device},a=e.getScene(n,r),u=e.getAnimator(n,r);if(a instanceof Uh){(l=this.state.scenegraph)==null||l.destroy(),this._applyAnimationsProp(u,e._animations);const _=[];a.traverse(w=>{w instanceof Ax&&_.push(w.model)}),this.setState({scenegraph:a,animator:u,models:_}),this.getAttributeManager().invalidateAll()}else a!==null&&ai.warn("invalid scenegraph:",a)()}_applyAnimationsProp(e,i){if(!e||!i)return;const n=e.getAnimations();Object.keys(i).sort().forEach(r=>{const a=i[r];if(r==="*")n.forEach(u=>{Object.assign(u,a)});else if(Number.isFinite(Number(r))){const u=Number(r);u>=0&&u<n.length?Object.assign(n[u],a):ai.warn(`animation ${r} not found`)()}else{const u=n.find(({name:l})=>l===r);u?Object.assign(u,a):ai.warn(`animation ${r} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let i;return e&&(typeof e=="function"?i=e({gl:this.context.gl,layer:this}):i=e),{imageBasedLightingEnvironment:i,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:i,renderPass:n}=this.context,{sizeScale:r,sizeMinPixels:a,sizeMaxPixels:u,opacity:l,coordinateSystem:_}=this.props,w=this.getNumInstances();this.state.scenegraph.traverse((E,{worldMatrix:I})=>{if(E instanceof Ax){const{model:R}=E;R.setInstanceCount(w),R.setUniforms({sizeScale:r,opacity:l,sizeMinPixels:a,sizeMaxPixels:u,composeModelMatrix:kM(i,_),sceneModelMatrix:I,u_Camera:R.uniforms.project_uCameraPosition}),R.draw(n)}})}};My.defaultProps=zX,My.layerName="ScenegraphLayer";let Vx=My;const VX=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project_uCameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,jX=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function HX(t){const e=t.positions||t.POSITION,i=e.value.length/e.size;t.COLOR_0||t.colors||(t.colors={size:4,value:new Uint8Array(i*4).fill(255),normalized:!0})}const $X={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class zw extends Lx{getShaders(){const e=super.getShaders();return e.modules.push(mw),{...e,vs:VX,fs:jX}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const i=this.getAttributeManager();e&&i.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:i,oldProps:n}=e;i.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(i.pbrMaterial)}draw(e){const{featureIds:i}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.uniforms.project_uCameraPosition,pickFeatureIds:!!i}),super.draw(e))}getModel(e){const{id:i,pbrMaterial:n}=this.props,r=this.parseMaterial(n,e);this.setState({parsedPBRMaterial:r});const a=this.getShaders();return HX(e.attributes),new na(this.context.device,{...this.getShaders(),id:i,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...a.defines,...r==null?void 0:r.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:r==null?void 0:r.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:i}=this.state;if(i){const{mesh:n}=this.props,r=this.parseMaterial(e,n);this.setState({parsedPBRMaterial:r}),i.setBindings(r.bindings),i.setUniforms(r.uniforms)}}parseMaterial(e,i){const n=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return FM(this.context.device,{unlit:n,...e},{NORMAL:i.attributes.normals,TEXCOORD_0:i.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const i=this.props.featureIds,n=new Uint8ClampedArray(i.length*e.size),r=[];for(let a=0;a<i.length;a++)this.encodePickingColor(i[a],r),n[a*3]=r[0],n[a*3+1]=r[1],n[a*3+2]=r[2];e.value=n}finalizeState(e){var i;super.finalizeState(e),(i=this.state.parsedPBRMaterial)==null||i.generatedTextures.forEach(n=>n.destroy()),this.setState({parsedPBRMaterial:null})}}zw.layerName="MeshLayer";zw.defaultProps=$X;const GX=6378137,WX=6378137,XX=6356752314245179e-9;function $y(t){return t}new Ie;function qX(t,e=[],i=$y){return"longitude"in t?(e[0]=i(t.longitude),e[1]=i(t.latitude),e[2]=t.height):"x"in t?(e[0]=i(t.x),e[1]=i(t.y),e[2]=t.z):(e[0]=i(t[0]),e[1]=i(t[1]),e[2]=t[2]),e}function KX(t,e=[]){return qX(t,e,Bn._cartographicRadians?$y:bz)}function ZX(t,e,i=$y){return"longitude"in e?(e.longitude=i(t[0]),e.latitude=i(t[1]),e.height=t[2]):"x"in e?(e.x=i(t[0]),e.y=i(t[1]),e.z=t[2]):(e[0]=i(t[0]),e[1]=i(t[1]),e[2]=t[2]),e}function YX(t,e){return ZX(t,e,Bn._cartographicRadians?$y:wz)}const u2=1e-14,JX=new Ie,h2={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},h1={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},If={east:new Ie,north:new Ie,up:new Ie,west:new Ie,south:new Ie,down:new Ie},QX=new Ie,eq=new Ie,tq=new Ie;function d2(t,e,i,n,r,a){const u=h2[e]&&h2[e][i];mo(u&&(!n||n===u));let l,_,w;const E=JX.copy(r);if(xo(E.x,0,u2)&&xo(E.y,0,u2)){const R=Math.sign(E.z);l=QX.fromArray(h1[e]),e!=="east"&&e!=="west"&&l.scale(R),_=eq.fromArray(h1[i]),i!=="east"&&i!=="west"&&_.scale(R),w=tq.fromArray(h1[n]),n!=="east"&&n!=="west"&&w.scale(R)}else{const{up:R,east:L,north:W}=If;L.set(-E.y,E.x,0).normalize(),t.geodeticSurfaceNormal(E,R),W.copy(R).cross(L);const{down:K,west:fe,south:X}=If;K.copy(R).scale(-1),fe.copy(L).scale(-1),X.copy(W).scale(-1),l=If[e],_=If[i],w=If[n]}return a[0]=l.x,a[1]=l.y,a[2]=l.z,a[3]=0,a[4]=_.x,a[5]=_.y,a[6]=_.z,a[7]=0,a[8]=w.x,a[9]=w.y,a[10]=w.z,a[11]=0,a[12]=E.x,a[13]=E.y,a[14]=E.z,a[15]=1,a}const ch=new Ie,iq=new Ie,nq=new Ie;function rq(t,e,i=[]){const{oneOverRadii:n,oneOverRadiiSquared:r,centerToleranceSquared:a}=e;ch.from(t);const u=ch.x,l=ch.y,_=ch.z,w=n.x,E=n.y,I=n.z,R=u*u*w*w,L=l*l*E*E,W=_*_*I*I,K=R+L+W,fe=Math.sqrt(1/K);if(!Number.isFinite(fe))return;const X=iq;if(X.copy(t).scale(fe),K<a)return X.to(i);const $=r.x,Q=r.y,me=r.z,Ce=nq;Ce.set(X.x*$*2,X.y*Q*2,X.z*me*2);let Be=(1-fe)*ch.len()/(.5*Ce.len()),Fe=0,ze,Ve,je,Ke;do{Be-=Fe,ze=1/(1+Be*$),Ve=1/(1+Be*Q),je=1/(1+Be*me);const Lt=ze*ze,Pt=Ve*Ve,bt=je*je,_i=Lt*ze,Zn=Pt*Ve,sn=bt*je;Ke=R*Lt+L*Pt+W*bt-1;const Et=-2*(R*_i*$+L*Zn*Q+W*sn*me);Fe=Ke/Et}while(Math.abs(Ke)>V6);return ch.scale([ze,Ve,je]).to(i)}const Mg=new Ie,f2=new Ie,sq=new Ie,lo=new Ie,oq=new Ie,Bg=new Ie;class Oi{constructor(e=0,i=0,n=0){this.centerToleranceSquared=z6,mo(e>=0),mo(i>=0),mo(n>=0),this.radii=new Ie(e,i,n),this.radiiSquared=new Ie(e*e,i*i,n*n),this.radiiToTheFourth=new Ie(e*e*e*e,i*i*i*i,n*n*n*n),this.oneOverRadii=new Ie(e===0?0:1/e,i===0?0:1/i,n===0?0:1/n),this.oneOverRadiiSquared=new Ie(e===0?0:1/(e*e),i===0?0:1/(i*i),n===0?0:1/(n*n)),this.minimumRadius=Math.min(e,i,n),this.maximumRadius=Math.max(e,i,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,i=[0,0,0]){const n=f2,r=sq,[,,a]=e;this.geodeticSurfaceNormalCartographic(e,n),r.copy(this.radiiSquared).scale(n);const u=Math.sqrt(n.dot(r));return r.scale(1/u),n.scale(a),r.add(n),r.to(i)}cartesianToCartographic(e,i=[0,0,0]){Bg.from(e);const n=this.scaleToGeodeticSurface(Bg,lo);if(!n)return;const r=this.geodeticSurfaceNormal(n,f2),a=oq;a.copy(Bg).subtract(n);const u=Math.atan2(r.y,r.x),l=Math.asin(r.z),_=Math.sign(uw(a,Bg))*yP(a);return YX([u,l,_],i)}eastNorthUpToFixedFrame(e,i=new ti){return d2(this,"east","north","up",e,i)}localFrameToFixedFrame(e,i,n,r,a=new ti){return d2(this,e,i,n,r,a)}geocentricSurfaceNormal(e,i=[0,0,0]){return Mg.from(e).normalize().to(i)}geodeticSurfaceNormalCartographic(e,i=[0,0,0]){const n=KX(e),r=n[0],a=n[1],u=Math.cos(a);return Mg.set(u*Math.cos(r),u*Math.sin(r),Math.sin(a)).normalize(),Mg.to(i)}geodeticSurfaceNormal(e,i=[0,0,0]){return Mg.from(e).scale(this.oneOverRadiiSquared).normalize().to(i)}scaleToGeodeticSurface(e,i){return rq(e,this,i)}scaleToGeocentricSurface(e,i=[0,0,0]){lo.from(e);const n=lo.x,r=lo.y,a=lo.z,u=this.oneOverRadiiSquared,l=1/Math.sqrt(n*n*u.x+r*r*u.y+a*a*u.z);return lo.multiplyScalar(l).to(i)}transformPositionToScaledSpace(e,i=[0,0,0]){return lo.from(e).scale(this.oneOverRadii).to(i)}transformPositionFromScaledSpace(e,i=[0,0,0]){return lo.from(e).scale(this.radii).to(i)}getSurfaceNormalIntersectionWithZAxis(e,i=0,n=[0,0,0]){mo(xo(this.radii.x,this.radii.y,IP)),mo(this.radii.z>0),lo.from(e);const r=lo.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-i))return lo.set(0,0,r).to(n)}}Oi.WGS84=new Oi(GX,WX,XX);class aq{constructor(e,i,n){k(this,"item");k(this,"previous");k(this,"next");this.item=e,this.previous=i,this.next=n}}class lq{constructor(){k(this,"head",null);k(this,"tail",null);k(this,"_length",0)}get length(){return this._length}add(e){const i=new aq(e,this.tail,null);return this.tail?(this.tail.next=i,this.tail=i):(this.head=i,this.tail=i),++this._length,i}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,i){e!==i&&(this.remove(i),this._insert(e,i))}_insert(e,i){const n=e.next;e.next=i,this.tail===e?this.tail=i:n.previous=i,i.next=n,i.previous=e,++this._length}}class cq{constructor(){k(this,"_list");k(this,"_sentinel");k(this,"_trimTiles");this._list=new lq,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const i=e._cacheNode;i&&this._list.splice(this._sentinel,i)}add(e,i,n){i._cacheNode||(i._cacheNode=this._list.add(i),n&&n(e,i))}unloadTile(e,i,n){const r=i._cacheNode;r&&(this._list.remove(r),i._cacheNode=null,n&&n(e,i))}unloadTiles(e,i){const n=this._trimTiles;this._trimTiles=!1;const r=this._list,a=e.maximumMemoryUsage*1024*1024,u=this._sentinel;let l=r.head;for(;l!==u&&(e.gpuMemoryUsageInBytes>a||n);){const _=l.item;l=l.next,this.unloadTile(e,_,i)}}trim(){this._trimTiles=!0}}function uq(t,e){Di(t),Di(e);const{rtcCenter:i,gltfUpAxis:n}=e,{computedTransform:r,boundingVolume:{center:a}}=t;let u=new ti(r);switch(i&&u.translate(i),n){case"Z":break;case"Y":const I=new ti().rotateX(Math.PI/2);u=u.multiplyRight(I);break;case"X":const R=new ti().rotateY(-Math.PI/2);u=u.multiplyRight(R);break}e.isQuantized&&u.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const l=new Ie(a);e.cartesianModelMatrix=u,e.cartesianOrigin=l;const _=Oi.WGS84.cartesianToCartographic(l,new Ie),E=Oi.WGS84.eastNorthUpToFixedFrame(l).invert();e.cartographicModelMatrix=E.multiplyRight(u),e.cartographicOrigin=_,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const p2=new Ie,d1=new Ie,jx=new Xs([new qo,new qo,new qo,new qo,new qo,new qo]);function hq(t,e){const{cameraDirection:i,cameraUp:n,height:r}=t,{metersPerUnit:a}=t.distanceScales,u=a_(t,t.center),l=Oi.WGS84.eastNorthUpToFixedFrame(u),_=t.unprojectPosition(t.cameraPosition),w=Oi.WGS84.cartographicToCartesian(_,new Ie),E=new Ie(l.transformAsVector(new Ie(i).scale(a))).normalize(),I=new Ie(l.transformAsVector(new Ie(n).scale(a))).normalize();fq(t);const R=t.constructor,{longitude:L,latitude:W,width:K,bearing:fe,zoom:X}=t,$=new R({longitude:L,latitude:W,height:r,width:K,bearing:fe,zoom:X,pitch:0});return{camera:{position:w,direction:E,up:I},viewport:t,topDownViewport:$,height:r,cullingVolume:jx,frameNumber:e,sseDenominator:1.15}}function dq(t,e,i){if(i===0||t.length<=i)return[t,[]];const n=[],{longitude:r,latitude:a}=e.viewport;for(const[w,E]of t.entries()){const[I,R]=E.header.mbs,L=Math.abs(r-I),W=Math.abs(a-R),K=Math.sqrt(W*W+L*L);n.push([w,K])}const u=n.sort((w,E)=>w[1]-E[1]),l=[];for(let w=0;w<i;w++)l.push(t[u[w][0]]);const _=[];for(let w=i;w<u.length;w++)_.push(t[u[w][0]]);return[l,_]}function fq(t){const e=t.getFrustumPlanes(),i=m2(e.near,t.cameraPosition),n=a_(t,i),r=a_(t,t.cameraPosition,d1);let a=0;jx.planes[a++].fromPointNormal(n,p2.copy(n).subtract(r));for(const u in e){if(u==="near")continue;const l=e[u],_=m2(l,i,d1),w=a_(t,_,d1);jx.planes[a++].fromPointNormal(w,p2.copy(n).subtract(w))}}function m2(t,e,i=new Ie){const n=t.normal.dot(e);return i.copy(t.normal).scale(t.distance-n).add(e),i}function a_(t,e,i=new Ie){const n=t.unprojectPosition(e);return Oi.WGS84.cartographicToCartesian(n,i)}const pq=6378137,mq=6378137,Hx=6356752314245179e-9,xh=new Ie;function gq(t,e){if(t instanceof Qp){const{halfAxes:i}=t,n=yq(i);return Math.log2(Hx/(n+e[2]))}else if(t instanceof Jp){const{radius:i}=t;return Math.log2(Hx/(i+e[2]))}else if(t.width&&t.height){const{width:i,height:n}=t,r=Math.log2(pq/i),a=Math.log2(mq/n);return(r+a)/2}return 1}function s3(t,e,i){Oi.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],xh);const n=Math.sqrt(Math.pow(xh[0]-i[0],2)+Math.pow(xh[1]-i[1],2)+Math.pow(xh[2]-i[2],2));return Math.log2(Hx/(n+e[2]))}function _q(t,e,i){const[n,r,a,u]=t;return s3({xmin:n,xmax:a,ymin:r,ymax:u,zmin:0,zmax:0},e,i)}function yq(t){t.getColumn(0,xh);const e=t.getColumn(1),i=t.getColumn(2);return xh.add(e).add(i).len()}const ws={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var bo;(function(t){t[t.ADD=1]="ADD",t[t.REPLACE=2]="REPLACE"})(bo||(bo={}));var Ia;(function(t){t.EMPTY="empty",t.SCENEGRAPH="scenegraph",t.POINTCLOUD="pointcloud",t.MESH="mesh"})(Ia||(Ia={}));var es;(function(t){t.I3S="I3S",t.TILES3D="TILES3D"})(es||(es={}));var id;(function(t){t.GEOMETRIC_ERROR="geometricError",t.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(id||(id={}));const vq={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function o3(t){return t!=null}const Er=new Ie,l_=new Ie,xq=new Ie,bq=new Ie,Pc=new Ie,g2=new Ie,_2=new Ie,y2=new Ie;function f1(t,e,i){if(Di(t,"3D Tile: boundingVolume must be defined"),t.box)return a3(t.box,e,i);if(t.region)return Tq(t.region);if(t.sphere)return Aq(t.sphere,e,i);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function wq(t,e){if(t.box)return Eq(e);if(t.region){const[i,n,r,a,u,l]=t.region;return[[fo(i),fo(n),u],[fo(r),fo(a),l]]}if(t.sphere)return Sq(e);throw new Error("Unkown boundingVolume type")}function a3(t,e,i){const n=new Ie(t[0],t[1],t[2]);e.transform(n,n);let r=[];if(t.length===10){const w=t.slice(3,6),E=new gp;E.fromArray(t,6);const I=new Ie([1,0,0]),R=new Ie([0,1,0]),L=new Ie([0,0,1]);I.transformByQuaternion(E),I.scale(w[0]),R.transformByQuaternion(E),R.scale(w[1]),L.transformByQuaternion(E),L.scale(w[2]),r=[...I.toArray(),...R.toArray(),...L.toArray()]}else r=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const a=e.transformAsVector(r.slice(0,3)),u=e.transformAsVector(r.slice(3,6)),l=e.transformAsVector(r.slice(6,9)),_=new hn([a[0],a[1],a[2],u[0],u[1],u[2],l[0],l[1],l[2]]);return o3(i)?(i.center=n,i.halfAxes=_,i):new Qp(n,_)}function Aq(t,e,i){const n=new Ie(t[0],t[1],t[2]);e.transform(n,n);const r=e.getScale(l_),a=Math.max(Math.max(r[0],r[1]),r[2]),u=t[3]*a;return o3(i)?(i.center=n,i.radius=u,i):new Jp(n,u)}function Tq(t){const[e,i,n,r,a,u]=t,l=Oi.WGS84.cartographicToCartesian([fo(e),fo(r),a],xq),_=Oi.WGS84.cartographicToCartesian([fo(n),fo(i),u],bq),w=new Ie().addVectors(l,_).multiplyByScalar(.5);return Oi.WGS84.cartesianToCartographic(w,Pc),Oi.WGS84.cartographicToCartesian([fo(n),Pc[1],Pc[2]],g2),Oi.WGS84.cartographicToCartesian([Pc[0],fo(r),Pc[2]],_2),Oi.WGS84.cartographicToCartesian([Pc[0],Pc[1],u],y2),a3([...w,...g2.subtract(w),..._2.subtract(w),...y2.subtract(w)],new ti)}function Eq(t){const e=l3(),{halfAxes:i}=t,n=new Ie(i.getColumn(0)),r=new Ie(i.getColumn(1)),a=new Ie(i.getColumn(2));for(let u=0;u<2;u++){for(let l=0;l<2;l++){for(let _=0;_<2;_++)Er.copy(t.center),Er.add(n),Er.add(r),Er.add(a),c3(e,Er),a.negate();r.negate()}n.negate()}return e}function Sq(t){const e=l3(),{center:i,radius:n}=t,r=Oi.WGS84.scaleToGeodeticSurface(i,Er);let a;r?a=Oi.WGS84.geodeticSurfaceNormal(r):a=new Ie(0,0,1);let u=new Ie(a[2],-a[1],0);u.len()>0?u.normalize():u=new Ie(0,1,0);const l=u.clone().cross(a);for(const _ of[u,l,a]){l_.copy(_).scale(n);for(let w=0;w<2;w++)Er.copy(i),Er.add(l_),c3(e,Er),l_.negate()}return e}function l3(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function c3(t,e){Oi.WGS84.cartesianToCartographic(e,Er),t[0][0]=Math.min(t[0][0],Er[0]),t[0][1]=Math.min(t[0][1],Er[1]),t[0][2]=Math.min(t[0][2],Er[2]),t[1][0]=Math.max(t[1][0],Er[0]),t[1][1]=Math.max(t[1][1],Er[1]),t[1][2]=Math.max(t[1][2],Er[2])}new Ie;new Ie;new ti;new Ie;new Ie;new Ie;function Cq(t,e){const i=t*e;return 1-Math.exp(-(i*i))}function Iq(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const i=t.dynamicScreenSpaceErrorComputedDensity,n=t.dynamicScreenSpaceErrorFactor;return Cq(e,i)*n}return 0}function Rq(t,e,i){const n=t.tileset,r=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,a=i?r:t.lodMetricValue;if(a===0)return 0;const u=Math.max(t._distanceToCamera,1e-7),{height:l,sseDenominator:_}=e,{viewDistanceScale:w}=n.options;let E=a*l*(w||1)/(u*_);return E-=Iq(n,u),E}const p1=new Ie,v2=new Ie,Al=new Ie,x2=new Ie,Pq=new Ie,m1=new ti,b2=new ti;function Mq(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const i=2*u3(t,e);return i<2?"OUT":!t.header.children||i<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function u3(t,e){const{topDownViewport:i}=e,n=t.header.mbs[1],r=t.header.mbs[0],a=t.header.mbs[2],u=t.header.mbs[3],l=[...t.boundingVolume.center],_=i.unprojectPosition(i.cameraPosition);Oi.WGS84.cartographicToCartesian(_,p1),v2.copy(p1).subtract(l).normalize(),Oi.WGS84.eastNorthUpToFixedFrame(l,m1),b2.copy(m1).invert(),Al.copy(p1).transform(b2);const w=Math.sqrt(Al[0]*Al[0]+Al[1]*Al[1]),E=w*w/Al[2];x2.copy([Al[0],Al[1],E]);const R=x2.transform(m1).subtract(l).normalize(),W=v2.cross(R).normalize().scale(u).add(l),K=Oi.WGS84.cartesianToCartographic(W),fe=i.project([r,n,a]),X=i.project(K);return Pq.copy(fe).subtract(X).magnitude()}function Bq(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class w2{constructor(e=0){k(this,"_map",new Map);k(this,"_array");k(this,"_length");this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Di(e<this._array.length),this._array[e]}set(e,i){Di(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=i,this._map.set(i,e)}delete(e){const i=this._map.get(e);i>=0&&(this._array.splice(i,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const i=this.length++;this._array[i]=e,this._map.set(e,i)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Di(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Di(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const Dq={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class Gy{constructor(e){k(this,"options");k(this,"root",null);k(this,"selectedTiles",{});k(this,"requestedTiles",{});k(this,"emptyTiles",{});k(this,"lastUpdate",new Date().getTime());k(this,"updateDebounceTime",1e3);k(this,"_traversalStack",new w2);k(this,"_emptyTraversalStack",new w2);k(this,"_frameNumber",null);this.options={...Dq,...e}}traversalFinished(e){return!0}traverse(e,i,n){this.root=e,this.options={...this.options,...n},this.reset(),this.updateTile(e,i),this._frameNumber=i.frameNumber,this.executeTraversal(e,i)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,i){const n=this._traversalStack;for(e._selectionDepth=1,n.push(e);n.length>0;){const a=n.pop();let u=!1;this.canTraverse(a,i)&&(this.updateChildTiles(a,i),u=this.updateAndPushChildren(a,i,n,a.hasRenderContent?a._selectionDepth+1:a._selectionDepth));const l=a.parent,_=!!(!l||l._shouldRefine),w=!u;a.hasRenderContent?a.refine===bo.ADD?(this.loadTile(a,i),this.selectTile(a,i)):a.refine===bo.REPLACE&&(this.loadTile(a,i),w&&this.selectTile(a,i)):(this.emptyTiles[a.id]=a,this.loadTile(a,i),w&&this.selectTile(a,i)),this.touchTile(a,i),a._shouldRefine=u&&_}const r=new Date().getTime();(this.traversalFinished(i)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(i))}updateChildTiles(e,i){const n=e.children;for(const r of n)this.updateTile(r,i)}updateAndPushChildren(e,i,n,r){const{loadSiblings:a,skipLevelOfDetail:u}=this.options,l=e.children;l.sort(this.compareDistanceToCamera.bind(this));const _=e.refine===bo.REPLACE&&e.hasRenderContent&&!u;let w=!1,E=!0;for(const I of l)if(I._selectionDepth=r,I.isVisibleAndInRequestVolume?(n.find(I)&&n.delete(I),n.push(I),w=!0):(_||a)&&(this.loadTile(I,i),this.touchTile(I,i)),_){let R;if(I._inRequestVolume?I.hasRenderContent?R=I.contentAvailable:R=this.executeEmptyTraversal(I,i):R=!1,E=E&&R,!E)return!1}return w||(E=!1),E}updateTile(e,i){this.updateTileVisibility(e,i)}selectTile(e,i){this.shouldSelectTile(e)&&(e._selectedFrame=i.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,i){this.shouldLoadTile(e)&&(e._requestedFrame=i.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,i){e.tileset._cache.touch(e),e._touchedFrame=i.frameNumber}canTraverse(e,i,n=!1,r=!1){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!r&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,i,n):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,i,n=!1){let r=e._screenSpaceError;return n&&(r=e.getScreenSpaceError(i,!0)),r>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,i){const n=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap)this.options.viewportTraversersMap[r]===i.viewport.id&&n.push(r);else n.push(i.viewport.id);e.updateVisibility(i,n)}compareDistanceToCamera(e,i){return e._distanceToCamera-i._distanceToCamera}anyChildrenVisible(e,i){let n=!1;for(const r of e.children)r.updateVisibility(i),n=n||r.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(e,i){let n=!0;const r=this._emptyTraversalStack;for(r.push(e);r.length>0;){const a=r.pop(),u=!a.hasRenderContent&&this.canTraverse(a,i,!1,!1),l=!a.hasRenderContent&&a.children.length===0;if(!u&&!a.contentAvailable&&!l&&(n=!1),this.updateTile(a,i),a.isVisibleAndInRequestVolume||(this.loadTile(a,i),this.touchTile(a,i)),u){const _=a.children;for(const w of _)r.push(w)}}return n}}const A2=new Ie;function Oq(t){return t!=null}class $x{constructor(e,i,n,r=""){k(this,"tileset");k(this,"header");k(this,"id");k(this,"url");k(this,"parent");k(this,"refine");k(this,"type");k(this,"contentUrl");k(this,"lodMetricType","geometricError");k(this,"lodMetricValue",0);k(this,"boundingVolume",null);k(this,"content",null);k(this,"contentState",ws.UNLOADED);k(this,"gpuMemoryUsageInBytes",0);k(this,"children",[]);k(this,"depth",0);k(this,"viewportIds",[]);k(this,"transform",new ti);k(this,"extensions",null);k(this,"implicitTiling",null);k(this,"userData",{});k(this,"computedTransform");k(this,"hasEmptyContent",!1);k(this,"hasTilesetContent",!1);k(this,"traverser",new Gy({}));k(this,"_cacheNode",null);k(this,"_frameNumber",null);k(this,"_expireDate",null);k(this,"_expiredContent",null);k(this,"_boundingBox");k(this,"_distanceToCamera",0);k(this,"_screenSpaceError",0);k(this,"_visibilityPlaneMask");k(this,"_visible");k(this,"_contentBoundingVolume");k(this,"_viewerRequestVolume");k(this,"_initialTransform",new ti);k(this,"_priority",0);k(this,"_selectedFrame",0);k(this,"_requestedFrame",0);k(this,"_selectionDepth",0);k(this,"_touchedFrame",0);k(this,"_centerZDepth",0);k(this,"_shouldRefine",!1);k(this,"_stackLength",0);k(this,"_visitedFrame",0);k(this,"_inRequestVolume",!1);k(this,"_lodJudge",null);this.header=i,this.tileset=e,this.id=r||i.id,this.url=i.url,this.parent=n,this.refine=this._getRefine(i.refine),this.type=i.type,this.contentUrl=i.contentUrl,this._initializeLodMetric(i),this._initializeTransforms(i),this._initializeBoundingVolumes(i),this._initializeContent(i),this._initializeRenderingState(i),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===ws.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===ws.UNLOADED}get contentExpired(){return this.contentState===ws.EXPIRED}get contentFailed(){return this.contentState===ws.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=wq(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,i){switch(this.tileset.type){case es.I3S:return u3(this,e);case es.TILES3D:return Rq(this,e,i);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:i}=e.options,n=this.refine===bo.ADD||i;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===ws.UNLOADED)return-1;const r=this.parent,u=r&&(!n||this._screenSpaceError===0||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,l=e.root?e.root._screenSpaceError:0;return Math.max(l-u,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=ws.LOADING;const i=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!i)return this.contentState=ws.UNLOADED,!1;try{const n=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,a={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await Wl(n,r,a),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=ws.READY,this._onContentLoaded(),!0}catch(n){throw this.contentState=ws.FAILED,n}finally{i.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=ws.UNLOADED,!0}updateVisibility(e,i){if(this._frameNumber===e.frameNumber)return;const n=this.parent,r=n?n._visibilityPlaneMask:Xs.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const a=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(a)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,r),this._visible=this._visibilityPlaneMask!==Xs.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=i}visibility(e,i){const{cullingVolume:n}=e,{boundingVolume:r}=this;return n.computeVisibilityWithPlaneMask(r,i)}contentVisibility(){return!0}distanceToTile(e){const i=this.boundingVolume;return Math.sqrt(Math.max(i.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const i=this.boundingVolume;return A2.subVectors(i.center,e.position),e.direction.dot(A2)}insideViewerRequestVolume(e){const i=this._viewerRequestVolume;return!i||i.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(Oq(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=ws.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new ti(e.transform):new ti;const i=this.parent,n=this.tileset,r=i&&i.computedTransform?i.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new ti(r).multiplyRight(this.transform);const a=i&&i._initialTransform?i._initialTransform.clone():new ti;this._initialTransform=new ti(a).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=ws.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Xs.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||bo.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=f1(e.boundingVolume,this.computedTransform,this.boundingVolume);const i=e.content;i&&(i.boundingVolume&&(this._contentBoundingVolume=f1(i.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=f1(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new ti){const i=e.clone().multiplyRight(this.transform);i.equals(this.computedTransform)||(this.computedTransform=i,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return Bq(this.tileset.tileset)}}}class kq extends Gy{compareDistanceToCamera(e,i){return i._distanceToCamera===0&&e._distanceToCamera===0?i._centerZDepth-e._centerZDepth:i._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,i){if(super.updateTileVisibility(e,i),!e.isVisibleAndInRequestVolume)return;const n=e.children.length>0;if(e.hasTilesetContent&&n){const u=e.children[0];this.updateTileVisibility(u,i),e._visible=u._visible;return}if(this.meetsScreenSpaceErrorEarly(e,i)){e._visible=!1;return}const r=e.refine===bo.REPLACE,a=e._optimChildrenWithinParent===vq.USE_OPTIMIZATION;if(r&&a&&n&&!this.anyChildrenVisible(e,i)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,i){const{parent:n}=e;return!n||n.hasTilesetContent||n.refine!==bo.ADD?!1:!this.shouldRefine(e,i,!0)}}class Fq{constructor(){k(this,"frameNumberMap",new Map)}register(e,i){const n=this.frameNumberMap.get(e)||new Map,r=n.get(i)||0;n.set(i,r+1),this.frameNumberMap.set(e,n)}deregister(e,i){const n=this.frameNumberMap.get(e);if(!n)return;const r=n.get(i)||1;n.set(i,r-1)}isZero(e,i){var r;return(((r=this.frameNumberMap.get(e))==null?void 0:r.get(i))||0)===0}}const g1={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Nq{constructor(){k(this,"_statusMap");k(this,"pendingTilesRegister",new Fq);this._statusMap={}}add(e,i,n,r){if(!this._statusMap[i]){const{frameNumber:a,viewport:{id:u}}=r;this._statusMap[i]={request:e,callback:n,key:i,frameState:r,status:g1.REQUESTED},this.pendingTilesRegister.register(u,a),e().then(l=>{this._statusMap[i].status=g1.COMPLETED;const{frameNumber:_,viewport:{id:w}}=this._statusMap[i].frameState;this.pendingTilesRegister.deregister(w,_),this._statusMap[i].callback(l,r)}).catch(l=>{this._statusMap[i].status=g1.ERROR;const{frameNumber:_,viewport:{id:w}}=this._statusMap[i].frameState;this.pendingTilesRegister.deregister(w,_),n(l)})}}update(e,i){if(this._statusMap[e]){const{frameNumber:n,viewport:{id:r}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(r,n);const{frameNumber:a,viewport:{id:u}}=i;this.pendingTilesRegister.register(u,a),this._statusMap[e].frameState=i}}find(e){return this._statusMap[e]}hasPendingTiles(e,i){return!this.pendingTilesRegister.isZero(e,i)}}class Lq extends Gy{constructor(i){super(i);k(this,"_tileManager");this._tileManager=new Nq}traversalFinished(i){return!this._tileManager.hasPendingTiles(i.viewport.id,this._frameNumber||0)}shouldRefine(i,n){return i._lodJudge=Mq(i,n),i._lodJudge==="DIG"}updateChildTiles(i,n){const r=i.header.children||[],a=i.children,u=i.tileset;for(const l of r){const _=`${l.id}-${n.viewport.id}`,w=a&&a.find(E=>E.id===_);if(w)w&&this.updateTile(w,n);else{let E=()=>this._loadTile(l.id,u);this._tileManager.find(_)?this._tileManager.update(_,n):(u.tileset.nodePages&&(E=()=>u.tileset.nodePagesTile.formTileFromNodePages(l.id)),this._tileManager.add(E,_,R=>this._onTileLoad(R,i,_),n))}}return!1}async _loadTile(i,n){const{loader:r}=n,a=n.getTileUrl(`${n.url}/nodes/${i}`),u={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await Wl(a,r,u)}_onTileLoad(i,n,r){const a=new $x(n.tileset,i,n,r);n.children.push(a);const u=this._tileManager.find(a.id).frameState;this.updateTile(a,u),this._frameNumber===u.frameNumber&&(this.traversalFinished(u)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(a,u)}}const Uq={description:"",ellipsoid:Oi.WGS84,modelMatrix:new ti,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Dg="Tiles In Tileset(s)",_1="Tiles In Memory",T2="Tiles In View",E2="Tiles To Render",S2="Tiles Loaded",y1="Tiles Loading",C2="Tiles Unloaded",I2="Failed Tile Loads",R2="Points/Vertices",v1="Tile Memory Use",P2="Maximum Screen Space Error";class zq{constructor(e,i){k(this,"options");k(this,"loadOptions");k(this,"type");k(this,"tileset");k(this,"loader");k(this,"url");k(this,"basePath");k(this,"modelMatrix");k(this,"ellipsoid");k(this,"lodMetricType");k(this,"lodMetricValue");k(this,"refine");k(this,"root",null);k(this,"roots",{});k(this,"asset",{});k(this,"description","");k(this,"properties");k(this,"extras",null);k(this,"attributions",{});k(this,"credits",{});k(this,"stats");k(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1});k(this,"cartographicCenter",null);k(this,"cartesianCenter",null);k(this,"zoom",1);k(this,"boundingVolume",null);k(this,"dynamicScreenSpaceErrorComputedDensity",0);k(this,"maximumMemoryUsage",32);k(this,"gpuMemoryUsageInBytes",0);k(this,"memoryAdjustedScreenSpaceError",0);k(this,"_cacheBytes",0);k(this,"_cacheOverflowBytes",0);k(this,"_frameNumber",0);k(this,"_queryParams",{});k(this,"_extensionsUsed",[]);k(this,"_tiles",{});k(this,"_pendingCount",0);k(this,"selectedTiles",[]);k(this,"traverseCounter",0);k(this,"geometricError",0);k(this,"lastUpdatedVieports",null);k(this,"_requestedTiles",[]);k(this,"_emptyTiles",[]);k(this,"frameStateData",{});k(this,"_traverser");k(this,"_cache",new cq);k(this,"_requestScheduler");k(this,"updatePromise",null);k(this,"tilesetInitializationPromise");this.options={...Uq,...i},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||Kb(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new WF({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new fd({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let n=e;return this.queryParams.length&&(n=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),n}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(i=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),i(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const i=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=i.length;const n=[];for(const r of i){const a=r.id;this._needTraverse(a)?n.push(a):this.traverseCounter--}for(const r of i){const a=r.id;if(this.roots[a]||(this.roots[a]=this._initializeTileHeaders(this.tileset,null)),!n.includes(a))continue;const u=hq(r,this._frameNumber);this._traverser.traverse(this.roots[a],u,this.options)}}_needTraverse(e){let i=e;return this.options.viewportTraversersMap&&(i=this.options.viewportTraversersMap[e]),i===e}_onTraversalEnd(e){const i=e.viewport.id;this.frameStateData[i]||(this.frameStateData[i]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[i],r=Object.values(this._traverser.selectedTiles),[a,u]=dq(r,e,this.options.maximumTilesSelected);n.selectedTiles=a;for(const l of u)l.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const i=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(i.selectedTiles),this._requestedTiles=this._requestedTiles.concat(i._requestedTiles),this._emptyTiles=this._emptyTiles.concat(i._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,i){if(e.length!==i.length)return!0;const n=new Set(e.map(u=>u.id)),r=new Set(i.map(u=>u.id));let a=e.filter(u=>!r.has(u.id)).length>0;return a=a||i.filter(u=>!n.has(u.id)).length>0,a}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,i)=>e._unloadTile(i))}_updateStats(){let e=0,i=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(e++,n.content.pointCount?i+=n.content.pointCount:i+=n.content.vertexCount);this.stats.get(T2).count=this.selectedTiles.length,this.stats.get(E2).count=e,this.stats.get(R2).count=i,this.stats.get(P2).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===es.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===es.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===es.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var n;const e=this.tileset.fullExtent;if(e){const{xmin:r,xmax:a,ymin:u,ymax:l,zmin:_,zmax:w}=e;this.cartographicCenter=new Ie(r+(a-r)/2,u+(l-u)/2,_+(w-_)/2),this.cartesianCenter=new Ie,Oi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=s3(e,this.cartographicCenter,this.cartesianCenter);return}const i=(n=this.tileset.store)==null?void 0:n.extent;if(i){const[r,a,u,l]=i;this.cartographicCenter=new Ie(r+(u-r)/2,a+(l-a)/2,0),this.cartesianCenter=new Ie,Oi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=_q(i,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Ie,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:i}=e.boundingVolume;if(!i){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Ie,this.zoom=1;return}i[0]!==0||i[1]!==0||i[2]!==0?(this.cartographicCenter=new Ie,Oi.WGS84.cartesianToCartographic(i,this.cartographicCenter)):this.cartographicCenter=new Ie(0,0,-Oi.WGS84.radii[0]),this.cartesianCenter=i,this.zoom=gq(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(Dg),this.stats.get(y1),this.stats.get(_1),this.stats.get(T2),this.stats.get(E2),this.stats.get(S2),this.stats.get(C2),this.stats.get(I2),this.stats.get(R2),this.stats.get(v1,"memory"),this.stats.get(P2)}_initializeTileHeaders(e,i){var r;const n=new $x(this,e.root,i);if(i&&(i.children.push(n),n.depth=i.depth+1),this.type===es.TILES3D){const a=[];for(a.push(n);a.length>0;){const u=a.pop();this.stats.get(Dg).incrementCount();const l=u.header.children||[];for(const _ of l){const w=new $x(this,_,u);if((r=w.contentUrl)!=null&&r.includes("?session=")){const I=new URL(w.contentUrl).searchParams.get("session");I&&(this._queryParams.session=I)}u.children.push(w),w.depth=u.depth+1,a.push(w)}}}return n}_initializeTraverser(){let e;switch(this.type){case es.TILES3D:e=kq;break;case es.I3S:e=Lq;break;default:e=Gy}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let i;try{this._onStartTileLoading(),i=await e.loadContent()}catch(n){this._onTileLoadError(e,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,i)}}_onTileLoadError(e,i){this.stats.get(I2).incrementCount();const n=i.message||i.toString(),r=e.url;console.error(`A 3D tile failed to load: ${e.url} ${n}`),this.options.onTileError(e,n,r)}_onTileLoad(e,i){var n,r;if(i){if(this.type===es.I3S){const a=((r=(n=this.tileset)==null?void 0:n.nodePagesTile)==null?void 0:r.nodesInNodePages)||0;this.stats.get(Dg).reset(),this.stats.get(Dg).addCount(a)}e&&e.content&&uq(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){var i;if(this.type===es.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===es.TILES3D){const{extensionsRemoved:n=[]}=((i=e.content)==null?void 0:i.gltf)||{};n.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),n.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),n.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(y1).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(y1).decrementCount()}_addTileToCache(e){this._cache.add(this,e,i=>i._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(S2).incrementCount(),this.stats.get(_1).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(v1).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(_1).decrementCount(),this.stats.get(C2).incrementCount(),this.stats.get(v1).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const i=e.pop();for(const n of i.children)e.push(n);this._destroyTile(i)}this.root=null}_destroySubtree(e){const i=e,n=[];for(n.push(i);n.length>0;){e=n.pop();for(const r of e.children)n.push(r);e!==i&&this._destroyTile(e)}i.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const i=new URLSearchParams(e.queryString),n=Object.fromEntries(i.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const h3="4.2.2",Rf={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function d3(t,e,i){Di(t instanceof ArrayBuffer);const n=new TextDecoder("utf8"),r=new Uint8Array(t,e,i);return n.decode(r)}function Vq(t,e=0){const i=new DataView(t);return`${String.fromCharCode(i.getUint8(e+0))}${String.fromCharCode(i.getUint8(e+1))}${String.fromCharCode(i.getUint8(e+2))}${String.fromCharCode(i.getUint8(e+3))}`}const jq={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},An={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},si={...jq,...An},x1={[An.DOUBLE]:Float64Array,[An.FLOAT]:Float32Array,[An.UNSIGNED_SHORT]:Uint16Array,[An.UNSIGNED_INT]:Uint32Array,[An.UNSIGNED_BYTE]:Uint8Array,[An.BYTE]:Int8Array,[An.SHORT]:Int16Array,[An.INT]:Int32Array},Hq={DOUBLE:An.DOUBLE,FLOAT:An.FLOAT,UNSIGNED_SHORT:An.UNSIGNED_SHORT,UNSIGNED_INT:An.UNSIGNED_INT,UNSIGNED_BYTE:An.UNSIGNED_BYTE,BYTE:An.BYTE,SHORT:An.SHORT,INT:An.INT},b1="Failed to convert GL type";class ea{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const i in x1)if(x1[i]===e)return i;throw new Error(b1)}static fromName(e){const i=Hq[e];if(!i)throw new Error(b1);return i}static getArrayType(e){switch(e){case An.UNSIGNED_SHORT_5_6_5:case An.UNSIGNED_SHORT_4_4_4_4:case An.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const i=x1[e];if(!i)throw new Error(b1);return i}}static getByteSize(e){return ea.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!ea.getArrayType(e)}static createTypedArray(e,i,n=0,r){r===void 0&&(r=(i.byteLength-n)/ea.getByteSize(e));const a=ea.getArrayType(e);return new a(i,n,r)}}function $q(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}function Gq(t,e=[0,0,0]){const i=t>>11&31,n=t>>5&63,r=t&31;return e[0]=i<<3,e[1]=n<<2,e[2]=r<<3,e}new cw;new Ie;new cw;new cw;function M2(t,e=255){return Ca(t,0,e)/e*2-1}function B2(t){return t<0?-1:1}function Wq(t,e,i,n){if($q(n),t<0||t>i||e<0||e>i)throw new Error(`x and y must be unsigned normalized integers between 0 and ${i}`);if(n.x=M2(t,i),n.y=M2(e,i),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const r=n.x;n.x=(1-Math.abs(n.y))*B2(r),n.y=(1-Math.abs(r))*B2(n.y)}return n.normalize()}function Xq(t,e,i){return Wq(t,e,255,i)}class Vw{constructor(e,i){k(this,"json");k(this,"buffer");k(this,"featuresLength",0);k(this,"_cachedTypedArrays",{});this.json=e,this.buffer=i}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,i=si.UNSIGNED_INT,n=1){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(e,i,n,1,r.byteOffset):r}getPropertyArray(e,i,n){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(i=ea.fromName(r.componentType)),this._getTypedArrayFromBinary(e,i,n,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(e,i,r)}getProperty(e,i,n,r,a){const u=this.json[e];if(!u)return u;const l=this.getPropertyArray(e,i,n);if(n===1)return l[r];for(let _=0;_<n;++_)a[_]=l[n*r+_];return a}_getTypedArrayFromBinary(e,i,n,r,a){const u=this._cachedTypedArrays;let l=u[e];return l||(l=ea.createTypedArray(i,this.buffer.buffer,this.buffer.byteOffset+a,r*n),u[e]=l),l}_getTypedArrayFromArray(e,i,n){const r=this._cachedTypedArrays;let a=r[e];return a||(a=ea.createTypedArray(i,n),r[e]=a),a}}const qq={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Kq={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},Zq={SCALAR:(t,e,i)=>{e[i]=t},VEC2:(t,e,i)=>{e[2*i+0]=t[0],e[2*i+1]=t[1]},VEC3:(t,e,i)=>{e[3*i+0]=t[0],e[3*i+1]=t[1],e[3*i+2]=t[2]},VEC4:(t,e,i)=>{e[4*i+0]=t[0],e[4*i+1]=t[1],e[4*i+2]=t[2],e[4*i+3]=t[3]},MAT2:(t,e,i)=>{e[4*i+0]=t[0],e[4*i+1]=t[1],e[4*i+2]=t[2],e[4*i+3]=t[3]},MAT3:(t,e,i)=>{e[9*i+0]=t[0],e[9*i+1]=t[1],e[9*i+2]=t[2],e[9*i+3]=t[3],e[9*i+4]=t[4],e[9*i+5]=t[5],e[9*i+6]=t[6],e[9*i+7]=t[7],e[9*i+8]=t[8],e[9*i+9]=t[9]},MAT4:(t,e,i)=>{e[16*i+0]=t[0],e[16*i+1]=t[1],e[16*i+2]=t[2],e[16*i+3]=t[3],e[16*i+4]=t[4],e[16*i+5]=t[5],e[16*i+6]=t[6],e[16*i+7]=t[7],e[16*i+8]=t[8],e[16*i+9]=t[9],e[16*i+10]=t[10],e[16*i+11]=t[11],e[16*i+12]=t[12],e[16*i+13]=t[13],e[16*i+14]=t[14],e[16*i+15]=t[15]}};function Yq(t,e,i,n){const{componentType:r}=t;Di(t.componentType);const a=typeof r=="string"?ea.fromName(r):r,u=qq[t.type],l=Kq[t.type],_=Zq[t.type];return i+=t.byteOffset,{values:ea.createTypedArray(a,e,i,u*n),type:a,size:u,unpacker:l,packer:_}}const Zo=t=>t!==void 0;function Jq(t,e,i){if(!e)return null;let n=t.getExtension("3DTILES_batch_table_hierarchy");const r=e.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=r,n=r),n?Qq(n,i):null}function Qq(t,e){let i,n,r;const a=t.instancesLength,u=t.classes;let l=t.classIds,_=t.parentCounts,w=t.parentIds,E=a;Zo(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,a));let I;if(Zo(_))for(Zo(_.byteOffset)&&(_.componentType=defaultValue(_.componentType,GL.UNSIGNED_SHORT),_.type=AttributeType.SCALAR,r=getBinaryAccessor(_),_=r.createArrayBufferView(e.buffer,e.byteOffset+_.byteOffset,a)),I=new Uint16Array(a),E=0,i=0;i<a;++i)I[i]=E,E+=_[i];Zo(w)&&Zo(w.byteOffset)&&(w.componentType=defaultValue(w.componentType,GL.UNSIGNED_SHORT),w.type=AttributeType.SCALAR,r=getBinaryAccessor(w),w=r.createArrayBufferView(e.buffer,e.byteOffset+w.byteOffset,E));const R=u.length;for(i=0;i<R;++i){const fe=u[i].length,X=u[i].instances,$=getBinaryProperties(fe,X,e);u[i].instances=combine($,X)}const L=new Array(R).fill(0),W=new Uint16Array(a);for(i=0;i<a;++i)n=l[i],W[i]=L[n],++L[n];const K={classes:u,classIds:l,classIndexes:W,parentCounts:_,parentIndexes:I,parentIds:w};return iK(K),K}function Pf(t,e,i){if(!t)return;const n=t.parentCounts;return t.parentIds?i(t,e):n>0?eK(t,e,i):tK(t,e,i)}function eK(t,e,i){const n=t.classIds,r=t.parentCounts,a=t.parentIds,u=t.parentIndexes,l=n.length,_=scratchVisited;_.length=Math.max(_.length,l);const w=++marker,E=scratchStack;for(E.length=0,E.push(e);E.length>0;){if(e=E.pop(),_[e]===w)continue;_[e]=w;const I=i(t,e);if(Zo(I))return I;const R=r[e],L=u[e];for(let W=0;W<R;++W){const K=a[L+W];K!==e&&E.push(K)}}return null}function tK(t,e,i){let n=!0;for(;n;){const r=i(t,e);if(Zo(r))return r;const a=t.parentIds[e];n=a!==e,e=a}throw new Error("traverseHierarchySingleParent")}function iK(t){const i=t.classIds.length;for(let n=0;n<i;++n)f3(t,n,stack)}function f3(t,e,i){const n=t.parentCounts,r=t.parentIds,a=t.parentIndexes,l=t.classIds.length;if(!Zo(r))return;assert(e<l,`Parent index ${e} exceeds the total number of instances: ${l}`),assert(i.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),i.push(e);const _=Zo(n)?n[e]:1,w=Zo(n)?a[e]:e;for(let E=0;E<_;++E){const I=r[w+E];I!==e&&f3(t,I,i)}i.pop(e)}function Qr(t){return t!=null}const Og=(t,e)=>t,nK={HIERARCHY:!0,extensions:!0,extras:!0};class p3{constructor(e,i,n,r={}){k(this,"json");k(this,"binary");k(this,"featureCount");k(this,"_extensions");k(this,"_properties");k(this,"_binaryProperties");k(this,"_hierarchy");var a;Di(n>=0),this.json=e||{},this.binary=i,this.featureCount=n,this._extensions=((a=this.json)==null?void 0:a.extensions)||{},this._properties={};for(const u in this.json)nK[u]||(this._properties[u]=this.json[u]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Jq(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,i){if(this._checkBatchId(e),Di(typeof i=="string",i),this._hierarchy){const n=Pf(this._hierarchy,e,(r,a)=>{const u=r.classIds[a];return r.classes[u].name===i});return Qr(n)}return!1}isExactClass(e,i){return Di(typeof i=="string",i),this.getExactClassName(e)===i}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const i=this._hierarchy.classIds[e];return this._hierarchy.classes[i].name}}hasProperty(e,i){return this._checkBatchId(e),Di(typeof i=="string",i),Qr(this._properties[i])||this._hasPropertyInHierarchy(e,i)}getPropertyNames(e,i){this._checkBatchId(e),i=Qr(i)?i:[],i.length=0;const n=Object.keys(this._properties);return i.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(e,i),i}getProperty(e,i){if(this._checkBatchId(e),Di(typeof i=="string",i),this._binaryProperties){const r=this._binaryProperties[i];if(Qr(r))return this._getBinaryProperty(r,e)}const n=this._properties[i];if(Qr(n))return Og(n[e]);if(this._hierarchy){const r=this._getHierarchyProperty(e,i);if(Qr(r))return r}}setProperty(e,i,n){const r=this.featureCount;if(this._checkBatchId(e),Di(typeof i=="string",i),this._binaryProperties){const u=this._binaryProperties[i];if(u){this._setBinaryProperty(u,e,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,i,n))return;let a=this._properties[i];Qr(a)||(this._properties[i]=new Array(r),a=this._properties[i]),a[e]=Og(n)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,i){return e.unpack(e.typedArray,i)}_setBinaryProperty(e,i,n){e.pack(n,e.typedArray,i)}_initializeBinaryProperties(){let e=null;for(const i in this._properties){const n=this._properties[i],r=this._initializeBinaryProperty(i,n);r&&(e=e||{},e[i]=r)}return e}_initializeBinaryProperty(e,i){if("byteOffset"in i){const n=i;Di(this.binary,`Property ${e} requires a batch table binary.`),Di(n.type,`Property ${e} requires a type.`);const r=Yq(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(e,i){if(!this._hierarchy)return!1;const n=Pf(this._hierarchy,e,(r,a)=>{const u=r.classIds[a],l=r.classes[u].instances;return Qr(l[i])});return Qr(n)}_getPropertyNamesInHierarchy(e,i){Pf(this._hierarchy,e,(n,r)=>{const a=n.classIds[r],u=n.classes[a].instances;for(const l in u)u.hasOwnProperty(l)&&i.indexOf(l)===-1&&i.push(l)})}_getHierarchyProperty(e,i){return Pf(this._hierarchy,e,(n,r)=>{const a=n.classIds[r],u=n.classes[a],l=n.classIndexes[r],_=u.instances[i];return Qr(_)?Qr(_.typedArray)?this._getBinaryProperty(_,l):Og(_[l]):null})}_setHierarchyProperty(e,i,n,r){const a=Pf(this._hierarchy,i,(u,l)=>{const _=u.classIds[l],w=u.classes[_],E=u.classIndexes[l],I=w.instances[n];return Qr(I)?(Di(l===i,`Inherited property "${n}" is read-only.`),Qr(I.typedArray)?this._setBinaryProperty(I,E,r):I[E]=Og(r),!0):!1});return Qr(a)}}const w1=4;function Wy(t,e,i=0){const n=new DataView(e);if(t.magic=n.getUint32(i,!0),i+=w1,t.version=n.getUint32(i,!0),i+=w1,t.byteLength=n.getUint32(i,!0),i+=w1,t.version!==1)throw new Error(`3D Tile Version ${t.version} not supported`);return i}const uh=4,D2="b3dm tile in legacy format.";function jw(t,e,i){const n=new DataView(e);let r;t.header=t.header||{};let a=n.getUint32(i,!0);i+=uh;let u=n.getUint32(i,!0);i+=uh;let l=n.getUint32(i,!0);i+=uh;let _=n.getUint32(i,!0);return i+=uh,l>=570425344?(i-=uh*2,r=a,l=u,_=0,a=0,u=0,console.warn(D2)):_>=570425344&&(i-=uh,r=l,l=a,_=u,a=0,u=0,console.warn(D2)),t.header.featureTableJsonByteLength=a,t.header.featureTableBinaryByteLength=u,t.header.batchTableJsonByteLength=l,t.header.batchTableBinaryByteLength=_,t.header.batchLength=r,i}function Hw(t,e,i,n){return i=rK(t,e,i),i=sK(t,e,i),i}function rK(t,e,i,n){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:a,batchLength:u}=t.header||{};if(t.featureTableJson={BATCH_LENGTH:u||0},r&&r>0){const l=d3(e,i,r);t.featureTableJson=JSON.parse(l)}return i+=r||0,t.featureTableBinary=new Uint8Array(e,i,a),i+=a||0,i}function sK(t,e,i,n){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:a}=t.header||{};if(r&&r>0){const u=d3(e,i,r);t.batchTableJson=JSON.parse(u),i+=r,a&&a>0&&(t.batchTableBinary=new Uint8Array(e,i,a),t.batchTableBinary=new Uint8Array(t.batchTableBinary),i+=a)}return i}function m3(t,e,i){if(!e&&(!t||!t.batchIds||!i))return null;const{batchIds:n,isRGB565:r,pointCount:a=0}=t;if(n&&i){const u=new Uint8ClampedArray(a*3);for(let l=0;l<a;l++){const _=n[l],E=i.getProperty(_,"dimensions").map(I=>I*255);u[l*3]=E[0],u[l*3+1]=E[1],u[l*3+2]=E[2]}return{type:si.UNSIGNED_BYTE,value:u,size:3,normalized:!0}}if(e&&r){const u=new Uint8ClampedArray(a*3);for(let l=0;l<a;l++){const _=Gq(e[l]);u[l*3]=_[0],u[l*3+1]=_[1],u[l*3+2]=_[2]}return{type:si.UNSIGNED_BYTE,value:u,size:3,normalized:!0}}return e&&e.length===a*3?{type:si.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:si.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const O2=new Ie;function oK(t,e){if(!e)return null;if(t.isOctEncoded16P){const i=new Float32Array((t.pointsLength||0)*3);for(let n=0;n<(t.pointsLength||0);n++)Xq(e[n*2],e[n*2+1],O2),O2.toArray(i,n*3);return{type:si.FLOAT,size:2,value:i}}return{type:si.FLOAT,size:2,value:e}}function aK(t,e,i){return t.isQuantized?i["3d-tiles"]&&i["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,lK(t,e)):{type:si.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function lK(t,e){const i=new Ie,n=new Float32Array(t.pointCount*3);for(let r=0;r<t.pointCount;r++)i.set(e[r*3],e[r*3+1],e[r*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(n,r*3);return n}async function cK(t,e,i,n,r){i=Wy(t,e,i),i=jw(t,e,i),i=Hw(t,e,i),uK(t);const{featureTable:a,batchTable:u}=hK(t);return await gK(t,a,u,n,r),dK(t,a,n),fK(t,a,u),pK(t,a),i}function uK(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function hK(t){const e=new Vw(t.featureTableJson,t.featureTableBinary),i=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(i))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=i,t.featuresLength=i,t.pointsLength=i,t.pointCount=i,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",si.FLOAT,3);const n=mK(t,e);return{featureTable:e,batchTable:n}}function dK(t,e,i){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",si.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const n=e.getPropertyArray("POSITION_QUANTIZED",si.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",si.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",si.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=aK(t,n,i)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function fK(t,e,i){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.colors){let n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",si.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",si.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",si.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=m3(t,n,i)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",si.UNSIGNED_BYTE,4))}function pK(t,e){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.normals){let i=null;e.hasProperty("NORMAL")?i=e.getPropertyArray("NORMAL",si.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(i=e.getPropertyArray("NORMAL_OCT16P",si.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=oK(t,i)}}function mK(t,e){let i=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",si.UNSIGNED_SHORT,1),t.batchIds)){const n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:a}=t;i=new p3(r,a,n)}return i}async function gK(t,e,i,n,r){let a,u,l;const _=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];_&&(l=_.properties);const w=e.getExtension("3DTILES_draco_point_compression");if(w){u=w.properties;const I=w.byteOffset,R=w.byteLength;if(!u||!Number.isFinite(I)||!R)throw new Error("Draco properties, byteOffset, and byteLength must be defined");a=(t.featureTableBinary||[]).slice(I,I+R),t.hasPositions=Number.isFinite(u.POSITION),t.hasColors=Number.isFinite(u.RGB)||Number.isFinite(u.RGBA),t.hasNormals=Number.isFinite(u.NORMAL),t.hasBatchIds=Number.isFinite(u.BATCH_ID),t.isTranslucent=Number.isFinite(u.RGBA)}if(!a)return!0;const E={buffer:a,properties:{...u,...l},featureTableProperties:u,batchTableProperties:l,dequantizeInShader:!1};return await _K(t,E,n,r)}async function _K(t,e,i,n){if(!n)return;const r={...i,draco:{...i==null?void 0:i.draco,extraAttributes:e.batchTableProperties||{}}};delete r["3d-tiles"];const a=await jp(e.buffer,QM,r,n),u=a.attributes.POSITION&&a.attributes.POSITION.value,l=a.attributes.COLOR_0&&a.attributes.COLOR_0.value,_=a.attributes.NORMAL&&a.attributes.NORMAL.value,w=a.attributes.BATCH_ID&&a.attributes.BATCH_ID.value,E=u&&a.attributes.POSITION.value.quantization,I=_&&a.attributes.NORMAL.value.quantization;if(E){const L=a.POSITION.data.quantization,W=L.range;t.quantizedVolumeScale=new Ie(W,W,W),t.quantizedVolumeOffset=new Ie(L.minValues),t.quantizedRange=(1<<L.quantizationBits)-1,t.isQuantizedDraco=!0}I&&(t.octEncodedRange=(1<<a.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const R={};if(e.batchTableProperties)for(const L of Object.keys(e.batchTableProperties))a.attributes[L]&&a.attributes[L].value&&(R[L.toLowerCase()]=a.attributes[L].value);t.attributes={positions:u,colors:m3(t,l,void 0),normals:_,batchIds:w,...R}}const Gx={URI:0,EMBEDDED:1};function g3(t,e,i,n){t.rotateYtoZ=!0;const r=(t.byteOffset||0)+(t.byteLength||0)-i;if(r===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=n!=null&&n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=qb(e,i,r),t.gltfByteOffset=0,t.gltfByteLength=r,i%4===0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function _3(t,e,i,n){const r=(i==null?void 0:i["3d-tiles"])||{};if(yK(t,e),r.loadGLTF){if(!n)return;if(t.gltfUrl){const{fetch:a}=n,u=await a(t.gltfUrl,i);t.gltfArrayBuffer=await u.arrayBuffer(),t.gltfByteOffset=0}if(t.gltfArrayBuffer){const a=await jp(t.gltfArrayBuffer,Ap,i,n);t.gltf=Uw(a),t.gpuMemoryUsageInBytes=jM(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength}}}function yK(t,e,i){switch(e){case Gx.URI:if(t.gltfArrayBuffer){const n=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),a=new TextDecoder().decode(n);t.gltfUrl=a.replace(/[\s\0]+$/,"")}delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case Gx.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function vK(t,e,i,n,r){var u;i=xK(t,e,i,n),await _3(t,Gx.EMBEDDED,n,r);const a=(u=t==null?void 0:t.gltf)==null?void 0:u.extensions;return a&&a.CESIUM_RTC&&(t.rtcCenter=a.CESIUM_RTC.center),i}function xK(t,e,i,n,r){i=Wy(t,e,i),i=jw(t,e,i),i=Hw(t,e,i),i=g3(t,e,i,n);const a=new Vw(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=a.getGlobalProperty("RTC_CENTER",si.FLOAT,3),i}async function bK(t,e,i,n,r){return i=wK(t,e,i,n),await _3(t,t.gltfFormat||0,n,r),i}function wK(t,e,i,n,r){var w;if(i=Wy(t,e,i),t.version!==1)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);i=jw(t,e,i);const a=new DataView(e);if(t.gltfFormat=a.getUint32(i,!0),i+=4,i=Hw(t,e,i),i=g3(t,e,i,n),!((w=t==null?void 0:t.header)!=null&&w.featureTableJsonByteLength)||t.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const u=new Vw(t.featureTableJson,t.featureTableBinary),l=u.getGlobalProperty("INSTANCES_LENGTH");if(u.featuresLength=l,!Number.isFinite(l))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=u.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=u.getGlobalProperty("RTC_CENTER",si.FLOAT,3);const _=new p3(t.batchTableJson,t.batchTableBinary,l);return AK(t,u,_,l),i}function AK(t,e,i,n){const r=new Array(n),a=new Ie;new Ie,new Ie,new Ie;const u=new hn,l=new gp,_=new Ie,w={},E=new ti,I=[],R=[],L=[],W=[];for(let K=0;K<n;K++){let fe;if(e.hasProperty("POSITION"))fe=e.getProperty("POSITION",si.FLOAT,3,K,a);else if(e.hasProperty("POSITION_QUANTIZED")){fe=e.getProperty("POSITION_QUANTIZED",si.UNSIGNED_SHORT,3,K,a);const Be=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",si.FLOAT,3);if(!Be)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Fe=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",si.FLOAT,3);if(!Fe)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const ze=65535;for(let Ve=0;Ve<3;Ve++)fe[Ve]=fe[Ve]/ze*Fe[Ve]+Be[Ve]}if(!fe)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(a.copy(fe),w.translation=a,t.normalUp=e.getProperty("NORMAL_UP",si.FLOAT,3,K,I),t.normalRight=e.getProperty("NORMAL_RIGHT",si.FLOAT,3,K,R),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",si.UNSIGNED_SHORT,2,K,I),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",si.UNSIGNED_SHORT,2,K,R),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(Oi.WGS84.eastNorthUpToFixedFrame(a,E),E.getRotationMatrix3(u)):u.identity()}l.fromMatrix3(u),w.rotation=l,_.set(1,1,1);const X=e.getProperty("SCALE",si.FLOAT,1,K,L);Number.isFinite(X)&&_.multiplyByScalar(X);const $=e.getProperty("SCALE_NON_UNIFORM",si.FLOAT,3,K,I);$&&_.scale($),w.scale=_;let Q=e.getProperty("BATCH_ID",si.UNSIGNED_SHORT,1,K,W);Q===void 0&&(Q=K);const me=new ti().fromQuaternion(w.rotation);E.identity(),E.translate(w.translation),E.multiplyRight(me),E.scale(w.scale);const Ce=E.clone();r[K]={modelMatrix:Ce,batchId:Q}}t.instances=r}async function TK(t,e,i,n,r,a){i=Wy(t,e,i);const u=new DataView(e);for(t.tilesLength=u.getUint32(i,!0),i+=4,t.tiles=[];t.tiles.length<t.tilesLength&&(t.byteLength||0)-i>12;){const l={shape:"tile3d"};t.tiles.push(l),i=await a(e,i,n,r,l)}return i}async function EK(t,e,i,n){var r,a;if(t.rotateYtoZ=!0,t.gltfUpAxis=(r=i==null?void 0:i["3d-tiles"])!=null&&r.assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",(a=i==null?void 0:i["3d-tiles"])!=null&&a.loadGLTF){if(!n)return e.byteLength;const u=await jp(e,Ap,i,n);t.gltf=Uw(u),t.gpuMemoryUsageInBytes=jM(t.gltf)}else t.gltfArrayBuffer=e;return e.byteLength}async function y3(t,e=0,i,n,r={shape:"tile3d"}){switch(r.byteOffset=e,r.type=Vq(t,e),r.type){case Rf.COMPOSITE:return await TK(r,t,e,i,n,y3);case Rf.BATCHED_3D_MODEL:return await vK(r,t,e,i,n);case Rf.GLTF:return await EK(r,t,i,n);case Rf.INSTANCED_3D_MODEL:return await bK(r,t,e,i,n);case Rf.POINT_CLOUD:return await cK(r,t,e,i,n);default:throw new Error(`3DTileLoader: unknown type ${r.type}`)}}const SK=1952609651,CK=1;async function IK(t,e,i){if(new Uint32Array(t.slice(0,4))[0]!==SK)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==CK)throw new Error("Wrong subtree file verson, must be 1");const a=k2(t.slice(8,16)),u=new Uint8Array(t,24,a),_=new TextDecoder("utf8").decode(u),w=JSON.parse(_),E=k2(t.slice(16,24));let I=new ArrayBuffer(0);if(E&&(I=t.slice(24+a)),await kg(w,w.tileAvailability,I,i),Array.isArray(w.contentAvailability))for(const R of w.contentAvailability)await kg(w,R,I,i);else await kg(w,w.contentAvailability,I,i);return await kg(w,w.childSubtreeAvailability,I,i),w}async function kg(t,e,i,n){const r=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof r!="number")return;const a=t.bufferViews[r],u=t.buffers[a.buffer];if(!(n!=null&&n.baseUrl))throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(u.uri){const _=`${(n==null?void 0:n.baseUrl)||""}/${u.uri}`,E=await(await n.fetch(_)).arrayBuffer();e.explicitBitstream=new Uint8Array(E,a.byteOffset,a.byteLength);return}const l=t.buffers.slice(0,a.buffer).reduce((_,w)=>_+w.byteLength,0);e.explicitBitstream=new Uint8Array(i.slice(l,l+u.byteLength),a.byteOffset,a.byteLength)}function k2(t){const e=new DataView(t),i=e.getUint32(0,!0),n=e.getUint32(4,!0);return i+2**32*n}const v3={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:h3,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:IK,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var qs=null;try{qs=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function bi(t,e,i){this.low=t|0,this.high=e|0,this.unsigned=!!i}bi.prototype.__isLong__;Object.defineProperty(bi.prototype,"__isLong__",{value:!0});function Rr(t){return(t&&t.__isLong__)===!0}function F2(t){var e=Math.clz32(t&-t);return t?31-e:e}bi.isLong=Rr;var N2={},L2={};function lu(t,e){var i,n,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(n=L2[t],n)?n:(i=li(t,0,!0),r&&(L2[t]=i),i)):(t|=0,(r=-128<=t&&t<128)&&(n=N2[t],n)?n:(i=li(t,t<0?-1:0,!1),r&&(N2[t]=i),i))}bi.fromInt=lu;function Ks(t,e){if(isNaN(t))return e?Ra:vo;if(e){if(t<0)return Ra;if(t>=x3)return A3}else{if(t<=-z2)return ns;if(t+1>=z2)return w3}return t<0?Ks(-t,e).neg():li(t%nd|0,t/nd|0,e)}bi.fromNumber=Ks;function li(t,e,i){return new bi(t,e,i)}bi.fromBits=li;var $_=Math.pow;function $w(t,e,i){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(i=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?Ra:vo;if(i=i||10,i<2||36<i)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return $w(t.substring(1),e,i).neg();for(var r=Ks($_(i,8)),a=vo,u=0;u<t.length;u+=8){var l=Math.min(8,t.length-u),_=parseInt(t.substring(u,u+l),i);if(l<8){var w=Ks($_(i,l));a=a.mul(w).add(Ks(_))}else a=a.mul(r),a=a.add(Ks(_))}return a.unsigned=e,a}bi.fromString=$w;function Co(t,e){return typeof t=="number"?Ks(t,e):typeof t=="string"?$w(t,e):li(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}bi.fromValue=Co;var U2=65536,RK=1<<24,nd=U2*U2,x3=nd*nd,z2=x3/2,V2=lu(RK),vo=lu(0);bi.ZERO=vo;var Ra=lu(0,!0);bi.UZERO=Ra;var bh=lu(1);bi.ONE=bh;var b3=lu(1,!0);bi.UONE=b3;var Wx=lu(-1);bi.NEG_ONE=Wx;var w3=li(-1,2147483647,!1);bi.MAX_VALUE=w3;var A3=li(-1,-1,!0);bi.MAX_UNSIGNED_VALUE=A3;var ns=li(0,-2147483648,!1);bi.MIN_VALUE=ns;var Je=bi.prototype;Je.toInt=function(){return this.unsigned?this.low>>>0:this.low};Je.toNumber=function(){return this.unsigned?(this.high>>>0)*nd+(this.low>>>0):this.high*nd+(this.low>>>0)};Je.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ns)){var i=Ks(e),n=this.div(i),r=n.mul(i).sub(this);return n.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var a=Ks($_(e,6),this.unsigned),u=this,l="";;){var _=u.div(a),w=u.sub(_.mul(a)).toInt()>>>0,E=w.toString(e);if(u=_,u.isZero())return E+l;for(;E.length<6;)E="0"+E;l=""+E+l}};Je.getHighBits=function(){return this.high};Je.getHighBitsUnsigned=function(){return this.high>>>0};Je.getLowBits=function(){return this.low};Je.getLowBitsUnsigned=function(){return this.low>>>0};Je.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ns)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,i=31;i>0&&!(e&1<<i);i--);return this.high!=0?i+33:i+1};Je.isZero=function(){return this.high===0&&this.low===0};Je.eqz=Je.isZero;Je.isNegative=function(){return!this.unsigned&&this.high<0};Je.isPositive=function(){return this.unsigned||this.high>=0};Je.isOdd=function(){return(this.low&1)===1};Je.isEven=function(){return(this.low&1)===0};Je.equals=function(e){return Rr(e)||(e=Co(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Je.eq=Je.equals;Je.notEquals=function(e){return!this.eq(e)};Je.neq=Je.notEquals;Je.ne=Je.notEquals;Je.lessThan=function(e){return this.comp(e)<0};Je.lt=Je.lessThan;Je.lessThanOrEqual=function(e){return this.comp(e)<=0};Je.lte=Je.lessThanOrEqual;Je.le=Je.lessThanOrEqual;Je.greaterThan=function(e){return this.comp(e)>0};Je.gt=Je.greaterThan;Je.greaterThanOrEqual=function(e){return this.comp(e)>=0};Je.gte=Je.greaterThanOrEqual;Je.ge=Je.greaterThanOrEqual;Je.compare=function(e){if(Rr(e)||(e=Co(e)),this.eq(e))return 0;var i=this.isNegative(),n=e.isNegative();return i&&!n?-1:!i&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Je.comp=Je.compare;Je.negate=function(){return!this.unsigned&&this.eq(ns)?ns:this.not().add(bh)};Je.neg=Je.negate;Je.add=function(e){Rr(e)||(e=Co(e));var i=this.high>>>16,n=this.high&65535,r=this.low>>>16,a=this.low&65535,u=e.high>>>16,l=e.high&65535,_=e.low>>>16,w=e.low&65535,E=0,I=0,R=0,L=0;return L+=a+w,R+=L>>>16,L&=65535,R+=r+_,I+=R>>>16,R&=65535,I+=n+l,E+=I>>>16,I&=65535,E+=i+u,E&=65535,li(R<<16|L,E<<16|I,this.unsigned)};Je.subtract=function(e){return Rr(e)||(e=Co(e)),this.add(e.neg())};Je.sub=Je.subtract;Je.multiply=function(e){if(this.isZero())return this;if(Rr(e)||(e=Co(e)),qs){var i=qs.mul(this.low,this.high,e.low,e.high);return li(i,qs.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Ra:vo;if(this.eq(ns))return e.isOdd()?ns:vo;if(e.eq(ns))return this.isOdd()?ns:vo;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(V2)&&e.lt(V2))return Ks(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,r=this.high&65535,a=this.low>>>16,u=this.low&65535,l=e.high>>>16,_=e.high&65535,w=e.low>>>16,E=e.low&65535,I=0,R=0,L=0,W=0;return W+=u*E,L+=W>>>16,W&=65535,L+=a*E,R+=L>>>16,L&=65535,L+=u*w,R+=L>>>16,L&=65535,R+=r*E,I+=R>>>16,R&=65535,R+=a*w,I+=R>>>16,R&=65535,R+=u*_,I+=R>>>16,R&=65535,I+=n*E+r*w+a*_+u*l,I&=65535,li(L<<16|W,I<<16|R,this.unsigned)};Je.mul=Je.multiply;Je.divide=function(e){if(Rr(e)||(e=Co(e)),e.isZero())throw Error("division by zero");if(qs){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var i=(this.unsigned?qs.div_u:qs.div_s)(this.low,this.high,e.low,e.high);return li(i,qs.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ra:vo;var n,r,a;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ra;if(e.gt(this.shru(1)))return b3;a=Ra}else{if(this.eq(ns)){if(e.eq(bh)||e.eq(Wx))return ns;if(e.eq(ns))return bh;var u=this.shr(1);return n=u.div(e).shl(1),n.eq(vo)?e.isNegative()?bh:Wx:(r=this.sub(e.mul(n)),a=n.add(r.div(e)),a)}else if(e.eq(ns))return this.unsigned?Ra:vo;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();a=vo}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var l=Math.ceil(Math.log(n)/Math.LN2),_=l<=48?1:$_(2,l-48),w=Ks(n),E=w.mul(e);E.isNegative()||E.gt(r);)n-=_,w=Ks(n,this.unsigned),E=w.mul(e);w.isZero()&&(w=bh),a=a.add(w),r=r.sub(E)}return a};Je.div=Je.divide;Je.modulo=function(e){if(Rr(e)||(e=Co(e)),qs){var i=(this.unsigned?qs.rem_u:qs.rem_s)(this.low,this.high,e.low,e.high);return li(i,qs.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Je.mod=Je.modulo;Je.rem=Je.modulo;Je.not=function(){return li(~this.low,~this.high,this.unsigned)};Je.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};Je.clz=Je.countLeadingZeros;Je.countTrailingZeros=function(){return this.low?F2(this.low):F2(this.high)+32};Je.ctz=Je.countTrailingZeros;Je.and=function(e){return Rr(e)||(e=Co(e)),li(this.low&e.low,this.high&e.high,this.unsigned)};Je.or=function(e){return Rr(e)||(e=Co(e)),li(this.low|e.low,this.high|e.high,this.unsigned)};Je.xor=function(e){return Rr(e)||(e=Co(e)),li(this.low^e.low,this.high^e.high,this.unsigned)};Je.shiftLeft=function(e){return Rr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?li(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):li(0,this.low<<e-32,this.unsigned)};Je.shl=Je.shiftLeft;Je.shiftRight=function(e){return Rr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?li(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):li(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Je.shr=Je.shiftRight;Je.shiftRightUnsigned=function(e){return Rr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?li(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?li(this.high,0,this.unsigned):li(this.high>>>e-32,0,this.unsigned)};Je.shru=Je.shiftRightUnsigned;Je.shr_u=Je.shiftRightUnsigned;Je.rotateLeft=function(e){var i;return Rr(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?li(this.high,this.low,this.unsigned):e<32?(i=32-e,li(this.low<<e|this.high>>>i,this.high<<e|this.low>>>i,this.unsigned)):(e-=32,i=32-e,li(this.high<<e|this.low>>>i,this.low<<e|this.high>>>i,this.unsigned))};Je.rotl=Je.rotateLeft;Je.rotateRight=function(e){var i;return Rr(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?li(this.high,this.low,this.unsigned):e<32?(i=32-e,li(this.high<<i|this.low>>>e,this.low<<i|this.high>>>e,this.unsigned)):(e-=32,i=32-e,li(this.low<<i|this.high>>>e,this.high<<i|this.low>>>e,this.unsigned))};Je.rotr=Je.rotateRight;Je.toSigned=function(){return this.unsigned?li(this.low,this.high,!1):this};Je.toUnsigned=function(){return this.unsigned?this:li(this.low,this.high,!0)};Je.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Je.toBytesLE=function(){var e=this.high,i=this.low;return[i&255,i>>>8&255,i>>>16&255,i>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Je.toBytesBE=function(){var e=this.high,i=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,i>>>24,i>>>16&255,i>>>8&255,i&255]};bi.fromBytes=function(e,i,n){return n?bi.fromBytesLE(e,i):bi.fromBytesBE(e,i)};bi.fromBytesLE=function(e,i){return new bi(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,i)};bi.fromBytesBE=function(e,i){return new bi(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],i)};const PK=16;function T3(t){t==="X"&&(t="");const e=t.padEnd(PK,"0");return bi.fromString(e,!0,16)}function MK(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const i=e%4;e=(e-i)/4;const n=e;e*=4;const a=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-n-a.length).join("0")+a}function BK(t,e){const i=DK(t).shiftRightUnsigned(2);return t.add(bi.fromNumber(2*e+1-4).multiply(i))}function DK(t){return t.and(t.not().add(1))}const OK=3,kK=30,FK=2*kK+1,j2=180/Math.PI;function NK(t){if(t.length===0)throw new Error(`Invalid Hilbert quad key ${t}`);const e=t.split("/"),i=parseInt(e[0],10),n=e[1],r=n.length;let a=0;const u=[0,0];for(let l=r-1;l>=0;l--){a=r-l;const _=n[l];let w=0,E=0;_==="1"?E=1:_==="2"?(w=1,E=1):_==="3"&&(w=1);const I=Math.pow(2,a-1);UK(I,u,w,E),u[0]+=I*w,u[1]+=I*E}if(i%2===1){const l=u[0];u[0]=u[1],u[1]=l}return{face:i,ij:u,level:a}}function LK(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<OK+FK;)e="0"+e;const i=e.lastIndexOf("1"),n=e.substring(0,3),r=e.substring(3,i),a=r.length/2,u=bi.fromString(n,!0,2).toString(10);let l="";if(a!==0)for(l=bi.fromString(r,!0,2).toString(4);l.length<a;)l="0"+l;return`${u}/${l}`}function E3(t,e,i){const n=1<<e;return[(t[0]+i[0])/n,(t[1]+i[1])/n]}function H2(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function S3(t){return[H2(t[0]),H2(t[1])]}function C3(t,[e,i]){switch(t){case 0:return[1,e,i];case 1:return[-e,1,i];case 2:return[-e,-i,1];case 3:return[-1,-i,-e];case 4:return[i,-1,-e];case 5:return[i,e,-1];default:throw new Error("Invalid face")}}function I3([t,e,i]){const n=Math.atan2(i,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*j2,n*j2]}function UK(t,e,i,n){if(n===0){i===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}function zK(t){const e=E3(t.ij,t.level,[.5,.5]),i=S3(e),n=C3(t.face,i);return I3(n)}const VK=100;function $2(t){const{face:e,ij:i,level:n}=t,r=[[0,0],[0,1],[1,1],[1,0],[0,0]],a=Math.max(1,Math.ceil(VK*Math.pow(2,-n))),u=new Float64Array(4*a*2+2);let l=0,_=0;for(let w=0;w<4;w++){const E=r[w].slice(0),I=r[w+1],R=(I[0]-E[0])/a,L=(I[1]-E[1])/a;for(let W=0;W<a;W++){E[0]+=R,E[1]+=L;const K=E3(i,n,E),fe=S3(K),X=C3(e,fe),$=I3(X);Math.abs($[1])>89.999&&($[0]=_);const Q=$[0]-_;$[0]+=Q>180?-360:Q<-180?360:0,u[l++]=$[0],u[l++]=$[1],_=$[0]}}return u[l++]=u[0],u[l++]=u[1],u}function Gw(t){const e=jK(t);return NK(e)}function jK(t){if(t.indexOf("/")>0)return t;const e=T3(t);return LK(e)}function HK(t){const e=Gw(t);return zK(e)}function $K(t){let e;if(t.face===2||t.face===5){let i=null,n=0;for(let r=0;r<4;r++){const a=`${t.face}/${r}`,u=Gw(a),l=$2(u);(typeof i>"u"||i===null)&&(i=new Float64Array(4*l.length)),i.set(l,n),n+=l.length}e=G2(i)}else{const i=$2(t);e=G2(i)}return e}function G2(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],i=[];for(let n=0;n<t.length;n+=2)e.push(t[n]),i.push(t[n+1]);return e.sort((n,r)=>n-r),i.sort((n,r)=>n-r),{west:e[0],east:e[e.length-1],north:i[i.length-1],south:i[0]}}function GK(t,e){const i=(e==null?void 0:e.minimumHeight)||0,n=(e==null?void 0:e.maximumHeight)||0,r=Gw(t),a=$K(r),u=a.west,l=a.south,_=a.east,w=a.north,E=[];return E.push(new Ie(u,w,i)),E.push(new Ie(_,w,i)),E.push(new Ie(_,l,i)),E.push(new Ie(u,l,i)),E.push(new Ie(u,w,n)),E.push(new Ie(_,w,n)),E.push(new Ie(_,l,n)),E.push(new Ie(u,l,n)),E}function R3(t){const e=t.token,i={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},n=GK(e,i),r=HK(e),a=r[0],u=r[1],l=Oi.WGS84.cartographicToCartesian([a,u,i.maximumHeight]),_=new Ie(l[0],l[1],l[2]);n.push(_);const w=eG(n);return[...w.center,...w.halfAxes]}const WK=4,XK=8,qK={QUADTREE:WK,OCTREE:XK};function KK(t,e,i){if(t!=null&&t.box){const n=T3(t.s2VolumeInfo.token),r=BK(n,e),a=MK(r),u={...t.s2VolumeInfo};switch(u.token=a,i){case"OCTREE":const w=t.s2VolumeInfo,E=w.maximumHeight-w.minimumHeight,I=E/2,R=w.minimumHeight+E/2;w.minimumHeight=R-I,w.maximumHeight=R+I;break}return{box:R3(u),s2VolumeInfo:u}}}async function P3(t){const{implicitOptions:e,parentData:i={mortonIndex:0,x:0,y:0,z:0},childIndex:n=0,s2VolumeBox:r,loaderOptions:a}=t;let{subtree:u,level:l=0,globalData:_={level:0,mortonIndex:0,x:0,y:0,z:0}}=t;const{subdivisionScheme:w,subtreeLevels:E,maximumLevel:I,contentUrlTemplate:R,subtreesUriTemplate:L,basePath:W}=e,K={children:[],lodMetricValue:0,contentUrl:""};if(!I)return _R.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${R} won't be loaded...`),K;const fe=l+_.level;if(fe>I)return K;const X=qK[w],$=Math.log2(X),Q=n&1,me=n>>1&1,Ce=n>>2&1,Be=(X**l-1)/(X-1);let Fe=Mc(i.mortonIndex,n,$),ze=Be+Fe,Ve=Mc(i.x,Q,1),je=Mc(i.y,me,1),Ke=Mc(i.z,Ce,1),Lt=!1;l>=E&&(Lt=A1(u.childSubtreeAvailability,Fe));const Pt=Mc(_.x,Ve,l),bt=Mc(_.y,je,l),_i=Mc(_.z,Ke,l);if(Lt){const At=`${W}/${L}`,Ft=Xx(At,fe,Pt,bt,_i);u=await Wl(Ft,v3,a),_={mortonIndex:Fe,x:Ve,y:je,z:Ke,level:l},Fe=0,ze=0,Ve=0,je=0,Ke=0,l=0}if(!A1(u.tileAvailability,ze))return K;A1(u.contentAvailability,ze)&&(K.contentUrl=Xx(R,fe,Pt,bt,_i));const ut=l+1,Et={mortonIndex:Fe,x:Ve,y:je,z:Ke};for(let At=0;At<X;At++){const Ft=KK(r,At,w),Ut=await P3({subtree:u,implicitOptions:e,loaderOptions:a,parentData:Et,childIndex:At,level:ut,globalData:{..._},s2VolumeBox:Ft});if(Ut.contentUrl||Ut.children.length){const Yn=fe+1,mn=ZK(Ut,Yn,{childTileX:Ve,childTileY:je,childTileZ:Ke},e,r);K.children.push(mn)}}return K}function A1(t,e){let i;return Array.isArray(t)?(i=t[0],t.length>1&&_R.once('Not supported extension "3DTILES_multiple_contents" has been detected')):i=t,"constant"in i?!!i.constant:i.explicitBitstream?QK(e,i.explicitBitstream):!1}function ZK(t,e,i,n,r){const{basePath:a,refine:u,getRefine:l,lodMetricType:_,getTileType:w,rootLodMetricValue:E,rootBoundingVolume:I}=n,R=t.contentUrl&&t.contentUrl.replace(`${a}/`,""),L=E/2**e,W=r!=null&&r.box?{box:r.box}:I,K=YK(e,W,i);return{children:t.children,contentUrl:t.contentUrl,content:{uri:R},id:t.contentUrl,refine:l(u),type:w(t),lodMetricType:_,lodMetricValue:L,geometricError:L,transform:t.transform,boundingVolume:K}}function YK(t,e,i){if(e.region){const{childTileX:n,childTileY:r,childTileZ:a}=i,[u,l,_,w,E,I]=e.region,R=2**t,L=(_-u)/R,W=(w-l)/R,K=(I-E)/R,[fe,X]=[u+L*n,u+L*(n+1)],[$,Q]=[l+W*r,l+W*(r+1)],[me,Ce]=[E+K*a,E+K*(a+1)];return{region:[fe,$,X,Q,me,Ce]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${JSON.stringify(e)}`)}function Mc(t,e,i){return(t<<i)+e}function Xx(t,e,i,n,r){const a=JK({level:e,x:i,y:n,z:r});return t.replace(/{level}|{x}|{y}|{z}/gi,u=>a[u])}function JK(t){const e={};for(const i in t)e[`{${i}}`]=t[i];return e}function QK(t,e){const i=Math.floor(t/8),n=t%8;return(e[i]>>n&1)===1}function Ww(t,e=""){if(!e)return Ia.EMPTY;const n=e.split("?")[0].split(".").pop();switch(n){case"pnts":return Ia.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Ia.SCENEGRAPH;default:return n||Ia.EMPTY}}function Xw(t){switch(t){case"REPLACE":case"replace":return bo.REPLACE;case"ADD":case"add":return bo.ADD;default:return t}}function qx(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const n=new URL(t,`${e}/`);return decodeURI(n.toString())}else if(t.startsWith("/"))return t;return YF(e,t)}function W2(t,e){var r;if(!t)return null;let i;if(t.content){const a=t.content.uri||((r=t.content)==null?void 0:r.url);typeof a<"u"&&(i=qx(a,e))}return{...t,id:i,contentUrl:i,lodMetricType:id.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:Ww(t,i),refine:Xw(t.refine)}}async function eZ(t,e,i){let n=null;const r=q2(t.root);r&&t.root?n=await X2(t.root,t,e,r,i):n=W2(t.root,e);const a=[];for(a.push(n);a.length>0;){const u=a.pop()||{},l=u.children||[],_=[];for(const w of l){const E=q2(w);let I;E?I=await X2(w,t,e,E,i):I=W2(w,e),I&&(_.push(I),a.push(I))}u.children=_}return n}async function X2(t,e,i,n,r){var me,Ce,Be;const{subdivisionScheme:a,maximumLevel:u,availableLevels:l,subtreeLevels:_,subtrees:{uri:w}}=n,E=Xx(w,0,0,0,0),I=qx(E,i),R=await Wl(I,v3,r),L=(me=t.content)==null?void 0:me.uri,W=L?qx(L,i):"",K=(Ce=e==null?void 0:e.root)==null?void 0:Ce.refine,fe=t.geometricError,X=(Be=t.boundingVolume.extensions)==null?void 0:Be["3DTILES_bounding_volume_S2"];if(X){const ze={box:R3(X),s2VolumeInfo:X};t.boundingVolume=ze}const $=t.boundingVolume,Q={contentUrlTemplate:W,subtreesUriTemplate:w,subdivisionScheme:a,subtreeLevels:_,maximumLevel:Number.isFinite(l)?l-1:u,refine:K,basePath:i,lodMetricType:id.GEOMETRIC_ERROR,rootLodMetricValue:fe,rootBoundingVolume:$,getTileType:Ww,getRefine:Xw};return await tZ(t,i,R,Q,r)}async function tZ(t,e,i,n,r){if(!t)return null;const{children:a,contentUrl:u}=await P3({subtree:i,implicitOptions:n,loaderOptions:r});let l,_=null;return u&&(l=u,_={uri:u.replace(`${e}/`,"")}),{...t,id:l,contentUrl:l,lodMetricType:id.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:Ww(t,l),refine:Xw(t.refine),content:_||t.content,children:a}}function q2(t){var e;return((e=t==null?void 0:t.extensions)==null?void 0:e["3DTILES_implicit_tiling"])||(t==null?void 0:t.implicitTiling)}const qw={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:h3,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:iZ,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function iZ(t,e={},i){const n=e["3d-tiles"]||{};let r;return n.isTileset==="auto"?r=(i==null?void 0:i.url)&&i.url.indexOf(".json")!==-1:r=n.isTileset,r?nZ(t,e,i):rZ(t,e,i)}async function nZ(t,e,i){var _;const n=JSON.parse(new TextDecoder().decode(t)),r=(i==null?void 0:i.url)||"",a=sZ(r),u=await eZ(n,a,e||{});return{...n,shape:"tileset3d",loader:qw,url:r,queryString:(i==null?void 0:i.queryString)||"",basePath:a,root:u||n.root,type:es.TILES3D,lodMetricType:id.GEOMETRIC_ERROR,lodMetricValue:((_=n.root)==null?void 0:_.geometricError)||0}}async function rZ(t,e,i){const n={content:{shape:"tile3d",featureIds:null}};return await y3(t,0,e,i,n.content),n.content}function sZ(t){return Kb(t)}const K2=[0],oZ={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:qw,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,i)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class Kw extends EM{initializeState(){"onTileLoadFail"in this.props&&ai.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,i;return!!((i=(e=this.state)==null?void 0:e.tileset3d)!=null&&i.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:i,changeFlags:n}){if(e.data&&e.data!==i.data&&this._loadTileset(e.data),n.viewportChanged){const{activeViewports:r}=this.state;Object.keys(r).length&&(this._updateTileset(r),this.state.lastUpdatedViewports=r,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:r}=this.state;for(const a in r)r[a].needsUpdate=!0}}activateViewport(e){const{activeViewports:i,lastUpdatedViewports:n}=this.state;this.internalState.viewport=e,i[e.id]=e;const r=n==null?void 0:n[e.id];(!r||!e.equals(r))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:i}){const n=i&&i.props.tile;return e.picked&&(e.object=n),e.sourceTile=n,e}filterSubLayer({layer:e,viewport:i}){const{tile:n}=e.props,{id:r}=i;return n.selected&&n.viewportIds.includes(r)}_updateAutoHighlight(e){const i=e.sourceTile,n=this.state.layerMap[i==null?void 0:i.id];n&&n.layer&&n.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:i={}}=this.props,n=this.props.loader||this.props.loaders,r=Array.isArray(n)?n[0]:n,a={loadOptions:{...i}};let u=e;if(r.preload){const w=await r.preload(e,i);w.url&&(u=w.url),w.headers&&(a.loadOptions.fetch={...a.loadOptions.fetch,headers:w.headers}),Object.assign(a,w)}const l=await Wl(u,r,a.loadOptions),_=new zq(l,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...a});this.setState({tileset3d:_,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(_)}_onTileLoad(e){const{lastUpdatedViewports:i}=this.state;this.props.onTileLoad(e),this._updateTileset(i),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:i}=this.state,{timeline:n}=this.context,r=Object.keys(e).length;!n||!r||!i||i.selectTiles(Object.values(e)).then(a=>{this.state.frameNumber!==a&&this.setState({frameNumber:a})})}_getSubLayer(e,i){if(!e.content)return null;switch(e.type){case Ia.POINTCLOUD:return this._makePointCloudLayer(e,i);case Ia.SCENEGRAPH:return this._make3DModelLayer(e);case Ia.MESH:return this._makeSimpleMeshLayer(e,i);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,i){const{attributes:n,pointCount:r,constantRGBA:a,cartographicOrigin:u,modelMatrix:l}=e.content,{positions:_,normals:w,colors:E}=n;if(!_)return null;const I=i&&i.props.data||{header:{vertexCount:r},attributes:{POSITION:_,NORMAL:w,COLOR_0:E}},{pointSize:R,getPointColor:L}=this.props,W=this.getSubLayerClass("pointcloud",Rw);return new W({pointSize:R},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:I,coordinateSystem:ii.METER_OFFSETS,coordinateOrigin:u,modelMatrix:l,getColor:a||L,_offset:0})}_make3DModelLayer(e){const{gltf:i,instances:n,cartographicOrigin:r,modelMatrix:a}=e.content,u=this.getSubLayerClass("scenegraph",Vx);return new u({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:n||K2,scenegraph:i,coordinateSystem:ii.METER_OFFSETS,coordinateOrigin:r,modelMatrix:a,getTransformMatrix:l=>l.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,i){const n=e.content,{attributes:r,indices:a,modelMatrix:u,cartographicOrigin:l,coordinateSystem:_=ii.METER_OFFSETS,material:w,featureIds:E}=n,{_getMeshColor:I}=this.props,R=i&&i.props.mesh||new kl({topology:"triangle-list",attributes:aZ(r),indices:a}),L=this.getSubLayerClass("mesh",zw);return new L(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:R,data:K2,getColor:I(e),pbrMaterial:w,modelMatrix:u,coordinateOrigin:l,coordinateSystem:_,featureIds:E,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:i}=this.state;return e?e.tiles.map(n=>{const r=i[n.id]=i[n.id]||{tile:n};let{layer:a}=r;return n.selected&&(a?r.needsUpdate&&(a=this._getSubLayer(n,a),r.needsUpdate=!1):a=this._getSubLayer(n)),r.layer=a,a}).filter(Boolean):null}}Kw.defaultProps=oZ;Kw.layerName="Tile3DLayer";function aZ(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}var M3={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(t,e){(function(i,n){t.exports=n()})(Pk,function(){var i={},n={};function r(u,l,_){if(n[u]=_,u==="index"){var w="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",E={};return n.shared(E),n.index(i,E),typeof window<"u"&&i.setWorkerUrl(window.URL.createObjectURL(new Blob([w],{type:"text/javascript"}))),i}}r("shared",["exports"],function(u){function l(c,o,h,f){return new(h||(h=Promise))(function(g,x){function b(M){try{S(f.next(M))}catch(B){x(B)}}function A(M){try{S(f.throw(M))}catch(B){x(B)}}function S(M){var B;M.done?g(M.value):(B=M.value,B instanceof h?B:new h(function(O){O(B)})).then(b,A)}S((f=f.apply(c,o||[])).next())})}function _(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var w=E;function E(c,o){this.x=c,this.y=o}E.prototype={clone:function(){return new E(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,o){return this.clone()._rotateAround(c,o)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var o=c.x-this.x,h=c.y-this.y;return o*o+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,o){return Math.atan2(this.x*o-this.y*c,this.x*c+this.y*o)},_matMult:function(c){var o=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=o,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var o=Math.cos(c),h=Math.sin(c),f=h*this.x+o*this.y;return this.x=o*this.x-h*this.y,this.y=f,this},_rotateAround:function(c,o){var h=Math.cos(c),f=Math.sin(c),g=o.y+f*(this.x-o.x)+h*(this.y-o.y);return this.x=o.x+h*(this.x-o.x)-f*(this.y-o.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},E.convert=function(c){return c instanceof E?c:Array.isArray(c)?new E(c[0],c[1]):c};var I=_(w),R=L;function L(c,o,h,f){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=o,this.p2x=h,this.p2y=f}L.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,o){if(o===void 0&&(o=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,f=0;f<8;f++){var g=this.sampleCurveX(h)-c;if(Math.abs(g)<o)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=g/x}var b=0,A=1;for(h=c,f=0;f<20&&(g=this.sampleCurveX(h),!(Math.abs(g-c)<o));f++)c>g?b=h:A=h,h=.5*(A-b)+b;return h},solve:function(c,o){return this.sampleCurveY(this.solveCurveX(c,o))}};var W=_(R);let K,fe;function X(){return K==null&&(K=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),K}function $(){if(fe==null&&(fe=!1,X())){const o=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(o){for(let f=0;f<5*5;f++){const g=4*f;o.fillStyle=`rgb(${g},${g+1},${g+2})`,o.fillRect(f%5,Math.floor(f/5),1,1)}const h=o.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&h[f]!==f){fe=!0;break}}}return fe||!1}function Q(c,o,h,f){const g=new W(c,o,h,f);return x=>g.solve(x)}const me=Q(.25,.1,.25,1);function Ce(c,o,h){return Math.min(h,Math.max(o,c))}function Be(c,o,h){const f=h-o,g=((c-o)%f+f)%f+o;return g===o?h:g}function Fe(c,...o){for(const h of o)for(const f in h)c[f]=h[f];return c}let ze=1;function Ve(c,o,h){const f={};for(const g in c)f[g]=o.call(this,c[g],g,c);return f}function je(c,o,h){const f={};for(const g in c)o.call(this,c[g],g,c)&&(f[g]=c[g]);return f}function Ke(c){return Array.isArray(c)?c.map(Ke):typeof c=="object"&&c?Ve(c,Ke):c}const Lt={};function Pt(c){Lt[c]||(typeof console<"u"&&console.warn(c),Lt[c]=!0)}function bt(c,o,h){return(h.y-c.y)*(o.x-c.x)>(o.y-c.y)*(h.x-c.x)}function _i(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let Zn=null;function sn(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Et(c,o,h,f,g){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(c,{timestamp:0});try{const b=x==null?void 0:x.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const A=b.startsWith("BGR"),S=new Uint8ClampedArray(f*g*4);if(yield x.copyTo(S,function(M,B,O,U,j){const G=4*Math.max(-B,0),Z=(Math.max(0,O)-O)*U*4+G,se=4*U,le=Math.max(0,B),Ee=Math.max(0,O);return{rect:{x:le,y:Ee,width:Math.min(M.width,B+U)-le,height:Math.min(M.height,O+j)-Ee},layout:[{offset:Z,stride:se}]}}(c,o,h,f,g)),A)for(let M=0;M<S.length;M+=4){const B=S[M];S[M]=S[M+2],S[M+2]=B}return S}finally{x.close()}})}let At,Ft;const Ut="AbortError";function Yn(){return new Error(Ut)}const Ji={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function mn(c){return Ji.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const On="global-dispatcher";class Jt extends Error{constructor(o,h,f,g){super(`AJAXError: ${h} (${o}): ${f}`),this.status=o,this.statusText=h,this.url=f,this.body=g}}const dn=()=>_i(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,pi=function(c,o){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const f=mn(c.url);if(f)return f(c,o);if(_i(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:On},o)}if(!(/^file:/.test(h=c.url)||/^file:/.test(dn())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,g){return l(this,void 0,void 0,function*(){const x=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:dn(),signal:g.signal});f.type!=="json"||x.headers.has("Accept")||x.headers.set("Accept","application/json");const b=yield fetch(x);if(!b.ok){const M=yield b.blob();throw new Jt(b.status,b.statusText,f.url,M)}let A;A=f.type==="arrayBuffer"||f.type==="image"?b.arrayBuffer():f.type==="json"?b.json():b.text();const S=yield A;if(g.signal.aborted)throw Yn();return{data:S,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}})}(c,o);if(_i(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:On},o)}var h;return function(f,g){return new Promise((x,b)=>{var A;const S=new XMLHttpRequest;S.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(S.responseType="arraybuffer");for(const M in f.headers)S.setRequestHeader(M,f.headers[M]);f.type==="json"&&(S.responseType="text",!((A=f.headers)===null||A===void 0)&&A.Accept||S.setRequestHeader("Accept","application/json")),S.withCredentials=f.credentials==="include",S.onerror=()=>{b(new Error(S.statusText))},S.onload=()=>{if(!g.signal.aborted)if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){let M=S.response;if(f.type==="json")try{M=JSON.parse(S.response)}catch(B){return void b(B)}x({data:M,cacheControl:S.getResponseHeader("Cache-Control"),expires:S.getResponseHeader("Expires")})}else{const M=new Blob([S.response],{type:S.getResponseHeader("Content-Type")});b(new Jt(S.status,S.statusText,f.url,M))}},g.signal.addEventListener("abort",()=>{S.abort(),b(Yn())}),S.send(f.body)})}(c,o)};function $i(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const o=new URL(c),h=window.location;return o.protocol===h.protocol&&o.host===h.host}function Bs(c,o,h){h[c]&&h[c].indexOf(o)!==-1||(h[c]=h[c]||[],h[c].push(o))}function Jn(c,o,h){if(h&&h[c]){const f=h[c].indexOf(o);f!==-1&&h[c].splice(f,1)}}class ur{constructor(o,h={}){Fe(this,h),this.type=o}}class hr extends ur{constructor(o,h={}){super("error",Fe({error:o},h))}}class jr{on(o,h){return this._listeners=this._listeners||{},Bs(o,h,this._listeners),this}off(o,h){return Jn(o,h,this._listeners),Jn(o,h,this._oneTimeListeners),this}once(o,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},Bs(o,h,this._oneTimeListeners),this):new Promise(f=>this.once(o,f))}fire(o,h){typeof o=="string"&&(o=new ur(o,h||{}));const f=o.type;if(this.listens(f)){o.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const A of g)A.call(this,o);const x=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const A of x)Jn(f,A,this._oneTimeListeners),A.call(this,o);const b=this._eventedParent;b&&(Fe(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(o))}else o instanceof hr&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,h){return this._eventedParent=o,this._eventedParentData=h,this}}var Pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Qn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Io(c,o){const h={};for(const f in c)f!=="ref"&&(h[f]=c[f]);return Qn.forEach(f=>{f in o&&(h[f]=o[f])}),h}function Xt(c,o){if(Array.isArray(c)){if(!Array.isArray(o)||c.length!==o.length)return!1;for(let h=0;h<c.length;h++)if(!Xt(c[h],o[h]))return!1;return!0}if(typeof c=="object"&&c!==null&&o!==null){if(typeof o!="object"||Object.keys(c).length!==Object.keys(o).length)return!1;for(const h in c)if(!Xt(c[h],o[h]))return!1;return!0}return c===o}function mi(c,o){c.push(o)}function gn(c,o,h){mi(h,{command:"addSource",args:[c,o[c]]})}function Ds(c,o,h){mi(o,{command:"removeSource",args:[c]}),h[c]=!0}function ls(c,o,h,f){Ds(c,h,f),gn(c,o,h)}function Ro(c,o,h){let f;for(f in c[h])if(Object.prototype.hasOwnProperty.call(c[h],f)&&f!=="data"&&!Xt(c[h][f],o[h][f]))return!1;for(f in o[h])if(Object.prototype.hasOwnProperty.call(o[h],f)&&f!=="data"&&!Xt(c[h][f],o[h][f]))return!1;return!0}function dr(c,o,h,f,g,x){c=c||{},o=o||{};for(const b in c)Object.prototype.hasOwnProperty.call(c,b)&&(Xt(c[b],o[b])||h.push({command:x,args:[f,b,o[b],g]}));for(const b in o)Object.prototype.hasOwnProperty.call(o,b)&&!Object.prototype.hasOwnProperty.call(c,b)&&(Xt(c[b],o[b])||h.push({command:x,args:[f,b,o[b],g]}))}function ra(c){return c.id}function Po(c,o){return c[o.id]=o,c}class We{constructor(o,h,f,g){this.message=(o?`${o}: `:"")+f,g&&(this.identifier=g),h!=null&&h.__line__&&(this.line=h.__line__)}}function Pr(c,...o){for(const h of o)for(const f in h)c[f]=h[f];return c}class _n extends Error{constructor(o,h){super(h),this.message=h,this.key=o}}class er{constructor(o,h=[]){this.parent=o,this.bindings={};for(const[f,g]of h)this.bindings[f]=g}concat(o){return new er(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Hr={kind:"null"},Qe={kind:"number"},Ot={kind:"string"},St={kind:"boolean"},kn={kind:"color"},Mr={kind:"object"},Ct={kind:"value"},$r={kind:"collator"},cs={kind:"formatted"},us={kind:"padding"},Br={kind:"resolvedImage"},ae={kind:"variableAnchorOffsetCollection"};function V(c,o){return{kind:"array",itemType:c,N:o}}function z(c){if(c.kind==="array"){const o=z(c.itemType);return typeof c.N=="number"?`array<${o}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${o}>`}return c.kind}const Y=[Hr,Qe,Ot,St,kn,cs,Mr,V(Ct),us,Br,ae];function ne(c,o){if(o.kind==="error")return null;if(c.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!ne(c.itemType,o.itemType))&&(typeof c.N!="number"||c.N===o.N))return null}else{if(c.kind===o.kind)return null;if(c.kind==="value"){for(const h of Y)if(!ne(h,o))return null}}return`Expected ${z(c)} but found ${z(o)} instead.`}function ge(c,o){return o.some(h=>h.kind===c.kind)}function ve(c,o){return o.some(h=>h==="null"?c===null:h==="array"?Array.isArray(c):h==="object"?c&&!Array.isArray(c)&&typeof c=="object":h===typeof c)}function Te(c,o){return c.kind==="array"&&o.kind==="array"?c.itemType.kind===o.itemType.kind&&typeof c.N=="number":c.kind===o.kind}const he=.96422,ke=.82521,Ue=4/29,Me=6/29,Xe=3*Me*Me,_t=Me*Me*Me,xt=Math.PI/180,Wt=180/Math.PI;function Bt(c){return(c%=360)<0&&(c+=360),c}function Ht([c,o,h,f]){let g,x;const b=Fi((.2225045*(c=Nt(c))+.7168786*(o=Nt(o))+.0606169*(h=Nt(h)))/1);c===o&&o===h?g=x=b:(g=Fi((.4360747*c+.3850649*o+.1430804*h)/he),x=Fi((.0139322*c+.0971045*o+.7141733*h)/ke));const A=116*b-16;return[A<0?0:A,500*(g-b),200*(b-x),f]}function Nt(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Fi(c){return c>_t?Math.pow(c,1/3):c/Xe+Ue}function yi([c,o,h,f]){let g=(c+16)/116,x=isNaN(o)?g:g+o/500,b=isNaN(h)?g:g-h/200;return g=1*qt(g),x=he*qt(x),b=ke*qt(b),[Dt(3.1338561*x-1.6168667*g-.4906146*b),Dt(-.9787684*x+1.9161415*g+.033454*b),Dt(.0719453*x-.2289914*g+1.4052427*b),f]}function Dt(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function qt(c){return c>Me?c*c*c:Xe*(c-Ue)}function ri(c){return parseInt(c.padEnd(2,c),16)/255}function Ni(c,o){return Qi(o?c/100:c,0,1)}function Qi(c,o,h){return Math.min(Math.max(o,c),h)}function Sn(c){return!c.some(Number.isNaN)}const Mo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Zt{constructor(o,h,f,g=1,x=!0){this.r=o,this.g=h,this.b=f,this.a=g,x||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[o,h,f,g]))}static parse(o){if(o instanceof Zt)return o;if(typeof o!="string")return;const h=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=Mo[f];if(g){const[b,A,S]=g;return[b/255,A/255,S/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const b=f.length<6?1:2;let A=1;return[ri(f.slice(A,A+=b)),ri(f.slice(A,A+=b)),ri(f.slice(A,A+=b)),ri(f.slice(A,A+b)||"ff")]}if(f.startsWith("rgb")){const b=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[A,S,M,B,O,U,j,G,Z,se,le,Ee]=b,_e=[B||" ",j||" ",se].join("");if(_e==="  "||_e==="  /"||_e===",,"||_e===",,,"){const be=[M,U,Z].join(""),Oe=be==="%%%"?100:be===""?255:0;if(Oe){const He=[Qi(+S/Oe,0,1),Qi(+O/Oe,0,1),Qi(+G/Oe,0,1),le?Ni(+le,Ee):1];if(Sn(He))return He}}return}}const x=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[b,A,S,M,B,O,U,j,G]=x,Z=[S||" ",B||" ",U].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const se=[+A,Qi(+M,0,100),Qi(+O,0,100),j?Ni(+j,G):1];if(Sn(se))return function([le,Ee,_e,be]){function Oe(He){const ot=(He+le/30)%12,wt=Ee*Math.min(_e,1-_e);return _e-wt*Math.max(-1,Math.min(ot-3,9-ot,1))}return le=Bt(le),Ee/=100,_e/=100,[Oe(0),Oe(8),Oe(4),be]}(se)}}}(o);return h?new Zt(...h,!1):void 0}get rgb(){const{r:o,g:h,b:f,a:g}=this,x=g||1/0;return this.overwriteGetter("rgb",[o/x,h/x,f/x,g])}get hcl(){return this.overwriteGetter("hcl",function(o){const[h,f,g,x]=Ht(o),b=Math.sqrt(f*f+g*g);return[Math.round(1e4*b)?Bt(Math.atan2(g,f)*Wt):NaN,b,h,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ht(this.rgb))}overwriteGetter(o,h){return Object.defineProperty(this,o,{value:h}),h}toString(){const[o,h,f,g]=this.rgb;return`rgba(${[o,h,f].map(x=>Math.round(255*x)).join(",")},${g})`}}Zt.black=new Zt(0,0,0,1),Zt.white=new Zt(1,1,1,1),Zt.transparent=new Zt(0,0,0,0),Zt.red=new Zt(1,0,0,1);class Fn{constructor(o,h,f){this.sensitivity=o?h?"variant":"case":h?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,h){return this.collator.compare(o,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Os{constructor(o,h,f,g,x){this.text=o,this.image=h,this.scale=f,this.fontStack=g,this.textColor=x}}class Gi{constructor(o){this.sections=o}static fromString(o){return new Gi([new Os(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||o.image&&o.image.name.length!==0)}static factory(o){return o instanceof Gi?o:Gi.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}}class Li{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof Li)return o;if(typeof o=="number")return new Li([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const h of o)if(typeof h!="number")return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new Li(o)}}toString(){return JSON.stringify(this.values)}}const sa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ui{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof Ui)return o;if(Array.isArray(o)&&!(o.length<1)&&o.length%2==0){for(let h=0;h<o.length;h+=2){const f=o[h],g=o[h+1];if(typeof f!="string"||!sa.has(f)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new Ui(o)}}toString(){return JSON.stringify(this.values)}}class zi{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new zi({name:o,available:!1}):null}}function io(c,o,h,f){return typeof c=="number"&&c>=0&&c<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof h=="number"&&h>=0&&h<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[c,o,h,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[c,o,h,f]:[c,o,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ks(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Zt||c instanceof Fn||c instanceof Gi||c instanceof Li||c instanceof Ui||c instanceof zi)return!0;if(Array.isArray(c)){for(const o of c)if(!ks(o))return!1;return!0}if(typeof c=="object"){for(const o in c)if(!ks(c[o]))return!1;return!0}return!1}function Mi(c){if(c===null)return Hr;if(typeof c=="string")return Ot;if(typeof c=="boolean")return St;if(typeof c=="number")return Qe;if(c instanceof Zt)return kn;if(c instanceof Fn)return $r;if(c instanceof Gi)return cs;if(c instanceof Li)return us;if(c instanceof Ui)return ae;if(c instanceof zi)return Br;if(Array.isArray(c)){const o=c.length;let h;for(const f of c){const g=Mi(f);if(h){if(h===g)continue;h=Ct;break}h=g}return V(h||Ct,o)}return Mr}function Cn(c){const o=typeof c;return c===null?"":o==="string"||o==="number"||o==="boolean"?String(c):c instanceof Zt||c instanceof Gi||c instanceof Li||c instanceof Ui||c instanceof zi?c.toString():JSON.stringify(c)}class Nn{constructor(o,h){this.type=o,this.value=h}static parse(o,h){if(o.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!ks(o[1]))return h.error("invalid value");const f=o[1];let g=Mi(f);const x=h.expectedType;return g.kind!=="array"||g.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(g=x),new Nn(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Bi{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const Bo={string:Ot,number:Qe,boolean:St,object:Mr};class tr{constructor(o,h){this.type=o,this.args=h}static parse(o,h){if(o.length<2)return h.error("Expected at least one argument.");let f,g=1;const x=o[0];if(x==="array"){let A,S;if(o.length>2){const M=o[1];if(typeof M!="string"||!(M in Bo)||M==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);A=Bo[M],g++}else A=Ct;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return h.error('The length argument to "array" must be a positive integer literal',2);S=o[2],g++}f=V(A,S)}else{if(!Bo[x])throw new Error(`Types doesn't contain name = ${x}`);f=Bo[x]}const b=[];for(;g<o.length;g++){const A=h.parse(o[g],g,Ct);if(!A)return null;b.push(A)}return new tr(f,b)}evaluate(o){for(let h=0;h<this.args.length;h++){const f=this.args[h].evaluate(o);if(!ne(this.type,Mi(f)))return f;if(h===this.args.length-1)throw new Bi(`Expected value to be of type ${z(this.type)}, but found ${z(Mi(f))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const oa={"to-boolean":St,"to-color":kn,"to-number":Qe,"to-string":Ot};class Ln{constructor(o,h){this.type=o,this.args=h}static parse(o,h){if(o.length<2)return h.error("Expected at least one argument.");const f=o[0];if(!oa[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&o.length!==2)return h.error("Expected one argument.");const g=oa[f],x=[];for(let b=1;b<o.length;b++){const A=h.parse(o[b],b,Ct);if(!A)return null;x.push(A)}return new Ln(g,x)}evaluate(o){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(o);case"color":{let h,f;for(const g of this.args){if(h=g.evaluate(o),f=null,h instanceof Zt)return h;if(typeof h=="string"){const x=o.parseColor(h);if(x)return x}else if(Array.isArray(h)&&(f=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:io(h[0],h[1],h[2],h[3]),!f))return new Zt(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Bi(f||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const f of this.args){h=f.evaluate(o);const g=Li.parse(h);if(g)return g}throw new Bi(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const f of this.args){h=f.evaluate(o);const g=Ui.parse(h);if(g)return g}throw new Bi(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const f of this.args){if(h=f.evaluate(o),h===null)return 0;const g=Number(h);if(!isNaN(g))return g}throw new Bi(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Gi.fromString(Cn(this.args[0].evaluate(o)));case"resolvedImage":return zi.fromString(Cn(this.args[0].evaluate(o)));default:return Cn(this.args[0].evaluate(o))}}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const Fs=["Unknown","Point","LineString","Polygon"];class Va{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Fs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let h=this._parseColorCache[o];return h||(h=this._parseColorCache[o]=Zt.parse(o)),h}}class Ns{constructor(o,h,f=[],g,x=new er,b=[]){this.registry=o,this.path=f,this.key=f.map(A=>`[${A}]`).join(""),this.scope=x,this.errors=b,this.expectedType=g,this._isConstant=h}parse(o,h,f,g,x={}){return h?this.concat(h,f,g)._parse(o,x):this._parse(o,x)}_parse(o,h){function f(g,x,b){return b==="assert"?new tr(x,[g]):b==="coerce"?new Ln(x,[g]):g}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=o[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[g];if(x){let b=x.parse(o,this);if(!b)return null;if(this.expectedType){const A=this.expectedType,S=b.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||S.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(A.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(A.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(A,S))return null}else b=f(b,A,h.typeAnnotation||"coerce");else b=f(b,A,h.typeAnnotation||"coerce");else b=f(b,A,h.typeAnnotation||"coerce");else b=f(b,A,h.typeAnnotation||"assert")}if(!(b instanceof Nn)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const A=new Va;try{b=new Nn(b.type,b.evaluate(A))}catch(S){return this.error(S.message),null}}return b}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,h,f){const g=typeof o=="number"?this.path.concat(o):this.path,x=f?this.scope.concat(f):this.scope;return new Ns(this.registry,this._isConstant,g,h||null,x,this.errors)}error(o,...h){const f=`${this.key}${h.map(g=>`[${g}]`).join("")}`;this.errors.push(new _n(f,o))}checkSubtype(o,h){const f=ne(o,h);return f&&this.error(f),f}}class Gr{constructor(o,h){this.type=h.type,this.bindings=[].concat(o),this.result=h}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const h of this.bindings)o(h[1]);o(this.result)}static parse(o,h){if(o.length<4)return h.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const f=[];for(let x=1;x<o.length-1;x+=2){const b=o[x];if(typeof b!="string")return h.error(`Expected string, but found ${typeof b} instead.`,x);if(/[^a-zA-Z0-9_]/.test(b))return h.error("Variable names must contain only alphanumeric characters or '_'.",x);const A=h.parse(o[x+1],x+1);if(!A)return null;f.push([b,A])}const g=h.parse(o[o.length-1],o.length-1,h.expectedType,f);return g?new Gr(f,g):null}outputDefined(){return this.result.outputDefined()}}class Kt{constructor(o,h){this.type=h.type,this.name=o,this.boundExpression=h}static parse(o,h){if(o.length!==2||typeof o[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const f=o[1];return h.scope.has(f)?new Kt(f,h.scope.get(f)):h.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class nc{constructor(o,h,f){this.type=o,this.index=h,this.input=f}static parse(o,h){if(o.length!==3)return h.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=h.parse(o[1],1,Qe),g=h.parse(o[2],2,V(h.expectedType||Ct));return f&&g?new nc(g.type.itemType,f,g):null}evaluate(o){const h=this.index.evaluate(o),f=this.input.evaluate(o);if(h<0)throw new Bi(`Array index out of bounds: ${h} < 0.`);if(h>=f.length)throw new Bi(`Array index out of bounds: ${h} > ${f.length-1}.`);if(h!==Math.floor(h))throw new Bi(`Array index must be an integer, but found ${h} instead.`);return f[h]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class rc{constructor(o,h){this.type=St,this.needle=o,this.haystack=h}static parse(o,h){if(o.length!==3)return h.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=h.parse(o[1],1,Ct),g=h.parse(o[2],2,Ct);return f&&g?ge(f.type,[St,Ot,Qe,Hr,Ct])?new rc(f,g):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${z(f.type)} instead`):null}evaluate(o){const h=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!f)return!1;if(!ve(h,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${z(Mi(h))} instead.`);if(!ve(f,["string","array"]))throw new Bi(`Expected second argument to be of type array or string, but found ${z(Mi(f))} instead.`);return f.indexOf(h)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class q{constructor(o,h,f){this.type=Qe,this.needle=o,this.haystack=h,this.fromIndex=f}static parse(o,h){if(o.length<=2||o.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=h.parse(o[1],1,Ct),g=h.parse(o[2],2,Ct);if(!f||!g)return null;if(!ge(f.type,[St,Ot,Qe,Hr,Ct]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${z(f.type)} instead`);if(o.length===4){const x=h.parse(o[3],3,Qe);return x?new q(f,g,x):null}return new q(f,g)}evaluate(o){const h=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!ve(h,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${z(Mi(h))} instead.`);let g;if(this.fromIndex&&(g=this.fromIndex.evaluate(o)),ve(f,["string"])){const x=f.indexOf(h,g);return x===-1?-1:[...f.slice(0,x)].length}if(ve(f,["array"]))return f.indexOf(h,g);throw new Bi(`Expected second argument to be of type array or string, but found ${z(Mi(f))} instead.`)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class ee{constructor(o,h,f,g,x,b){this.inputType=o,this.type=h,this.input=f,this.cases=g,this.outputs=x,this.otherwise=b}static parse(o,h){if(o.length<5)return h.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return h.error("Expected an even number of arguments.");let f,g;h.expectedType&&h.expectedType.kind!=="value"&&(g=h.expectedType);const x={},b=[];for(let M=2;M<o.length-1;M+=2){let B=o[M];const O=o[M+1];Array.isArray(B)||(B=[B]);const U=h.concat(M);if(B.length===0)return U.error("Expected at least one branch label.");for(const G of B){if(typeof G!="number"&&typeof G!="string")return U.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return U.error("Numeric branch labels must be integer values.");if(f){if(U.checkSubtype(f,Mi(G)))return null}else f=Mi(G);if(x[String(G)]!==void 0)return U.error("Branch labels must be unique.");x[String(G)]=b.length}const j=h.parse(O,M,g);if(!j)return null;g=g||j.type,b.push(j)}const A=h.parse(o[1],1,Ct);if(!A)return null;const S=h.parse(o[o.length-1],o.length-1,g);return S?A.type.kind!=="value"&&h.concat(1).checkSubtype(f,A.type)?null:new ee(f,g,A,x,b,S):null}evaluate(o){const h=this.input.evaluate(o);return(Mi(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}}class de{constructor(o,h,f){this.type=o,this.branches=h,this.otherwise=f}static parse(o,h){if(o.length<4)return h.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return h.error("Expected an odd number of arguments.");let f;h.expectedType&&h.expectedType.kind!=="value"&&(f=h.expectedType);const g=[];for(let b=1;b<o.length-1;b+=2){const A=h.parse(o[b],b,St);if(!A)return null;const S=h.parse(o[b+1],b+1,f);if(!S)return null;g.push([A,S]),f=f||S.type}const x=h.parse(o[o.length-1],o.length-1,f);if(!x)return null;if(!f)throw new Error("Can't infer output type");return new de(f,g,x)}evaluate(o){for(const[h,f]of this.branches)if(h.evaluate(o))return f.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[h,f]of this.branches)o(h),o(f);o(this.otherwise)}outputDefined(){return this.branches.every(([o,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class De{constructor(o,h,f,g){this.type=o,this.input=h,this.beginIndex=f,this.endIndex=g}static parse(o,h){if(o.length<=2||o.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=h.parse(o[1],1,Ct),g=h.parse(o[2],2,Qe);if(!f||!g)return null;if(!ge(f.type,[V(Ct),Ot,Ct]))return h.error(`Expected first argument to be of type array or string, but found ${z(f.type)} instead`);if(o.length===4){const x=h.parse(o[3],3,Qe);return x?new De(f.type,f,g,x):null}return new De(f.type,f,g)}evaluate(o){const h=this.input.evaluate(o),f=this.beginIndex.evaluate(o);let g;if(this.endIndex&&(g=this.endIndex.evaluate(o)),ve(h,["string"]))return[...h].slice(f,g).join("");if(ve(h,["array"]))return h.slice(f,g);throw new Bi(`Expected first argument to be of type array or string, but found ${z(Mi(h))} instead.`)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function $e(c,o){const h=c.length-1;let f,g,x=0,b=h,A=0;for(;x<=b;)if(A=Math.floor((x+b)/2),f=c[A],g=c[A+1],f<=o){if(A===h||o<g)return A;x=A+1}else{if(!(f>o))throw new Bi("Input is not a number.");b=A-1}return 0}class ht{constructor(o,h,f){this.type=o,this.input=h,this.labels=[],this.outputs=[];for(const[g,x]of f)this.labels.push(g),this.outputs.push(x)}static parse(o,h){if(o.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return h.error("Expected an even number of arguments.");const f=h.parse(o[1],1,Qe);if(!f)return null;const g=[];let x=null;h.expectedType&&h.expectedType.kind!=="value"&&(x=h.expectedType);for(let b=1;b<o.length;b+=2){const A=b===1?-1/0:o[b],S=o[b+1],M=b,B=b+1;if(typeof A!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(g.length&&g[g.length-1][0]>=A)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const O=h.parse(S,B,x);if(!O)return null;x=x||O.type,g.push([A,O])}return new ht(x,f,g)}evaluate(o){const h=this.labels,f=this.outputs;if(h.length===1)return f[0].evaluate(o);const g=this.input.evaluate(o);if(g<=h[0])return f[0].evaluate(o);const x=h.length;return g>=h[x-1]?f[x-1].evaluate(o):f[$e(h,g)].evaluate(o)}eachChild(o){o(this.input);for(const h of this.outputs)o(h)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Vt(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var on=an;function an(c,o,h,f){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=o,this.p2x=h,this.p2y=f}an.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,o){if(o===void 0&&(o=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,f=0;f<8;f++){var g=this.sampleCurveX(h)-c;if(Math.abs(g)<o)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=g/x}var b=0,A=1;for(h=c,f=0;f<20&&(g=this.sampleCurveX(h),!(Math.abs(g-c)<o));f++)c>g?b=h:A=h,h=.5*(A-b)+b;return h},solve:function(c,o){return this.sampleCurveY(this.solveCurveX(c,o))}};var In=Vt(on);function yn(c,o,h){return c+h*(o-c)}function sc(c,o,h){return c.map((f,g)=>yn(f,o[g],h))}const fr={number:yn,color:function(c,o,h,f="rgb"){switch(f){case"rgb":{const[g,x,b,A]=sc(c.rgb,o.rgb,h);return new Zt(g,x,b,A,!1)}case"hcl":{const[g,x,b,A]=c.hcl,[S,M,B,O]=o.hcl;let U,j;if(isNaN(g)||isNaN(S))isNaN(g)?isNaN(S)?U=NaN:(U=S,b!==1&&b!==0||(j=M)):(U=g,B!==1&&B!==0||(j=x));else{let Ee=S-g;S>g&&Ee>180?Ee-=360:S<g&&g-S>180&&(Ee+=360),U=g+h*Ee}const[G,Z,se,le]=function([Ee,_e,be,Oe]){return Ee=isNaN(Ee)?0:Ee*xt,yi([be,Math.cos(Ee)*_e,Math.sin(Ee)*_e,Oe])}([U,j??yn(x,M,h),yn(b,B,h),yn(A,O,h)]);return new Zt(G,Z,se,le,!1)}case"lab":{const[g,x,b,A]=yi(sc(c.lab,o.lab,h));return new Zt(g,x,b,A,!1)}}},array:sc,padding:function(c,o,h){return new Li(sc(c.values,o.values,h))},variableAnchorOffsetCollection:function(c,o,h){const f=c.values,g=o.values;if(f.length!==g.length)throw new Bi(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${o.toString()}`);const x=[];for(let b=0;b<f.length;b+=2){if(f[b]!==g[b])throw new Bi(`Cannot interpolate values containing mismatched anchors. from[${b}]: ${f[b]}, to[${b}]: ${g[b]}`);x.push(f[b]);const[A,S]=f[b+1],[M,B]=g[b+1];x.push([yn(A,M,h),yn(S,B,h)])}return new Ui(x)}};class pr{constructor(o,h,f,g,x){this.type=o,this.operator=h,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[b,A]of x)this.labels.push(b),this.outputs.push(A)}static interpolationFactor(o,h,f,g){let x=0;if(o.name==="exponential")x=hu(h,o.base,f,g);else if(o.name==="linear")x=hu(h,1,f,g);else if(o.name==="cubic-bezier"){const b=o.controlPoints;x=new In(b[0],b[1],b[2],b[3]).solve(hu(h,1,f,g))}return x}static parse(o,h){let[f,g,x,...b]=o;if(!Array.isArray(g)||g.length===0)return h.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const M=g[1];if(typeof M!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:M}}else{if(g[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const M=g.slice(1);if(M.length!==4||M.some(B=>typeof B!="number"||B<0||B>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:M}}}if(o.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(x=h.parse(x,2,Qe),!x)return null;const A=[];let S=null;f==="interpolate-hcl"||f==="interpolate-lab"?S=kn:h.expectedType&&h.expectedType.kind!=="value"&&(S=h.expectedType);for(let M=0;M<b.length;M+=2){const B=b[M],O=b[M+1],U=M+3,j=M+4;if(typeof B!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(A.length&&A[A.length-1][0]>=B)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const G=h.parse(O,j,S);if(!G)return null;S=S||G.type,A.push([B,G])}return Te(S,Qe)||Te(S,kn)||Te(S,us)||Te(S,ae)||Te(S,V(Qe))?new pr(S,f,g,x,A):h.error(`Type ${z(S)} is not interpolatable.`)}evaluate(o){const h=this.labels,f=this.outputs;if(h.length===1)return f[0].evaluate(o);const g=this.input.evaluate(o);if(g<=h[0])return f[0].evaluate(o);const x=h.length;if(g>=h[x-1])return f[x-1].evaluate(o);const b=$e(h,g),A=pr.interpolationFactor(this.interpolation,g,h[b],h[b+1]),S=f[b].evaluate(o),M=f[b+1].evaluate(o);switch(this.operator){case"interpolate":return fr[this.type.kind](S,M,A);case"interpolate-hcl":return fr.color(S,M,A,"hcl");case"interpolate-lab":return fr.color(S,M,A,"lab")}}eachChild(o){o(this.input);for(const h of this.outputs)o(h)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function hu(c,o,h,f){const g=f-h,x=c-h;return g===0?0:o===1?x/g:(Math.pow(o,x)-1)/(Math.pow(o,g)-1)}class du{constructor(o,h){this.type=o,this.args=h}static parse(o,h){if(o.length<2)return h.error("Expectected at least one argument.");let f=null;const g=h.expectedType;g&&g.kind!=="value"&&(f=g);const x=[];for(const A of o.slice(1)){const S=h.parse(A,1+x.length,f,void 0,{typeAnnotation:"omit"});if(!S)return null;f=f||S.type,x.push(S)}if(!f)throw new Error("No output type");const b=g&&x.some(A=>ne(g,A.type));return new du(b?Ct:f,x)}evaluate(o){let h,f=null,g=0;for(const x of this.args)if(g++,f=x.evaluate(o),f&&f instanceof zi&&!f.available&&(h||(h=f.name),f=null,g===this.args.length&&(f=h)),f!==null)break;return f}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}function fu(c,o){return c==="=="||c==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function rm(c,o,h,f){return f.compare(o,h)===0}function ja(c,o,h){const f=c!=="=="&&c!=="!=";return class B3{constructor(x,b,A){this.type=St,this.lhs=x,this.rhs=b,this.collator=A,this.hasUntypedArgument=x.type.kind==="value"||b.type.kind==="value"}static parse(x,b){if(x.length!==3&&x.length!==4)return b.error("Expected two or three arguments.");const A=x[0];let S=b.parse(x[1],1,Ct);if(!S)return null;if(!fu(A,S.type))return b.concat(1).error(`"${A}" comparisons are not supported for type '${z(S.type)}'.`);let M=b.parse(x[2],2,Ct);if(!M)return null;if(!fu(A,M.type))return b.concat(2).error(`"${A}" comparisons are not supported for type '${z(M.type)}'.`);if(S.type.kind!==M.type.kind&&S.type.kind!=="value"&&M.type.kind!=="value")return b.error(`Cannot compare types '${z(S.type)}' and '${z(M.type)}'.`);f&&(S.type.kind==="value"&&M.type.kind!=="value"?S=new tr(M.type,[S]):S.type.kind!=="value"&&M.type.kind==="value"&&(M=new tr(S.type,[M])));let B=null;if(x.length===4){if(S.type.kind!=="string"&&M.type.kind!=="string"&&S.type.kind!=="value"&&M.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(B=b.parse(x[3],3,$r),!B)return null}return new B3(S,M,B)}evaluate(x){const b=this.lhs.evaluate(x),A=this.rhs.evaluate(x);if(f&&this.hasUntypedArgument){const S=Mi(b),M=Mi(A);if(S.kind!==M.kind||S.kind!=="string"&&S.kind!=="number")throw new Bi(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${S.kind}, ${M.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const S=Mi(b),M=Mi(A);if(S.kind!=="string"||M.kind!=="string")return o(x,b,A)}return this.collator?h(x,b,A,this.collator.evaluate(x)):o(x,b,A)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const l0=ja("==",function(c,o,h){return o===h},rm),sm=ja("!=",function(c,o,h){return o!==h},function(c,o,h,f){return!rm(0,o,h,f)}),om=ja("<",function(c,o,h){return o<h},function(c,o,h,f){return f.compare(o,h)<0}),c0=ja(">",function(c,o,h){return o>h},function(c,o,h,f){return f.compare(o,h)>0}),u0=ja("<=",function(c,o,h){return o<=h},function(c,o,h,f){return f.compare(o,h)<=0}),am=ja(">=",function(c,o,h){return o>=h},function(c,o,h,f){return f.compare(o,h)>=0});class oc{constructor(o,h,f){this.type=$r,this.locale=f,this.caseSensitive=o,this.diacriticSensitive=h}static parse(o,h){if(o.length!==2)return h.error("Expected one argument.");const f=o[1];if(typeof f!="object"||Array.isArray(f))return h.error("Collator options argument must be an object.");const g=h.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,St);if(!g)return null;const x=h.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,St);if(!x)return null;let b=null;return f.locale&&(b=h.parse(f.locale,1,Ot),!b)?null:new oc(g,x,b)}evaluate(o){return new Fn(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}class _d{constructor(o,h,f,g,x){this.type=Ot,this.number=o,this.locale=h,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=x}static parse(o,h){if(o.length!==3)return h.error("Expected two arguments.");const f=h.parse(o[1],1,Qe);if(!f)return null;const g=o[2];if(typeof g!="object"||Array.isArray(g))return h.error("NumberFormat options argument must be an object.");let x=null;if(g.locale&&(x=h.parse(g.locale,1,Ot),!x))return null;let b=null;if(g.currency&&(b=h.parse(g.currency,1,Ot),!b))return null;let A=null;if(g["min-fraction-digits"]&&(A=h.parse(g["min-fraction-digits"],1,Qe),!A))return null;let S=null;return g["max-fraction-digits"]&&(S=h.parse(g["max-fraction-digits"],1,Qe),!S)?null:new _d(f,x,b,A,S)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class pu{constructor(o){this.type=cs,this.sections=o}static parse(o,h){if(o.length<2)return h.error("Expected at least one argument.");const f=o[1];if(!Array.isArray(f)&&typeof f=="object")return h.error("First argument must be an image or text section.");const g=[];let x=!1;for(let b=1;b<=o.length-1;++b){const A=o[b];if(x&&typeof A=="object"&&!Array.isArray(A)){x=!1;let S=null;if(A["font-scale"]&&(S=h.parse(A["font-scale"],1,Qe),!S))return null;let M=null;if(A["text-font"]&&(M=h.parse(A["text-font"],1,V(Ot)),!M))return null;let B=null;if(A["text-color"]&&(B=h.parse(A["text-color"],1,kn),!B))return null;const O=g[g.length-1];O.scale=S,O.font=M,O.textColor=B}else{const S=h.parse(o[b],1,Ct);if(!S)return null;const M=S.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,g.push({content:S,scale:null,font:null,textColor:null})}}return new pu(g)}evaluate(o){return new Gi(this.sections.map(h=>{const f=h.content.evaluate(o);return Mi(f)===Br?new Os("",f,null,null,null):new Os(Cn(f),null,h.scale?h.scale.evaluate(o):null,h.font?h.font.evaluate(o).join(","):null,h.textColor?h.textColor.evaluate(o):null)}))}eachChild(o){for(const h of this.sections)o(h.content),h.scale&&o(h.scale),h.font&&o(h.font),h.textColor&&o(h.textColor)}outputDefined(){return!1}}class yd{constructor(o){this.type=Br,this.input=o}static parse(o,h){if(o.length!==2)return h.error("Expected two arguments.");const f=h.parse(o[1],1,Ot);return f?new yd(f):h.error("No image name provided.")}evaluate(o){const h=this.input.evaluate(o),f=zi.fromString(h);return f&&o.availableImages&&(f.available=o.availableImages.indexOf(h)>-1),f}eachChild(o){o(this.input)}outputDefined(){return!1}}class vd{constructor(o){this.type=Qe,this.input=o}static parse(o,h){if(o.length!==2)return h.error(`Expected 1 argument, but found ${o.length-1} instead.`);const f=h.parse(o[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${z(f.type)} instead.`):new vd(f):null}evaluate(o){const h=this.input.evaluate(o);if(typeof h=="string")return[...h].length;if(Array.isArray(h))return h.length;throw new Bi(`Expected value to be of type string or array, but found ${z(Mi(h))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const Ls=8192;function h0(c,o){const h=(180+c[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,g=Math.pow(2,o.z);return[Math.round(h*g*Ls),Math.round(f*g*Ls)]}function xd(c,o){const h=Math.pow(2,o.z);return[(g=(c[0]/Ls+o.x)/h,360*g-180),(f=(c[1]/Ls+o.y)/h,360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90)];var f,g}function aa(c,o){c[0]=Math.min(c[0],o[0]),c[1]=Math.min(c[1],o[1]),c[2]=Math.max(c[2],o[0]),c[3]=Math.max(c[3],o[1])}function Do(c,o){return!(c[0]<=o[0]||c[2]>=o[2]||c[1]<=o[1]||c[3]>=o[3])}function ni(c,o,h){const f=c[0]-o[0],g=c[1]-o[1],x=c[0]-h[0],b=c[1]-h[1];return f*b-x*g==0&&f*x<=0&&g*b<=0}function mu(c,o,h,f){return(g=[f[0]-h[0],f[1]-h[1]])[0]*(x=[o[0]-c[0],o[1]-c[1]])[1]-g[1]*x[0]!=0&&!(!cm(c,o,h,f)||!cm(h,f,c,o));var g,x}function d0(c,o,h){for(const f of h)for(let g=0;g<f.length-1;++g)if(mu(c,o,f[g],f[g+1]))return!0;return!1}function Ha(c,o,h=!1){let f=!1;for(const A of o)for(let S=0;S<A.length-1;S++){if(ni(c,A[S],A[S+1]))return h;(x=A[S])[1]>(g=c)[1]!=(b=A[S+1])[1]>g[1]&&g[0]<(b[0]-x[0])*(g[1]-x[1])/(b[1]-x[1])+x[0]&&(f=!f)}var g,x,b;return f}function f0(c,o){for(const h of o)if(Ha(c,h))return!0;return!1}function lm(c,o){for(const h of c)if(!Ha(h,o))return!1;for(let h=0;h<c.length-1;++h)if(d0(c[h],c[h+1],o))return!1;return!0}function p0(c,o){for(const h of o)if(lm(c,h))return!0;return!1}function cm(c,o,h,f){const g=f[0]-h[0],x=f[1]-h[1],b=(c[0]-h[0])*x-g*(c[1]-h[1]),A=(o[0]-h[0])*x-g*(o[1]-h[1]);return b>0&&A<0||b<0&&A>0}function bd(c,o,h){const f=[];for(let g=0;g<c.length;g++){const x=[];for(let b=0;b<c[g].length;b++){const A=h0(c[g][b],h);aa(o,A),x.push(A)}f.push(x)}return f}function um(c,o,h){const f=[];for(let g=0;g<c.length;g++){const x=bd(c[g],o,h);f.push(x)}return f}function hm(c,o,h,f){if(c[0]<h[0]||c[0]>h[2]){const g=.5*f;let x=c[0]-h[0]>g?-f:h[0]-c[0]>g?f:0;x===0&&(x=c[0]-h[2]>g?-f:h[2]-c[0]>g?f:0),c[0]+=x}aa(o,c)}function dm(c,o,h,f){const g=Math.pow(2,f.z)*Ls,x=[f.x*Ls,f.y*Ls],b=[];for(const A of c)for(const S of A){const M=[S.x+x[0],S.y+x[1]];hm(M,o,h,g),b.push(M)}return b}function fm(c,o,h,f){const g=Math.pow(2,f.z)*Ls,x=[f.x*Ls,f.y*Ls],b=[];for(const S of c){const M=[];for(const B of S){const O=[B.x+x[0],B.y+x[1]];aa(o,O),M.push(O)}b.push(M)}if(o[2]-o[0]<=g/2){(A=o)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const S of b)for(const M of S)hm(M,o,h,g)}var A;return b}class la{constructor(o,h){this.type=St,this.geojson=o,this.geometries=h}static parse(o,h){if(o.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(ks(o[1])){const f=o[1];if(f.type==="FeatureCollection"){const g=[];for(const x of f.features){const{type:b,coordinates:A}=x.geometry;b==="Polygon"&&g.push(A),b==="MultiPolygon"&&g.push(...A)}if(g.length)return new la(f,{type:"MultiPolygon",coordinates:g})}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new la(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new la(f,f)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(h,f){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=h.canonicalID();if(f.type==="Polygon"){const A=bd(f.coordinates,x,b),S=dm(h.geometry(),g,x,b);if(!Do(g,x))return!1;for(const M of S)if(!Ha(M,A))return!1}if(f.type==="MultiPolygon"){const A=um(f.coordinates,x,b),S=dm(h.geometry(),g,x,b);if(!Do(g,x))return!1;for(const M of S)if(!f0(M,A))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(h,f){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=h.canonicalID();if(f.type==="Polygon"){const A=bd(f.coordinates,x,b),S=fm(h.geometry(),g,x,b);if(!Do(g,x))return!1;for(const M of S)if(!lm(M,A))return!1}if(f.type==="MultiPolygon"){const A=um(f.coordinates,x,b),S=fm(h.geometry(),g,x,b);if(!Do(g,x))return!1;for(const M of S)if(!p0(M,A))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let pm=class{constructor(c=[],o=(h,f)=>h<f?-1:h>f?1:0){if(this.data=c,this.length=this.data.length,this.compare=o,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;const c=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:o,compare:h}=this,f=o[c];for(;c>0;){const g=c-1>>1,x=o[g];if(h(f,x)>=0)break;o[c]=x,c=g}o[c]=f}_down(c){const{data:o,compare:h}=this,f=this.length>>1,g=o[c];for(;c<f;){let x=1+(c<<1);const b=x+1;if(b<this.length&&h(o[b],o[x])<0&&(x=b),h(o[x],g)>=0)break;o[c]=o[x],c=x}o[c]=g}};function m0(c,o,h,f,g){mm(c,o,h,f||c.length-1,g||g0)}function mm(c,o,h,f,g){for(;f>h;){if(f-h>600){var x=f-h+1,b=o-h+1,A=Math.log(x),S=.5*Math.exp(2*A/3),M=.5*Math.sqrt(A*S*(x-S)/x)*(b-x/2<0?-1:1);mm(c,o,Math.max(h,Math.floor(o-b*S/x+M)),Math.min(f,Math.floor(o+(x-b)*S/x+M)),g)}var B=c[o],O=h,U=f;for(ac(c,h,o),g(c[f],B)>0&&ac(c,h,f);O<U;){for(ac(c,O,U),O++,U--;g(c[O],B)<0;)O++;for(;g(c[U],B)>0;)U--}g(c[h],B)===0?ac(c,h,U):ac(c,++U,f),U<=o&&(h=U+1),o<=U&&(f=U-1)}}function ac(c,o,h){var f=c[o];c[o]=c[h],c[h]=f}function g0(c,o){return c<o?-1:c>o?1:0}function gu(c,o){if(c.length<=1)return[c];const h=[];let f,g;for(const x of c){const b=y0(x);b!==0&&(x.area=Math.abs(b),g===void 0&&(g=b<0),g===b<0?(f&&h.push(f),f=[x]):f.push(x))}if(f&&h.push(f),o>1)for(let x=0;x<h.length;x++)h[x].length<=o||(m0(h[x],o,1,h[x].length-1,_0),h[x]=h[x].slice(0,o));return h}function _0(c,o){return o.area-c.area}function y0(c){let o=0;for(let h,f,g=0,x=c.length,b=x-1;g<x;b=g++)h=c[g],f=c[b],o+=(f.x-h.x)*(h.y+f.y);return o}const gm=1/298.257223563,_m=gm*(2-gm),ym=Math.PI/180;class wd{constructor(o){const h=6378.137*ym*1e3,f=Math.cos(o*ym),g=1/(1-_m*(1-f*f)),x=Math.sqrt(g);this.kx=h*x*f,this.ky=h*x*g*(1-_m)}distance(o,h){const f=this.wrap(o[0]-h[0])*this.kx,g=(o[1]-h[1])*this.ky;return Math.sqrt(f*f+g*g)}pointOnLine(o,h){let f,g,x,b,A=1/0;for(let S=0;S<o.length-1;S++){let M=o[S][0],B=o[S][1],O=this.wrap(o[S+1][0]-M)*this.kx,U=(o[S+1][1]-B)*this.ky,j=0;O===0&&U===0||(j=(this.wrap(h[0]-M)*this.kx*O+(h[1]-B)*this.ky*U)/(O*O+U*U),j>1?(M=o[S+1][0],B=o[S+1][1]):j>0&&(M+=O/this.kx*j,B+=U/this.ky*j)),O=this.wrap(h[0]-M)*this.kx,U=(h[1]-B)*this.ky;const G=O*O+U*U;G<A&&(A=G,f=M,g=B,x=S,b=j)}return{point:[f,g],index:x,t:Math.max(0,Math.min(1,b))}}wrap(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}}function vm(c,o){return o[0]-c[0]}function _u(c){return c[1]-c[0]+1}function no(c,o){return c[1]>=c[0]&&c[1]<o}function Ad(c,o){if(c[0]>c[1])return[null,null];const h=_u(c);if(o){if(h===2)return[c,null];const g=Math.floor(h/2);return[[c[0],c[0]+g],[c[0]+g,c[1]]]}if(h===1)return[c,null];const f=Math.floor(h/2)-1;return[[c[0],c[0]+f],[c[0]+f+1,c[1]]]}function Td(c,o){if(!no(o,c.length))return[1/0,1/0,-1/0,-1/0];const h=[1/0,1/0,-1/0,-1/0];for(let f=o[0];f<=o[1];++f)aa(h,c[f]);return h}function Ed(c){const o=[1/0,1/0,-1/0,-1/0];for(const h of c)for(const f of h)aa(o,f);return o}function yu(c){return c[0]!==-1/0&&c[1]!==-1/0&&c[2]!==1/0&&c[3]!==1/0}function Sd(c,o,h){if(!yu(c)||!yu(o))return NaN;let f=0,g=0;return c[2]<o[0]&&(f=o[0]-c[2]),c[0]>o[2]&&(f=c[0]-o[2]),c[1]>o[3]&&(g=c[1]-o[3]),c[3]<o[1]&&(g=o[1]-c[3]),h.distance([0,0],[f,g])}function ca(c,o,h){const f=h.pointOnLine(o,c);return h.distance(c,f.point)}function Cd(c,o,h,f,g){const x=Math.min(ca(c,[h,f],g),ca(o,[h,f],g)),b=Math.min(ca(h,[c,o],g),ca(f,[c,o],g));return Math.min(x,b)}function v0(c,o,h,f,g){if(!no(o,c.length)||!no(f,h.length))return 1/0;let x=1/0;for(let b=o[0];b<o[1];++b){const A=c[b],S=c[b+1];for(let M=f[0];M<f[1];++M){const B=h[M],O=h[M+1];if(mu(A,S,B,O))return 0;x=Math.min(x,Cd(A,S,B,O,g))}}return x}function Wi(c,o,h,f,g){if(!no(o,c.length)||!no(f,h.length))return NaN;let x=1/0;for(let b=o[0];b<=o[1];++b)for(let A=f[0];A<=f[1];++A)if(x=Math.min(x,g.distance(c[b],h[A])),x===0)return x;return x}function x0(c,o,h){if(Ha(c,o,!0))return 0;let f=1/0;for(const g of o){const x=g[0],b=g[g.length-1];if(x!==b&&(f=Math.min(f,ca(c,[b,x],h)),f===0))return f;const A=h.pointOnLine(g,c);if(f=Math.min(f,h.distance(c,A.point)),f===0)return f}return f}function zt(c,o,h,f){if(!no(o,c.length))return NaN;for(let x=o[0];x<=o[1];++x)if(Ha(c[x],h,!0))return 0;let g=1/0;for(let x=o[0];x<o[1];++x){const b=c[x],A=c[x+1];for(const S of h)for(let M=0,B=S.length,O=B-1;M<B;O=M++){const U=S[O],j=S[M];if(mu(b,A,U,j))return 0;g=Math.min(g,Cd(b,A,U,j,f))}}return g}function vu(c,o){for(const h of c)for(const f of h)if(Ha(f,o,!0))return!0;return!1}function vi(c,o,h,f=1/0){const g=Ed(c),x=Ed(o);if(f!==1/0&&Sd(g,x,h)>=f)return f;if(Do(g,x)){if(vu(c,o))return 0}else if(vu(o,c))return 0;let b=1/0;for(const A of c)for(let S=0,M=A.length,B=M-1;S<M;B=S++){const O=A[B],U=A[S];for(const j of o)for(let G=0,Z=j.length,se=Z-1;G<Z;se=G++){const le=j[se],Ee=j[G];if(mu(O,U,le,Ee))return 0;b=Math.min(b,Cd(O,U,le,Ee,h))}}return b}function ci(c,o,h,f,g,x){if(!x)return;const b=Sd(Td(f,x),g,h);b<o&&c.push([b,x,[0,0]])}function ua(c,o,h,f,g,x,b){if(!x||!b)return;const A=Sd(Td(f,x),Td(g,b),h);A<o&&c.push([A,x,b])}function lc(c,o,h,f,g=1/0){let x=Math.min(f.distance(c[0],h[0][0]),g);if(x===0)return x;const b=new pm([[0,[0,c.length-1],[0,0]]],vm),A=Ed(h);for(;b.length>0;){const S=b.pop();if(S[0]>=x)continue;const M=S[1],B=o?50:100;if(_u(M)<=B){if(!no(M,c.length))return NaN;if(o){const O=zt(c,M,h,f);if(isNaN(O)||O===0)return O;x=Math.min(x,O)}else for(let O=M[0];O<=M[1];++O){const U=x0(c[O],h,f);if(x=Math.min(x,U),x===0)return 0}}else{const O=Ad(M,o);ci(b,x,f,c,A,O[0]),ci(b,x,f,c,A,O[1])}}return x}function cc(c,o,h,f,g,x=1/0){let b=Math.min(x,g.distance(c[0],h[0]));if(b===0)return b;const A=new pm([[0,[0,c.length-1],[0,h.length-1]]],vm);for(;A.length>0;){const S=A.pop();if(S[0]>=b)continue;const M=S[1],B=S[2],O=o?50:100,U=f?50:100;if(_u(M)<=O&&_u(B)<=U){if(!no(M,c.length)&&no(B,h.length))return NaN;let j;if(o&&f)j=v0(c,M,h,B,g),b=Math.min(b,j);else if(o&&!f){const G=c.slice(M[0],M[1]+1);for(let Z=B[0];Z<=B[1];++Z)if(j=ca(h[Z],G,g),b=Math.min(b,j),b===0)return b}else if(!o&&f){const G=h.slice(B[0],B[1]+1);for(let Z=M[0];Z<=M[1];++Z)if(j=ca(c[Z],G,g),b=Math.min(b,j),b===0)return b}else j=Wi(c,M,h,B,g),b=Math.min(b,j)}else{const j=Ad(M,o),G=Ad(B,f);ua(A,b,g,c,h,j[0],G[0]),ua(A,b,g,c,h,j[0],G[1]),ua(A,b,g,c,h,j[1],G[0]),ua(A,b,g,c,h,j[1],G[1])}}return b}function Id(c){return c.type==="MultiPolygon"?c.coordinates.map(o=>({type:"Polygon",coordinates:o})):c.type==="MultiLineString"?c.coordinates.map(o=>({type:"LineString",coordinates:o})):c.type==="MultiPoint"?c.coordinates.map(o=>({type:"Point",coordinates:o})):[c]}class ha{constructor(o,h){this.type=Qe,this.geojson=o,this.geometries=h}static parse(o,h){if(o.length!==2)return h.error(`'distance' expression requires exactly one argument, but found ${o.length-1} instead.`);if(ks(o[1])){const f=o[1];if(f.type==="FeatureCollection")return new ha(f,f.features.map(g=>Id(g.geometry)).flat());if(f.type==="Feature")return new ha(f,Id(f.geometry));if("type"in f&&"coordinates"in f)return new ha(f,Id(f))}return h.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(h,f){const g=h.geometry(),x=g.flat().map(S=>xd([S.x,S.y],h.canonical));if(g.length===0)return NaN;const b=new wd(x[0][1]);let A=1/0;for(const S of f){switch(S.type){case"Point":A=Math.min(A,cc(x,!1,[S.coordinates],!1,b,A));break;case"LineString":A=Math.min(A,cc(x,!1,S.coordinates,!0,b,A));break;case"Polygon":A=Math.min(A,lc(x,!1,S.coordinates,b,A))}if(A===0)return A}return A}(o,this.geometries);if(o.geometryType()==="LineString")return function(h,f){const g=h.geometry(),x=g.flat().map(S=>xd([S.x,S.y],h.canonical));if(g.length===0)return NaN;const b=new wd(x[0][1]);let A=1/0;for(const S of f){switch(S.type){case"Point":A=Math.min(A,cc(x,!0,[S.coordinates],!1,b,A));break;case"LineString":A=Math.min(A,cc(x,!0,S.coordinates,!0,b,A));break;case"Polygon":A=Math.min(A,lc(x,!0,S.coordinates,b,A))}if(A===0)return A}return A}(o,this.geometries);if(o.geometryType()==="Polygon")return function(h,f){const g=h.geometry();if(g.length===0||g[0].length===0)return NaN;const x=gu(g,0).map(S=>S.map(M=>M.map(B=>xd([B.x,B.y],h.canonical)))),b=new wd(x[0][0][0][1]);let A=1/0;for(const S of f)for(const M of x){switch(S.type){case"Point":A=Math.min(A,lc([S.coordinates],!1,M,b,A));break;case"LineString":A=Math.min(A,lc(S.coordinates,!0,M,b,A));break;case"Polygon":A=Math.min(A,vi(M,S.coordinates,b,A))}if(A===0)return A}return A}(o,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const $a={"==":l0,"!=":sm,">":c0,"<":om,">=":am,"<=":u0,array:tr,at:nc,boolean:tr,case:de,coalesce:du,collator:oc,format:pu,image:yd,in:rc,"index-of":q,interpolate:pr,"interpolate-hcl":pr,"interpolate-lab":pr,length:vd,let:Gr,literal:Nn,match:ee,number:tr,"number-format":_d,object:tr,slice:De,step:ht,string:tr,"to-boolean":Ln,"to-color":Ln,"to-number":Ln,"to-string":Ln,var:Kt,within:la,distance:ha};class Wr{constructor(o,h,f,g){this.name=o,this.type=h,this._evaluate=f,this.args=g}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,h){const f=o[0],g=Wr.definitions[f];if(!g)return h.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,A=b.filter(([M])=>!Array.isArray(M)||M.length===o.length-1);let S=null;for(const[M,B]of A){S=new Ns(h.registry,uc,h.path,null,h.scope);const O=[];let U=!1;for(let j=1;j<o.length;j++){const G=o[j],Z=Array.isArray(M)?M[j-1]:M.type,se=S.parse(G,1+O.length,Z);if(!se){U=!0;break}O.push(se)}if(!U)if(Array.isArray(M)&&M.length!==O.length)S.error(`Expected ${M.length} arguments, but found ${O.length} instead.`);else{for(let j=0;j<O.length;j++){const G=Array.isArray(M)?M[j]:M.type,Z=O[j];S.concat(j+1).checkSubtype(G,Z.type)}if(S.errors.length===0)return new Wr(f,x,B,O)}}if(A.length===1)h.errors.push(...S.errors);else{const M=(A.length?A:b).map(([O])=>{return U=O,Array.isArray(U)?`(${U.map(z).join(", ")})`:`(${z(U.type)}...)`;var U}).join(" | "),B=[];for(let O=1;O<o.length;O++){const U=h.parse(o[O],1+B.length);if(!U)return null;B.push(z(U.type))}h.error(`Expected arguments of type ${M}, but found (${B.join(", ")}) instead.`)}return null}static register(o,h){Wr.definitions=h;for(const f in h)o[f]=Wr}}function Rd(c,[o,h,f,g]){o=o.evaluate(c),h=h.evaluate(c),f=f.evaluate(c);const x=g?g.evaluate(c):1,b=io(o,h,f,x);if(b)throw new Bi(b);return new Zt(o/255,h/255,f/255,x,!1)}function Pd(c,o){return c in o}function Md(c,o){const h=o[c];return h===void 0?null:h}function da(c){return{type:c}}function uc(c){if(c instanceof Kt)return uc(c.boundExpression);if(c instanceof Wr&&c.name==="error"||c instanceof oc||c instanceof la||c instanceof ha)return!1;const o=c instanceof Ln||c instanceof tr;let h=!0;return c.eachChild(f=>{h=o?h&&uc(f):h&&f instanceof Nn}),!!h&&hc(c)&&dc(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function hc(c){if(c instanceof Wr&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof la||c instanceof ha)return!1;let o=!0;return c.eachChild(h=>{o&&!hc(h)&&(o=!1)}),o}function Ga(c){if(c instanceof Wr&&c.name==="feature-state")return!1;let o=!0;return c.eachChild(h=>{o&&!Ga(h)&&(o=!1)}),o}function dc(c,o){if(c instanceof Wr&&o.indexOf(c.name)>=0)return!1;let h=!0;return c.eachChild(f=>{h&&!dc(f,o)&&(h=!1)}),h}function xu(c){return{result:"success",value:c}}function Wa(c){return{result:"error",value:c}}function Xa(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function xm(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Bd(c){return!!c.expression&&c.expression.interpolated}function Qt(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function bu(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function b0(c){return c}function bm(c,o){const h=o.type==="color",f=c.stops&&typeof c.stops[0][0]=="object",g=f||!(f||c.property!==void 0),x=c.type||(Bd(o)?"exponential":"interval");if(h||o.type==="padding"){const B=h?Zt.parse:Li.parse;(c=Pr({},c)).stops&&(c.stops=c.stops.map(O=>[O[0],B(O[1])])),c.default=B(c.default?c.default:o.default)}if(c.colorSpace&&(b=c.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var b;let A,S,M;if(x==="exponential")A=Am;else if(x==="interval")A=wu;else if(x==="categorical"){A=wm,S=Object.create(null);for(const B of c.stops)S[B[0]]=B[1];M=typeof c.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);A=Tm}if(f){const B={},O=[];for(let G=0;G<c.stops.length;G++){const Z=c.stops[G],se=Z[0].zoom;B[se]===void 0&&(B[se]={zoom:se,type:c.type,property:c.property,default:c.default,stops:[]},O.push(se)),B[se].stops.push([Z[0].value,Z[1]])}const U=[];for(const G of O)U.push([B[G].zoom,bm(B[G],o)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:pr.interpolationFactor.bind(void 0,j),zoomStops:U.map(G=>G[0]),evaluate:({zoom:G},Z)=>Am({stops:U,base:c.base},o,G).evaluate(G,Z)}}if(g){const B=x==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:B,interpolationFactor:pr.interpolationFactor.bind(void 0,B),zoomStops:c.stops.map(O=>O[0]),evaluate:({zoom:O})=>A(c,o,O,S,M)}}return{kind:"source",evaluate(B,O){const U=O&&O.properties?O.properties[c.property]:void 0;return U===void 0?qa(c.default,o.default):A(c,o,U,S,M)}}}function qa(c,o,h){return c!==void 0?c:o!==void 0?o:h!==void 0?h:void 0}function wm(c,o,h,f,g){return qa(typeof h===g?f[h]:void 0,c.default,o.default)}function wu(c,o,h){if(Qt(h)!=="number")return qa(c.default,o.default);const f=c.stops.length;if(f===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[f-1][0])return c.stops[f-1][1];const g=$e(c.stops.map(x=>x[0]),h);return c.stops[g][1]}function Am(c,o,h){const f=c.base!==void 0?c.base:1;if(Qt(h)!=="number")return qa(c.default,o.default);const g=c.stops.length;if(g===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[g-1][0])return c.stops[g-1][1];const x=$e(c.stops.map(B=>B[0]),h),b=function(B,O,U,j){const G=j-U,Z=B-U;return G===0?0:O===1?Z/G:(Math.pow(O,Z)-1)/(Math.pow(O,G)-1)}(h,f,c.stops[x][0],c.stops[x+1][0]),A=c.stops[x][1],S=c.stops[x+1][1],M=fr[o.type]||b0;return typeof A.evaluate=="function"?{evaluate(...B){const O=A.evaluate.apply(void 0,B),U=S.evaluate.apply(void 0,B);if(O!==void 0&&U!==void 0)return M(O,U,b,c.colorSpace)}}:M(A,S,b,c.colorSpace)}function Tm(c,o,h){switch(o.type){case"color":h=Zt.parse(h);break;case"formatted":h=Gi.fromString(h.toString());break;case"resolvedImage":h=zi.fromString(h.toString());break;case"padding":h=Li.parse(h);break;default:Qt(h)===o.type||o.type==="enum"&&o.values[h]||(h=void 0)}return qa(h,c.default,o.default)}Wr.register($a,{error:[{kind:"error"},[Ot],(c,[o])=>{throw new Bi(o.evaluate(c))}],typeof:[Ot,[Ct],(c,[o])=>z(Mi(o.evaluate(c)))],"to-rgba":[V(Qe,4),[kn],(c,[o])=>{const[h,f,g,x]=o.evaluate(c).rgb;return[255*h,255*f,255*g,x]}],rgb:[kn,[Qe,Qe,Qe],Rd],rgba:[kn,[Qe,Qe,Qe,Qe],Rd],has:{type:St,overloads:[[[Ot],(c,[o])=>Pd(o.evaluate(c),c.properties())],[[Ot,Mr],(c,[o,h])=>Pd(o.evaluate(c),h.evaluate(c))]]},get:{type:Ct,overloads:[[[Ot],(c,[o])=>Md(o.evaluate(c),c.properties())],[[Ot,Mr],(c,[o,h])=>Md(o.evaluate(c),h.evaluate(c))]]},"feature-state":[Ct,[Ot],(c,[o])=>Md(o.evaluate(c),c.featureState||{})],properties:[Mr,[],c=>c.properties()],"geometry-type":[Ot,[],c=>c.geometryType()],id:[Ct,[],c=>c.id()],zoom:[Qe,[],c=>c.globals.zoom],"heatmap-density":[Qe,[],c=>c.globals.heatmapDensity||0],"line-progress":[Qe,[],c=>c.globals.lineProgress||0],accumulated:[Ct,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Qe,da(Qe),(c,o)=>{let h=0;for(const f of o)h+=f.evaluate(c);return h}],"*":[Qe,da(Qe),(c,o)=>{let h=1;for(const f of o)h*=f.evaluate(c);return h}],"-":{type:Qe,overloads:[[[Qe,Qe],(c,[o,h])=>o.evaluate(c)-h.evaluate(c)],[[Qe],(c,[o])=>-o.evaluate(c)]]},"/":[Qe,[Qe,Qe],(c,[o,h])=>o.evaluate(c)/h.evaluate(c)],"%":[Qe,[Qe,Qe],(c,[o,h])=>o.evaluate(c)%h.evaluate(c)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(c,[o,h])=>Math.pow(o.evaluate(c),h.evaluate(c))],sqrt:[Qe,[Qe],(c,[o])=>Math.sqrt(o.evaluate(c))],log10:[Qe,[Qe],(c,[o])=>Math.log(o.evaluate(c))/Math.LN10],ln:[Qe,[Qe],(c,[o])=>Math.log(o.evaluate(c))],log2:[Qe,[Qe],(c,[o])=>Math.log(o.evaluate(c))/Math.LN2],sin:[Qe,[Qe],(c,[o])=>Math.sin(o.evaluate(c))],cos:[Qe,[Qe],(c,[o])=>Math.cos(o.evaluate(c))],tan:[Qe,[Qe],(c,[o])=>Math.tan(o.evaluate(c))],asin:[Qe,[Qe],(c,[o])=>Math.asin(o.evaluate(c))],acos:[Qe,[Qe],(c,[o])=>Math.acos(o.evaluate(c))],atan:[Qe,[Qe],(c,[o])=>Math.atan(o.evaluate(c))],min:[Qe,da(Qe),(c,o)=>Math.min(...o.map(h=>h.evaluate(c)))],max:[Qe,da(Qe),(c,o)=>Math.max(...o.map(h=>h.evaluate(c)))],abs:[Qe,[Qe],(c,[o])=>Math.abs(o.evaluate(c))],round:[Qe,[Qe],(c,[o])=>{const h=o.evaluate(c);return h<0?-Math.round(-h):Math.round(h)}],floor:[Qe,[Qe],(c,[o])=>Math.floor(o.evaluate(c))],ceil:[Qe,[Qe],(c,[o])=>Math.ceil(o.evaluate(c))],"filter-==":[St,[Ot,Ct],(c,[o,h])=>c.properties()[o.value]===h.value],"filter-id-==":[St,[Ct],(c,[o])=>c.id()===o.value],"filter-type-==":[St,[Ot],(c,[o])=>c.geometryType()===o.value],"filter-<":[St,[Ot,Ct],(c,[o,h])=>{const f=c.properties()[o.value],g=h.value;return typeof f==typeof g&&f<g}],"filter-id-<":[St,[Ct],(c,[o])=>{const h=c.id(),f=o.value;return typeof h==typeof f&&h<f}],"filter->":[St,[Ot,Ct],(c,[o,h])=>{const f=c.properties()[o.value],g=h.value;return typeof f==typeof g&&f>g}],"filter-id->":[St,[Ct],(c,[o])=>{const h=c.id(),f=o.value;return typeof h==typeof f&&h>f}],"filter-<=":[St,[Ot,Ct],(c,[o,h])=>{const f=c.properties()[o.value],g=h.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[St,[Ct],(c,[o])=>{const h=c.id(),f=o.value;return typeof h==typeof f&&h<=f}],"filter->=":[St,[Ot,Ct],(c,[o,h])=>{const f=c.properties()[o.value],g=h.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[St,[Ct],(c,[o])=>{const h=c.id(),f=o.value;return typeof h==typeof f&&h>=f}],"filter-has":[St,[Ct],(c,[o])=>o.value in c.properties()],"filter-has-id":[St,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[St,[V(Ot)],(c,[o])=>o.value.indexOf(c.geometryType())>=0],"filter-id-in":[St,[V(Ct)],(c,[o])=>o.value.indexOf(c.id())>=0],"filter-in-small":[St,[Ot,V(Ct)],(c,[o,h])=>h.value.indexOf(c.properties()[o.value])>=0],"filter-in-large":[St,[Ot,V(Ct)],(c,[o,h])=>function(f,g,x,b){for(;x<=b;){const A=x+b>>1;if(g[A]===f)return!0;g[A]>f?b=A-1:x=A+1}return!1}(c.properties()[o.value],h.value,0,h.value.length-1)],all:{type:St,overloads:[[[St,St],(c,[o,h])=>o.evaluate(c)&&h.evaluate(c)],[da(St),(c,o)=>{for(const h of o)if(!h.evaluate(c))return!1;return!0}]]},any:{type:St,overloads:[[[St,St],(c,[o,h])=>o.evaluate(c)||h.evaluate(c)],[da(St),(c,o)=>{for(const h of o)if(h.evaluate(c))return!0;return!1}]]},"!":[St,[St],(c,[o])=>!o.evaluate(c)],"is-supported-script":[St,[Ot],(c,[o])=>{const h=c.globals&&c.globals.isSupportedScript;return!h||h(o.evaluate(c))}],upcase:[Ot,[Ot],(c,[o])=>o.evaluate(c).toUpperCase()],downcase:[Ot,[Ot],(c,[o])=>o.evaluate(c).toLowerCase()],concat:[Ot,da(Ct),(c,o)=>o.map(h=>Cn(h.evaluate(c))).join("")],"resolved-locale":[Ot,[$r],(c,[o])=>o.evaluate(c).resolvedLocale()]});class Au{constructor(o,h){var f;this.expression=o,this._warningHistory={},this._evaluator=new Va,this._defaultValue=h?(f=h).type==="color"&&bu(f.default)?new Zt(0,0,0,0):f.type==="color"?Zt.parse(f.default)||null:f.type==="padding"?Li.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?Ui.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(o,h,f,g,x,b){return this._evaluator.globals=o,this._evaluator.feature=h,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(o,h,f,g,x,b){this._evaluator.globals=o,this._evaluator.feature=h||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Bi(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function Tu(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in $a}function Ka(c,o){const h=new Ns($a,uc,[],o?function(g){const x={color:kn,string:Ot,number:Qe,enum:Ot,boolean:St,formatted:cs,padding:us,resolvedImage:Br,variableAnchorOffsetCollection:ae};return g.type==="array"?V(x[g.value]||Ct,g.length):x[g.type]}(o):void 0),f=h.parse(c,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?xu(new Au(f,o)):Wa(h.errors)}class Za{constructor(o,h){this.kind=o,this._styleExpression=h,this.isStateDependent=o!=="constant"&&!Ga(h.expression)}evaluateWithoutErrorHandling(o,h,f,g,x,b){return this._styleExpression.evaluateWithoutErrorHandling(o,h,f,g,x,b)}evaluate(o,h,f,g,x,b){return this._styleExpression.evaluate(o,h,f,g,x,b)}}class Ya{constructor(o,h,f,g){this.kind=o,this.zoomStops=f,this._styleExpression=h,this.isStateDependent=o!=="camera"&&!Ga(h.expression),this.interpolationType=g}evaluateWithoutErrorHandling(o,h,f,g,x,b){return this._styleExpression.evaluateWithoutErrorHandling(o,h,f,g,x,b)}evaluate(o,h,f,g,x,b){return this._styleExpression.evaluate(o,h,f,g,x,b)}interpolationFactor(o,h,f){return this.interpolationType?pr.interpolationFactor(this.interpolationType,o,h,f):0}}function Dd(c,o){const h=Ka(c,o);if(h.result==="error")return h;const f=h.value.expression,g=hc(f);if(!g&&!Xa(o))return Wa([new _n("","data expressions not supported")]);const x=dc(f,["zoom"]);if(!x&&!xm(o))return Wa([new _n("","zoom expressions not supported")]);const b=fc(f);return b||x?b instanceof _n?Wa([b]):b instanceof pr&&!Bd(o)?Wa([new _n("",'"interpolate" expressions cannot be used with this property')]):xu(b?new Ya(g?"camera":"composite",h.value,b.labels,b instanceof pr?b.interpolation:void 0):new Za(g?"constant":"source",h.value)):Wa([new _n("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ja{constructor(o,h){this._parameters=o,this._specification=h,Pr(this,bm(this._parameters,this._specification))}static deserialize(o){return new Ja(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function fc(c){let o=null;if(c instanceof Gr)o=fc(c.result);else if(c instanceof du){for(const h of c.args)if(o=fc(h),o)break}else(c instanceof ht||c instanceof pr)&&c.input instanceof Wr&&c.input.name==="zoom"&&(o=c);return o instanceof _n||c.eachChild(h=>{const f=fc(h);f instanceof _n?o=f:!o&&f?o=new _n("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&f&&o!==f&&(o=new _n("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}function Eu(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const o of c.slice(1))if(!Eu(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}const Su={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Od(c){if(c==null)return{filter:()=>!0,needGeometry:!1};Eu(c)||(c=Cu(c));const o=Ka(c,Su);if(o.result==="error")throw new Error(o.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,f,g)=>o.value.evaluate(h,f,{},g),needGeometry:Em(c)}}function w0(c,o){return c<o?-1:c>o?1:0}function Em(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let o=1;o<c.length;o++)if(Em(c[o]))return!0;return!1}function Cu(c){if(!c)return!0;const o=c[0];return c.length<=1?o!=="any":o==="=="?kd(c[1],c[2],"=="):o==="!="?Un(kd(c[1],c[2],"==")):o==="<"||o===">"||o==="<="||o===">="?kd(c[1],c[2],o):o==="any"?(h=c.slice(1),["any"].concat(h.map(Cu))):o==="all"?["all"].concat(c.slice(1).map(Cu)):o==="none"?["all"].concat(c.slice(1).map(Cu).map(Un)):o==="in"?pc(c[1],c.slice(2)):o==="!in"?Un(pc(c[1],c.slice(2))):o==="has"?mc(c[1]):o!=="!has"||Un(mc(c[1]));var h}function kd(c,o,h){switch(c){case"$type":return[`filter-type-${h}`,o];case"$id":return[`filter-id-${h}`,o];default:return[`filter-${h}`,c,o]}}function pc(c,o){if(o.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(h=>typeof h!=typeof o[0])?["filter-in-large",c,["literal",o.sort(w0)]]:["filter-in-small",c,["literal",o]]}}function mc(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Un(c){return["!",c]}function fa(c){const o=typeof c;if(o==="number"||o==="boolean"||o==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let g="[";for(const x of c)g+=`${fa(x)},`;return`${g}]`}const h=Object.keys(c).sort();let f="{";for(let g=0;g<h.length;g++)f+=`${JSON.stringify(h[g])}:${fa(c[h[g]])},`;return`${f}}`}function Sm(c){let o="";for(const h of Qn)o+=`/${fa(c[h])}`;return o}function Cm(c){const o=c.value;return o?[new We(c.key,o,"constants have been deprecated as of v8")]:[]}function Xi(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function hs(c){if(Array.isArray(c))return c.map(hs);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const o={};for(const h in c)o[h]=hs(c[h]);return o}return Xi(c)}function Dr(c){const o=c.key,h=c.value,f=c.valueSpec||{},g=c.objectElementValidators||{},x=c.style,b=c.styleSpec,A=c.validateSpec;let S=[];const M=Qt(h);if(M!=="object")return[new We(o,h,`object expected, ${M} found`)];for(const B in h){const O=B.split(".")[0],U=f[O]||f["*"];let j;if(g[O])j=g[O];else if(f[O])j=A;else if(g["*"])j=g["*"];else{if(!f["*"]){S.push(new We(o,h[B],`unknown property "${B}"`));continue}j=A}S=S.concat(j({key:(o&&`${o}.`)+B,value:h[B],valueSpec:U,style:x,styleSpec:b,object:h,objectKey:B,validateSpec:A},h))}for(const B in f)g[B]||f[B].required&&f[B].default===void 0&&h[B]===void 0&&S.push(new We(o,h,`missing required property "${B}"`));return S}function gc(c){const o=c.value,h=c.valueSpec,f=c.style,g=c.styleSpec,x=c.key,b=c.arrayElementValidator||c.validateSpec;if(Qt(o)!=="array")return[new We(x,o,`array expected, ${Qt(o)} found`)];if(h.length&&o.length!==h.length)return[new We(x,o,`array length ${h.length} expected, length ${o.length} found`)];if(h["min-length"]&&o.length<h["min-length"])return[new We(x,o,`array length at least ${h["min-length"]} expected, length ${o.length} found`)];let A={type:h.value,values:h.values};g.$version<7&&(A.function=h.function),Qt(h.value)==="object"&&(A=h.value);let S=[];for(let M=0;M<o.length;M++)S=S.concat(b({array:o,arrayIndex:M,value:o[M],valueSpec:A,validateSpec:c.validateSpec,style:f,styleSpec:g,key:`${x}[${M}]`}));return S}function Fd(c){const o=c.key,h=c.value,f=c.valueSpec;let g=Qt(h);return g==="number"&&h!=h&&(g="NaN"),g!=="number"?[new We(o,h,`number expected, ${g} found`)]:"minimum"in f&&h<f.minimum?[new We(o,h,`${h} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&h>f.maximum?[new We(o,h,`${h} is greater than the maximum value ${f.maximum}`)]:[]}function Iu(c){const o=c.valueSpec,h=Xi(c.value.type);let f,g,x,b={};const A=h!=="categorical"&&c.value.property===void 0,S=!A,M=Qt(c.value.stops)==="array"&&Qt(c.value.stops[0])==="array"&&Qt(c.value.stops[0][0])==="object",B=Dr({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(j){if(h==="identity")return[new We(j.key,j.value,'identity function may not have a "stops" property')];let G=[];const Z=j.value;return G=G.concat(gc({key:j.key,value:Z,valueSpec:j.valueSpec,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:O})),Qt(Z)==="array"&&Z.length===0&&G.push(new We(j.key,Z,"array must have at least one stop")),G},default:function(j){return j.validateSpec({key:j.key,value:j.value,valueSpec:o,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec})}}});return h==="identity"&&A&&B.push(new We(c.key,c.value,'missing required property "property"')),h==="identity"||c.value.stops||B.push(new We(c.key,c.value,'missing required property "stops"')),h==="exponential"&&c.valueSpec.expression&&!Bd(c.valueSpec)&&B.push(new We(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(S&&!Xa(c.valueSpec)?B.push(new We(c.key,c.value,"property functions not supported")):A&&!xm(c.valueSpec)&&B.push(new We(c.key,c.value,"zoom functions not supported"))),h!=="categorical"&&!M||c.value.property!==void 0||B.push(new We(c.key,c.value,'"property" property is required')),B;function O(j){let G=[];const Z=j.value,se=j.key;if(Qt(Z)!=="array")return[new We(se,Z,`array expected, ${Qt(Z)} found`)];if(Z.length!==2)return[new We(se,Z,`array length 2 expected, length ${Z.length} found`)];if(M){if(Qt(Z[0])!=="object")return[new We(se,Z,`object expected, ${Qt(Z[0])} found`)];if(Z[0].zoom===void 0)return[new We(se,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new We(se,Z,"object stop key must have value")];if(x&&x>Xi(Z[0].zoom))return[new We(se,Z[0].zoom,"stop zoom values must appear in ascending order")];Xi(Z[0].zoom)!==x&&(x=Xi(Z[0].zoom),g=void 0,b={}),G=G.concat(Dr({key:`${se}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:Fd,value:U}}))}else G=G.concat(U({key:`${se}[0]`,value:Z[0],valueSpec:{},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec},Z));return Tu(hs(Z[1]))?G.concat([new We(`${se}[1]`,Z[1],"expressions are not allowed in function stops.")]):G.concat(j.validateSpec({key:`${se}[1]`,value:Z[1],valueSpec:o,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec}))}function U(j,G){const Z=Qt(j.value),se=Xi(j.value),le=j.value!==null?j.value:G;if(f){if(Z!==f)return[new We(j.key,le,`${Z} stop domain type must match previous stop domain type ${f}`)]}else f=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new We(j.key,le,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&h!=="categorical"){let Ee=`number expected, ${Z} found`;return Xa(o)&&h===void 0&&(Ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(j.key,le,Ee)]}return h!=="categorical"||Z!=="number"||isFinite(se)&&Math.floor(se)===se?h!=="categorical"&&Z==="number"&&g!==void 0&&se<g?[new We(j.key,le,"stop domain values must appear in ascending order")]:(g=se,h==="categorical"&&se in b?[new We(j.key,le,"stop domain values must be unique")]:(b[se]=!0,[])):[new We(j.key,le,`integer expected, found ${se}`)]}}function Qa(c){const o=(c.expressionContext==="property"?Dd:Ka)(hs(c.value),c.valueSpec);if(o.result==="error")return o.value.map(f=>new We(`${c.key}${f.key}`,c.value,f.message));const h=o.value.expression||o.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!h.outputDefined())return[new We(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!Ga(h))return[new We(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!Ga(h))return[new We(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!dc(h,["zoom","feature-state"]))return[new We(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!hc(h))return[new We(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ro(c){const o=c.key,h=c.value,f=c.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(Xi(h))===-1&&g.push(new We(o,h,`expected one of [${f.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(f.values).indexOf(Xi(h))===-1&&g.push(new We(o,h,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(h)} found`)),g}function Nd(c){return Eu(hs(c.value))?Qa(Pr({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ru(c)}function Ru(c){const o=c.value,h=c.key;if(Qt(o)!=="array")return[new We(h,o,`array expected, ${Qt(o)} found`)];const f=c.styleSpec;let g,x=[];if(o.length<1)return[new We(h,o,"filter array must have at least 1 element")];switch(x=x.concat(ro({key:`${h}[0]`,value:o[0],valueSpec:f.filter_operator,style:c.style,styleSpec:c.styleSpec})),Xi(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&Xi(o[1])==="$type"&&x.push(new We(h,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&x.push(new We(h,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(g=Qt(o[1]),g!=="string"&&x.push(new We(`${h}[1]`,o[1],`string expected, ${g} found`)));for(let b=2;b<o.length;b++)g=Qt(o[b]),Xi(o[1])==="$type"?x=x.concat(ro({key:`${h}[${b}]`,value:o[b],valueSpec:f.geometry_type,style:c.style,styleSpec:c.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&x.push(new We(`${h}[${b}]`,o[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<o.length;b++)x=x.concat(Ru({key:`${h}[${b}]`,value:o[b],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":g=Qt(o[1]),o.length!==2?x.push(new We(h,o,`filter array for "${o[0]}" operator must have 2 elements`)):g!=="string"&&x.push(new We(`${h}[1]`,o[1],`string expected, ${g} found`))}return x}function Ld(c,o){const h=c.key,f=c.validateSpec,g=c.style,x=c.styleSpec,b=c.value,A=c.objectKey,S=x[`${o}_${c.layerType}`];if(!S)return[];const M=A.match(/^(.*)-transition$/);if(o==="paint"&&M&&S[M[1]]&&S[M[1]].transition)return f({key:h,value:b,valueSpec:x.transition,style:g,styleSpec:x});const B=c.valueSpec||S[A];if(!B)return[new We(h,b,`unknown property "${A}"`)];let O;if(Qt(b)==="string"&&Xa(B)&&!B.tokens&&(O=/^{([^}]+)}$/.exec(b)))return[new We(h,b,`"${A}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const U=[];return c.layerType==="symbol"&&(A==="text-field"&&g&&!g.glyphs&&U.push(new We(h,b,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&bu(hs(b))&&Xi(b.type)==="identity"&&U.push(new We(h,b,'"text-font" does not support identity functions'))),U.concat(f({key:c.key,value:b,valueSpec:B,style:g,styleSpec:x,expressionContext:"property",propertyType:o,propertyKey:A}))}function Pu(c){return Ld(c,"paint")}function Ud(c){return Ld(c,"layout")}function zd(c){let o=[];const h=c.value,f=c.key,g=c.style,x=c.styleSpec;h.type||h.ref||o.push(new We(f,h,'either "type" or "ref" is required'));let b=Xi(h.type);const A=Xi(h.ref);if(h.id){const S=Xi(h.id);for(let M=0;M<c.arrayIndex;M++){const B=g.layers[M];Xi(B.id)===S&&o.push(new We(f,h.id,`duplicate layer id "${h.id}", previously used at line ${B.id.__line__}`))}}if("ref"in h){let S;["type","source","source-layer","filter","layout"].forEach(M=>{M in h&&o.push(new We(f,h[M],`"${M}" is prohibited for ref layers`))}),g.layers.forEach(M=>{Xi(M.id)===A&&(S=M)}),S?S.ref?o.push(new We(f,h.ref,"ref cannot reference another ref layer")):b=Xi(S.type):o.push(new We(f,h.ref,`ref layer "${A}" not found`))}else if(b!=="background")if(h.source){const S=g.sources&&g.sources[h.source],M=S&&Xi(S.type);S?M==="vector"&&b==="raster"?o.push(new We(f,h.source,`layer "${h.id}" requires a raster source`)):M!=="raster-dem"&&b==="hillshade"?o.push(new We(f,h.source,`layer "${h.id}" requires a raster-dem source`)):M==="raster"&&b!=="raster"?o.push(new We(f,h.source,`layer "${h.id}" requires a vector source`)):M!=="vector"||h["source-layer"]?M==="raster-dem"&&b!=="hillshade"?o.push(new We(f,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!h.paint||!h.paint["line-gradient"]||M==="geojson"&&S.lineMetrics||o.push(new We(f,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new We(f,h,`layer "${h.id}" must specify a "source-layer"`)):o.push(new We(f,h.source,`source "${h.source}" not found`))}else o.push(new We(f,h,'missing required property "source"'));return o=o.concat(Dr({key:f,value:h,valueSpec:x.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${f}.type`,value:h.type,valueSpec:x.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:h,objectKey:"type"}),filter:Nd,layout:S=>Dr({layer:h,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":M=>Ud(Pr({layerType:b},M))}}),paint:S=>Dr({layer:h,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":M=>Pu(Pr({layerType:b},M))}})}})),o}function pa(c){const o=c.value,h=c.key,f=Qt(o);return f!=="string"?[new We(h,o,`string expected, ${f} found`)]:[]}const Mu={promoteId:function({key:c,value:o}){if(Qt(o)==="string")return pa({key:c,value:o});{const h=[];for(const f in o)h.push(...pa({key:`${c}.${f}`,value:o[f]}));return h}}};function _c(c){const o=c.value,h=c.key,f=c.styleSpec,g=c.style,x=c.validateSpec;if(!o.type)return[new We(h,o,'"type" is required')];const b=Xi(o.type);let A;switch(b){case"vector":case"raster":return A=Dr({key:h,value:o,valueSpec:f[`source_${b.replace("-","_")}`],style:c.style,styleSpec:f,objectElementValidators:Mu,validateSpec:x}),A;case"raster-dem":return A=function(S){var M;const B=(M=S.sourceName)!==null&&M!==void 0?M:"",O=S.value,U=S.styleSpec,j=U.source_raster_dem,G=S.style;let Z=[];const se=Qt(O);if(O===void 0)return Z;if(se!=="object")return Z.push(new We("source_raster_dem",O,`object expected, ${se} found`)),Z;const le=Xi(O.encoding)==="custom",Ee=["redFactor","greenFactor","blueFactor","baseShift"],_e=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const be in O)!le&&Ee.includes(be)?Z.push(new We(be,O[be],`In "${B}": "${be}" is only valid when "encoding" is set to "custom". ${_e} encoding found`)):j[be]?Z=Z.concat(S.validateSpec({key:be,value:O[be],valueSpec:j[be],validateSpec:S.validateSpec,style:G,styleSpec:U})):Z.push(new We(be,O[be],`unknown property "${be}"`));return Z}({sourceName:h,value:o,style:c.style,styleSpec:f,validateSpec:x}),A;case"geojson":if(A=Dr({key:h,value:o,valueSpec:f.source_geojson,style:g,styleSpec:f,validateSpec:x,objectElementValidators:Mu}),o.cluster)for(const S in o.clusterProperties){const[M,B]=o.clusterProperties[S],O=typeof M=="string"?[M,["accumulated"],["get",S]]:M;A.push(...Qa({key:`${h}.${S}.map`,value:B,validateSpec:x,expressionContext:"cluster-map"})),A.push(...Qa({key:`${h}.${S}.reduce`,value:O,validateSpec:x,expressionContext:"cluster-reduce"}))}return A;case"video":return Dr({key:h,value:o,valueSpec:f.source_video,style:g,validateSpec:x,styleSpec:f});case"image":return Dr({key:h,value:o,valueSpec:f.source_image,style:g,validateSpec:x,styleSpec:f});case"canvas":return[new We(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ro({key:`${h}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:x,styleSpec:f})}}function Vd(c){const o=c.value,h=c.styleSpec,f=h.light,g=c.style;let x=[];const b=Qt(o);if(o===void 0)return x;if(b!=="object")return x=x.concat([new We("light",o,`object expected, ${b} found`)]),x;for(const A in o){const S=A.match(/^(.*)-transition$/);x=x.concat(S&&f[S[1]]&&f[S[1]].transition?c.validateSpec({key:A,value:o[A],valueSpec:h.transition,validateSpec:c.validateSpec,style:g,styleSpec:h}):f[A]?c.validateSpec({key:A,value:o[A],valueSpec:f[A],validateSpec:c.validateSpec,style:g,styleSpec:h}):[new We(A,o[A],`unknown property "${A}"`)])}return x}function jd(c){const o=c.value,h=c.styleSpec,f=h.sky,g=c.style,x=Qt(o);if(o===void 0)return[];if(x!=="object")return[new We("sky",o,`object expected, ${x} found`)];let b=[];for(const A in o)b=b.concat(f[A]?c.validateSpec({key:A,value:o[A],valueSpec:f[A],style:g,styleSpec:h}):[new We(A,o[A],`unknown property "${A}"`)]);return b}function Hd(c){const o=c.value,h=c.styleSpec,f=h.terrain,g=c.style;let x=[];const b=Qt(o);if(o===void 0)return x;if(b!=="object")return x=x.concat([new We("terrain",o,`object expected, ${b} found`)]),x;for(const A in o)x=x.concat(f[A]?c.validateSpec({key:A,value:o[A],valueSpec:f[A],validateSpec:c.validateSpec,style:g,styleSpec:h}):[new We(A,o[A],`unknown property "${A}"`)]);return x}function $d(c){let o=[];const h=c.value,f=c.key;if(Array.isArray(h)){const g=[],x=[];for(const b in h)h[b].id&&g.includes(h[b].id)&&o.push(new We(f,h,`all the sprites' ids must be unique, but ${h[b].id} is duplicated`)),g.push(h[b].id),h[b].url&&x.includes(h[b].url)&&o.push(new We(f,h,`all the sprites' URLs must be unique, but ${h[b].url} is duplicated`)),x.push(h[b].url),o=o.concat(Dr({key:`${f}[${b}]`,value:h[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return o}return pa({key:f,value:h})}const Bu={"*":()=>[],array:gc,boolean:function(c){const o=c.value,h=c.key,f=Qt(o);return f!=="boolean"?[new We(h,o,`boolean expected, ${f} found`)]:[]},number:Fd,color:function(c){const o=c.key,h=c.value,f=Qt(h);return f!=="string"?[new We(o,h,`color expected, ${f} found`)]:Zt.parse(String(h))?[]:[new We(o,h,`color expected, "${h}" found`)]},constants:Cm,enum:ro,filter:Nd,function:Iu,layer:zd,object:Dr,source:_c,light:Vd,sky:jd,terrain:Hd,projection:function(c){const o=c.value,h=c.styleSpec,f=h.projection,g=c.style,x=Qt(o);if(o===void 0)return[];if(x!=="object")return[new We("projection",o,`object expected, ${x} found`)];let b=[];for(const A in o)b=b.concat(f[A]?c.validateSpec({key:A,value:o[A],valueSpec:f[A],style:g,styleSpec:h}):[new We(A,o[A],`unknown property "${A}"`)]);return b},string:pa,formatted:function(c){return pa(c).length===0?[]:Qa(c)},resolvedImage:function(c){return pa(c).length===0?[]:Qa(c)},padding:function(c){const o=c.key,h=c.value;if(Qt(h)==="array"){if(h.length<1||h.length>4)return[new We(o,h,`padding requires 1 to 4 values; ${h.length} values found`)];const f={type:"number"};let g=[];for(let x=0;x<h.length;x++)g=g.concat(c.validateSpec({key:`${o}[${x}]`,value:h[x],validateSpec:c.validateSpec,valueSpec:f}));return g}return Fd({key:o,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const o=c.key,h=c.value,f=Qt(h),g=c.styleSpec;if(f!=="array"||h.length<1||h.length%2!=0)return[new We(o,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let b=0;b<h.length;b+=2)x=x.concat(ro({key:`${o}[${b}]`,value:h[b],valueSpec:g.layout_symbol["text-anchor"]})),x=x.concat(gc({key:`${o}[${b+1}]`,value:h[b+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:g}));return x},sprite:$d};function el(c){const o=c.value,h=c.valueSpec,f=c.styleSpec;return c.validateSpec=el,h.expression&&bu(Xi(o))?Iu(c):h.expression&&Tu(hs(o))?Qa(c):h.type&&Bu[h.type]?Bu[h.type](c):Dr(Pr({},c,{valueSpec:h.type?f[h.type]:h}))}function Im(c){const o=c.value,h=c.key,f=pa(c);return f.length||(o.indexOf("{fontstack}")===-1&&f.push(new We(h,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&f.push(new We(h,o,'"glyphs" url must include a "{range}" token'))),f}function Xr(c,o=Pe){let h=[];return h=h.concat(el({key:"",value:c,valueSpec:o.$root,styleSpec:o,style:c,validateSpec:el,objectElementValidators:{glyphs:Im,"*":()=>[]}})),c.constants&&(h=h.concat(Cm({key:"constants",value:c.constants,style:c,styleSpec:o,validateSpec:el}))),Gd(h)}function Us(c){return function(o){return c({...o,validateSpec:el})}}function Gd(c){return[].concat(c).sort((o,h)=>o.line-h.line)}function ds(c){return function(...o){return Gd(c.apply(this,o))}}Xr.source=ds(Us(_c)),Xr.sprite=ds(Us($d)),Xr.glyphs=ds(Us(Im)),Xr.light=ds(Us(Vd)),Xr.sky=ds(Us(jd)),Xr.terrain=ds(Us(Hd)),Xr.layer=ds(Us(zd)),Xr.filter=ds(Us(Nd)),Xr.paintProperty=ds(Us(Pu)),Xr.layoutProperty=ds(Us(Ud));const ma=Xr,A0=ma.light,T0=ma.sky,Rm=ma.paintProperty,Pm=ma.layoutProperty;function Wd(c,o){let h=!1;if(o&&o.length)for(const f of o)c.fire(new hr(new Error(f.message))),h=!0;return h}class tl{constructor(o,h,f){const g=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const b=new Int32Array(this.arrayBuffer);o=b[0],this.d=(h=b[1])+2*(f=b[2]);for(let S=0;S<this.d*this.d;S++){const M=b[3+S],B=b[3+S+1];g.push(M===B?null:b.subarray(M,B))}const A=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],A),this.bboxes=b.subarray(A),this.insert=this._insertReadonly}else{this.d=h+2*f;for(let b=0;b<this.d*this.d;b++)g.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=o,this.padding=f,this.scale=h/o,this.uid=0;const x=f/h*o;this.min=-x,this.max=o+x}insert(o,h,f,g,x){this._forEachCell(h,f,g,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,h,f,g,x,b){this.cells[x].push(b)}query(o,h,f,g,x){const b=this.min,A=this.max;if(o<=b&&h<=b&&A<=f&&A<=g&&!x)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(o,h,f,g,this._queryCell,S,{},x),S}}_queryCell(o,h,f,g,x,b,A,S){const M=this.cells[x];if(M!==null){const B=this.keys,O=this.bboxes;for(let U=0;U<M.length;U++){const j=M[U];if(A[j]===void 0){const G=4*j;(S?S(O[G+0],O[G+1],O[G+2],O[G+3]):o<=O[G+2]&&h<=O[G+3]&&f>=O[G+0]&&g>=O[G+1])?(A[j]=!0,b.push(B[j])):A[j]=!1}}}}_forEachCell(o,h,f,g,x,b,A,S){const M=this._convertToCellCoord(o),B=this._convertToCellCoord(h),O=this._convertToCellCoord(f),U=this._convertToCellCoord(g);for(let j=M;j<=O;j++)for(let G=B;G<=U;G++){const Z=this.d*G+j;if((!S||S(this._convertFromCellCoord(j),this._convertFromCellCoord(G),this._convertFromCellCoord(j+1),this._convertFromCellCoord(G+1)))&&x.call(this,o,h,f,g,Z,b,A,S))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,h=3+this.cells.length+1+1;let f=0;for(let b=0;b<this.cells.length;b++)f+=this.cells[b].length;const g=new Int32Array(h+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let x=h;for(let b=0;b<o.length;b++){const A=o[b];g[3+b]=x,g.set(A,x),x+=A.length}return g[3+o.length]=x,g.set(this.keys,x),x+=this.keys.length,g[3+o.length+1]=x,g.set(this.bboxes,x),x+=this.bboxes.length,g.buffer}static serialize(o,h){const f=o.toArrayBuffer();return h&&h.push(f),{buffer:f}}static deserialize(o){return new tl(o.buffer)}}const qr={};function ct(c,o,h={}){if(qr[c])throw new Error(`${c} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:c,writeable:!1}),qr[c]={klass:o,omit:h.omit||[],shallow:h.shallow||[]}}ct("Object",Object),ct("TransferableGridIndex",tl),ct("Color",Zt),ct("Error",Error),ct("AJAXError",Jt),ct("ResolvedImage",zi),ct("StylePropertyFunction",Ja),ct("StyleExpression",Au,{omit:["_evaluator"]}),ct("ZoomDependentExpression",Ya),ct("ZoomConstantExpression",Za),ct("CompoundExpression",Wr,{omit:["_evaluate"]});for(const c in $a)$a[c]._classRegistryKey||ct(`Expression_${c}`,$a[c]);function Du(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function Xd(c){return c.$name||c.constructor._classRegistryKey}function Mm(c){return!function(o){if(o===null||typeof o!="object")return!1;const h=Xd(o);return!(!h||h==="Object")}(c)&&(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||Du(c)||sn(c)||ArrayBuffer.isView(c)||c instanceof ImageData)}function il(c,o){if(Mm(c))return(Du(c)||sn(c))&&o&&o.push(c),ArrayBuffer.isView(c)&&o&&o.push(c.buffer),c instanceof ImageData&&o&&o.push(c.data.buffer),c;if(Array.isArray(c)){const x=[];for(const b of c)x.push(il(b,o));return x}if(typeof c!="object")throw new Error("can't serialize object of type "+typeof c);const h=Xd(c);if(!h)throw new Error(`can't serialize object of unregistered class ${c.constructor.name}`);if(!qr[h])throw new Error(`${h} is not registered.`);const{klass:f}=qr[h],g=f.serialize?f.serialize(c,o):{};if(f.serialize){if(o&&g===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in c){if(!c.hasOwnProperty(x)||qr[h].omit.indexOf(x)>=0)continue;const b=c[x];g[x]=qr[h].shallow.indexOf(x)>=0?b:il(b,o)}c instanceof Error&&(g.message=c.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(g.$name=h),g}function nl(c){if(Mm(c))return c;if(Array.isArray(c))return c.map(nl);if(typeof c!="object")throw new Error("can't deserialize object of type "+typeof c);const o=Xd(c)||"Object";if(!qr[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:h}=qr[o];if(!h)throw new Error(`can't deserialize unregistered class ${o}`);if(h.deserialize)return h.deserialize(c);const f=Object.create(h.prototype);for(const g of Object.keys(c)){if(g==="$name")continue;const x=c[g];f[g]=qr[o].shallow.indexOf(g)>=0?x:nl(x)}return f}class qd{constructor(){this.first=!0}update(o,h){const f=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=h),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=f,!0))}}const $t={"Latin-1 Supplement":c=>c>=128&&c<=255,"Hangul Jamo":c=>c>=4352&&c<=4607,Khmer:c=>c>=6016&&c<=6143,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Katakana:c=>c>=12448&&c<=12543,Kanbun:c=>c>=12688&&c<=12703,"CJK Strokes":c=>c>=12736&&c<=12783,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"Private Use Area":c=>c>=57344&&c<=63743,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function Kd(c){for(const o of c)if(Yd(o.charCodeAt(0)))return!0;return!1}function E0(c){for(const o of c)if(!rl(o.charCodeAt(0)))return!1;return!0}function Zd(c){const o=c.map(h=>{try{return new RegExp(`\\p{sc=${h}}`,"u").source}catch{return null}}).filter(h=>h);return new RegExp(o.join("|"),"u")}const S0=Zd(["Arab","Dupl","Mong","Ougr","Syrc"]);function rl(c){return!S0.test(String.fromCodePoint(c))}const Bm=Zd(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Yd(c){return!(c!==746&&c!==747&&(c<4352||!($t["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||$t["CJK Compatibility"](c)||$t["CJK Strokes"](c)||!(!$t["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||$t["Enclosed CJK Letters and Months"](c)||$t["Ideographic Description Characters"](c)||$t.Kanbun(c)||$t.Katakana(c)&&c!==12540||!(!$t["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!$t["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||$t["Vertical Forms"](c)||$t["Yijing Hexagram Symbols"](c)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(c))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(c))||Bm.test(String.fromCodePoint(c)))))}function Dm(c){return!(Yd(c)||function(o){return!!($t["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||$t["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||$t["Letterlike Symbols"](o)||$t["Number Forms"](o)||$t["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||$t["Control Pictures"](o)&&o!==9251||$t["Optical Character Recognition"](o)||$t["Enclosed Alphanumerics"](o)||$t["Geometric Shapes"](o)||$t["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||$t["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||$t["CJK Symbols and Punctuation"](o)||$t.Katakana(o)||$t["Private Use Area"](o)||$t["CJK Compatibility Forms"](o)||$t["Small Form Variants"](o)||$t["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(c))}const C0=Zd(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Jd(c){return C0.test(String.fromCodePoint(c))}function I0(c,o){return!(!o&&Jd(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||$t.Khmer(c))}function R0(c){for(const o of c)if(Jd(o.charCodeAt(0)))return!0;return!1}const Or=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ai{constructor(o,h){this.zoom=o,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qd,this.transition={})}isSupportedScript(o){return function(h,f){for(const g of h)if(!I0(g.charCodeAt(0),f))return!1;return!0}(o,Or.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,h=o-Math.floor(o),f=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*h}}}class sl{constructor(o,h){this.property=o,this.value=h,this.expression=function(f,g){if(bu(f))return new Ja(f,g);if(Tu(f)){const x=Dd(f,g);if(x.result==="error")throw new Error(x.value.map(b=>`${b.key}: ${b.message}`).join(", "));return x.value}{let x=f;return g.type==="color"&&typeof f=="string"?x=Zt.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(x=Ui.parse(f)):x=Li.parse(f),{kind:"constant",evaluate:()=>x}}}(h===void 0?o.specification.default:h,o.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,h,f){return this.property.possiblyEvaluate(this,o,h,f)}}class Ou{constructor(o){this.property=o,this.value=new sl(o,void 0)}transitioned(o,h){return new Om(this.property,this.value,h,Fe({},o.transition,this.transition),o.now)}untransitioned(){return new Om(this.property,this.value,null,{},0)}}class ku{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return Ke(this._values[o].value.value)}setValue(o,h){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new Ou(this._values[o].property)),this._values[o].value=new sl(this._values[o].property,h===null?void 0:Ke(h))}getTransition(o){return Ke(this._values[o].transition)}setTransition(o,h){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new Ou(this._values[o].property)),this._values[o].transition=Ke(h)||void 0}serialize(){const o={};for(const h of Object.keys(this._values)){const f=this.getValue(h);f!==void 0&&(o[h]=f);const g=this.getTransition(h);g!==void 0&&(o[`${h}-transition`]=g)}return o}transitioned(o,h){const f=new yc(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(o,h._values[g]);return f}untransitioned(){const o=new yc(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].untransitioned();return o}}class Om{constructor(o,h,f,g,x){this.property=o,this.value=h,this.begin=x+g.delay||0,this.end=this.begin+g.duration||0,o.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(o,h,f){const g=o.now||0,x=this.value.possiblyEvaluate(o,h,f),b=this.prior;if(b){if(g>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(g<this.begin)return b.possiblyEvaluate(o,h,f);{const A=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(o,h,f),x,function(S){if(S<=0)return 0;if(S>=1)return 1;const M=S*S,B=M*S;return 4*(S<.5?B:3*(S-M)+B-.75)}(A))}}return x}}class yc{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,h,f){const g=new xc(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].possiblyEvaluate(o,h,f);return g}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class vc{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}hasValue(o){return this._values[o].value!==void 0}getValue(o){return Ke(this._values[o].value)}setValue(o,h){this._values[o]=new sl(this._values[o].property,h===null?void 0:Ke(h))}serialize(){const o={};for(const h of Object.keys(this._values)){const f=this.getValue(h);f!==void 0&&(o[h]=f)}return o}possiblyEvaluate(o,h,f){const g=new xc(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].possiblyEvaluate(o,h,f);return g}}class zs{constructor(o,h,f){this.property=o,this.value=h,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,h,f,g){return this.property.evaluate(this.value,this.parameters,o,h,f,g)}}class xc{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class ft{constructor(o){this.specification=o}possiblyEvaluate(o,h){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(h)}interpolate(o,h,f){const g=fr[this.specification.type];return g?g(o,h,f):o}}class Tt{constructor(o,h){this.specification=o,this.overrides=h}possiblyEvaluate(o,h,f,g){return new zs(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(h,null,{},f,g)}:o.expression,h)}interpolate(o,h,f){if(o.value.kind!=="constant"||h.value.kind!=="constant")return o;if(o.value.value===void 0||h.value.value===void 0)return new zs(this,{kind:"constant",value:void 0},o.parameters);const g=fr[this.specification.type];if(g){const x=g(o.value.value,h.value.value,f);return new zs(this,{kind:"constant",value:x},o.parameters)}return o}evaluate(o,h,f,g,x,b){return o.kind==="constant"?o.value:o.evaluate(h,f,g,x,b)}}class Fu extends Tt{possiblyEvaluate(o,h,f,g){if(o.value===void 0)return new zs(this,{kind:"constant",value:void 0},h);if(o.expression.kind==="constant"){const x=o.expression.evaluate(h,null,{},f,g),b=o.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,A=this._calculate(b,b,b,h);return new zs(this,{kind:"constant",value:A},h)}if(o.expression.kind==="camera"){const x=this._calculate(o.expression.evaluate({zoom:h.zoom-1}),o.expression.evaluate({zoom:h.zoom}),o.expression.evaluate({zoom:h.zoom+1}),h);return new zs(this,{kind:"constant",value:x},h)}return new zs(this,o.expression,h)}evaluate(o,h,f,g,x,b){if(o.kind==="source"){const A=o.evaluate(h,f,g,x,b);return this._calculate(A,A,A,h)}return o.kind==="composite"?this._calculate(o.evaluate({zoom:Math.floor(h.zoom)-1},f,g),o.evaluate({zoom:Math.floor(h.zoom)},f,g),o.evaluate({zoom:Math.floor(h.zoom)+1},f,g),h):o.value}_calculate(o,h,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:o,to:h}:{from:f,to:h}}interpolate(o){return o}}class Nu{constructor(o){this.specification=o}possiblyEvaluate(o,h,f,g){if(o.value!==void 0){if(o.expression.kind==="constant"){const x=o.expression.evaluate(h,null,{},f,g);return this._calculate(x,x,x,h)}return this._calculate(o.expression.evaluate(new Ai(Math.floor(h.zoom-1),h)),o.expression.evaluate(new Ai(Math.floor(h.zoom),h)),o.expression.evaluate(new Ai(Math.floor(h.zoom+1),h)),h)}}_calculate(o,h,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:o,to:h}:{from:f,to:h}}interpolate(o){return o}}class Qd{constructor(o){this.specification=o}possiblyEvaluate(o,h,f,g){return!!o.expression.evaluate(h,null,{},f,g)}interpolate(){return!1}}class v{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in o){const f=o[h];f.specification.overridable&&this.overridableProperties.push(h);const g=this.defaultPropertyValues[h]=new sl(f,void 0),x=this.defaultTransitionablePropertyValues[h]=new Ou(f);this.defaultTransitioningPropertyValues[h]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=g.possiblyEvaluate({})}}}ct("DataDrivenProperty",Tt),ct("DataConstantProperty",ft),ct("CrossFadedDataDrivenProperty",Fu),ct("CrossFadedProperty",Nu),ct("ColorRampProperty",Qd);const s="-transition";class d extends jr{constructor(o,h){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1},o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),h.layout&&(this._unevaluatedLayout=new vc(h.layout)),h.paint)){this._transitionablePaint=new ku(h.paint);for(const f in o.paint)this.setPaintProperty(f,o.paint[f],{validate:!1});for(const f in o.layout)this.setLayoutProperty(f,o.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xc(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,h,f={}){h!=null&&this._validate(Pm,`layers.${this.id}.layout.${o}`,o,h,f)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,h):this.visibility=h)}getPaintProperty(o){return o.endsWith(s)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,h,f={}){if(h!=null&&this._validate(Rm,`layers.${this.id}.paint.${o}`,o,h,f))return!1;if(o.endsWith(s))return this._transitionablePaint.setTransition(o.slice(0,-11),h||void 0),!1;{const g=this._transitionablePaint._values[o],x=g.property.specification["property-type"]==="cross-faded-data-driven",b=g.value.isDataDriven(),A=g.value;this._transitionablePaint.setValue(o,h),this._handleSpecialPaintPropertyUpdate(o);const S=this._transitionablePaint._values[o].value;return S.isDataDriven()||b||x||this._handleOverridablePaintPropertyUpdate(o,A,S)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,h,f){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,h){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,h)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),je(o,(h,f)=>!(h===void 0||f==="layout"&&!Object.keys(h).length||f==="paint"&&!Object.keys(h).length))}_validate(o,h,f,g,x={}){return(!x||x.validate!==!1)&&Wd(this,o.call(ma,{key:h,layerType:this.type,objectKey:f,value:g,styleSpec:Pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const h=this.paint.get(o);if(h instanceof zs&&Xa(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const p={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class m{constructor(o,h){this._structArray=o,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class y{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,h){return o._trim(),h&&(o.isTransferred=!0,h.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const h=Object.create(this.prototype);return h.arrayBuffer=o.arrayBuffer,h.length=o.length,h.capacity=o.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function T(c,o=1){let h=0,f=0;return{members:c.map(g=>{const x=p[g.type].BYTES_PER_ELEMENT,b=h=C(h,Math.max(o,x)),A=g.components||1;return f=Math.max(f,x),h+=x*A,{name:g.name,type:g.type,components:A,offset:b}}),size:C(h,Math.max(f,o)),alignment:o}}function C(c,o){return Math.ceil(c/o)*o}class P extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h){const f=this.length;return this.resize(f+1),this.emplace(f,o,h)}emplace(o,h,f){const g=2*o;return this.int16[g+0]=h,this.int16[g+1]=f,o}}P.prototype.bytesPerElement=4,ct("StructArrayLayout2i4",P);class D extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,h,f)}emplace(o,h,f,g){const x=3*o;return this.int16[x+0]=h,this.int16[x+1]=f,this.int16[x+2]=g,o}}D.prototype.bytesPerElement=6,ct("StructArrayLayout3i6",D);class F extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,o,h,f,g)}emplace(o,h,f,g,x){const b=4*o;return this.int16[b+0]=h,this.int16[b+1]=f,this.int16[b+2]=g,this.int16[b+3]=x,o}}F.prototype.bytesPerElement=8,ct("StructArrayLayout4i8",F);class N extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,f,g,x,b){const A=this.length;return this.resize(A+1),this.emplace(A,o,h,f,g,x,b)}emplace(o,h,f,g,x,b,A){const S=6*o;return this.int16[S+0]=h,this.int16[S+1]=f,this.int16[S+2]=g,this.int16[S+3]=x,this.int16[S+4]=b,this.int16[S+5]=A,o}}N.prototype.bytesPerElement=12,ct("StructArrayLayout2i4i12",N);class H extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,f,g,x,b){const A=this.length;return this.resize(A+1),this.emplace(A,o,h,f,g,x,b)}emplace(o,h,f,g,x,b,A){const S=4*o,M=8*o;return this.int16[S+0]=h,this.int16[S+1]=f,this.uint8[M+4]=g,this.uint8[M+5]=x,this.uint8[M+6]=b,this.uint8[M+7]=A,o}}H.prototype.bytesPerElement=8,ct("StructArrayLayout2i4ub8",H);class J extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h){const f=this.length;return this.resize(f+1),this.emplace(f,o,h)}emplace(o,h,f){const g=2*o;return this.float32[g+0]=h,this.float32[g+1]=f,o}}J.prototype.bytesPerElement=8,ct("StructArrayLayout2f8",J);class te extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,f,g,x,b,A,S,M,B){const O=this.length;return this.resize(O+1),this.emplace(O,o,h,f,g,x,b,A,S,M,B)}emplace(o,h,f,g,x,b,A,S,M,B,O){const U=10*o;return this.uint16[U+0]=h,this.uint16[U+1]=f,this.uint16[U+2]=g,this.uint16[U+3]=x,this.uint16[U+4]=b,this.uint16[U+5]=A,this.uint16[U+6]=S,this.uint16[U+7]=M,this.uint16[U+8]=B,this.uint16[U+9]=O,o}}te.prototype.bytesPerElement=20,ct("StructArrayLayout10ui20",te);class oe extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,f,g,x,b,A,S,M,B,O,U){const j=this.length;return this.resize(j+1),this.emplace(j,o,h,f,g,x,b,A,S,M,B,O,U)}emplace(o,h,f,g,x,b,A,S,M,B,O,U,j){const G=12*o;return this.int16[G+0]=h,this.int16[G+1]=f,this.int16[G+2]=g,this.int16[G+3]=x,this.uint16[G+4]=b,this.uint16[G+5]=A,this.uint16[G+6]=S,this.uint16[G+7]=M,this.int16[G+8]=B,this.int16[G+9]=O,this.int16[G+10]=U,this.int16[G+11]=j,o}}oe.prototype.bytesPerElement=24,ct("StructArrayLayout4i4ui4i24",oe);class ce extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,h,f)}emplace(o,h,f,g){const x=3*o;return this.float32[x+0]=h,this.float32[x+1]=f,this.float32[x+2]=g,o}}ce.prototype.bytesPerElement=12,ct("StructArrayLayout3f12",ce);class ue extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const h=this.length;return this.resize(h+1),this.emplace(h,o)}emplace(o,h){return this.uint32[1*o+0]=h,o}}ue.prototype.bytesPerElement=4,ct("StructArrayLayout1ul4",ue);class pe extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,f,g,x,b,A,S,M){const B=this.length;return this.resize(B+1),this.emplace(B,o,h,f,g,x,b,A,S,M)}emplace(o,h,f,g,x,b,A,S,M,B){const O=10*o,U=5*o;return this.int16[O+0]=h,this.int16[O+1]=f,this.int16[O+2]=g,this.int16[O+3]=x,this.int16[O+4]=b,this.int16[O+5]=A,this.uint32[U+3]=S,this.uint16[O+8]=M,this.uint16[O+9]=B,o}}pe.prototype.bytesPerElement=20,ct("StructArrayLayout6i1ul2ui20",pe);class re extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,f,g,x,b){const A=this.length;return this.resize(A+1),this.emplace(A,o,h,f,g,x,b)}emplace(o,h,f,g,x,b,A){const S=6*o;return this.int16[S+0]=h,this.int16[S+1]=f,this.int16[S+2]=g,this.int16[S+3]=x,this.int16[S+4]=b,this.int16[S+5]=A,o}}re.prototype.bytesPerElement=12,ct("StructArrayLayout2i2i2i12",re);class ye extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,f,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,o,h,f,g,x)}emplace(o,h,f,g,x,b){const A=4*o,S=8*o;return this.float32[A+0]=h,this.float32[A+1]=f,this.float32[A+2]=g,this.int16[S+6]=x,this.int16[S+7]=b,o}}ye.prototype.bytesPerElement=16,ct("StructArrayLayout2f1f2i16",ye);class xe extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,h,f,g,x,b){const A=this.length;return this.resize(A+1),this.emplace(A,o,h,f,g,x,b)}emplace(o,h,f,g,x,b,A){const S=16*o,M=4*o,B=8*o;return this.uint8[S+0]=h,this.uint8[S+1]=f,this.float32[M+1]=g,this.float32[M+2]=x,this.int16[B+6]=b,this.int16[B+7]=A,o}}xe.prototype.bytesPerElement=16,ct("StructArrayLayout2ub2f2i16",xe);class Se extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,h,f)}emplace(o,h,f,g){const x=3*o;return this.uint16[x+0]=h,this.uint16[x+1]=f,this.uint16[x+2]=g,o}}Se.prototype.bytesPerElement=6,ct("StructArrayLayout3ui6",Se);class Le extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,f,g,x,b,A,S,M,B,O,U,j,G,Z,se,le){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,o,h,f,g,x,b,A,S,M,B,O,U,j,G,Z,se,le)}emplace(o,h,f,g,x,b,A,S,M,B,O,U,j,G,Z,se,le,Ee){const _e=24*o,be=12*o,Oe=48*o;return this.int16[_e+0]=h,this.int16[_e+1]=f,this.uint16[_e+2]=g,this.uint16[_e+3]=x,this.uint32[be+2]=b,this.uint32[be+3]=A,this.uint32[be+4]=S,this.uint16[_e+10]=M,this.uint16[_e+11]=B,this.uint16[_e+12]=O,this.float32[be+7]=U,this.float32[be+8]=j,this.uint8[Oe+36]=G,this.uint8[Oe+37]=Z,this.uint8[Oe+38]=se,this.uint32[be+10]=le,this.int16[_e+22]=Ee,o}}Le.prototype.bytesPerElement=48,ct("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Le);class Ge extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,f,g,x,b,A,S,M,B,O,U,j,G,Z,se,le,Ee,_e,be,Oe,He,ot,wt,rt,it,gt,dt){const lt=this.length;return this.resize(lt+1),this.emplace(lt,o,h,f,g,x,b,A,S,M,B,O,U,j,G,Z,se,le,Ee,_e,be,Oe,He,ot,wt,rt,it,gt,dt)}emplace(o,h,f,g,x,b,A,S,M,B,O,U,j,G,Z,se,le,Ee,_e,be,Oe,He,ot,wt,rt,it,gt,dt,lt){const Ne=32*o,yt=16*o;return this.int16[Ne+0]=h,this.int16[Ne+1]=f,this.int16[Ne+2]=g,this.int16[Ne+3]=x,this.int16[Ne+4]=b,this.int16[Ne+5]=A,this.int16[Ne+6]=S,this.int16[Ne+7]=M,this.uint16[Ne+8]=B,this.uint16[Ne+9]=O,this.uint16[Ne+10]=U,this.uint16[Ne+11]=j,this.uint16[Ne+12]=G,this.uint16[Ne+13]=Z,this.uint16[Ne+14]=se,this.uint16[Ne+15]=le,this.uint16[Ne+16]=Ee,this.uint16[Ne+17]=_e,this.uint16[Ne+18]=be,this.uint16[Ne+19]=Oe,this.uint16[Ne+20]=He,this.uint16[Ne+21]=ot,this.uint16[Ne+22]=wt,this.uint32[yt+12]=rt,this.float32[yt+13]=it,this.float32[yt+14]=gt,this.uint16[Ne+30]=dt,this.uint16[Ne+31]=lt,o}}Ge.prototype.bytesPerElement=64,ct("StructArrayLayout8i15ui1ul2f2ui64",Ge);class nt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const h=this.length;return this.resize(h+1),this.emplace(h,o)}emplace(o,h){return this.float32[1*o+0]=h,o}}nt.prototype.bytesPerElement=4,ct("StructArrayLayout1f4",nt);class at extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,h,f)}emplace(o,h,f,g){const x=3*o;return this.uint16[6*o+0]=h,this.float32[x+1]=f,this.float32[x+2]=g,o}}at.prototype.bytesPerElement=12,ct("StructArrayLayout1ui2f12",at);class et extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,h,f)}emplace(o,h,f,g){const x=4*o;return this.uint32[2*o+0]=h,this.uint16[x+2]=f,this.uint16[x+3]=g,o}}et.prototype.bytesPerElement=8,ct("StructArrayLayout1ul2ui8",et);class Ye extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,h){const f=this.length;return this.resize(f+1),this.emplace(f,o,h)}emplace(o,h,f){const g=2*o;return this.uint16[g+0]=h,this.uint16[g+1]=f,o}}Ye.prototype.bytesPerElement=4,ct("StructArrayLayout2ui4",Ye);class pt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const h=this.length;return this.resize(h+1),this.emplace(h,o)}emplace(o,h){return this.uint16[1*o+0]=h,o}}pt.prototype.bytesPerElement=2,ct("StructArrayLayout1ui2",pt);class Mt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,h,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,o,h,f,g)}emplace(o,h,f,g,x){const b=4*o;return this.float32[b+0]=h,this.float32[b+1]=f,this.float32[b+2]=g,this.float32[b+3]=x,o}}Mt.prototype.bytesPerElement=16,ct("StructArrayLayout4f16",Mt);class tt extends m{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new I(this.anchorPointX,this.anchorPointY)}}tt.prototype.size=20;class st extends pe{get(o){return new tt(this,o)}}ct("CollisionBoxArray",st);class It extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}It.prototype.size=48;class Ti extends Le{get(o){return new It(this,o)}}ct("PlacedSymbolArray",Ti);class kt extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}kt.prototype.size=64;class jt extends Ge{get(o){return new kt(this,o)}}ct("SymbolInstanceArray",jt);class Ei extends nt{getoffsetX(o){return this.float32[1*o+0]}}ct("GlyphOffsetArray",Ei);class zn extends D{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}ct("SymbolLineVertexArray",zn);class fs extends m{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}fs.prototype.size=12;class Si extends at{get(o){return new fs(this,o)}}ct("TextAnchorOffsetArray",Si);class mr extends m{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}mr.prototype.size=8;class ir extends et{get(o){return new mr(this,o)}}ct("FeatureIndexArray",ir);class Vn extends P{}class nr extends P{}class Vs extends P{}class ol extends N{}class Lu extends H{}class al extends J{}class Kr extends te{}class Uu extends oe{}class ef extends ce{}class Zr extends ue{}class Yr extends re{}class Oo extends xe{}class ps extends Se{}class Rn extends Ye{}const jn=T([{name:"a_pos",components:2,type:"Int16"}],4),{members:kr}=jn;class Gt{constructor(o=[]){this.segments=o}prepareSegment(o,h,f,g){let x=this.segments[this.segments.length-1];return o>Gt.MAX_VERTEX_ARRAY_LENGTH&&Pt(`Max vertices per segment is ${Gt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!x||x.vertexLength+o>Gt.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==g)&&(x={vertexOffset:h.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(x.sortKey=g),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const o of this.segments)for(const h in o.vaos)o.vaos[h].destroy()}static simpleSegment(o,h,f,g){return new Gt([{vertexOffset:o,primitiveOffset:h,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function ga(c,o){return 256*(c=Ce(Math.floor(c),0,255))+Ce(Math.floor(o),0,255)}Gt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ct("SegmentVector",Gt);const ll=T([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var cl={exports:{}},km={exports:{}};km.exports=function(c,o){var h,f,g,x,b,A,S,M;for(f=c.length-(h=3&c.length),g=o,b=3432918353,A=461845907,M=0;M<f;)S=255&c.charCodeAt(M)|(255&c.charCodeAt(++M))<<8|(255&c.charCodeAt(++M))<<16|(255&c.charCodeAt(++M))<<24,++M,g=27492+(65535&(x=5*(65535&(g=(g^=S=(65535&(S=(S=(65535&S)*b+(((S>>>16)*b&65535)<<16)&4294967295)<<15|S>>>17))*A+(((S>>>16)*A&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(S=0,h){case 3:S^=(255&c.charCodeAt(M+2))<<16;case 2:S^=(255&c.charCodeAt(M+1))<<8;case 1:g^=S=(65535&(S=(S=(65535&(S^=255&c.charCodeAt(M)))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<15|S>>>17))*A+(((S>>>16)*A&65535)<<16)&4294967295}return g^=c.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var P0=km.exports,Fm={exports:{}};Fm.exports=function(c,o){for(var h,f=c.length,g=o^f,x=0;f>=4;)h=1540483477*(65535&(h=255&c.charCodeAt(x)|(255&c.charCodeAt(++x))<<8|(255&c.charCodeAt(++x))<<16|(255&c.charCodeAt(++x))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),f-=4,++x;switch(f){case 3:g^=(255&c.charCodeAt(x+2))<<16;case 2:g^=(255&c.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&c.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var ko=P0,Nm=Fm.exports;cl.exports=ko,cl.exports.murmur3=ko,cl.exports.murmur2=Nm;var zu=_(cl.exports);class bc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,h,f,g){this.ids.push(Vu(o)),this.positions.push(h,f,g)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=Vu(o);let f=0,g=this.ids.length-1;for(;f<g;){const b=f+g>>1;this.ids[b]>=h?g=b:f=b+1}const x=[];for(;this.ids[f]===h;)x.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return x}static serialize(o,h){const f=new Float64Array(o.ids),g=new Uint32Array(o.positions);return ju(f,g,0,f.length-1),h&&h.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(o){const h=new bc;return h.ids=o.ids,h.positions=o.positions,h.indexed=!0,h}}function Vu(c){const o=+c;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:zu(String(c))}function ju(c,o,h,f){for(;h<f;){const g=c[h+f>>1];let x=h-1,b=f+1;for(;;){do x++;while(c[x]<g);do b--;while(c[b]>g);if(x>=b)break;ul(c,x,b),ul(o,3*x,3*b),ul(o,3*x+1,3*b+1),ul(o,3*x+2,3*b+2)}b-h<f-b?(ju(c,o,h,b),h=b+1):(ju(c,o,b+1,f),f=b)}}function ul(c,o,h){const f=c[o];c[o]=c[h],c[h]=f}ct("FeaturePositionMap",bc);class wc{constructor(o,h){this.gl=o.gl,this.location=h}}class Lm extends wc{constructor(o,h){super(o,h),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class zA extends wc{constructor(o,h){super(o,h),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class VA extends wc{constructor(o,h){super(o,h),this.current=Zt.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const kD=new Float32Array(16);function M0(c){return[ga(255*c.r,255*c.g),ga(255*c.b,255*c.a)]}class tf{constructor(o,h,f){this.value=o,this.uniformNames=h.map(g=>`u_${g}`),this.type=f}setUniform(o,h,f){o.set(f.constantOr(this.value))}getBinding(o,h,f){return this.type==="color"?new VA(o,h):new Lm(o,h)}}class Hu{constructor(o,h){this.uniformNames=h.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=o.tlbr}setUniform(o,h,f,g){const x=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&o.set(x)}getBinding(o,h,f){return f.substr(0,9)==="u_pattern"?new zA(o,h):new Lm(o,h)}}class _a{constructor(o,h,f,g){this.expression=o,this.type=f,this.maxValue=0,this.paintVertexAttributes=h.map(x=>({name:`a_${x}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(o,h,f,g,x){const b=this.paintVertexArray.length,A=this.expression.evaluate(new Ai(0),h,{},g,[],x);this.paintVertexArray.resize(o),this._setPaintValue(b,o,A)}updatePaintArray(o,h,f,g){const x=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(o,h,x)}_setPaintValue(o,h,f){if(this.type==="color"){const g=M0(f);for(let x=o;x<h;x++)this.paintVertexArray.emplace(x,g[0],g[1])}else{for(let g=o;g<h;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class so{constructor(o,h,f,g,x,b){this.expression=o,this.uniformNames=h.map(A=>`u_${A}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=h.map(A=>({name:`a_${A}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(o,h,f,g,x){const b=this.expression.evaluate(new Ai(this.zoom),h,{},g,[],x),A=this.expression.evaluate(new Ai(this.zoom+1),h,{},g,[],x),S=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(S,o,b,A)}updatePaintArray(o,h,f,g){const x=this.expression.evaluate({zoom:this.zoom},f,g),b=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(o,h,x,b)}_setPaintValue(o,h,f,g){if(this.type==="color"){const x=M0(f),b=M0(g);for(let A=o;A<h;A++)this.paintVertexArray.emplace(A,x[0],x[1],b[0],b[1])}else{for(let x=o;x<h;x++)this.paintVertexArray.emplace(x,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,h){const f=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,g=Ce(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);o.set(g)}getBinding(o,h,f){return new Lm(o,h)}}class hl{constructor(o,h,f,g,x,b){this.expression=o,this.type=h,this.useIntegerZoom=f,this.zoom=g,this.layerId=b,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(o,h,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(g,o,h.patterns&&h.patterns[this.layerId],f)}updatePaintArray(o,h,f,g,x){this._setPaintValues(o,h,f.patterns&&f.patterns[this.layerId],x)}_setPaintValues(o,h,f,g){if(!g||!f)return;const{min:x,mid:b,max:A}=f,S=g[x],M=g[b],B=g[A];if(S&&M&&B)for(let O=o;O<h;O++)this.zoomInPaintVertexArray.emplace(O,M.tl[0],M.tl[1],M.br[0],M.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],M.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,M.tl[0],M.tl[1],M.br[0],M.br[1],B.tl[0],B.tl[1],B.br[0],B.br[1],M.pixelRatio,B.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,ll.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,ll.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class jA{constructor(o,h,f){this.binders={},this._buffers=[];const g=[];for(const x in o.paint._values){if(!f(x))continue;const b=o.paint.get(x);if(!(b instanceof zs&&Xa(b.property.specification)))continue;const A=FD(x,o.type),S=b.value,M=b.property.specification.type,B=b.property.useIntegerZoom,O=b.property.specification["property-type"],U=O==="cross-faded"||O==="cross-faded-data-driven";if(S.kind==="constant")this.binders[x]=U?new Hu(S.value,A):new tf(S.value,A,M),g.push(`/u_${x}`);else if(S.kind==="source"||U){const j=HA(x,M,"source");this.binders[x]=U?new hl(S,M,B,h,j,o.id):new _a(S,A,M,j),g.push(`/a_${x}`)}else{const j=HA(x,M,"composite");this.binders[x]=new so(S,A,M,B,h,j),g.push(`/z_${x}`)}}this.cacheKey=g.sort().join("")}getMaxValue(o){const h=this.binders[o];return h instanceof _a||h instanceof so?h.maxValue:0}populatePaintArrays(o,h,f,g,x){for(const b in this.binders){const A=this.binders[b];(A instanceof _a||A instanceof so||A instanceof hl)&&A.populatePaintArray(o,h,f,g,x)}}setConstantPatternPositions(o,h){for(const f in this.binders){const g=this.binders[f];g instanceof Hu&&g.setConstantPatternPositions(o,h)}}updatePaintArrays(o,h,f,g,x){let b=!1;for(const A in o){const S=h.getPositions(A);for(const M of S){const B=f.feature(M.index);for(const O in this.binders){const U=this.binders[O];if((U instanceof _a||U instanceof so||U instanceof hl)&&U.expression.isStateDependent===!0){const j=g.paint.get(O);U.expression=j.value,U.updatePaintArray(M.start,M.end,B,o[A],x),b=!0}}}}return b}defines(){const o=[];for(const h in this.binders){const f=this.binders[h];(f instanceof tf||f instanceof Hu)&&o.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return o}getBinderAttributes(){const o=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof _a||f instanceof so)for(let g=0;g<f.paintVertexAttributes.length;g++)o.push(f.paintVertexAttributes[g].name);else if(f instanceof hl)for(let g=0;g<ll.members.length;g++)o.push(ll.members[g].name)}return o}getBinderUniforms(){const o=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof tf||f instanceof Hu||f instanceof so)for(const g of f.uniformNames)o.push(g)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,h){const f=[];for(const g in this.binders){const x=this.binders[g];if(x instanceof tf||x instanceof Hu||x instanceof so){for(const b of x.uniformNames)if(h[b]){const A=x.getBinding(o,h[b],b);f.push({name:b,property:g,binding:A})}}}return f}setUniforms(o,h,f,g){for(const{name:x,property:b,binding:A}of h)this.binders[b].setUniform(A,g,f.get(b),x)}updatePaintBuffers(o){this._buffers=[];for(const h in this.binders){const f=this.binders[h];if(o&&f instanceof hl){const g=o.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof _a||f instanceof so)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(o){for(const h in this.binders){const f=this.binders[h];(f instanceof _a||f instanceof so||f instanceof hl)&&f.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const h=this.binders[o];(h instanceof _a||h instanceof so||h instanceof hl)&&h.destroy()}}}class Ac{constructor(o,h,f=()=>!0){this.programConfigurations={};for(const g of o)this.programConfigurations[g.id]=new jA(g,h,f);this.needsUpload=!1,this._featureMap=new bc,this._bufferOffset=0}populatePaintArrays(o,h,f,g,x,b){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(o,h,g,x,b);h.id!==void 0&&this._featureMap.add(h.id,f,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,h,f,g){for(const x of f)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(o,this._featureMap,h,x,g)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function FD(c,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${o}-`,"").replace(/-/g,"_")]}function HA(c,o,h){const f={color:{source:J,composite:Mt},number:{source:nt,composite:J}},g=function(x){return{"line-pattern":{source:Kr,composite:Kr},"fill-pattern":{source:Kr,composite:Kr},"fill-extrusion-pattern":{source:Kr,composite:Kr}}[x]}(c);return g&&g[h]||f[o][h]}ct("ConstantBinder",tf),ct("CrossFadedConstantBinder",Hu),ct("SourceExpressionBinder",_a),ct("CrossFadedCompositeBinder",hl),ct("CompositeExpressionBinder",so),ct("ProgramConfiguration",jA,{omit:["_buffers"]}),ct("ProgramConfigurationSet",Ac);const ln=8192,B0=Math.pow(2,14)-1,$A=-B0-1;function Tc(c){const o=ln/c.extent,h=c.loadGeometry();for(let f=0;f<h.length;f++){const g=h[f];for(let x=0;x<g.length;x++){const b=g[x],A=Math.round(b.x*o),S=Math.round(b.y*o);b.x=Ce(A,$A,B0),b.y=Ce(S,$A,B0),(A<b.x||A>b.x+1||S<b.y||S>b.y+1)&&Pt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function Ec(c,o){return{type:c.type,id:c.id,properties:c.properties,geometry:o?Tc(c):[]}}function Um(c,o,h,f,g){c.emplaceBack(2*o+(f+1)/2,2*h+(g+1)/2)}class D0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new nr,this.indexArray=new ps,this.segments=new Gt,this.programConfigurations=new Ac(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,f){const g=this.layers[0],x=[];let b=null,A=!1;g.type==="circle"&&(b=g.layout.get("circle-sort-key"),A=!b.isConstant());for(const{feature:S,id:M,index:B,sourceLayerIndex:O}of o){const U=this.layers[0]._featureFilter.needGeometry,j=Ec(S,U);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),j,f))continue;const G=A?b.evaluate(j,{},f):void 0,Z={id:M,properties:S.properties,type:S.type,sourceLayerIndex:O,index:B,geometry:U?j.geometry:Tc(S),patterns:{},sortKey:G};x.push(Z)}A&&x.sort((S,M)=>S.sortKey-M.sortKey);for(const S of x){const{geometry:M,index:B,sourceLayerIndex:O}=S,U=o[B].feature;this.addFeature(S,M,B,f),h.featureIndex.insert(U,M,B,O,this.index)}}update(o,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,kr),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,h,f,g){for(const x of h)for(const b of x){const A=b.x,S=b.y;if(A<0||A>=ln||S<0||S>=ln)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),B=M.vertexLength;Um(this.layoutVertexArray,A,S,-1,-1),Um(this.layoutVertexArray,A,S,1,-1),Um(this.layoutVertexArray,A,S,1,1),Um(this.layoutVertexArray,A,S,-1,1),this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+3,B+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{},g)}}function GA(c,o){for(let h=0;h<c.length;h++)if($u(o,c[h]))return!0;for(let h=0;h<o.length;h++)if($u(c,o[h]))return!0;return!!O0(c,o)}function ND(c,o,h){return!!$u(c,o)||!!k0(o,c,h)}function WA(c,o){if(c.length===1)return qA(o,c[0]);for(let h=0;h<o.length;h++){const f=o[h];for(let g=0;g<f.length;g++)if($u(c,f[g]))return!0}for(let h=0;h<c.length;h++)if(qA(o,c[h]))return!0;for(let h=0;h<o.length;h++)if(O0(c,o[h]))return!0;return!1}function LD(c,o,h){if(c.length>1){if(O0(c,o))return!0;for(let f=0;f<o.length;f++)if(k0(o[f],c,h))return!0}for(let f=0;f<c.length;f++)if(k0(c[f],o,h))return!0;return!1}function O0(c,o){if(c.length===0||o.length===0)return!1;for(let h=0;h<c.length-1;h++){const f=c[h],g=c[h+1];for(let x=0;x<o.length-1;x++)if(UD(f,g,o[x],o[x+1]))return!0}return!1}function UD(c,o,h,f){return bt(c,h,f)!==bt(o,h,f)&&bt(c,o,h)!==bt(c,o,f)}function k0(c,o,h){const f=h*h;if(o.length===1)return c.distSqr(o[0])<f;for(let g=1;g<o.length;g++)if(XA(c,o[g-1],o[g])<f)return!0;return!1}function XA(c,o,h){const f=o.distSqr(h);if(f===0)return c.distSqr(o);const g=((c.x-o.x)*(h.x-o.x)+(c.y-o.y)*(h.y-o.y))/f;return c.distSqr(g<0?o:g>1?h:h.sub(o)._mult(g)._add(o))}function qA(c,o){let h,f,g,x=!1;for(let b=0;b<c.length;b++){h=c[b];for(let A=0,S=h.length-1;A<h.length;S=A++)f=h[A],g=h[S],f.y>o.y!=g.y>o.y&&o.x<(g.x-f.x)*(o.y-f.y)/(g.y-f.y)+f.x&&(x=!x)}return x}function $u(c,o){let h=!1;for(let f=0,g=c.length-1;f<c.length;g=f++){const x=c[f],b=c[g];x.y>o.y!=b.y>o.y&&o.x<(b.x-x.x)*(o.y-x.y)/(b.y-x.y)+x.x&&(h=!h)}return h}function zD(c,o,h){const f=h[0],g=h[2];if(c.x<f.x&&o.x<f.x||c.x>g.x&&o.x>g.x||c.y<f.y&&o.y<f.y||c.y>g.y&&o.y>g.y)return!1;const x=bt(c,o,h[0]);return x!==bt(c,o,h[1])||x!==bt(c,o,h[2])||x!==bt(c,o,h[3])}function nf(c,o,h){const f=o.paint.get(c).value;return f.kind==="constant"?f.value:h.programConfigurations.get(o.id).getMaxValue(c)}function zm(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Vm(c,o,h,f,g){if(!o[0]&&!o[1])return c;const x=I.convert(o)._mult(g);h==="viewport"&&x._rotate(-f);const b=[];for(let A=0;A<c.length;A++)b.push(c[A].sub(x));return b}let KA,ZA;ct("CircleBucket",D0,{omit:["layers"]});var VD={get paint(){return ZA=ZA||new v({"circle-radius":new Tt(Pe.paint_circle["circle-radius"]),"circle-color":new Tt(Pe.paint_circle["circle-color"]),"circle-blur":new Tt(Pe.paint_circle["circle-blur"]),"circle-opacity":new Tt(Pe.paint_circle["circle-opacity"]),"circle-translate":new ft(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new ft(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ft(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ft(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Tt(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Tt(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Tt(Pe.paint_circle["circle-stroke-opacity"])})},get layout(){return KA=KA||new v({"circle-sort-key":new Tt(Pe.layout_circle["circle-sort-key"])})}},gr=1e-6,Gu=typeof Float32Array<"u"?Float32Array:Array;function F0(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function YA(c,o,h){var f=o[0],g=o[1],x=o[2],b=o[3],A=o[4],S=o[5],M=o[6],B=o[7],O=o[8],U=o[9],j=o[10],G=o[11],Z=o[12],se=o[13],le=o[14],Ee=o[15],_e=h[0],be=h[1],Oe=h[2],He=h[3];return c[0]=_e*f+be*A+Oe*O+He*Z,c[1]=_e*g+be*S+Oe*U+He*se,c[2]=_e*x+be*M+Oe*j+He*le,c[3]=_e*b+be*B+Oe*G+He*Ee,c[4]=(_e=h[4])*f+(be=h[5])*A+(Oe=h[6])*O+(He=h[7])*Z,c[5]=_e*g+be*S+Oe*U+He*se,c[6]=_e*x+be*M+Oe*j+He*le,c[7]=_e*b+be*B+Oe*G+He*Ee,c[8]=(_e=h[8])*f+(be=h[9])*A+(Oe=h[10])*O+(He=h[11])*Z,c[9]=_e*g+be*S+Oe*U+He*se,c[10]=_e*x+be*M+Oe*j+He*le,c[11]=_e*b+be*B+Oe*G+He*Ee,c[12]=(_e=h[12])*f+(be=h[13])*A+(Oe=h[14])*O+(He=h[15])*Z,c[13]=_e*g+be*S+Oe*U+He*se,c[14]=_e*x+be*M+Oe*j+He*le,c[15]=_e*b+be*B+Oe*G+He*Ee,c}Math.hypot||(Math.hypot=function(){for(var c=0,o=arguments.length;o--;)c+=arguments[o]*arguments[o];return Math.sqrt(c)});var rf,jD=YA;function jm(c,o,h){var f=o[0],g=o[1],x=o[2],b=o[3];return c[0]=h[0]*f+h[4]*g+h[8]*x+h[12]*b,c[1]=h[1]*f+h[5]*g+h[9]*x+h[13]*b,c[2]=h[2]*f+h[6]*g+h[10]*x+h[14]*b,c[3]=h[3]*f+h[7]*g+h[11]*x+h[15]*b,c}rf=new Gu(4),Gu!=Float32Array&&(rf[0]=0,rf[1]=0,rf[2]=0,rf[3]=0);class HD extends d{constructor(o){super(o,VD)}createBucket(o){return new D0(o)}queryRadius(o){const h=o;return nf("circle-radius",this,h)+nf("circle-stroke-width",this,h)+zm(this.paint.get("circle-translate"))}queryIntersectsFeature(o,h,f,g,x,b,A,S){const M=Vm(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,A),B=this.paint.get("circle-radius").evaluate(h,f)+this.paint.get("circle-stroke-width").evaluate(h,f),O=this.paint.get("circle-pitch-alignment")==="map",U=O?M:function(G,Z){return G.map(se=>JA(se,Z))}(M,S),j=O?B*A:B;for(const G of g)for(const Z of G){const se=O?Z:JA(Z,S);let le=j;const Ee=jm([],[Z.x,Z.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?le*=Ee[3]/b.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(le*=b.cameraToCenterDistance/Ee[3]),ND(U,se,le))return!0}return!1}}function JA(c,o){const h=jm([],[c.x,c.y,0,1],o);return new I(h[0]/h[3],h[1]/h[3])}class QA extends D0{}let eT;ct("HeatmapBucket",QA,{omit:["layers"]});var $D={get paint(){return eT=eT||new v({"heatmap-radius":new Tt(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Tt(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ft(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Qd(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ft(Pe.paint_heatmap["heatmap-opacity"])})}};function N0(c,{width:o,height:h},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==o*h*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${o*h*f}`)}else g=new Uint8Array(o*h*f);return c.width=o,c.height=h,c.data=g,c}function tT(c,{width:o,height:h},f){if(o===c.width&&h===c.height)return;const g=N0({},{width:o,height:h},f);L0(c,g,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,o),height:Math.min(c.height,h)},f),c.width=o,c.height=h,c.data=g.data}function L0(c,o,h,f,g,x){if(g.width===0||g.height===0)return o;if(g.width>c.width||g.height>c.height||h.x>c.width-g.width||h.y>c.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>o.width||g.height>o.height||f.x>o.width-g.width||f.y>o.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const b=c.data,A=o.data;if(b===A)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<g.height;S++){const M=((h.y+S)*c.width+h.x)*x,B=((f.y+S)*o.width+f.x)*x;for(let O=0;O<g.width*x;O++)A[B+O]=b[M+O]}return o}class sf{constructor(o,h){N0(this,o,1,h)}resize(o){tT(this,o,1)}clone(){return new sf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,h,f,g,x){L0(o,h,f,g,x,1)}}class ms{constructor(o,h){N0(this,o,4,h)}resize(o){tT(this,o,4)}replace(o,h){h?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new ms({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,h,f,g,x){L0(o,h,f,g,x,4)}}function iT(c){const o={},h=c.resolution||256,f=c.clips?c.clips.length:1,g=c.image||new ms({width:h,height:f});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const x=(b,A,S)=>{o[c.evaluationKey]=S;const M=c.expression.evaluate(o);g.data[b+A+0]=Math.floor(255*M.r/M.a),g.data[b+A+1]=Math.floor(255*M.g/M.a),g.data[b+A+2]=Math.floor(255*M.b/M.a),g.data[b+A+3]=Math.floor(255*M.a)};if(c.clips)for(let b=0,A=0;b<f;++b,A+=4*h)for(let S=0,M=0;S<h;S++,M+=4){const B=S/(h-1),{start:O,end:U}=c.clips[b];x(A,M,O*(1-B)+U*B)}else for(let b=0,A=0;b<h;b++,A+=4)x(0,A,b/(h-1));return g}ct("AlphaImage",sf),ct("RGBAImage",ms);const U0="big-fb";class GD extends d{createBucket(o){return new QA(o)}constructor(o){super(o,$D),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=iT({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(U0)&&this.heatmapFbos.delete(U0)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let nT;var WD={get paint(){return nT=nT||new v({"hillshade-illumination-direction":new ft(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ft(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ft(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ft(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ft(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ft(Pe.paint_hillshade["hillshade-accent-color"])})}};class XD extends d{constructor(o){super(o,WD)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const qD=T([{name:"a_pos",components:2,type:"Int16"}],4),{members:KD}=qD;function rT(c,o,h=2){const f=o&&o.length,g=f?o[0]*h:c.length;let x=sT(c,0,g,h,!0);const b=[];if(!x||x.next===x.prev)return b;let A,S,M;if(f&&(x=function(B,O,U,j){const G=[];for(let Z=0,se=O.length;Z<se;Z++){const le=sT(B,O[Z]*j,Z<se-1?O[Z+1]*j:B.length,j,!1);le===le.next&&(le.steiner=!0),G.push(nO(le))}G.sort(eO);for(let Z=0;Z<G.length;Z++)U=tO(G[Z],U);return U}(c,o,x,h)),c.length>80*h){A=1/0,S=1/0;let B=-1/0,O=-1/0;for(let U=h;U<g;U+=h){const j=c[U],G=c[U+1];j<A&&(A=j),G<S&&(S=G),j>B&&(B=j),G>O&&(O=G)}M=Math.max(B-A,O-S),M=M!==0?32767/M:0}return of(x,b,h,A,S,M,0),b}function sT(c,o,h,f,g){let x;if(g===function(b,A,S,M){let B=0;for(let O=A,U=S-M;O<S;O+=M)B+=(b[U]-b[O])*(b[O+1]+b[U+1]),U=O;return B}(c,o,h,f)>0)for(let b=o;b<h;b+=f)x=lT(b/f|0,c[b],c[b+1],x);else for(let b=h-f;b>=o;b-=f)x=lT(b/f|0,c[b],c[b+1],x);return x&&Hm(x,x.next)&&(lf(x),x=x.next),x}function Sc(c,o){if(!c)return c;o||(o=c);let h,f=c;do if(h=!1,f.steiner||!Hm(f,f.next)&&en(f.prev,f,f.next)!==0)f=f.next;else{if(lf(f),f=o=f.prev,f===f.next)break;h=!0}while(h||f!==o);return o}function of(c,o,h,f,g,x,b){if(!c)return;!b&&x&&function(S,M,B,O){let U=S;do U.z===0&&(U.z=z0(U.x,U.y,M,B,O)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==S);U.prevZ.nextZ=null,U.prevZ=null,function(j){let G,Z=1;do{let se,le=j;j=null;let Ee=null;for(G=0;le;){G++;let _e=le,be=0;for(let He=0;He<Z&&(be++,_e=_e.nextZ,_e);He++);let Oe=Z;for(;be>0||Oe>0&&_e;)be!==0&&(Oe===0||!_e||le.z<=_e.z)?(se=le,le=le.nextZ,be--):(se=_e,_e=_e.nextZ,Oe--),Ee?Ee.nextZ=se:j=se,se.prevZ=Ee,Ee=se;le=_e}Ee.nextZ=null,Z*=2}while(G>1)}(U)}(c,f,g,x);let A=c;for(;c.prev!==c.next;){const S=c.prev,M=c.next;if(x?YD(c,f,g,x):ZD(c))o.push(S.i,c.i,M.i),lf(c),c=M.next,A=M.next;else if((c=M)===A){b?b===1?of(c=JD(Sc(c),o),o,h,f,g,x,2):b===2&&QD(c,o,h,f,g,x):of(Sc(c),o,h,f,g,x,1);break}}}function ZD(c){const o=c.prev,h=c,f=c.next;if(en(o,h,f)>=0)return!1;const g=o.x,x=h.x,b=f.x,A=o.y,S=h.y,M=f.y,B=g<x?g<b?g:b:x<b?x:b,O=A<S?A<M?A:M:S<M?S:M,U=g>x?g>b?g:b:x>b?x:b,j=A>S?A>M?A:M:S>M?S:M;let G=f.next;for(;G!==o;){if(G.x>=B&&G.x<=U&&G.y>=O&&G.y<=j&&Wu(g,A,x,S,b,M,G.x,G.y)&&en(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function YD(c,o,h,f){const g=c.prev,x=c,b=c.next;if(en(g,x,b)>=0)return!1;const A=g.x,S=x.x,M=b.x,B=g.y,O=x.y,U=b.y,j=A<S?A<M?A:M:S<M?S:M,G=B<O?B<U?B:U:O<U?O:U,Z=A>S?A>M?A:M:S>M?S:M,se=B>O?B>U?B:U:O>U?O:U,le=z0(j,G,o,h,f),Ee=z0(Z,se,o,h,f);let _e=c.prevZ,be=c.nextZ;for(;_e&&_e.z>=le&&be&&be.z<=Ee;){if(_e.x>=j&&_e.x<=Z&&_e.y>=G&&_e.y<=se&&_e!==g&&_e!==b&&Wu(A,B,S,O,M,U,_e.x,_e.y)&&en(_e.prev,_e,_e.next)>=0||(_e=_e.prevZ,be.x>=j&&be.x<=Z&&be.y>=G&&be.y<=se&&be!==g&&be!==b&&Wu(A,B,S,O,M,U,be.x,be.y)&&en(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;_e&&_e.z>=le;){if(_e.x>=j&&_e.x<=Z&&_e.y>=G&&_e.y<=se&&_e!==g&&_e!==b&&Wu(A,B,S,O,M,U,_e.x,_e.y)&&en(_e.prev,_e,_e.next)>=0)return!1;_e=_e.prevZ}for(;be&&be.z<=Ee;){if(be.x>=j&&be.x<=Z&&be.y>=G&&be.y<=se&&be!==g&&be!==b&&Wu(A,B,S,O,M,U,be.x,be.y)&&en(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function JD(c,o){let h=c;do{const f=h.prev,g=h.next.next;!Hm(f,g)&&oT(f,h,h.next,g)&&af(f,g)&&af(g,f)&&(o.push(f.i,h.i,g.i),lf(h),lf(h.next),h=c=g),h=h.next}while(h!==c);return Sc(h)}function QD(c,o,h,f,g,x){let b=c;do{let A=b.next.next;for(;A!==b.prev;){if(b.i!==A.i&&rO(b,A)){let S=aT(b,A);return b=Sc(b,b.next),S=Sc(S,S.next),of(b,o,h,f,g,x,0),void of(S,o,h,f,g,x,0)}A=A.next}b=b.next}while(b!==c)}function eO(c,o){return c.x-o.x}function tO(c,o){const h=function(g,x){let b=x;const A=g.x,S=g.y;let M,B=-1/0;do{if(S<=b.y&&S>=b.next.y&&b.next.y!==b.y){const Z=b.x+(S-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(Z<=A&&Z>B&&(B=Z,M=b.x<b.next.x?b:b.next,Z===A))return M}b=b.next}while(b!==x);if(!M)return null;const O=M,U=M.x,j=M.y;let G=1/0;b=M;do{if(A>=b.x&&b.x>=U&&A!==b.x&&Wu(S<j?A:B,S,U,j,S<j?B:A,S,b.x,b.y)){const Z=Math.abs(S-b.y)/(A-b.x);af(b,g)&&(Z<G||Z===G&&(b.x>M.x||b.x===M.x&&iO(M,b)))&&(M=b,G=Z)}b=b.next}while(b!==O);return M}(c,o);if(!h)return o;const f=aT(h,c);return Sc(f,f.next),Sc(h,h.next)}function iO(c,o){return en(c.prev,c,o.prev)<0&&en(o.next,c,c.next)<0}function z0(c,o,h,f,g){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-h)*g|0)|c<<8))|c<<4))|c<<2))|c<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-f)*g|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function nO(c){let o=c,h=c;do(o.x<h.x||o.x===h.x&&o.y<h.y)&&(h=o),o=o.next;while(o!==c);return h}function Wu(c,o,h,f,g,x,b,A){return(g-b)*(o-A)>=(c-b)*(x-A)&&(c-b)*(f-A)>=(h-b)*(o-A)&&(h-b)*(x-A)>=(g-b)*(f-A)}function rO(c,o){return c.next.i!==o.i&&c.prev.i!==o.i&&!function(h,f){let g=h;do{if(g.i!==h.i&&g.next.i!==h.i&&g.i!==f.i&&g.next.i!==f.i&&oT(g,g.next,h,f))return!0;g=g.next}while(g!==h);return!1}(c,o)&&(af(c,o)&&af(o,c)&&function(h,f){let g=h,x=!1;const b=(h.x+f.x)/2,A=(h.y+f.y)/2;do g.y>A!=g.next.y>A&&g.next.y!==g.y&&b<(g.next.x-g.x)*(A-g.y)/(g.next.y-g.y)+g.x&&(x=!x),g=g.next;while(g!==h);return x}(c,o)&&(en(c.prev,c,o.prev)||en(c,o.prev,o))||Hm(c,o)&&en(c.prev,c,c.next)>0&&en(o.prev,o,o.next)>0)}function en(c,o,h){return(o.y-c.y)*(h.x-o.x)-(o.x-c.x)*(h.y-o.y)}function Hm(c,o){return c.x===o.x&&c.y===o.y}function oT(c,o,h,f){const g=Gm(en(c,o,h)),x=Gm(en(c,o,f)),b=Gm(en(h,f,c)),A=Gm(en(h,f,o));return g!==x&&b!==A||!(g!==0||!$m(c,h,o))||!(x!==0||!$m(c,f,o))||!(b!==0||!$m(h,c,f))||!(A!==0||!$m(h,o,f))}function $m(c,o,h){return o.x<=Math.max(c.x,h.x)&&o.x>=Math.min(c.x,h.x)&&o.y<=Math.max(c.y,h.y)&&o.y>=Math.min(c.y,h.y)}function Gm(c){return c>0?1:c<0?-1:0}function af(c,o){return en(c.prev,c,c.next)<0?en(c,o,c.next)>=0&&en(c,c.prev,o)>=0:en(c,o,c.prev)<0||en(c,c.next,o)<0}function aT(c,o){const h=V0(c.i,c.x,c.y),f=V0(o.i,o.x,o.y),g=c.next,x=o.prev;return c.next=o,o.prev=c,h.next=g,g.prev=h,f.next=h,h.prev=f,x.next=f,f.prev=x,f}function lT(c,o,h,f){const g=V0(c,o,h);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function lf(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function V0(c,o,h){return{i:c,x:o,y:h,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function j0(c,o,h){const f=h.patternDependencies;let g=!1;for(const x of o){const b=x.paint.get(`${c}-pattern`);b.isConstant()||(g=!0);const A=b.constantOr(null);A&&(g=!0,f[A.to]=!0,f[A.from]=!0)}return g}function H0(c,o,h,f,g){const x=g.patternDependencies;for(const b of o){const A=b.paint.get(`${c}-pattern`).value;if(A.kind!=="constant"){let S=A.evaluate({zoom:f-1},h,{},g.availableImages),M=A.evaluate({zoom:f},h,{},g.availableImages),B=A.evaluate({zoom:f+1},h,{},g.availableImages);S=S&&S.name?S.name:S,M=M&&M.name?M.name:M,B=B&&B.name?B.name:B,x[S]=!0,x[M]=!0,x[B]=!0,h.patterns[b.id]={min:S,mid:M,max:B}}}return h}class $0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Vs,this.indexArray=new ps,this.indexArray2=new Rn,this.programConfigurations=new Ac(o.layers,o.zoom),this.segments=new Gt,this.segments2=new Gt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,f){this.hasPattern=j0("fill",this.layers,h);const g=this.layers[0].layout.get("fill-sort-key"),x=!g.isConstant(),b=[];for(const{feature:A,id:S,index:M,sourceLayerIndex:B}of o){const O=this.layers[0]._featureFilter.needGeometry,U=Ec(A,O);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),U,f))continue;const j=x?g.evaluate(U,{},f,h.availableImages):void 0,G={id:S,properties:A.properties,type:A.type,sourceLayerIndex:B,index:M,geometry:O?U.geometry:Tc(A),patterns:{},sortKey:j};b.push(G)}x&&b.sort((A,S)=>A.sortKey-S.sortKey);for(const A of b){const{geometry:S,index:M,sourceLayerIndex:B}=A;if(this.hasPattern){const O=H0("fill",this.layers,A,this.zoom,h);this.patternFeatures.push(O)}else this.addFeature(A,S,M,f,{});h.featureIndex.insert(o[M].feature,S,M,B,this.index)}}update(o,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,f)}addFeatures(o,h,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,KD),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,h,f,g,x){for(const b of gu(h,500)){let A=0;for(const j of b)A+=j.length;const S=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),M=S.vertexLength,B=[],O=[];for(const j of b){if(j.length===0)continue;j!==b[0]&&O.push(B.length/2);const G=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),Z=G.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(Z+j.length-1,Z),B.push(j[0].x),B.push(j[0].y);for(let se=1;se<j.length;se++)this.layoutVertexArray.emplaceBack(j[se].x,j[se].y),this.indexArray2.emplaceBack(Z+se-1,Z+se),B.push(j[se].x),B.push(j[se].y);G.vertexLength+=j.length,G.primitiveLength+=j.length}const U=rT(B,O);for(let j=0;j<U.length;j+=3)this.indexArray.emplaceBack(M+U[j],M+U[j+1],M+U[j+2]);S.vertexLength+=A,S.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,g)}}let cT,uT;ct("FillBucket",$0,{omit:["layers","patternFeatures"]});var sO={get paint(){return uT=uT||new v({"fill-antialias":new ft(Pe.paint_fill["fill-antialias"]),"fill-opacity":new Tt(Pe.paint_fill["fill-opacity"]),"fill-color":new Tt(Pe.paint_fill["fill-color"]),"fill-outline-color":new Tt(Pe.paint_fill["fill-outline-color"]),"fill-translate":new ft(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new ft(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fu(Pe.paint_fill["fill-pattern"])})},get layout(){return cT=cT||new v({"fill-sort-key":new Tt(Pe.layout_fill["fill-sort-key"])})}};class oO extends d{constructor(o){super(o,sO)}recalculate(o,h){super.recalculate(o,h);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new $0(o)}queryRadius(){return zm(this.paint.get("fill-translate"))}queryIntersectsFeature(o,h,f,g,x,b,A){return WA(Vm(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,A),g)}isTileClipped(){return!0}}const aO=T([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),lO=T([{name:"a_centroid",components:2,type:"Int16"}],4),{members:cO}=aO;var dl={},uO=w,hT=Xu;function Xu(c,o,h,f,g){this.properties={},this.extent=h,this.type=0,this._pbf=c,this._geometry=-1,this._keys=f,this._values=g,c.readFields(hO,this,o)}function hO(c,o,h){c==1?o.id=h.readVarint():c==2?function(f,g){for(var x=f.readVarint()+f.pos;f.pos<x;){var b=g._keys[f.readVarint()],A=g._values[f.readVarint()];g.properties[b]=A}}(h,o):c==3?o.type=h.readVarint():c==4&&(o._geometry=h.pos)}function dO(c){for(var o,h,f=0,g=0,x=c.length,b=x-1;g<x;b=g++)f+=((h=c[b]).x-(o=c[g]).x)*(o.y+h.y);return f}Xu.types=["Unknown","Point","LineString","Polygon"],Xu.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var o,h=c.readVarint()+c.pos,f=1,g=0,x=0,b=0,A=[];c.pos<h;){if(g<=0){var S=c.readVarint();f=7&S,g=S>>3}if(g--,f===1||f===2)x+=c.readSVarint(),b+=c.readSVarint(),f===1&&(o&&A.push(o),o=[]),o.push(new uO(x,b));else{if(f!==7)throw new Error("unknown command "+f);o&&o.push(o[0].clone())}}return o&&A.push(o),A},Xu.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var o=c.readVarint()+c.pos,h=1,f=0,g=0,x=0,b=1/0,A=-1/0,S=1/0,M=-1/0;c.pos<o;){if(f<=0){var B=c.readVarint();h=7&B,f=B>>3}if(f--,h===1||h===2)(g+=c.readSVarint())<b&&(b=g),g>A&&(A=g),(x+=c.readSVarint())<S&&(S=x),x>M&&(M=x);else if(h!==7)throw new Error("unknown command "+h)}return[b,S,A,M]},Xu.prototype.toGeoJSON=function(c,o,h){var f,g,x=this.extent*Math.pow(2,h),b=this.extent*c,A=this.extent*o,S=this.loadGeometry(),M=Xu.types[this.type];function B(j){for(var G=0;G<j.length;G++){var Z=j[G];j[G]=[360*(Z.x+b)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+A)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(f=0;f<S.length;f++)O[f]=S[f][0];B(S=O);break;case 2:for(f=0;f<S.length;f++)B(S[f]);break;case 3:for(S=function(j){var G=j.length;if(G<=1)return[j];for(var Z,se,le=[],Ee=0;Ee<G;Ee++){var _e=dO(j[Ee]);_e!==0&&(se===void 0&&(se=_e<0),se===_e<0?(Z&&le.push(Z),Z=[j[Ee]]):Z.push(j[Ee]))}return Z&&le.push(Z),le}(S),f=0;f<S.length;f++)for(g=0;g<S[f].length;g++)B(S[f][g])}S.length===1?S=S[0]:M="Multi"+M;var U={type:"Feature",geometry:{type:M,coordinates:S},properties:this.properties};return"id"in this&&(U.id=this.id),U};var fO=hT,dT=fT;function fT(c,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(pO,this,o),this.length=this._features.length}function pO(c,o,h){c===15?o.version=h.readVarint():c===1?o.name=h.readString():c===5?o.extent=h.readVarint():c===2?o._features.push(h.pos):c===3?o._keys.push(h.readString()):c===4&&o._values.push(function(f){for(var g=null,x=f.readVarint()+f.pos;f.pos<x;){var b=f.readVarint()>>3;g=b===1?f.readString():b===2?f.readFloat():b===3?f.readDouble():b===4?f.readVarint64():b===5?f.readVarint():b===6?f.readSVarint():b===7?f.readBoolean():null}return g}(h))}fT.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var o=this._pbf.readVarint()+this._pbf.pos;return new fO(this._pbf,o,this.extent,this._keys,this._values)};var mO=dT;function gO(c,o,h){if(c===3){var f=new mO(h,h.readVarint()+h.pos);f.length&&(o[f.name]=f)}}dl.VectorTile=function(c,o){this.layers=c.readFields(gO,{},o)},dl.VectorTileFeature=hT,dl.VectorTileLayer=dT;const _O=dl.VectorTileFeature.types,G0=Math.pow(2,13);function cf(c,o,h,f,g,x,b,A){c.emplaceBack(o,h,2*Math.floor(f*G0)+b,g*G0*2,x*G0*2,Math.round(A))}class W0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new ol,this.centroidVertexArray=new Vn,this.indexArray=new ps,this.programConfigurations=new Ac(o.layers,o.zoom),this.segments=new Gt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,f){this.features=[],this.hasPattern=j0("fill-extrusion",this.layers,h);for(const{feature:g,id:x,index:b,sourceLayerIndex:A}of o){const S=this.layers[0]._featureFilter.needGeometry,M=Ec(g,S);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),M,f))continue;const B={id:x,sourceLayerIndex:A,index:b,geometry:S?M.geometry:Tc(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(H0("fill-extrusion",this.layers,B,this.zoom,h)):this.addFeature(B,B.geometry,b,f,{}),h.featureIndex.insert(g,B.geometry,b,A,this.index,!0)}}addFeatures(o,h,f){for(const g of this.features){const{geometry:x}=g;this.addFeature(g,x,g.index,h,f)}}update(o,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,cO),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,lO.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,h,f,g,x){for(const b of gu(h,500)){const A={x:0,y:0,vertexCount:0};let S=0;for(const G of b)S+=G.length;let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const G of b){if(G.length===0||vO(G))continue;let Z=0;for(let se=0;se<G.length;se++){const le=G[se];if(se>=1){const Ee=G[se-1];if(!yO(le,Ee)){M.vertexLength+4>Gt.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const _e=le.sub(Ee)._perp()._unit(),be=Ee.dist(le);Z+be>32768&&(Z=0),cf(this.layoutVertexArray,le.x,le.y,_e.x,_e.y,0,0,Z),cf(this.layoutVertexArray,le.x,le.y,_e.x,_e.y,0,1,Z),A.x+=2*le.x,A.y+=2*le.y,A.vertexCount+=2,Z+=be,cf(this.layoutVertexArray,Ee.x,Ee.y,_e.x,_e.y,0,0,Z),cf(this.layoutVertexArray,Ee.x,Ee.y,_e.x,_e.y,0,1,Z),A.x+=2*Ee.x,A.y+=2*Ee.y,A.vertexCount+=2;const Oe=M.vertexLength;this.indexArray.emplaceBack(Oe,Oe+2,Oe+1),this.indexArray.emplaceBack(Oe+1,Oe+2,Oe+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+S>Gt.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),_O[o.type]!=="Polygon")continue;const B=[],O=[],U=M.vertexLength;for(const G of b)if(G.length!==0){G!==b[0]&&O.push(B.length/2);for(let Z=0;Z<G.length;Z++){const se=G[Z];cf(this.layoutVertexArray,se.x,se.y,0,0,1,1,0),A.x+=se.x,A.y+=se.y,A.vertexCount+=1,B.push(se.x),B.push(se.y)}}const j=rT(B,O);for(let G=0;G<j.length;G+=3)this.indexArray.emplaceBack(U+j[G],U+j[G+2],U+j[G+1]);M.primitiveLength+=j.length/3,M.vertexLength+=S;for(let G=0;G<A.vertexCount;G++){const Z=Math.floor(A.x/A.vertexCount),se=Math.floor(A.y/A.vertexCount);this.centroidVertexArray.emplaceBack(Z,se)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,g)}}function yO(c,o){return c.x===o.x&&(c.x<0||c.x>ln)||c.y===o.y&&(c.y<0||c.y>ln)}function vO(c){return c.every(o=>o.x<0)||c.every(o=>o.x>ln)||c.every(o=>o.y<0)||c.every(o=>o.y>ln)}let pT;ct("FillExtrusionBucket",W0,{omit:["layers","features"]});var xO={get paint(){return pT=pT||new v({"fill-extrusion-opacity":new ft(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Tt(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ft(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ft(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fu(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Tt(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Tt(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ft(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class bO extends d{constructor(o){super(o,xO)}createBucket(o){return new W0(o)}queryRadius(){return zm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(o,h,f,g,x,b,A,S){const M=Vm(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,A),B=this.paint.get("fill-extrusion-height").evaluate(h,f),O=this.paint.get("fill-extrusion-base").evaluate(h,f),U=function(G,Z,se,le){const Ee=[];for(const _e of G){const be=[_e.x,_e.y,0,1];jm(be,be,Z),Ee.push(new I(be[0]/be[3],be[1]/be[3]))}return Ee}(M,S),j=function(G,Z,se,le){const Ee=[],_e=[],be=le[8]*Z,Oe=le[9]*Z,He=le[10]*Z,ot=le[11]*Z,wt=le[8]*se,rt=le[9]*se,it=le[10]*se,gt=le[11]*se;for(const dt of G){const lt=[],Ne=[];for(const yt of dt){const mt=yt.x,Rt=yt.y,gi=le[0]*mt+le[4]*Rt+le[12],hi=le[1]*mt+le[5]*Rt+le[13],vn=le[2]*mt+le[6]*Rt+le[14],js=le[3]*mt+le[7]*Rt+le[15],$n=vn+He,xn=js+ot,_r=gi+wt,yr=hi+rt,vr=vn+it,qi=js+gt,bn=new I((gi+be)/xn,(hi+Oe)/xn);bn.z=$n/xn,lt.push(bn);const rr=new I(_r/qi,yr/qi);rr.z=vr/qi,Ne.push(rr)}Ee.push(lt),_e.push(Ne)}return[Ee,_e]}(g,O,B,S);return function(G,Z,se){let le=1/0;WA(se,Z)&&(le=mT(se,Z[0]));for(let Ee=0;Ee<Z.length;Ee++){const _e=Z[Ee],be=G[Ee];for(let Oe=0;Oe<_e.length-1;Oe++){const He=_e[Oe],ot=[He,_e[Oe+1],be[Oe+1],be[Oe],He];GA(se,ot)&&(le=Math.min(le,mT(se,ot)))}}return le!==1/0&&le}(j[0],j[1],U)}}function uf(c,o){return c.x*o.x+c.y*o.y}function mT(c,o){if(c.length===1){let h=0;const f=o[h++];let g;for(;!g||f.equals(g);)if(g=o[h++],!g)return 1/0;for(;h<o.length;h++){const x=o[h],b=c[0],A=g.sub(f),S=x.sub(f),M=b.sub(f),B=uf(A,A),O=uf(A,S),U=uf(S,S),j=uf(M,A),G=uf(M,S),Z=B*U-O*O,se=(U*j-O*G)/Z,le=(B*G-O*j)/Z,Ee=f.z*(1-se-le)+g.z*se+x.z*le;if(isFinite(Ee))return Ee}return 1/0}{let h=1/0;for(const f of o)h=Math.min(h,f.z);return h}}const wO=T([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:AO}=wO,TO=T([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:EO}=TO,SO=dl.VectorTileFeature.types,CO=Math.cos(Math.PI/180*37.5),gT=Math.pow(2,14)/.5;class X0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(h=>h.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new Lu,this.layoutVertexArray2=new al,this.indexArray=new ps,this.programConfigurations=new Ac(o.layers,o.zoom),this.segments=new Gt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(o,h,f){this.hasPattern=j0("line",this.layers,h);const g=this.layers[0].layout.get("line-sort-key"),x=!g.isConstant(),b=[];for(const{feature:A,id:S,index:M,sourceLayerIndex:B}of o){const O=this.layers[0]._featureFilter.needGeometry,U=Ec(A,O);if(!this.layers[0]._featureFilter.filter(new Ai(this.zoom),U,f))continue;const j=x?g.evaluate(U,{},f):void 0,G={id:S,properties:A.properties,type:A.type,sourceLayerIndex:B,index:M,geometry:O?U.geometry:Tc(A),patterns:{},sortKey:j};b.push(G)}x&&b.sort((A,S)=>A.sortKey-S.sortKey);for(const A of b){const{geometry:S,index:M,sourceLayerIndex:B}=A;if(this.hasPattern){const O=H0("line",this.layers,A,this.zoom,h);this.patternFeatures.push(O)}else this.addFeature(A,S,M,f,{});h.featureIndex.insert(o[M].feature,S,M,B,this.index)}}update(o,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,h,this.stateDependentLayers,f)}addFeatures(o,h,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,EO)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,AO),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,h,f,g,x){const b=this.layers[0].layout,A=b.get("line-join").evaluate(o,{}),S=b.get("line-cap"),M=b.get("line-miter-limit"),B=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const O of h)this.addLine(O,o,A,S,M,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,g)}addLine(o,h,f,g,x,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<o.length-1;le++)this.totalDistance+=o[le].dist(o[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=SO[h.type]==="Polygon";let S=o.length;for(;S>=2&&o[S-1].equals(o[S-2]);)S--;let M=0;for(;M<S-1&&o[M].equals(o[M+1]);)M++;if(S<(A?3:2))return;f==="bevel"&&(x=1.05);const B=this.overscaling<=16?15*ln/(512*this.overscaling):0,O=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let U,j,G,Z,se;this.e1=this.e2=-1,A&&(U=o[S-2],se=o[M].sub(U)._unit()._perp());for(let le=M;le<S;le++){if(G=le===S-1?A?o[M+1]:void 0:o[le+1],G&&o[le].equals(G))continue;se&&(Z=se),U&&(j=U),U=o[le],se=G?G.sub(U)._unit()._perp():Z,Z=Z||se;let Ee=Z.add(se);Ee.x===0&&Ee.y===0||Ee._unit();const _e=Z.x*se.x+Z.y*se.y,be=Ee.x*se.x+Ee.y*se.y,Oe=be!==0?1/be:1/0,He=2*Math.sqrt(2-2*be),ot=be<CO&&j&&G,wt=Z.x*se.y-Z.y*se.x>0;if(ot&&le>M){const gt=U.dist(j);if(gt>2*B){const dt=U.sub(U.sub(j)._mult(B/gt)._round());this.updateDistance(j,dt),this.addCurrentVertex(dt,Z,0,0,O),j=dt}}const rt=j&&G;let it=rt?f:A?"butt":g;if(rt&&it==="round"&&(Oe<b?it="miter":Oe<=2&&(it="fakeround")),it==="miter"&&Oe>x&&(it="bevel"),it==="bevel"&&(Oe>2&&(it="flipbevel"),Oe<x&&(it="miter")),j&&this.updateDistance(j,U),it==="miter")Ee._mult(Oe),this.addCurrentVertex(U,Ee,0,0,O);else if(it==="flipbevel"){if(Oe>100)Ee=se.mult(-1);else{const gt=Oe*Z.add(se).mag()/Z.sub(se).mag();Ee._perp()._mult(gt*(wt?-1:1))}this.addCurrentVertex(U,Ee,0,0,O),this.addCurrentVertex(U,Ee.mult(-1),0,0,O)}else if(it==="bevel"||it==="fakeround"){const gt=-Math.sqrt(Oe*Oe-1),dt=wt?gt:0,lt=wt?0:gt;if(j&&this.addCurrentVertex(U,Z,dt,lt,O),it==="fakeround"){const Ne=Math.round(180*He/Math.PI/20);for(let yt=1;yt<Ne;yt++){let mt=yt/Ne;if(mt!==.5){const gi=mt-.5;mt+=mt*gi*(mt-1)*((1.0904+_e*(_e*(3.55645-1.43519*_e)-3.2452))*gi*gi+(.848013+_e*(.215638*_e-1.06021)))}const Rt=se.sub(Z)._mult(mt)._add(Z)._unit()._mult(wt?-1:1);this.addHalfVertex(U,Rt.x,Rt.y,!1,wt,0,O)}}G&&this.addCurrentVertex(U,se,-dt,-lt,O)}else if(it==="butt")this.addCurrentVertex(U,Ee,0,0,O);else if(it==="square"){const gt=j?1:-1;this.addCurrentVertex(U,Ee,gt,gt,O)}else it==="round"&&(j&&(this.addCurrentVertex(U,Z,0,0,O),this.addCurrentVertex(U,Z,1,1,O,!0)),G&&(this.addCurrentVertex(U,se,-1,-1,O,!0),this.addCurrentVertex(U,se,0,0,O)));if(ot&&le<S-1){const gt=U.dist(G);if(gt>2*B){const dt=U.add(G.sub(U)._mult(B/gt)._round());this.updateDistance(U,dt),this.addCurrentVertex(dt,se,0,0,O),U=dt}}}}addCurrentVertex(o,h,f,g,x,b=!1){const A=h.y*g-h.x,S=-h.y-h.x*g;this.addHalfVertex(o,h.x+h.y*f,h.y-h.x*f,b,!1,f,x),this.addHalfVertex(o,A,S,b,!0,-g,x),this.distance>gT/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(o,h,f,g,x,b))}addHalfVertex({x:o,y:h},f,g,x,b,A,S){const M=.5*(this.lineClips?this.scaledDistance*(gT-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o<<1)+(x?1:0),(h<<1)+(b?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(A===0?0:A<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const B=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,B),S.primitiveLength++),b?this.e2=B:this.e1=B}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,h){this.distance+=o.dist(h),this.updateScaledDistance()}}let _T,yT;ct("LineBucket",X0,{omit:["layers","patternFeatures"]});var vT={get paint(){return yT=yT||new v({"line-opacity":new Tt(Pe.paint_line["line-opacity"]),"line-color":new Tt(Pe.paint_line["line-color"]),"line-translate":new ft(Pe.paint_line["line-translate"]),"line-translate-anchor":new ft(Pe.paint_line["line-translate-anchor"]),"line-width":new Tt(Pe.paint_line["line-width"]),"line-gap-width":new Tt(Pe.paint_line["line-gap-width"]),"line-offset":new Tt(Pe.paint_line["line-offset"]),"line-blur":new Tt(Pe.paint_line["line-blur"]),"line-dasharray":new Nu(Pe.paint_line["line-dasharray"]),"line-pattern":new Fu(Pe.paint_line["line-pattern"]),"line-gradient":new Qd(Pe.paint_line["line-gradient"])})},get layout(){return _T=_T||new v({"line-cap":new ft(Pe.layout_line["line-cap"]),"line-join":new Tt(Pe.layout_line["line-join"]),"line-miter-limit":new ft(Pe.layout_line["line-miter-limit"]),"line-round-limit":new ft(Pe.layout_line["line-round-limit"]),"line-sort-key":new Tt(Pe.layout_line["line-sort-key"])})}};class IO extends Tt{possiblyEvaluate(o,h){return h=new Ai(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(o,h)}evaluate(o,h,f,g){return h=Fe({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(o,h,f,g)}}let Wm;class RO extends d{constructor(o){super(o,vT),this.gradientVersion=0,Wm||(Wm=new IO(vT.paint.properties["line-width"].specification),Wm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof ht,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,h){super.recalculate(o,h),this.paint._values["line-floorwidth"]=Wm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new X0(o)}queryRadius(o){const h=o,f=xT(nf("line-width",this,h),nf("line-gap-width",this,h)),g=nf("line-offset",this,h);return f/2+Math.abs(g)+zm(this.paint.get("line-translate"))}queryIntersectsFeature(o,h,f,g,x,b,A){const S=Vm(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,A),M=A/2*xT(this.paint.get("line-width").evaluate(h,f),this.paint.get("line-gap-width").evaluate(h,f)),B=this.paint.get("line-offset").evaluate(h,f);return B&&(g=function(O,U){const j=[];for(let G=0;G<O.length;G++){const Z=O[G],se=[];for(let le=0;le<Z.length;le++){const Ee=Z[le-1],_e=Z[le],be=Z[le+1],Oe=le===0?new I(0,0):_e.sub(Ee)._unit()._perp(),He=le===Z.length-1?new I(0,0):be.sub(_e)._unit()._perp(),ot=Oe._add(He)._unit(),wt=ot.x*He.x+ot.y*He.y;wt!==0&&ot._mult(1/wt),se.push(ot._mult(U)._add(_e))}j.push(se)}return j}(g,B*A)),function(O,U,j){for(let G=0;G<U.length;G++){const Z=U[G];if(O.length>=3){for(let se=0;se<Z.length;se++)if($u(O,Z[se]))return!0}if(LD(O,Z,j))return!0}return!1}(S,g,M)}isTileClipped(){return!0}}function xT(c,o){return o>0?o+2*c:c}const PO=T([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),MO=T([{name:"a_projected_pos",components:3,type:"Float32"}],4);T([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const BO=T([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);T([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const bT=T([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),DO=T([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function OO(c,o,h){return c.sections.forEach(f=>{f.text=function(g,x,b){const A=x.layout.get("text-transform").evaluate(b,{});return A==="uppercase"?g=g.toLocaleUpperCase():A==="lowercase"&&(g=g.toLocaleLowerCase()),Or.applyArabicShaping&&(g=Or.applyArabicShaping(g)),g}(f.text,o,h)}),c}T([{name:"triangle",components:3,type:"Uint16"}]),T([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),T([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),T([{type:"Float32",name:"offsetX"}]),T([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),T([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const hf={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var fn=24,wT=ui,AT=function(c,o,h,f,g){var x,b,A=8*g-f-1,S=(1<<A)-1,M=S>>1,B=-7,O=g-1,U=-1,j=c[o+O];for(O+=U,x=j&(1<<-B)-1,j>>=-B,B+=A;B>0;x=256*x+c[o+O],O+=U,B-=8);for(b=x&(1<<-B)-1,x>>=-B,B+=f;B>0;b=256*b+c[o+O],O+=U,B-=8);if(x===0)x=1-M;else{if(x===S)return b?NaN:1/0*(j?-1:1);b+=Math.pow(2,f),x-=M}return(j?-1:1)*b*Math.pow(2,x-f)},TT=function(c,o,h,f,g,x){var b,A,S,M=8*x-g-1,B=(1<<M)-1,O=B>>1,U=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,j=0,G=1,Z=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(A=isNaN(o)?1:0,b=B):(b=Math.floor(Math.log(o)/Math.LN2),o*(S=Math.pow(2,-b))<1&&(b--,S*=2),(o+=b+O>=1?U/S:U*Math.pow(2,1-O))*S>=2&&(b++,S/=2),b+O>=B?(A=0,b=B):b+O>=1?(A=(o*S-1)*Math.pow(2,g),b+=O):(A=o*Math.pow(2,O-1)*Math.pow(2,g),b=0));g>=8;c[h+j]=255&A,j+=G,A/=256,g-=8);for(b=b<<g|A,M+=g;M>0;c[h+j]=255&b,j+=G,b/=256,M-=8);c[h+j-G]|=128*Z};function ui(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}ui.Varint=0,ui.Fixed64=1,ui.Bytes=2,ui.Fixed32=5;var q0=4294967296,ET=1/q0,ST=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function ya(c){return c.type===ui.Bytes?c.readVarint()+c.pos:c.pos+1}function qu(c,o,h){return h?4294967296*o+(c>>>0):4294967296*(o>>>0)+(c>>>0)}function CT(c,o,h){var f=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));h.realloc(f);for(var g=h.pos-1;g>=c;g--)h.buf[g+f]=h.buf[g]}function kO(c,o){for(var h=0;h<c.length;h++)o.writeVarint(c[h])}function FO(c,o){for(var h=0;h<c.length;h++)o.writeSVarint(c[h])}function NO(c,o){for(var h=0;h<c.length;h++)o.writeFloat(c[h])}function LO(c,o){for(var h=0;h<c.length;h++)o.writeDouble(c[h])}function UO(c,o){for(var h=0;h<c.length;h++)o.writeBoolean(c[h])}function zO(c,o){for(var h=0;h<c.length;h++)o.writeFixed32(c[h])}function VO(c,o){for(var h=0;h<c.length;h++)o.writeSFixed32(c[h])}function jO(c,o){for(var h=0;h<c.length;h++)o.writeFixed64(c[h])}function HO(c,o){for(var h=0;h<c.length;h++)o.writeSFixed64(c[h])}function Xm(c,o){return(c[o]|c[o+1]<<8|c[o+2]<<16)+16777216*c[o+3]}function Ku(c,o,h){c[h]=o,c[h+1]=o>>>8,c[h+2]=o>>>16,c[h+3]=o>>>24}function IT(c,o){return(c[o]|c[o+1]<<8|c[o+2]<<16)+(c[o+3]<<24)}ui.prototype={destroy:function(){this.buf=null},readFields:function(c,o,h){for(h=h||this.length;this.pos<h;){var f=this.readVarint(),g=f>>3,x=this.pos;this.type=7&f,c(g,o,this),this.pos===x&&this.skip(f)}return o},readMessage:function(c,o){return this.readFields(c,o,this.readVarint()+this.pos)},readFixed32:function(){var c=Xm(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=IT(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=Xm(this.buf,this.pos)+Xm(this.buf,this.pos+4)*q0;return this.pos+=8,c},readSFixed64:function(){var c=Xm(this.buf,this.pos)+IT(this.buf,this.pos+4)*q0;return this.pos+=8,c},readFloat:function(){var c=AT(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=AT(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var o,h,f=this.buf;return o=127&(h=f[this.pos++]),h<128?o:(o|=(127&(h=f[this.pos++]))<<7,h<128?o:(o|=(127&(h=f[this.pos++]))<<14,h<128?o:(o|=(127&(h=f[this.pos++]))<<21,h<128?o:function(g,x,b){var A,S,M=b.buf;if(A=(112&(S=M[b.pos++]))>>4,S<128||(A|=(127&(S=M[b.pos++]))<<3,S<128)||(A|=(127&(S=M[b.pos++]))<<10,S<128)||(A|=(127&(S=M[b.pos++]))<<17,S<128)||(A|=(127&(S=M[b.pos++]))<<24,S<128)||(A|=(1&(S=M[b.pos++]))<<31,S<128))return qu(g,A,x);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(h=f[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,o=this.pos;return this.pos=c,c-o>=12&&ST?function(h,f,g){return ST.decode(h.subarray(f,g))}(this.buf,o,c):function(h,f,g){for(var x="",b=f;b<g;){var A,S,M,B=h[b],O=null,U=B>239?4:B>223?3:B>191?2:1;if(b+U>g)break;U===1?B<128&&(O=B):U===2?(192&(A=h[b+1]))==128&&(O=(31&B)<<6|63&A)<=127&&(O=null):U===3?(S=h[b+2],(192&(A=h[b+1]))==128&&(192&S)==128&&((O=(15&B)<<12|(63&A)<<6|63&S)<=2047||O>=55296&&O<=57343)&&(O=null)):U===4&&(S=h[b+2],M=h[b+3],(192&(A=h[b+1]))==128&&(192&S)==128&&(192&M)==128&&((O=(15&B)<<18|(63&A)<<12|(63&S)<<6|63&M)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,U=1):O>65535&&(O-=65536,x+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),x+=String.fromCharCode(O),b+=U}return x}(this.buf,o,c)},readBytes:function(){var c=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,c);return this.pos=c,o},readPackedVarint:function(c,o){if(this.type!==ui.Bytes)return c.push(this.readVarint(o));var h=ya(this);for(c=c||[];this.pos<h;)c.push(this.readVarint(o));return c},readPackedSVarint:function(c){if(this.type!==ui.Bytes)return c.push(this.readSVarint());var o=ya(this);for(c=c||[];this.pos<o;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==ui.Bytes)return c.push(this.readBoolean());var o=ya(this);for(c=c||[];this.pos<o;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==ui.Bytes)return c.push(this.readFloat());var o=ya(this);for(c=c||[];this.pos<o;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==ui.Bytes)return c.push(this.readDouble());var o=ya(this);for(c=c||[];this.pos<o;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==ui.Bytes)return c.push(this.readFixed32());var o=ya(this);for(c=c||[];this.pos<o;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==ui.Bytes)return c.push(this.readSFixed32());var o=ya(this);for(c=c||[];this.pos<o;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==ui.Bytes)return c.push(this.readFixed64());var o=ya(this);for(c=c||[];this.pos<o;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==ui.Bytes)return c.push(this.readSFixed64());var o=ya(this);for(c=c||[];this.pos<o;)c.push(this.readSFixed64());return c},skip:function(c){var o=7&c;if(o===ui.Varint)for(;this.buf[this.pos++]>127;);else if(o===ui.Bytes)this.pos=this.readVarint()+this.pos;else if(o===ui.Fixed32)this.pos+=4;else{if(o!==ui.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(c,o){this.writeVarint(c<<3|o)},realloc:function(c){for(var o=this.length||16;o<this.pos+c;)o*=2;if(o!==this.length){var h=new Uint8Array(o);h.set(this.buf),this.buf=h,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),Ku(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),Ku(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),Ku(this.buf,-1&c,this.pos),Ku(this.buf,Math.floor(c*ET),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),Ku(this.buf,-1&c,this.pos),Ku(this.buf,Math.floor(c*ET),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(o,h){var f,g;if(o>=0?(f=o%4294967296|0,g=o/4294967296|0):(g=~(-o/4294967296),4294967295^(f=~(-o%4294967296))?f=f+1|0:(f=0,g=g+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(x,b,A){A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,x>>>=7,A.buf[A.pos++]=127&x|128,A.buf[A.pos]=127&(x>>>=7)}(f,0,h),function(x,b){var A=(7&x)<<4;b.buf[b.pos++]|=A|((x>>>=3)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x)))))}(g,h)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var o=this.pos;this.pos=function(f,g,x){for(var b,A,S=0;S<g.length;S++){if((b=g.charCodeAt(S))>55295&&b<57344){if(!A){b>56319||S+1===g.length?(f[x++]=239,f[x++]=191,f[x++]=189):A=b;continue}if(b<56320){f[x++]=239,f[x++]=191,f[x++]=189,A=b;continue}b=A-55296<<10|b-56320|65536,A=null}else A&&(f[x++]=239,f[x++]=191,f[x++]=189,A=null);b<128?f[x++]=b:(b<2048?f[x++]=b>>6|192:(b<65536?f[x++]=b>>12|224:(f[x++]=b>>18|240,f[x++]=b>>12&63|128),f[x++]=b>>6&63|128),f[x++]=63&b|128)}return x}(this.buf,c,this.pos);var h=this.pos-o;h>=128&&CT(o,h,this),this.pos=o-1,this.writeVarint(h),this.pos+=h},writeFloat:function(c){this.realloc(4),TT(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),TT(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var o=c.length;this.writeVarint(o),this.realloc(o);for(var h=0;h<o;h++)this.buf[this.pos++]=c[h]},writeRawMessage:function(c,o){this.pos++;var h=this.pos;c(o,this);var f=this.pos-h;f>=128&&CT(h,f,this),this.pos=h-1,this.writeVarint(f),this.pos+=f},writeMessage:function(c,o,h){this.writeTag(c,ui.Bytes),this.writeRawMessage(o,h)},writePackedVarint:function(c,o){o.length&&this.writeMessage(c,kO,o)},writePackedSVarint:function(c,o){o.length&&this.writeMessage(c,FO,o)},writePackedBoolean:function(c,o){o.length&&this.writeMessage(c,UO,o)},writePackedFloat:function(c,o){o.length&&this.writeMessage(c,NO,o)},writePackedDouble:function(c,o){o.length&&this.writeMessage(c,LO,o)},writePackedFixed32:function(c,o){o.length&&this.writeMessage(c,zO,o)},writePackedSFixed32:function(c,o){o.length&&this.writeMessage(c,VO,o)},writePackedFixed64:function(c,o){o.length&&this.writeMessage(c,jO,o)},writePackedSFixed64:function(c,o){o.length&&this.writeMessage(c,HO,o)},writeBytesField:function(c,o){this.writeTag(c,ui.Bytes),this.writeBytes(o)},writeFixed32Field:function(c,o){this.writeTag(c,ui.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(c,o){this.writeTag(c,ui.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(c,o){this.writeTag(c,ui.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(c,o){this.writeTag(c,ui.Fixed64),this.writeSFixed64(o)},writeVarintField:function(c,o){this.writeTag(c,ui.Varint),this.writeVarint(o)},writeSVarintField:function(c,o){this.writeTag(c,ui.Varint),this.writeSVarint(o)},writeStringField:function(c,o){this.writeTag(c,ui.Bytes),this.writeString(o)},writeFloatField:function(c,o){this.writeTag(c,ui.Fixed32),this.writeFloat(o)},writeDoubleField:function(c,o){this.writeTag(c,ui.Fixed64),this.writeDouble(o)},writeBooleanField:function(c,o){this.writeVarintField(c,!!o)}};var K0=_(wT);const Z0=3;function $O(c,o,h){c===1&&h.readMessage(GO,o)}function GO(c,o,h){if(c===3){const{id:f,bitmap:g,width:x,height:b,left:A,top:S,advance:M}=h.readMessage(WO,{});o.push({id:f,bitmap:new sf({width:x+2*Z0,height:b+2*Z0},g),metrics:{width:x,height:b,left:A,top:S,advance:M}})}}function WO(c,o,h){c===1?o.id=h.readVarint():c===2?o.bitmap=h.readBytes():c===3?o.width=h.readVarint():c===4?o.height=h.readVarint():c===5?o.left=h.readSVarint():c===6?o.top=h.readSVarint():c===7&&(o.advance=h.readVarint())}const RT=Z0;function PT(c){let o=0,h=0;for(const b of c)o+=b.w*b.h,h=Math.max(h,b.w);c.sort((b,A)=>A.h-b.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),h),h:1/0}];let g=0,x=0;for(const b of c)for(let A=f.length-1;A>=0;A--){const S=f[A];if(!(b.w>S.w||b.h>S.h)){if(b.x=S.x,b.y=S.y,x=Math.max(x,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===S.w&&b.h===S.h){const M=f.pop();A<f.length&&(f[A]=M)}else b.h===S.h?(S.x+=b.w,S.w-=b.w):b.w===S.w?(S.y+=b.h,S.h-=b.h):(f.push({x:S.x+b.w,y:S.y,w:S.w-b.w,h:b.h}),S.y+=b.h,S.h-=b.h);break}}return{w:g,h:x,fill:o/(g*x)||0}}const Fr=1;class Y0{constructor(o,{pixelRatio:h,version:f,stretchX:g,stretchY:x,content:b,textFitWidth:A,textFitHeight:S}){this.paddedRect=o,this.pixelRatio=h,this.stretchX=g,this.stretchY=x,this.content=b,this.version=f,this.textFitWidth=A,this.textFitHeight=S}get tl(){return[this.paddedRect.x+Fr,this.paddedRect.y+Fr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Fr,this.paddedRect.y+this.paddedRect.h-Fr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Fr)/this.pixelRatio,(this.paddedRect.h-2*Fr)/this.pixelRatio]}}class MT{constructor(o,h){const f={},g={};this.haveRenderCallbacks=[];const x=[];this.addImages(o,f,x),this.addImages(h,g,x);const{w:b,h:A}=PT(x),S=new ms({width:b||1,height:A||1});for(const M in o){const B=o[M],O=f[M].paddedRect;ms.copy(B.data,S,{x:0,y:0},{x:O.x+Fr,y:O.y+Fr},B.data)}for(const M in h){const B=h[M],O=g[M].paddedRect,U=O.x+Fr,j=O.y+Fr,G=B.data.width,Z=B.data.height;ms.copy(B.data,S,{x:0,y:0},{x:U,y:j},B.data),ms.copy(B.data,S,{x:0,y:Z-1},{x:U,y:j-1},{width:G,height:1}),ms.copy(B.data,S,{x:0,y:0},{x:U,y:j+Z},{width:G,height:1}),ms.copy(B.data,S,{x:G-1,y:0},{x:U-1,y:j},{width:1,height:Z}),ms.copy(B.data,S,{x:0,y:0},{x:U+G,y:j},{width:1,height:Z})}this.image=S,this.iconPositions=f,this.patternPositions=g}addImages(o,h,f){for(const g in o){const x=o[g],b={x:0,y:0,w:x.data.width+2*Fr,h:x.data.height+2*Fr};f.push(b),h[g]=new Y0(b,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(o,h){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in o.updatedImages)this.patchUpdatedImage(this.iconPositions[f],o.getImage(f),h),this.patchUpdatedImage(this.patternPositions[f],o.getImage(f),h)}patchUpdatedImage(o,h,f){if(!o||!h||o.version===h.version)return;o.version=h.version;const[g,x]=o.tl;f.update(h.data,void 0,{x:g,y:x})}}var fl;ct("ImagePosition",Y0),ct("ImageAtlas",MT),u.ah=void 0,(fl=u.ah||(u.ah={}))[fl.none=0]="none",fl[fl.horizontal=1]="horizontal",fl[fl.vertical=2]="vertical",fl[fl.horizontalOnly=3]="horizontalOnly";const df=-17;class ff{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,h){const f=new ff;return f.scale=o||1,f.fontStack=h,f}static forImage(o){const h=new ff;return h.imageName=o,h}}class Zu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,h){const f=new Zu;for(let g=0;g<o.sections.length;g++){const x=o.sections[g];x.image?f.addImageSection(x):f.addTextSection(x,h)}return f}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=function(o){let h="";for(let f=0;f<o.length;f++){const g=o.charCodeAt(f+1)||null,x=o.charCodeAt(f-1)||null;h+=g&&Dm(g)&&!hf[o[f+1]]||x&&Dm(x)&&!hf[o[f-1]]||!hf[o[f]]?o[f]:hf[o[f]]}return h}(this.text)}trim(){let o=0;for(let f=0;f<this.text.length&&Km[this.text.charCodeAt(f)];f++)o++;let h=this.text.length;for(let f=this.text.length-1;f>=0&&f>=o&&Km[this.text.charCodeAt(f)];f--)h--;this.text=this.text.substring(o,h),this.sectionIndex=this.sectionIndex.slice(o,h)}substring(o,h){const f=new Zu;return f.text=this.text.substring(o,h),f.sectionIndex=this.sectionIndex.slice(o,h),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,h)=>Math.max(o,this.sections[h].scale),0)}addTextSection(o,h){this.text+=o.text,this.sections.push(ff.forText(o.scale,o.fontStack||h));const f=this.sections.length-1;for(let g=0;g<o.text.length;++g)this.sectionIndex.push(f)}addImageSection(o){const h=o.image?o.image.name:"";if(h.length===0)return void Pt("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(ff.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Pt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function qm(c,o,h,f,g,x,b,A,S,M,B,O,U,j,G){const Z=Zu.fromFeature(c,g);let se;O===u.ah.vertical&&Z.verticalizePunctuation();const{processBidirectionalText:le,processStyledBidirectionalText:Ee}=Or;if(le&&Z.sections.length===1){se=[];const Oe=le(Z.toString(),J0(Z,M,x,o,f,j));for(const He of Oe){const ot=new Zu;ot.text=He,ot.sections=Z.sections;for(let wt=0;wt<He.length;wt++)ot.sectionIndex.push(0);se.push(ot)}}else if(Ee){se=[];const Oe=Ee(Z.text,Z.sectionIndex,J0(Z,M,x,o,f,j));for(const He of Oe){const ot=new Zu;ot.text=He[0],ot.sectionIndex=He[1],ot.sections=Z.sections,se.push(ot)}}else se=function(Oe,He){const ot=[],wt=Oe.text;let rt=0;for(const it of He)ot.push(Oe.substring(rt,it)),rt=it;return rt<wt.length&&ot.push(Oe.substring(rt,wt.length)),ot}(Z,J0(Z,M,x,o,f,j));const _e=[],be={positionedLines:_e,text:Z.toString(),top:B[1],bottom:B[1],left:B[0],right:B[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(Oe,He,ot,wt,rt,it,gt,dt,lt,Ne,yt,mt){let Rt=0,gi=df,hi=0,vn=0;const js=dt==="right"?1:dt==="left"?0:.5;let $n=0;for(const qi of rt){qi.trim();const bn=qi.getMaxScale(),rr=(bn-1)*fn,Gn={positionedGlyphs:[],lineOffset:0};Oe.positionedLines[$n]=Gn;const xr=Gn.positionedGlyphs;let Wn=0;if(!qi.length()){gi+=it,++$n;continue}for(let Nr=0;Nr<qi.length();Nr++){const ei=qi.getSection(Nr),xi=qi.getSectionIndex(Nr),Ci=qi.getCharCode(Nr);let Jr=0,Vi=null,eh=null,No=null,Lo=fn;const Hs=!(lt===u.ah.horizontal||!yt&&!Yd(Ci)||yt&&(Km[Ci]||(xn=Ci,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(xn)))));if(ei.imageName){const ys=wt[ei.imageName];if(!ys)continue;No=ei.imageName,Oe.iconsInText=Oe.iconsInText||!0,eh=ys.paddedRect;const Pn=ys.displaySize;ei.scale=ei.scale*fn/mt,Vi={width:Pn[0],height:Pn[1],left:Fr,top:-RT,advance:Hs?Pn[1]:Pn[0]},Jr=rr+(fn-Pn[1]*ei.scale),Lo=Vi.advance;const va=Hs?Pn[0]*ei.scale-fn*bn:Pn[1]*ei.scale-fn*bn;va>0&&va>Wn&&(Wn=va)}else{const ys=ot[ei.fontStack],Pn=ys&&ys[Ci];if(Pn&&Pn.rect)eh=Pn.rect,Vi=Pn.metrics;else{const va=He[ei.fontStack],vf=va&&va[Ci];if(!vf)continue;Vi=vf.metrics}Jr=(bn-ei.scale)*fn}Hs?(Oe.verticalizable=!0,xr.push({glyph:Ci,imageName:No,x:Rt,y:gi+Jr,vertical:Hs,scale:ei.scale,fontStack:ei.fontStack,sectionIndex:xi,metrics:Vi,rect:eh}),Rt+=Lo*ei.scale+Ne):(xr.push({glyph:Ci,imageName:No,x:Rt,y:gi+Jr,vertical:Hs,scale:ei.scale,fontStack:ei.fontStack,sectionIndex:xi,metrics:Vi,rect:eh}),Rt+=Vi.advance*ei.scale+Ne)}xr.length!==0&&(hi=Math.max(Rt-Ne,hi),ZO(xr,0,xr.length-1,js,Wn)),Rt=0;const _s=it*bn+Wn;Gn.lineOffset=Math.max(Wn,rr),gi+=_s,vn=Math.max(_s,vn),++$n}var xn;const _r=gi-df,{horizontalAlign:yr,verticalAlign:vr}=Q0(gt);(function(qi,bn,rr,Gn,xr,Wn,_s,Nr,ei){const xi=(bn-rr)*xr;let Ci=0;Ci=Wn!==_s?-Nr*Gn-df:(-Gn*ei+.5)*_s;for(const Jr of qi)for(const Vi of Jr.positionedGlyphs)Vi.x+=xi,Vi.y+=Ci})(Oe.positionedLines,js,yr,vr,hi,vn,it,_r,rt.length),Oe.top+=-vr*_r,Oe.bottom=Oe.top+_r,Oe.left+=-yr*hi,Oe.right=Oe.left+hi}(be,o,h,f,se,b,A,S,O,M,U,G),!function(Oe){for(const He of Oe)if(He.positionedGlyphs.length!==0)return!1;return!0}(_e)&&be}const Km={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},XO={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},qO={40:!0};function BT(c,o,h,f,g,x){if(o.imageName){const b=f[o.imageName];return b?b.displaySize[0]*o.scale*fn/x+g:0}{const b=h[o.fontStack],A=b&&b[c];return A?A.metrics.advance*o.scale+g:0}}function DT(c,o,h,f){const g=Math.pow(c-o,2);return f?c<o?g/2:2*g:g+Math.abs(h)*h}function KO(c,o,h){let f=0;return c===10&&(f-=1e4),h&&(f+=150),c!==40&&c!==65288||(f+=50),o!==41&&o!==65289||(f+=50),f}function OT(c,o,h,f,g,x){let b=null,A=DT(o,h,g,x);for(const S of f){const M=DT(o-S.x,h,g,x)+S.badness;M<=A&&(b=S,A=M)}return{index:c,x:o,priorBreak:b,badness:A}}function kT(c){return c?kT(c.priorBreak).concat(c.index):[]}function J0(c,o,h,f,g,x){if(!c)return[];const b=[],A=function(O,U,j,G,Z,se){let le=0;for(let Ee=0;Ee<O.length();Ee++){const _e=O.getSection(Ee);le+=BT(O.getCharCode(Ee),_e,G,Z,U,se)}return le/Math.max(1,Math.ceil(le/j))}(c,o,h,f,g,x),S=c.text.indexOf("​")>=0;let M=0;for(let O=0;O<c.length();O++){const U=c.getSection(O),j=c.getCharCode(O);if(Km[j]||(M+=BT(j,U,f,g,o,x)),O<c.length()-1){const G=!((B=j)<11904)&&(!!$t["CJK Compatibility Forms"](B)||!!$t["CJK Compatibility"](B)||!!$t["CJK Strokes"](B)||!!$t["CJK Symbols and Punctuation"](B)||!!$t["Enclosed CJK Letters and Months"](B)||!!$t["Halfwidth and Fullwidth Forms"](B)||!!$t["Ideographic Description Characters"](B)||!!$t["Vertical Forms"](B)||Bm.test(String.fromCodePoint(B)));(XO[j]||G||U.imageName||O!==c.length()-2&&qO[c.getCharCode(O+1)])&&b.push(OT(O+1,M,A,b,KO(j,c.getCharCode(O+1),G&&S),!1))}}var B;return kT(OT(c.length(),M,A,b,0,!0))}function Q0(c){let o=.5,h=.5;switch(c){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:o,verticalAlign:h}}function ZO(c,o,h,f,g){if(!f&&!g)return;const x=c[h],b=(c[h].x+x.metrics.advance*x.scale)*f;for(let A=o;A<=h;A++)c[A].x-=b,c[A].y+=g}function YO(c,o,h){const{horizontalAlign:f,verticalAlign:g}=Q0(h),x=o[0]-c.displaySize[0]*f,b=o[1]-c.displaySize[1]*g;return{image:c,top:b,bottom:b+c.displaySize[1],left:x,right:x+c.displaySize[0]}}function FT(c){var o,h;let f=c.left,g=c.top,x=c.right-f,b=c.bottom-g;const A=(o=c.image.textFitWidth)!==null&&o!==void 0?o:"stretchOrShrink",S=(h=c.image.textFitHeight)!==null&&h!==void 0?h:"stretchOrShrink",M=(c.image.content[2]-c.image.content[0])/(c.image.content[3]-c.image.content[1]);if(S==="proportional"){if(A==="stretchOnly"&&x/b<M||A==="proportional"){const B=Math.ceil(b*M);f*=B/x,x=B}}else if(A==="proportional"&&S==="stretchOnly"&&M!==0&&x/b>M){const B=Math.ceil(x/M);g*=B/b,b=B}return{x1:f,y1:g,x2:f+x,y2:g+b}}function NT(c,o,h,f,g,x){const b=c.image;let A;if(b.content){const se=b.content,le=b.pixelRatio||1;A=[se[0]/le,se[1]/le,b.displaySize[0]-se[2]/le,b.displaySize[1]-se[3]/le]}const S=o.left*x,M=o.right*x;let B,O,U,j;h==="width"||h==="both"?(j=g[0]+S-f[3],O=g[0]+M+f[1]):(j=g[0]+(S+M-b.displaySize[0])/2,O=j+b.displaySize[0]);const G=o.top*x,Z=o.bottom*x;return h==="height"||h==="both"?(B=g[1]+G-f[0],U=g[1]+Z+f[2]):(B=g[1]+(G+Z-b.displaySize[1])/2,U=B+b.displaySize[1]),{image:b,top:B,right:O,bottom:U,left:j,collisionPadding:A}}const pf=255,Fo=128,pl=pf*Fo;function LT(c,o){const{expression:h}=o;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Ai(c+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=h;let x=0;for(;x<f.length&&f[x]<=c;)x++;x=Math.max(0,x-1);let b=x;for(;b<f.length&&f[b]<c+1;)b++;b=Math.min(f.length-1,b);const A=f[x],S=f[b];return h.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:S,interpolationType:g}:{kind:"camera",minZoom:A,maxZoom:S,minSize:h.evaluate(new Ai(A)),maxSize:h.evaluate(new Ai(S)),interpolationType:g}}}function ev(c,o,h){let f="never";const g=c.get(o);return g?f=g:c.get(h)&&(f="always"),f}const JO=dl.VectorTileFeature.types,QO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Zm(c,o,h,f,g,x,b,A,S,M,B,O,U){const j=A?Math.min(pl,Math.round(A[0])):0,G=A?Math.min(pl,Math.round(A[1])):0;c.emplaceBack(o,h,Math.round(32*f),Math.round(32*g),x,b,(j<<1)+(S?1:0),G,16*M,16*B,256*O,256*U)}function tv(c,o,h){c.emplaceBack(o.x,o.y,h),c.emplaceBack(o.x,o.y,h),c.emplaceBack(o.x,o.y,h),c.emplaceBack(o.x,o.y,h)}function ek(c){for(const o of c.sections)if(R0(o.text))return!0;return!1}class iv{constructor(o){this.layoutVertexArray=new Uu,this.indexArray=new ps,this.programConfigurations=o,this.segments=new Gt,this.dynamicLayoutVertexArray=new ef,this.opacityVertexArray=new Zr,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ti}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,h,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,PO.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,MO.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,QO,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ct("SymbolBuffers",iv);class nv{constructor(o,h,f){this.layoutVertexArray=new o,this.layoutAttributes=h,this.indexArray=new f,this.segments=new Gt,this.collisionVertexArray=new Oo}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,BO.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ct("CollisionBuffers",nv);class Yu{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(b=>b.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=F0([]),this.placementViewportMatrix=F0([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=LT(this.zoom,h["text-size"]),this.iconSizeData=LT(this.zoom,h["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),x=f.get("symbol-z-order");this.canOverlap=ev(f,"text-overlap","text-allow-overlap")!=="never"||ev(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(b=>u.ah[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=o.sourceID}createArrays(){this.text=new iv(new Ac(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new iv(new Ac(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new Ei,this.lineVertexArray=new zn,this.symbolInstances=new jt,this.textAnchorOffsets=new Si}calculateGlyphDependencies(o,h,f,g,x){for(let b=0;b<o.length;b++)if(h[o.charCodeAt(b)]=!0,(f||g)&&x){const A=hf[o.charAt(b)];A&&(h[A.charCodeAt(0)]=!0)}}populate(o,h,f){const g=this.layers[0],x=g.layout,b=x.get("text-font"),A=x.get("text-field"),S=x.get("icon-image"),M=(A.value.kind!=="constant"||A.value.value instanceof Gi&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),B=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,O=x.get("symbol-sort-key");if(this.features=[],!M&&!B)return;const U=h.iconDependencies,j=h.glyphDependencies,G=h.availableImages,Z=new Ai(this.zoom);for(const{feature:se,id:le,index:Ee,sourceLayerIndex:_e}of o){const be=g._featureFilter.needGeometry,Oe=Ec(se,be);if(!g._featureFilter.filter(Z,Oe,f))continue;let He,ot;if(be||(Oe.geometry=Tc(se)),M){const rt=g.getValueAndResolveTokens("text-field",Oe,f,G),it=Gi.factory(rt),gt=this.hasRTLText=this.hasRTLText||ek(it);(!gt||Or.getRTLTextPluginStatus()==="unavailable"||gt&&Or.isParsed())&&(He=OO(it,g,Oe))}if(B){const rt=g.getValueAndResolveTokens("icon-image",Oe,f,G);ot=rt instanceof zi?rt:zi.fromString(rt)}if(!He&&!ot)continue;const wt=this.sortFeaturesByKey?O.evaluate(Oe,{},f):void 0;if(this.features.push({id:le,text:He,icon:ot,index:Ee,sourceLayerIndex:_e,geometry:Oe.geometry,properties:se.properties,type:JO[se.type],sortKey:wt}),ot&&(U[ot.name]=!0),He){const rt=b.evaluate(Oe,{},f).join(","),it=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const gt of He.sections)if(gt.image)U[gt.image.name]=!0;else{const dt=Kd(He.toString()),lt=gt.fontStack||rt,Ne=j[lt]=j[lt]||{};this.calculateGlyphDependencies(gt.text,Ne,it,this.allowVerticalPlacement,dt)}}}x.get("symbol-placement")==="line"&&(this.features=function(se){const le={},Ee={},_e=[];let be=0;function Oe(rt){_e.push(se[rt]),be++}function He(rt,it,gt){const dt=Ee[rt];return delete Ee[rt],Ee[it]=dt,_e[dt].geometry[0].pop(),_e[dt].geometry[0]=_e[dt].geometry[0].concat(gt[0]),dt}function ot(rt,it,gt){const dt=le[it];return delete le[it],le[rt]=dt,_e[dt].geometry[0].shift(),_e[dt].geometry[0]=gt[0].concat(_e[dt].geometry[0]),dt}function wt(rt,it,gt){const dt=gt?it[0][it[0].length-1]:it[0][0];return`${rt}:${dt.x}:${dt.y}`}for(let rt=0;rt<se.length;rt++){const it=se[rt],gt=it.geometry,dt=it.text?it.text.toString():null;if(!dt){Oe(rt);continue}const lt=wt(dt,gt),Ne=wt(dt,gt,!0);if(lt in Ee&&Ne in le&&Ee[lt]!==le[Ne]){const yt=ot(lt,Ne,gt),mt=He(lt,Ne,_e[yt].geometry);delete le[lt],delete Ee[Ne],Ee[wt(dt,_e[mt].geometry,!0)]=mt,_e[yt].geometry=null}else lt in Ee?He(lt,Ne,gt):Ne in le?ot(lt,Ne,gt):(Oe(rt),le[lt]=be-1,Ee[Ne]=be-1)}return _e.filter(rt=>rt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,le)=>se.sortKey-le.sortKey)}update(o,h,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,h,this.layers,f),this.icon.programConfigurations.updatePaintArrays(o,h,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,h){const f=this.lineVertexArray.length;if(o.segment!==void 0){let g=o.dist(h[o.segment+1]),x=o.dist(h[o.segment]);const b={};for(let A=o.segment+1;A<h.length;A++)b[A]={x:h[A].x,y:h[A].y,tileUnitDistanceFromAnchor:g},A<h.length-1&&(g+=h[A+1].dist(h[A]));for(let A=o.segment||0;A>=0;A--)b[A]={x:h[A].x,y:h[A].y,tileUnitDistanceFromAnchor:x},A>0&&(x+=h[A-1].dist(h[A]));for(let A=0;A<h.length;A++){const S=b[A];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(o,h,f,g,x,b,A,S,M,B,O,U){const j=o.indexArray,G=o.layoutVertexArray,Z=o.segments.prepareSegment(4*h.length,G,j,this.canOverlap?b.sortKey:void 0),se=this.glyphOffsetArray.length,le=Z.vertexLength,Ee=this.allowVerticalPlacement&&A===u.ah.vertical?Math.PI/2:0,_e=b.text&&b.text.sections;for(let be=0;be<h.length;be++){const{tl:Oe,tr:He,bl:ot,br:wt,tex:rt,pixelOffsetTL:it,pixelOffsetBR:gt,minFontScaleX:dt,minFontScaleY:lt,glyphOffset:Ne,isSDF:yt,sectionIndex:mt}=h[be],Rt=Z.vertexLength,gi=Ne[1];Zm(G,S.x,S.y,Oe.x,gi+Oe.y,rt.x,rt.y,f,yt,it.x,it.y,dt,lt),Zm(G,S.x,S.y,He.x,gi+He.y,rt.x+rt.w,rt.y,f,yt,gt.x,it.y,dt,lt),Zm(G,S.x,S.y,ot.x,gi+ot.y,rt.x,rt.y+rt.h,f,yt,it.x,gt.y,dt,lt),Zm(G,S.x,S.y,wt.x,gi+wt.y,rt.x+rt.w,rt.y+rt.h,f,yt,gt.x,gt.y,dt,lt),tv(o.dynamicLayoutVertexArray,S,Ee),j.emplaceBack(Rt,Rt+1,Rt+2),j.emplaceBack(Rt+1,Rt+2,Rt+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ne[0]),be!==h.length-1&&mt===h[be+1].sectionIndex||o.programConfigurations.populatePaintArrays(G.length,b,b.index,{},U,_e&&_e[mt])}o.placedSymbolArray.emplaceBack(S.x,S.y,se,this.glyphOffsetArray.length-se,le,M,B,S.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],A,0,!1,0,O)}_addCollisionDebugVertex(o,h,f,g,x,b){return h.emplaceBack(0,0),o.emplaceBack(f.x,f.y,g,x,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(o,h,f,g,x,b,A){const S=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),M=S.vertexLength,B=x.layoutVertexArray,O=x.collisionVertexArray,U=A.anchorX,j=A.anchorY;this._addCollisionDebugVertex(B,O,b,U,j,new I(o,h)),this._addCollisionDebugVertex(B,O,b,U,j,new I(f,h)),this._addCollisionDebugVertex(B,O,b,U,j,new I(f,g)),this._addCollisionDebugVertex(B,O,b,U,j,new I(o,g)),S.vertexLength+=4;const G=x.indexArray;G.emplaceBack(M,M+1),G.emplaceBack(M+1,M+2),G.emplaceBack(M+2,M+3),G.emplaceBack(M+3,M),S.primitiveLength+=4}addDebugCollisionBoxes(o,h,f,g){for(let x=o;x<h;x++){const b=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,g?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new nv(Yr,bT.members,Rn),this.iconCollisionBox=new nv(Yr,bT.members,Rn);for(let o=0;o<this.symbolInstances.length;o++){const h=this.symbolInstances.get(o);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(o,h,f,g,x,b,A,S,M){const B={};for(let O=h;O<f;O++){const U=o.get(O);B.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},B.textFeatureIndex=U.featureIndex;break}for(let O=g;O<x;O++){const U=o.get(O);B.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},B.verticalTextFeatureIndex=U.featureIndex;break}for(let O=b;O<A;O++){const U=o.get(O);B.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},B.iconFeatureIndex=U.featureIndex;break}for(let O=S;O<M;O++){const U=o.get(O);B.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},B.verticalIconFeatureIndex=U.featureIndex;break}return B}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const f=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,h){const f=o.placedSymbolArray.get(h),g=f.vertexStartIndex+4*f.numGlyphs;for(let x=f.vertexStartIndex;x<g;x+=4)o.indexArray.emplaceBack(x,x+1,x+2),o.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(o),f=Math.cos(o),g=[],x=[],b=[];for(let A=0;A<this.symbolInstances.length;++A){b.push(A);const S=this.symbolInstances.get(A);g.push(0|Math.round(h*S.anchorX+f*S.anchorY)),x.push(S.featureIndex)}return b.sort((A,S)=>g[A]-g[S]||x[S]-x[A]),b}addToSortKeyRanges(o,h){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===h?f.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const f=this.symbolInstances.get(h);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,x,b)=>{g>=0&&b.indexOf(g)===x&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let UT,zT;ct("SymbolBucket",Yu,{omit:["layers","collisionBoxArray","features","compareText"]}),Yu.MAX_GLYPHS=65535,Yu.addDynamicAttributes=tv;var rv={get paint(){return zT=zT||new v({"icon-opacity":new Tt(Pe.paint_symbol["icon-opacity"]),"icon-color":new Tt(Pe.paint_symbol["icon-color"]),"icon-halo-color":new Tt(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Tt(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Tt(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new ft(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new ft(Pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Tt(Pe.paint_symbol["text-opacity"]),"text-color":new Tt(Pe.paint_symbol["text-color"],{runtimeType:kn,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Tt(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new Tt(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new Tt(Pe.paint_symbol["text-halo-blur"]),"text-translate":new ft(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new ft(Pe.paint_symbol["text-translate-anchor"])})},get layout(){return UT=UT||new v({"symbol-placement":new ft(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new ft(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ft(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Tt(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ft(Pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ft(Pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ft(Pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ft(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new ft(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ft(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Tt(Pe.layout_symbol["icon-size"]),"icon-text-fit":new ft(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ft(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Tt(Pe.layout_symbol["icon-image"]),"icon-rotate":new Tt(Pe.layout_symbol["icon-rotate"]),"icon-padding":new Tt(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new ft(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new Tt(Pe.layout_symbol["icon-offset"]),"icon-anchor":new Tt(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ft(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ft(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ft(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new Tt(Pe.layout_symbol["text-field"]),"text-font":new Tt(Pe.layout_symbol["text-font"]),"text-size":new Tt(Pe.layout_symbol["text-size"]),"text-max-width":new Tt(Pe.layout_symbol["text-max-width"]),"text-line-height":new ft(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new Tt(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new Tt(Pe.layout_symbol["text-justify"]),"text-radial-offset":new Tt(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ft(Pe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Tt(Pe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Tt(Pe.layout_symbol["text-anchor"]),"text-max-angle":new ft(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new ft(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new Tt(Pe.layout_symbol["text-rotate"]),"text-padding":new ft(Pe.layout_symbol["text-padding"]),"text-keep-upright":new ft(Pe.layout_symbol["text-keep-upright"]),"text-transform":new Tt(Pe.layout_symbol["text-transform"]),"text-offset":new Tt(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new ft(Pe.layout_symbol["text-allow-overlap"]),"text-overlap":new ft(Pe.layout_symbol["text-overlap"]),"text-ignore-placement":new ft(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new ft(Pe.layout_symbol["text-optional"])})}};class VT{constructor(o){if(o.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:Hr,this.defaultValue=o}evaluate(o){if(o.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(o.formattedSection))return h.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ct("FormatSectionOverride",VT,{omit:["defaultValue"]});class Ym extends d{constructor(o){super(o,rv)}recalculate(o,h){if(super.recalculate(o,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const x of f)g.indexOf(x)<0&&g.push(x);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,h,f,g){const x=this.layout.get(o).evaluate(h,{},f,g),b=this._unevaluatedLayout._values[o];return b.isDataDriven()||Tu(b.value)||!x?x:function(A,S){return S.replace(/{([^{}]+)}/g,(M,B)=>A&&B in A?String(A[B]):"")}(h.properties,x)}createBucket(o){return new Yu(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of rv.paint.overridableProperties){if(!Ym.hasPaintOverride(this.layout,o))continue;const h=this.paint.get(o),f=new VT(h),g=new Au(f,h.property.specification);let x=null;x=h.value.kind==="constant"||h.value.kind==="source"?new Za("source",g):new Ya("composite",g,h.value.zoomStops),this.paint._values[o]=new zs(h.property,x,h.parameters)}}_handleOverridablePaintPropertyUpdate(o,h,f){return!(!this.layout||h.isDataDriven()||f.isDataDriven())&&Ym.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,h){const f=o.get("text-field"),g=rv.paint.properties[h];let x=!1;const b=A=>{for(const S of A)if(g.overrides&&g.overrides.hasOverride(S))return void(x=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Gi)b(f.value.value.sections);else if(f.value.kind==="source"){const A=M=>{x||(M instanceof Nn&&Mi(M.value)===cs?b(M.value.sections):M instanceof pu?b(M.sections):M.eachChild(A))},S=f.value;S._styleExpression&&A(S._styleExpression.expression)}return x}}let jT;var tk={get paint(){return jT=jT||new v({"background-color":new ft(Pe.paint_background["background-color"]),"background-pattern":new Nu(Pe.paint_background["background-pattern"]),"background-opacity":new ft(Pe.paint_background["background-opacity"])})}};class ik extends d{constructor(o){super(o,tk)}}let HT;var nk={get paint(){return HT=HT||new v({"raster-opacity":new ft(Pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new ft(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ft(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ft(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new ft(Pe.paint_raster["raster-saturation"]),"raster-contrast":new ft(Pe.paint_raster["raster-contrast"]),"raster-resampling":new ft(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new ft(Pe.paint_raster["raster-fade-duration"])})}};class rk extends d{constructor(o){super(o,nk)}}class sk extends d{constructor(o){super(o,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class ok{constructor(o){this._methodToThrottle=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const sv=63710088e-1;class ml{constructor(o,h){if(isNaN(o)||isNaN(h))throw new Error(`Invalid LngLat object: (${o}, ${h})`);if(this.lng=+o,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ml(Be(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const h=Math.PI/180,f=this.lat*h,g=o.lat*h,x=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((o.lng-this.lng)*h);return sv*Math.acos(Math.min(x,1))}static convert(o){if(o instanceof ml)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new ml(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new ml(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const $T=2*Math.PI*sv;function GT(c){return $T*Math.cos(c*Math.PI/180)}function WT(c){return(180+c)/360}function XT(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function qT(c,o){return c/GT(o)}function ov(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class mf{constructor(o,h,f=0){this.x=+o,this.y=+h,this.z=+f}static fromLngLat(o,h=0){const f=ml.convert(o);return new mf(WT(f.lng),XT(f.lat),qT(h,f.lat))}toLngLat(){return new ml(360*this.x-180,ov(this.y))}toAltitude(){return this.z*GT(ov(this.y))}meterInMercatorCoordinateUnits(){return 1/$T*(o=ov(this.y),1/Math.cos(o*Math.PI/180));var o}}function KT(c,o,h){var f=2*Math.PI*6378137/256/Math.pow(2,h);return[c*f-2*Math.PI*6378137/2,o*f-2*Math.PI*6378137/2]}class av{constructor(o,h,f){if(!function(g,x,b){return!(g<0||g>25||b<0||b>=Math.pow(2,g)||x<0||x>=Math.pow(2,g))}(o,h,f))throw new Error(`x=${h}, y=${f}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=h,this.y=f,this.key=gf(0,o,o,h,f)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,h,f){const g=(b=this.y,A=this.z,S=KT(256*(x=this.x),256*(b=Math.pow(2,A)-b-1),A),M=KT(256*(x+1),256*(b+1),A),S[0]+","+S[1]+","+M[0]+","+M[1]);var x,b,A,S,M;const B=function(O,U,j){let G,Z="";for(let se=O;se>0;se--)G=1<<se-1,Z+=(U&G?1:0)+(j&G?2:0);return Z}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,B).replace(/{bbox-epsg-3857}/g,g)}isChildOf(o){const h=this.z-o.z;return h>0&&o.x===this.x>>h&&o.y===this.y>>h}getTilePoint(o){const h=Math.pow(2,this.z);return new I((o.x*h-this.x)*ln,(o.y*h-this.y)*ln)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ZT{constructor(o,h){this.wrap=o,this.canonical=h,this.key=gf(o,h.z,h.z,h.x,h.y)}}class gs{constructor(o,h,f,g,x){if(o<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${f}`);this.overscaledZ=o,this.wrap=h,this.canonical=new av(f,+g,+x),this.key=gf(h,o,f,g,x)}clone(){return new gs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-o;return o>this.canonical.z?new gs(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gs(o,this.wrap,o,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(o,h){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-o;return o>this.canonical.z?gf(this.wrap*+h,o,this.canonical.z,this.canonical.x,this.canonical.y):gf(this.wrap*+h,o,o,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const h=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>h&&o.canonical.y===this.canonical.y>>h}children(o){if(this.overscaledZ>=o)return[new gs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new gs(h,this.wrap,h,f,g),new gs(h,this.wrap,h,f+1,g),new gs(h,this.wrap,h,f,g+1),new gs(h,this.wrap,h,f+1,g+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new gs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new gs(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ZT(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new mf(o.x-this.wrap,o.y))}}function gf(c,o,h,f,g){(c*=2)<0&&(c=-1*c-1);const x=1<<h;return(x*x*c+x*g+f).toString(36)+h.toString(36)+o.toString(36)}ct("CanonicalTileID",av),ct("OverscaledTileID",gs,{omit:["posMatrix"]});class YT{constructor(o,h,f,g=1,x=1,b=1,A=0){if(this.uid=o,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void Pt(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const S=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=x,this.blueFactor=b,this.baseShift=A;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<S;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(S,M)]=this.data[this._idx(S-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,S)]=this.data[this._idx(M,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<S;M++)for(let B=0;B<S;B++){const O=this.get(M,B);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(o,h){const f=new Uint8Array(this.data.buffer),g=4*this._idx(o,h);return this.unpack(f[g],f[g+1],f[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(o,h){if(o<-1||o>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(o+1)}unpack(o,h,f){return o*this.redFactor+h*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new ms({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,h,f){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let g=h*this.dim,x=h*this.dim+this.dim,b=f*this.dim,A=f*this.dim+this.dim;switch(h){case-1:g=x-1;break;case 1:x=g+1}switch(f){case-1:b=A-1;break;case 1:A=b+1}const S=-h*this.dim,M=-f*this.dim;for(let B=b;B<A;B++)for(let O=g;O<x;O++)this.data[this._idx(O,B)]=o.data[this._idx(O+S,B+M)]}}ct("DEMData",YT);class JT{constructor(o){this._stringToNumber={},this._numberToString=[];for(let h=0;h<o.length;h++){const f=o[h];this._stringToNumber[f]=h,this._numberToString[h]=f}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class QT{constructor(o,h,f,g,x){this.type="Feature",this._vectorTileFeature=o,o._z=h,o._x=f,o._y=g,this.properties=o.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(o[h]=this[h]);return o}}class eE{constructor(o,h){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new tl(ln,16,0),this.grid3D=new tl(ln,16,0),this.featureIndexArray=new ir,this.promoteId=h}insert(o,h,f,g,x,b){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,x);const S=b?this.grid3D:this.grid;for(let M=0;M<h.length;M++){const B=h[M],O=[1/0,1/0,-1/0,-1/0];for(let U=0;U<B.length;U++){const j=B[U];O[0]=Math.min(O[0],j.x),O[1]=Math.min(O[1],j.y),O[2]=Math.max(O[2],j.x),O[3]=Math.max(O[3],j.y)}O[0]<ln&&O[1]<ln&&O[2]>=0&&O[3]>=0&&S.insert(A,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new dl.VectorTile(new K0(this.rawTileData)).layers,this.sourceLayerCoder=new JT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,h,f,g){this.loadVTLayers();const x=o.params||{},b=ln/o.tileSize/o.scale,A=Od(x.filter),S=o.queryGeometry,M=o.queryPadding*b,B=iE(S),O=this.grid.query(B.minX-M,B.minY-M,B.maxX+M,B.maxY+M),U=iE(o.cameraQueryGeometry),j=this.grid3D.query(U.minX-M,U.minY-M,U.maxX+M,U.maxY+M,(se,le,Ee,_e)=>function(be,Oe,He,ot,wt){for(const it of be)if(Oe<=it.x&&He<=it.y&&ot>=it.x&&wt>=it.y)return!0;const rt=[new I(Oe,He),new I(Oe,wt),new I(ot,wt),new I(ot,He)];if(be.length>2){for(const it of rt)if($u(be,it))return!0}for(let it=0;it<be.length-1;it++)if(zD(be[it],be[it+1],rt))return!0;return!1}(o.cameraQueryGeometry,se-M,le-M,Ee+M,_e+M));for(const se of j)O.push(se);O.sort(ak);const G={};let Z;for(let se=0;se<O.length;se++){const le=O[se];if(le===Z)continue;Z=le;const Ee=this.featureIndexArray.get(le);let _e=null;this.loadMatchingFeature(G,Ee.bucketIndex,Ee.sourceLayerIndex,Ee.featureIndex,A,x.layers,x.availableImages,h,f,g,(be,Oe,He)=>(_e||(_e=Tc(be)),Oe.queryIntersectsFeature(S,be,He,_e,this.z,o.transform,b,o.pixelPosMatrix)))}return G}loadMatchingFeature(o,h,f,g,x,b,A,S,M,B,O){const U=this.bucketLayerIDs[h];if(b&&!function(se,le){for(let Ee=0;Ee<se.length;Ee++)if(le.indexOf(se[Ee])>=0)return!0;return!1}(b,U))return;const j=this.sourceLayerCoder.decode(f),G=this.vtLayers[j].feature(g);if(x.needGeometry){const se=Ec(G,!0);if(!x.filter(new Ai(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!x.filter(new Ai(this.tileID.overscaledZ),G))return;const Z=this.getId(G,j);for(let se=0;se<U.length;se++){const le=U[se];if(b&&b.indexOf(le)<0)continue;const Ee=S[le];if(!Ee)continue;let _e={};Z&&B&&(_e=B.getState(Ee.sourceLayer||"_geojsonTileLayer",Z));const be=Fe({},M[le]);be.paint=tE(be.paint,Ee.paint,G,_e,A),be.layout=tE(be.layout,Ee.layout,G,_e,A);const Oe=!O||O(G,Ee,_e);if(!Oe)continue;const He=new QT(G,this.z,this.x,this.y,Z);He.layer=be;let ot=o[le];ot===void 0&&(ot=o[le]=[]),ot.push({featureIndex:g,feature:He,intersectionZ:Oe})}}lookupSymbolFeatures(o,h,f,g,x,b,A,S){const M={};this.loadVTLayers();const B=Od(x);for(const O of o)this.loadMatchingFeature(M,f,g,O,B,b,A,S,h);return M}hasLayer(o){for(const h of this.bucketLayerIDs)for(const f of h)if(o===f)return!0;return!1}getId(o,h){let f=o.id;return this.promoteId&&(f=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof f=="boolean"&&(f=Number(f))),f}}function tE(c,o,h,f,g){return Ve(c,(x,b)=>{const A=o instanceof xc?o.get(b):null;return A&&A.evaluate?A.evaluate(h,f,g):A})}function iE(c){let o=1/0,h=1/0,f=-1/0,g=-1/0;for(const x of c)o=Math.min(o,x.x),h=Math.min(h,x.y),f=Math.max(f,x.x),g=Math.max(g,x.y);return{minX:o,minY:h,maxX:f,maxY:g}}function ak(c,o){return o-c}function nE(c,o,h,f,g){const x=[];for(let b=0;b<c.length;b++){const A=c[b];let S;for(let M=0;M<A.length-1;M++){let B=A[M],O=A[M+1];B.x<o&&O.x<o||(B.x<o?B=new I(o,B.y+(o-B.x)/(O.x-B.x)*(O.y-B.y))._round():O.x<o&&(O=new I(o,B.y+(o-B.x)/(O.x-B.x)*(O.y-B.y))._round()),B.y<h&&O.y<h||(B.y<h?B=new I(B.x+(h-B.y)/(O.y-B.y)*(O.x-B.x),h)._round():O.y<h&&(O=new I(B.x+(h-B.y)/(O.y-B.y)*(O.x-B.x),h)._round()),B.x>=f&&O.x>=f||(B.x>=f?B=new I(f,B.y+(f-B.x)/(O.x-B.x)*(O.y-B.y))._round():O.x>=f&&(O=new I(f,B.y+(f-B.x)/(O.x-B.x)*(O.y-B.y))._round()),B.y>=g&&O.y>=g||(B.y>=g?B=new I(B.x+(g-B.y)/(O.y-B.y)*(O.x-B.x),g)._round():O.y>=g&&(O=new I(B.x+(g-B.y)/(O.y-B.y)*(O.x-B.x),g)._round()),S&&B.equals(S[S.length-1])||(S=[B],x.push(S)),S.push(O)))))}}return x}ct("FeatureIndex",eE,{omit:["rawTileData","sourceLayerCoder"]});class gl extends I{constructor(o,h,f,g){super(o,h),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new gl(this.x,this.y,this.angle,this.segment)}}function rE(c,o,h,f,g){if(o.segment===void 0||h===0)return!0;let x=o,b=o.segment+1,A=0;for(;A>-h/2;){if(b--,b<0)return!1;A-=c[b].dist(x),x=c[b]}A+=c[b].dist(c[b+1]),b++;const S=[];let M=0;for(;A<h/2;){const B=c[b],O=c[b+1];if(!O)return!1;let U=c[b-1].angleTo(B)-B.angleTo(O);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:A,angleDelta:U}),M+=U;A-S[0].distance>f;)M-=S.shift().angleDelta;if(M>g)return!1;b++,A+=B.dist(O)}return!0}function sE(c){let o=0;for(let h=0;h<c.length-1;h++)o+=c[h].dist(c[h+1]);return o}function oE(c,o,h){return c?.6*o*h:0}function aE(c,o){return Math.max(c?c.right-c.left:0,o?o.right-o.left:0)}function lk(c,o,h,f,g,x){const b=oE(h,g,x),A=aE(h,f)*x;let S=0;const M=sE(c)/2;for(let B=0;B<c.length-1;B++){const O=c[B],U=c[B+1],j=O.dist(U);if(S+j>M){const G=(M-S)/j,Z=fr.number(O.x,U.x,G),se=fr.number(O.y,U.y,G),le=new gl(Z,se,U.angleTo(O),B);return le._round(),!b||rE(c,le,A,b,o)?le:void 0}S+=j}}function ck(c,o,h,f,g,x,b,A,S){const M=oE(f,x,b),B=aE(f,g),O=B*b,U=c[0].x===0||c[0].x===S||c[0].y===0||c[0].y===S;return o-O<o/4&&(o=O+o/4),lE(c,U?o/2*A%o:(B/2+2*x)*b*A%o,o,M,h,O,U,!1,S)}function lE(c,o,h,f,g,x,b,A,S){const M=x/2,B=sE(c);let O=0,U=o-h,j=[];for(let G=0;G<c.length-1;G++){const Z=c[G],se=c[G+1],le=Z.dist(se),Ee=se.angleTo(Z);for(;U+h<O+le;){U+=h;const _e=(U-O)/le,be=fr.number(Z.x,se.x,_e),Oe=fr.number(Z.y,se.y,_e);if(be>=0&&be<S&&Oe>=0&&Oe<S&&U-M>=0&&U+M<=B){const He=new gl(be,Oe,Ee,G);He._round(),f&&!rE(c,He,x,f,g)||j.push(He)}}O+=le}return A||j.length||b||(j=lE(c,O/2,h,f,g,x,b,!0,S)),j}ct("Anchor",gl);const Ju=Fr;function cE(c,o,h,f){const g=[],x=c.image,b=x.pixelRatio,A=x.paddedRect.w-2*Ju,S=x.paddedRect.h-2*Ju;let M={x1:c.left,y1:c.top,x2:c.right,y2:c.bottom};const B=x.stretchX||[[0,A]],O=x.stretchY||[[0,S]],U=(Ne,yt)=>Ne+yt[1]-yt[0],j=B.reduce(U,0),G=O.reduce(U,0),Z=A-j,se=S-G;let le=0,Ee=j,_e=0,be=G,Oe=0,He=Z,ot=0,wt=se;if(x.content&&f){const Ne=x.content,yt=Ne[2]-Ne[0],mt=Ne[3]-Ne[1];(x.textFitWidth||x.textFitHeight)&&(M=FT(c)),le=Jm(B,0,Ne[0]),_e=Jm(O,0,Ne[1]),Ee=Jm(B,Ne[0],Ne[2]),be=Jm(O,Ne[1],Ne[3]),Oe=Ne[0]-le,ot=Ne[1]-_e,He=yt-Ee,wt=mt-be}const rt=M.x1,it=M.y1,gt=M.x2-rt,dt=M.y2-it,lt=(Ne,yt,mt,Rt)=>{const gi=Qm(Ne.stretch-le,Ee,gt,rt),hi=eg(Ne.fixed-Oe,He,Ne.stretch,j),vn=Qm(yt.stretch-_e,be,dt,it),js=eg(yt.fixed-ot,wt,yt.stretch,G),$n=Qm(mt.stretch-le,Ee,gt,rt),xn=eg(mt.fixed-Oe,He,mt.stretch,j),_r=Qm(Rt.stretch-_e,be,dt,it),yr=eg(Rt.fixed-ot,wt,Rt.stretch,G),vr=new I(gi,vn),qi=new I($n,vn),bn=new I($n,_r),rr=new I(gi,_r),Gn=new I(hi/b,js/b),xr=new I(xn/b,yr/b),Wn=o*Math.PI/180;if(Wn){const ei=Math.sin(Wn),xi=Math.cos(Wn),Ci=[xi,-ei,ei,xi];vr._matMult(Ci),qi._matMult(Ci),rr._matMult(Ci),bn._matMult(Ci)}const _s=Ne.stretch+Ne.fixed,Nr=yt.stretch+yt.fixed;return{tl:vr,tr:qi,bl:rr,br:bn,tex:{x:x.paddedRect.x+Ju+_s,y:x.paddedRect.y+Ju+Nr,w:mt.stretch+mt.fixed-_s,h:Rt.stretch+Rt.fixed-Nr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gn,pixelOffsetBR:xr,minFontScaleX:He/b/gt,minFontScaleY:wt/b/dt,isSDF:h}};if(f&&(x.stretchX||x.stretchY)){const Ne=uE(B,Z,j),yt=uE(O,se,G);for(let mt=0;mt<Ne.length-1;mt++){const Rt=Ne[mt],gi=Ne[mt+1];for(let hi=0;hi<yt.length-1;hi++)g.push(lt(Rt,yt[hi],gi,yt[hi+1]))}}else g.push(lt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:S+1}));return g}function Jm(c,o,h){let f=0;for(const g of c)f+=Math.max(o,Math.min(h,g[1]))-Math.max(o,Math.min(h,g[0]));return f}function uE(c,o,h){const f=[{fixed:-Ju,stretch:0}];for(const[g,x]of c){const b=f[f.length-1];f.push({fixed:g-b.stretch,stretch:b.stretch}),f.push({fixed:g-b.stretch,stretch:b.stretch+(x-g)})}return f.push({fixed:o+Ju,stretch:h}),f}function Qm(c,o,h,f){return c/o*h+f}function eg(c,o,h,f){return c-o*h/f}class tg{constructor(o,h,f,g,x,b,A,S,M,B){var O;if(this.boxStartIndex=o.length,M){let U=b.top,j=b.bottom;const G=b.collisionPadding;G&&(U-=G[1],j+=G[3]);let Z=j-U;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{const U=!((O=b.image)===null||O===void 0)&&O.content&&(b.image.textFitWidth||b.image.textFitHeight)?FT(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};U.y1=U.y1*A-S[0],U.y2=U.y2*A+S[2],U.x1=U.x1*A-S[3],U.x2=U.x2*A+S[1];const j=b.collisionPadding;if(j&&(U.x1-=j[0]*A,U.y1-=j[1]*A,U.x2+=j[2]*A,U.y2+=j[3]*A),B){const G=new I(U.x1,U.y1),Z=new I(U.x2,U.y1),se=new I(U.x1,U.y2),le=new I(U.x2,U.y2),Ee=B*Math.PI/180;G._rotate(Ee),Z._rotate(Ee),se._rotate(Ee),le._rotate(Ee),U.x1=Math.min(G.x,Z.x,se.x,le.x),U.x2=Math.max(G.x,Z.x,se.x,le.x),U.y1=Math.min(G.y,Z.y,se.y,le.y),U.y2=Math.max(G.y,Z.y,se.y,le.y)}o.emplaceBack(h.x,h.y,U.x1,U.y1,U.x2,U.y2,f,g,x)}this.boxEndIndex=o.length}}class uk{constructor(o=[],h=(f,g)=>f<g?-1:f>g?1:0){if(this.data=o,this.length=this.data.length,this.compare=h,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],h=this.data.pop();return--this.length>0&&(this.data[0]=h,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:h,compare:f}=this,g=h[o];for(;o>0;){const x=o-1>>1,b=h[x];if(f(g,b)>=0)break;h[o]=b,o=x}h[o]=g}_down(o){const{data:h,compare:f}=this,g=this.length>>1,x=h[o];for(;o<g;){let b=1+(o<<1);const A=b+1;if(A<this.length&&f(h[A],h[b])<0&&(b=A),f(h[b],x)>=0)break;h[o]=h[b],o=b}h[o]=x}}function hk(c,o=1,h=!1){let f=1/0,g=1/0,x=-1/0,b=-1/0;const A=c[0];for(let j=0;j<A.length;j++){const G=A[j];(!j||G.x<f)&&(f=G.x),(!j||G.y<g)&&(g=G.y),(!j||G.x>x)&&(x=G.x),(!j||G.y>b)&&(b=G.y)}const S=Math.min(x-f,b-g);let M=S/2;const B=new uk([],dk);if(S===0)return new I(f,g);for(let j=f;j<x;j+=S)for(let G=g;G<b;G+=S)B.push(new Qu(j+M,G+M,M,c));let O=function(j){let G=0,Z=0,se=0;const le=j[0];for(let Ee=0,_e=le.length,be=_e-1;Ee<_e;be=Ee++){const Oe=le[Ee],He=le[be],ot=Oe.x*He.y-He.x*Oe.y;Z+=(Oe.x+He.x)*ot,se+=(Oe.y+He.y)*ot,G+=3*ot}return new Qu(Z/G,se/G,0,j)}(c),U=B.length;for(;B.length;){const j=B.pop();(j.d>O.d||!O.d)&&(O=j,h&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,U)),j.max-O.d<=o||(M=j.h/2,B.push(new Qu(j.p.x-M,j.p.y-M,M,c)),B.push(new Qu(j.p.x+M,j.p.y-M,M,c)),B.push(new Qu(j.p.x-M,j.p.y+M,M,c)),B.push(new Qu(j.p.x+M,j.p.y+M,M,c)),U+=4)}return h&&(console.log(`num probes: ${U}`),console.log(`best distance: ${O.d}`)),O.p}function dk(c,o){return o.max-c.max}function Qu(c,o,h,f){this.p=new I(c,o),this.h=h,this.d=function(g,x){let b=!1,A=1/0;for(let S=0;S<x.length;S++){const M=x[S];for(let B=0,O=M.length,U=O-1;B<O;U=B++){const j=M[B],G=M[U];j.y>g.y!=G.y>g.y&&g.x<(G.x-j.x)*(g.y-j.y)/(G.y-j.y)+j.x&&(b=!b),A=Math.min(A,XA(g,j,G))}}return(b?1:-1)*Math.sqrt(A)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var Hn;u.aq=void 0,(Hn=u.aq||(u.aq={}))[Hn.center=1]="center",Hn[Hn.left=2]="left",Hn[Hn.right=3]="right",Hn[Hn.top=4]="top",Hn[Hn.bottom=5]="bottom",Hn[Hn["top-left"]=6]="top-left",Hn[Hn["top-right"]=7]="top-right",Hn[Hn["bottom-left"]=8]="bottom-left",Hn[Hn["bottom-right"]=9]="bottom-right";const _l=7,lv=Number.POSITIVE_INFINITY;function hE(c,o){return o[1]!==lv?function(h,f,g){let x=0,b=0;switch(f=Math.abs(f),g=Math.abs(g),h){case"top-right":case"top-left":case"top":b=g-_l;break;case"bottom-right":case"bottom-left":case"bottom":b=-g+_l}switch(h){case"top-right":case"bottom-right":case"right":x=-f;break;case"top-left":case"bottom-left":case"left":x=f}return[x,b]}(c,o[0],o[1]):function(h,f){let g=0,x=0;f<0&&(f=0);const b=f/Math.SQRT2;switch(h){case"top-right":case"top-left":x=b-_l;break;case"bottom-right":case"bottom-left":x=-b+_l;break;case"bottom":x=-f+_l;break;case"top":x=f-_l}switch(h){case"top-right":case"bottom-right":g=-b;break;case"top-left":case"bottom-left":g=b;break;case"left":g=f;break;case"right":g=-f}return[g,x]}(c,o[0])}function dE(c,o,h){var f;const g=c.layout,x=(f=g.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(o,{},h);if(x){const A=x.values,S=[];for(let M=0;M<A.length;M+=2){const B=S[M]=A[M],O=A[M+1].map(U=>U*fn);B.startsWith("top")?O[1]-=_l:B.startsWith("bottom")&&(O[1]+=_l),S[M+1]=O}return new Ui(S)}const b=g.get("text-variable-anchor");if(b){let A;A=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(o,{},h)*fn,lv]:g.get("text-offset").evaluate(o,{},h).map(M=>M*fn);const S=[];for(const M of b)S.push(M,hE(M,A));return new Ui(S)}return null}function cv(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fk(c,o,h,f,g,x,b,A,S,M,B){let O=x.textMaxSize.evaluate(o,{});O===void 0&&(O=b);const U=c.layers[0].layout,j=U.get("icon-offset").evaluate(o,{},B),G=pE(h.horizontal),Z=b/24,se=c.tilePixelRatio*Z,le=c.tilePixelRatio*O/24,Ee=c.tilePixelRatio*A,_e=c.tilePixelRatio*U.get("symbol-spacing"),be=U.get("text-padding")*c.tilePixelRatio,Oe=function(Ne,yt,mt,Rt=1){const gi=Ne.get("icon-padding").evaluate(yt,{},mt),hi=gi&&gi.values;return[hi[0]*Rt,hi[1]*Rt,hi[2]*Rt,hi[3]*Rt]}(U,o,B,c.tilePixelRatio),He=U.get("text-max-angle")/180*Math.PI,ot=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",wt=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",rt=U.get("symbol-placement"),it=_e/2,gt=U.get("icon-text-fit");let dt;f&&gt!=="none"&&(c.allowVerticalPlacement&&h.vertical&&(dt=NT(f,h.vertical,gt,U.get("icon-text-fit-padding"),j,Z)),G&&(f=NT(f,G,gt,U.get("icon-text-fit-padding"),j,Z)));const lt=(Ne,yt)=>{yt.x<0||yt.x>=ln||yt.y<0||yt.y>=ln||function(mt,Rt,gi,hi,vn,js,$n,xn,_r,yr,vr,qi,bn,rr,Gn,xr,Wn,_s,Nr,ei,xi,Ci,Jr,Vi,eh){const No=mt.addToLineVertexArray(Rt,gi);let Lo,Hs,ys,Pn,va=0,vf=0,yE=0,vE=0,_v=-1,yv=-1;const xa={};let xE=zu("");if(mt.allowVerticalPlacement&&hi.vertical){const sr=xn.layout.get("text-rotate").evaluate(xi,{},Vi)+90;ys=new tg(_r,Rt,yr,vr,qi,hi.vertical,bn,rr,Gn,sr),$n&&(Pn=new tg(_r,Rt,yr,vr,qi,$n,Wn,_s,Gn,sr))}if(vn){const sr=xn.layout.get("icon-rotate").evaluate(xi,{}),vs=xn.layout.get("icon-text-fit")!=="none",Cc=cE(vn,sr,Jr,vs),ao=$n?cE($n,sr,Jr,vs):void 0;Hs=new tg(_r,Rt,yr,vr,qi,vn,Wn,_s,!1,sr),va=4*Cc.length;const Ic=mt.iconSizeData;let Uo=null;Ic.kind==="source"?(Uo=[Fo*xn.layout.get("icon-size").evaluate(xi,{})],Uo[0]>pl&&Pt(`${mt.layerIds[0]}: Value for "icon-size" is >= ${pf}. Reduce your "icon-size".`)):Ic.kind==="composite"&&(Uo=[Fo*Ci.compositeIconSizes[0].evaluate(xi,{},Vi),Fo*Ci.compositeIconSizes[1].evaluate(xi,{},Vi)],(Uo[0]>pl||Uo[1]>pl)&&Pt(`${mt.layerIds[0]}: Value for "icon-size" is >= ${pf}. Reduce your "icon-size".`)),mt.addSymbols(mt.icon,Cc,Uo,ei,Nr,xi,u.ah.none,Rt,No.lineStartIndex,No.lineLength,-1,Vi),_v=mt.icon.placedSymbolArray.length-1,ao&&(vf=4*ao.length,mt.addSymbols(mt.icon,ao,Uo,ei,Nr,xi,u.ah.vertical,Rt,No.lineStartIndex,No.lineLength,-1,Vi),yv=mt.icon.placedSymbolArray.length-1)}const bE=Object.keys(hi.horizontal);for(const sr of bE){const vs=hi.horizontal[sr];if(!Lo){xE=zu(vs.text);const ao=xn.layout.get("text-rotate").evaluate(xi,{},Vi);Lo=new tg(_r,Rt,yr,vr,qi,vs,bn,rr,Gn,ao)}const Cc=vs.positionedLines.length===1;if(yE+=fE(mt,Rt,vs,js,xn,Gn,xi,xr,No,hi.vertical?u.ah.horizontal:u.ah.horizontalOnly,Cc?bE:[sr],xa,_v,Ci,Vi),Cc)break}hi.vertical&&(vE+=fE(mt,Rt,hi.vertical,js,xn,Gn,xi,xr,No,u.ah.vertical,["vertical"],xa,yv,Ci,Vi));const gk=Lo?Lo.boxStartIndex:mt.collisionBoxArray.length,_k=Lo?Lo.boxEndIndex:mt.collisionBoxArray.length,yk=ys?ys.boxStartIndex:mt.collisionBoxArray.length,vk=ys?ys.boxEndIndex:mt.collisionBoxArray.length,xk=Hs?Hs.boxStartIndex:mt.collisionBoxArray.length,bk=Hs?Hs.boxEndIndex:mt.collisionBoxArray.length,wk=Pn?Pn.boxStartIndex:mt.collisionBoxArray.length,Ak=Pn?Pn.boxEndIndex:mt.collisionBoxArray.length;let oo=-1;const ng=(sr,vs)=>sr&&sr.circleDiameter?Math.max(sr.circleDiameter,vs):vs;oo=ng(Lo,oo),oo=ng(ys,oo),oo=ng(Hs,oo),oo=ng(Pn,oo);const wE=oo>-1?1:0;wE&&(oo*=eh/fn),mt.glyphOffsetArray.length>=Yu.MAX_GLYPHS&&Pt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xi.sortKey!==void 0&&mt.addToSortKeyRanges(mt.symbolInstances.length,xi.sortKey);const Tk=dE(xn,xi,Vi),[Ek,Sk]=function(sr,vs){const Cc=sr.length,ao=vs==null?void 0:vs.values;if((ao==null?void 0:ao.length)>0)for(let Ic=0;Ic<ao.length;Ic+=2){const Uo=ao[Ic+1];sr.emplaceBack(u.aq[ao[Ic]],Uo[0],Uo[1])}return[Cc,sr.length]}(mt.textAnchorOffsets,Tk);mt.symbolInstances.emplaceBack(Rt.x,Rt.y,xa.right>=0?xa.right:-1,xa.center>=0?xa.center:-1,xa.left>=0?xa.left:-1,xa.vertical||-1,_v,yv,xE,gk,_k,yk,vk,xk,bk,wk,Ak,yr,yE,vE,va,vf,wE,0,bn,oo,Ek,Sk)}(c,yt,Ne,h,f,g,dt,c.layers[0],c.collisionBoxArray,o.index,o.sourceLayerIndex,c.index,se,[be,be,be,be],ot,S,Ee,Oe,wt,j,o,x,M,B,b)};if(rt==="line")for(const Ne of nE(o.geometry,0,0,ln,ln)){const yt=ck(Ne,_e,He,h.vertical||G,f,24,le,c.overscaling,ln);for(const mt of yt)G&&pk(c,G.text,it,mt)||lt(Ne,mt)}else if(rt==="line-center"){for(const Ne of o.geometry)if(Ne.length>1){const yt=lk(Ne,He,h.vertical||G,f,24,le);yt&&lt(Ne,yt)}}else if(o.type==="Polygon")for(const Ne of gu(o.geometry,0)){const yt=hk(Ne,16);lt(Ne[0],new gl(yt.x,yt.y,0))}else if(o.type==="LineString")for(const Ne of o.geometry)lt(Ne,new gl(Ne[0].x,Ne[0].y,0));else if(o.type==="Point")for(const Ne of o.geometry)for(const yt of Ne)lt([yt],new gl(yt.x,yt.y,0))}function fE(c,o,h,f,g,x,b,A,S,M,B,O,U,j,G){const Z=function(Ee,_e,be,Oe,He,ot,wt,rt){const it=Oe.layout.get("text-rotate").evaluate(ot,{})*Math.PI/180,gt=[];for(const dt of _e.positionedLines)for(const lt of dt.positionedGlyphs){if(!lt.rect)continue;const Ne=lt.rect||{};let yt=RT+1,mt=!0,Rt=1,gi=0;const hi=(He||rt)&&lt.vertical,vn=lt.metrics.advance*lt.scale/2;if(rt&&_e.verticalizable&&(gi=dt.lineOffset/2-(lt.imageName?-(fn-lt.metrics.width*lt.scale)/2:(lt.scale-1)*fn)),lt.imageName){const ei=wt[lt.imageName];mt=ei.sdf,Rt=ei.pixelRatio,yt=Fr/Rt}const js=He?[lt.x+vn,lt.y]:[0,0];let $n=He?[0,0]:[lt.x+vn+be[0],lt.y+be[1]-gi],xn=[0,0];hi&&(xn=$n,$n=[0,0]);const _r=lt.metrics.isDoubleResolution?2:1,yr=(lt.metrics.left-yt)*lt.scale-vn+$n[0],vr=(-lt.metrics.top-yt)*lt.scale+$n[1],qi=yr+Ne.w/_r*lt.scale/Rt,bn=vr+Ne.h/_r*lt.scale/Rt,rr=new I(yr,vr),Gn=new I(qi,vr),xr=new I(yr,bn),Wn=new I(qi,bn);if(hi){const ei=new I(-vn,vn-df),xi=-Math.PI/2,Ci=fn/2-vn,Jr=new I(5-df-Ci,-(lt.imageName?Ci:0)),Vi=new I(...xn);rr._rotateAround(xi,ei)._add(Jr)._add(Vi),Gn._rotateAround(xi,ei)._add(Jr)._add(Vi),xr._rotateAround(xi,ei)._add(Jr)._add(Vi),Wn._rotateAround(xi,ei)._add(Jr)._add(Vi)}if(it){const ei=Math.sin(it),xi=Math.cos(it),Ci=[xi,-ei,ei,xi];rr._matMult(Ci),Gn._matMult(Ci),xr._matMult(Ci),Wn._matMult(Ci)}const _s=new I(0,0),Nr=new I(0,0);gt.push({tl:rr,tr:Gn,bl:xr,br:Wn,tex:Ne,writingMode:_e.writingMode,glyphOffset:js,sectionIndex:lt.sectionIndex,isSDF:mt,pixelOffsetTL:_s,pixelOffsetBR:Nr,minFontScaleX:0,minFontScaleY:0})}return gt}(0,h,A,g,x,b,f,c.allowVerticalPlacement),se=c.textSizeData;let le=null;se.kind==="source"?(le=[Fo*g.layout.get("text-size").evaluate(b,{})],le[0]>pl&&Pt(`${c.layerIds[0]}: Value for "text-size" is >= ${pf}. Reduce your "text-size".`)):se.kind==="composite"&&(le=[Fo*j.compositeTextSizes[0].evaluate(b,{},G),Fo*j.compositeTextSizes[1].evaluate(b,{},G)],(le[0]>pl||le[1]>pl)&&Pt(`${c.layerIds[0]}: Value for "text-size" is >= ${pf}. Reduce your "text-size".`)),c.addSymbols(c.text,Z,le,A,x,b,M,o,S.lineStartIndex,S.lineLength,U,G);for(const Ee of B)O[Ee]=c.text.placedSymbolArray.length-1;return 4*Z.length}function pE(c){for(const o in c)return c[o];return null}function pk(c,o,h,f){const g=c.compareText;if(o in g){const x=g[o];for(let b=x.length-1;b>=0;b--)if(f.dist(x[b])<h)return!0}else g[o]=[];return g[o].push(f),!1}const mE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class uv{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,f]=new Uint8Array(o,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=f>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const x=mE[15&f];if(!x)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(o,2,1),[A]=new Uint32Array(o,4,1);return new uv(A,b,x,o)}constructor(o,h=64,f=Float64Array,g){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=f,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const x=mE.indexOf(this.ArrayType),b=2*o*this.ArrayType.BYTES_PER_ELEMENT,A=o*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-A%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${f}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+A+S,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+b+A+S),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+A+S,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=o)}add(o,h){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=o,this.coords[this._pos++]=h,f}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return hv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,h,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:b,nodeSize:A}=this,S=[0,x.length-1,0],M=[];for(;S.length;){const B=S.pop()||0,O=S.pop()||0,U=S.pop()||0;if(O-U<=A){for(let se=U;se<=O;se++){const le=b[2*se],Ee=b[2*se+1];le>=o&&le<=f&&Ee>=h&&Ee<=g&&M.push(x[se])}continue}const j=U+O>>1,G=b[2*j],Z=b[2*j+1];G>=o&&G<=f&&Z>=h&&Z<=g&&M.push(x[j]),(B===0?o<=G:h<=Z)&&(S.push(U),S.push(j-1),S.push(1-B)),(B===0?f>=G:g>=Z)&&(S.push(j+1),S.push(O),S.push(1-B))}return M}within(o,h,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:x,nodeSize:b}=this,A=[0,g.length-1,0],S=[],M=f*f;for(;A.length;){const B=A.pop()||0,O=A.pop()||0,U=A.pop()||0;if(O-U<=b){for(let se=U;se<=O;se++)_E(x[2*se],x[2*se+1],o,h)<=M&&S.push(g[se]);continue}const j=U+O>>1,G=x[2*j],Z=x[2*j+1];_E(G,Z,o,h)<=M&&S.push(g[j]),(B===0?o-f<=G:h-f<=Z)&&(A.push(U),A.push(j-1),A.push(1-B)),(B===0?o+f>=G:h+f>=Z)&&(A.push(j+1),A.push(O),A.push(1-B))}return S}}function hv(c,o,h,f,g,x){if(g-f<=h)return;const b=f+g>>1;gE(c,o,b,f,g,x),hv(c,o,h,f,b-1,1-x),hv(c,o,h,b+1,g,1-x)}function gE(c,o,h,f,g,x){for(;g>f;){if(g-f>600){const M=g-f+1,B=h-f+1,O=Math.log(M),U=.5*Math.exp(2*O/3),j=.5*Math.sqrt(O*U*(M-U)/M)*(B-M/2<0?-1:1);gE(c,o,h,Math.max(f,Math.floor(h-B*U/M+j)),Math.min(g,Math.floor(h+(M-B)*U/M+j)),x)}const b=o[2*h+x];let A=f,S=g;for(_f(c,o,f,h),o[2*g+x]>b&&_f(c,o,f,g);A<S;){for(_f(c,o,A,S),A++,S--;o[2*A+x]<b;)A++;for(;o[2*S+x]>b;)S--}o[2*f+x]===b?_f(c,o,f,S):(S++,_f(c,o,S,g)),S<=h&&(f=S+1),h<=S&&(g=S-1)}}function _f(c,o,h,f){dv(c,h,f),dv(o,2*h,2*f),dv(o,2*h+1,2*f+1)}function dv(c,o,h){const f=c[o];c[o]=c[h],c[h]=f}function _E(c,o,h,f){const g=c-h,x=o-f;return g*g+x*x}var fv;u.bg=void 0,(fv=u.bg||(u.bg={})).create="create",fv.load="load",fv.fullLoad="fullLoad";let ig=null,yf=[];const pv=1e3/60,mv="loadTime",gv="fullLoadTime",mk={mark(c){performance.mark(c)},frame(c){const o=c;ig!=null&&yf.push(o-ig),ig=o},clearMetrics(){ig=null,yf=[],performance.clearMeasures(mv),performance.clearMeasures(gv);for(const c in u.bg)performance.clearMarks(u.bg[c])},getPerformanceMetrics(){performance.measure(mv,u.bg.create,u.bg.load),performance.measure(gv,u.bg.create,u.bg.fullLoad);const c=performance.getEntriesByName(mv)[0].duration,o=performance.getEntriesByName(gv)[0].duration,h=yf.length,f=1/(yf.reduce((x,b)=>x+b,0)/h/1e3),g=yf.filter(x=>x>pv).reduce((x,b)=>x+(b-pv)/pv,0);return{loadTime:c,fullLoadTime:o,fps:f,percentDroppedFrames:g/(h+g)*100,totalFrames:h}}};u.$=class extends F{},u.A=Gu,u.B=T0,u.C=function(c){if(Zn==null){const o=c.navigator?c.navigator.userAgent:null;Zn=!!c.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Zn},u.D=ft,u.E=jr,u.F=class{constructor(c,o){this.target=c,this.mapId=o,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new ok(()=>this.process()),this.subscription=function(h,f,g,x){return h.addEventListener(f,g,!1),{unsubscribe:()=>{h.removeEventListener(f,g,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=_i(self)?c:window}registerMessageHandler(c,o){this.messageHandlers[c]=o}sendAsync(c,o){return new Promise((h,f)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:h,reject:f},o&&o.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const A={id:g,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(A)},{once:!0});const x=[],b=Object.assign(Object.assign({},c),{id:g,sourceMapId:this.mapId,origin:location.origin,data:il(c.data,x)});this.target.postMessage(b,{transfer:x})})}receive(c){const o=c.data,h=o.id;if(!(o.origin!=="file://"&&location.origin!=="file://"&&o.origin!=="resource://android"&&location.origin!=="resource://android"&&o.origin!==location.origin||o.targetMapId&&this.mapId!==o.targetMapId)){if(o.type==="<cancel>"){delete this.tasks[h];const f=this.abortControllers[h];return delete this.abortControllers[h],void(f&&f.abort())}if(_i(self)||o.mustQueue)return this.tasks[h]=o,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,o)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),o=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),o&&this.processTask(c,o)}processTask(c,o){return l(this,void 0,void 0,function*(){if(o.type==="<response>"){const g=this.resolveRejects[c];return delete this.resolveRejects[c],g?void(o.error?g.reject(nl(o.error)):g.resolve(nl(o.data))):void 0}if(!this.messageHandlers[o.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${o.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=nl(o.data),f=new AbortController;this.abortControllers[c]=f;try{const g=yield this.messageHandlers[o.type](o.sourceMapId,h,f);this.completeTask(c,null,g)}catch(g){this.completeTask(c,g)}})}completeTask(c,o,h){const f=[];delete this.abortControllers[c];const g={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:o?il(o):null,data:il(h,f)};this.target.postMessage(g,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.G=On,u.H=function(){var c=new Gu(16);return Gu!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},u.I=Y0,u.J=function(c,o,h){var f,g,x,b,A,S,M,B,O,U,j,G,Z=h[0],se=h[1],le=h[2];return o===c?(c[12]=o[0]*Z+o[4]*se+o[8]*le+o[12],c[13]=o[1]*Z+o[5]*se+o[9]*le+o[13],c[14]=o[2]*Z+o[6]*se+o[10]*le+o[14],c[15]=o[3]*Z+o[7]*se+o[11]*le+o[15]):(g=o[1],x=o[2],b=o[3],A=o[4],S=o[5],M=o[6],B=o[7],O=o[8],U=o[9],j=o[10],G=o[11],c[0]=f=o[0],c[1]=g,c[2]=x,c[3]=b,c[4]=A,c[5]=S,c[6]=M,c[7]=B,c[8]=O,c[9]=U,c[10]=j,c[11]=G,c[12]=f*Z+A*se+O*le+o[12],c[13]=g*Z+S*se+U*le+o[13],c[14]=x*Z+M*se+j*le+o[14],c[15]=b*Z+B*se+G*le+o[15]),c},u.K=function(c,o,h){var f=h[0],g=h[1],x=h[2];return c[0]=o[0]*f,c[1]=o[1]*f,c[2]=o[2]*f,c[3]=o[3]*f,c[4]=o[4]*g,c[5]=o[5]*g,c[6]=o[6]*g,c[7]=o[7]*g,c[8]=o[8]*x,c[9]=o[9]*x,c[10]=o[10]*x,c[11]=o[11]*x,c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15],c},u.L=YA,u.M=function(c,o){const h={};for(let f=0;f<o.length;f++){const g=o[f];g in c&&(h[g]=c[g])}return h},u.N=ml,u.O=WT,u.P=I,u.Q=XT,u.R=ms,u.S=gs,u.T=ku,u.U=X,u.V=$,u.W=Et,u.X=ln,u.Y=T,u.Z=mf,u._=l,u.a=Ji,u.a$=function(c,o){var h=c[0],f=c[1],g=c[2],x=c[3],b=c[4],A=c[5],S=c[6],M=c[7],B=c[8],O=c[9],U=c[10],j=c[11],G=c[12],Z=c[13],se=c[14],le=c[15],Ee=o[0],_e=o[1],be=o[2],Oe=o[3],He=o[4],ot=o[5],wt=o[6],rt=o[7],it=o[8],gt=o[9],dt=o[10],lt=o[11],Ne=o[12],yt=o[13],mt=o[14],Rt=o[15];return Math.abs(h-Ee)<=gr*Math.max(1,Math.abs(h),Math.abs(Ee))&&Math.abs(f-_e)<=gr*Math.max(1,Math.abs(f),Math.abs(_e))&&Math.abs(g-be)<=gr*Math.max(1,Math.abs(g),Math.abs(be))&&Math.abs(x-Oe)<=gr*Math.max(1,Math.abs(x),Math.abs(Oe))&&Math.abs(b-He)<=gr*Math.max(1,Math.abs(b),Math.abs(He))&&Math.abs(A-ot)<=gr*Math.max(1,Math.abs(A),Math.abs(ot))&&Math.abs(S-wt)<=gr*Math.max(1,Math.abs(S),Math.abs(wt))&&Math.abs(M-rt)<=gr*Math.max(1,Math.abs(M),Math.abs(rt))&&Math.abs(B-it)<=gr*Math.max(1,Math.abs(B),Math.abs(it))&&Math.abs(O-gt)<=gr*Math.max(1,Math.abs(O),Math.abs(gt))&&Math.abs(U-dt)<=gr*Math.max(1,Math.abs(U),Math.abs(dt))&&Math.abs(j-lt)<=gr*Math.max(1,Math.abs(j),Math.abs(lt))&&Math.abs(G-Ne)<=gr*Math.max(1,Math.abs(G),Math.abs(Ne))&&Math.abs(Z-yt)<=gr*Math.max(1,Math.abs(Z),Math.abs(yt))&&Math.abs(se-mt)<=gr*Math.max(1,Math.abs(se),Math.abs(mt))&&Math.abs(le-Rt)<=gr*Math.max(1,Math.abs(le),Math.abs(Rt))},u.a0=Gt,u.a1=av,u.a2=We,u.a3=c=>{const o=window.document.createElement("video");return o.muted=!0,new Promise(h=>{o.onloadstart=()=>{h(o)};for(const f of c){const g=window.document.createElement("source");$i(f)||(o.crossOrigin="Anonymous"),g.src=f,o.appendChild(g)}})},u.a4=function(){return ze++},u.a5=st,u.a6=Yu,u.a7=Od,u.a8=Ec,u.a9=QT,u.aA=function(c){if(c.type==="custom")return new sk(c);switch(c.type){case"background":return new ik(c);case"circle":return new HD(c);case"fill":return new oO(c);case"fill-extrusion":return new bO(c);case"heatmap":return new GD(c);case"hillshade":return new XD(c);case"line":return new RO(c);case"raster":return new rk(c);case"symbol":return new Ym(c)}},u.aB=Ke,u.aC=function(c,o){if(!c)return[{command:"setStyle",args:[o]}];let h=[];try{if(!Xt(c.version,o.version))return[{command:"setStyle",args:[o]}];Xt(c.center,o.center)||h.push({command:"setCenter",args:[o.center]}),Xt(c.zoom,o.zoom)||h.push({command:"setZoom",args:[o.zoom]}),Xt(c.bearing,o.bearing)||h.push({command:"setBearing",args:[o.bearing]}),Xt(c.pitch,o.pitch)||h.push({command:"setPitch",args:[o.pitch]}),Xt(c.sprite,o.sprite)||h.push({command:"setSprite",args:[o.sprite]}),Xt(c.glyphs,o.glyphs)||h.push({command:"setGlyphs",args:[o.glyphs]}),Xt(c.transition,o.transition)||h.push({command:"setTransition",args:[o.transition]}),Xt(c.light,o.light)||h.push({command:"setLight",args:[o.light]}),Xt(c.terrain,o.terrain)||h.push({command:"setTerrain",args:[o.terrain]}),Xt(c.sky,o.sky)||h.push({command:"setSky",args:[o.sky]}),Xt(c.projection,o.projection)||h.push({command:"setProjection",args:[o.projection]});const f={},g=[];(function(b,A,S,M){let B;for(B in A=A||{},b=b||{})Object.prototype.hasOwnProperty.call(b,B)&&(Object.prototype.hasOwnProperty.call(A,B)||Ds(B,S,M));for(B in A)Object.prototype.hasOwnProperty.call(A,B)&&(Object.prototype.hasOwnProperty.call(b,B)?Xt(b[B],A[B])||(b[B].type==="geojson"&&A[B].type==="geojson"&&Ro(b,A,B)?mi(S,{command:"setGeoJSONSourceData",args:[B,A[B].data]}):ls(B,A,S,M)):gn(B,A,S))})(c.sources,o.sources,g,f);const x=[];c.layers&&c.layers.forEach(b=>{"source"in b&&f[b.source]?h.push({command:"removeLayer",args:[b.id]}):x.push(b)}),h=h.concat(g),function(b,A,S){A=A||[];const M=(b=b||[]).map(ra),B=A.map(ra),O=b.reduce(Po,{}),U=A.reduce(Po,{}),j=M.slice(),G=Object.create(null);let Z,se,le,Ee,_e;for(let be=0,Oe=0;be<M.length;be++)Z=M[be],Object.prototype.hasOwnProperty.call(U,Z)?Oe++:(mi(S,{command:"removeLayer",args:[Z]}),j.splice(j.indexOf(Z,Oe),1));for(let be=0,Oe=0;be<B.length;be++)Z=B[B.length-1-be],j[j.length-1-be]!==Z&&(Object.prototype.hasOwnProperty.call(O,Z)?(mi(S,{command:"removeLayer",args:[Z]}),j.splice(j.lastIndexOf(Z,j.length-Oe),1)):Oe++,Ee=j[j.length-be],mi(S,{command:"addLayer",args:[U[Z],Ee]}),j.splice(j.length-be,0,Z),G[Z]=!0);for(let be=0;be<B.length;be++)if(Z=B[be],se=O[Z],le=U[Z],!G[Z]&&!Xt(se,le))if(Xt(se.source,le.source)&&Xt(se["source-layer"],le["source-layer"])&&Xt(se.type,le.type)){for(_e in dr(se.layout,le.layout,S,Z,null,"setLayoutProperty"),dr(se.paint,le.paint,S,Z,null,"setPaintProperty"),Xt(se.filter,le.filter)||mi(S,{command:"setFilter",args:[Z,le.filter]}),Xt(se.minzoom,le.minzoom)&&Xt(se.maxzoom,le.maxzoom)||mi(S,{command:"setLayerZoomRange",args:[Z,le.minzoom,le.maxzoom]}),se)Object.prototype.hasOwnProperty.call(se,_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&(_e.indexOf("paint.")===0?dr(se[_e],le[_e],S,Z,_e.slice(6),"setPaintProperty"):Xt(se[_e],le[_e])||mi(S,{command:"setLayerProperty",args:[Z,_e,le[_e]]}));for(_e in le)Object.prototype.hasOwnProperty.call(le,_e)&&!Object.prototype.hasOwnProperty.call(se,_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&(_e.indexOf("paint.")===0?dr(se[_e],le[_e],S,Z,_e.slice(6),"setPaintProperty"):Xt(se[_e],le[_e])||mi(S,{command:"setLayerProperty",args:[Z,_e,le[_e]]}))}else mi(S,{command:"removeLayer",args:[Z]}),Ee=j[j.lastIndexOf(Z)+1],mi(S,{command:"addLayer",args:[le,Ee]})}(x,o.layers,h)}catch(f){console.warn("Unable to compute style diff:",f),h=[{command:"setStyle",args:[o]}]}return h},u.aD=function(c){const o=[],h=c.id;return h===void 0&&o.push({message:`layers.${h}: missing required property "id"`}),c.render===void 0&&o.push({message:`layers.${h}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&o.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),o},u.aE=function c(o,h){if(Array.isArray(o)){if(!Array.isArray(h)||o.length!==h.length)return!1;for(let f=0;f<o.length;f++)if(!c(o[f],h[f]))return!1;return!0}if(typeof o=="object"&&o!==null&&h!==null){if(typeof h!="object"||Object.keys(o).length!==Object.keys(h).length)return!1;for(const f in o)if(!c(o[f],h[f]))return!1;return!0}return o===h},u.aF=Ve,u.aG=je,u.aH=class extends wc{constructor(c,o){super(c,o),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},u.aI=Lm,u.aJ=class extends wc{constructor(c,o){super(c,o),this.current=kD}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let o=1;o<16;o++)if(c[o]!==this.current[o]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},u.aK=zA,u.aL=VA,u.aM=Zt,u.aN=class extends wc{constructor(c,o){super(c,o),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},u.aO=class extends wc{constructor(c,o){super(c,o),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},u.aP=function(c,o,h,f,g,x,b){var A=1/(o-h),S=1/(f-g),M=1/(x-b);return c[0]=-2*A,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*S,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*M,c[11]=0,c[12]=(o+h)*A,c[13]=(g+f)*S,c[14]=(b+x)*M,c[15]=1,c},u.aQ=jD,u.aR=class extends ye{},u.aS=DO,u.aT=class extends Se{},u.aU=U0,u.aV=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},u.aW=iT,u.aX=Vn,u.aY=ps,u.aZ=class extends pt{},u.a_=function(c,o){return c[0]===o[0]&&c[1]===o[1]&&c[2]===o[2]&&c[3]===o[3]&&c[4]===o[4]&&c[5]===o[5]&&c[6]===o[6]&&c[7]===o[7]&&c[8]===o[8]&&c[9]===o[9]&&c[10]===o[10]&&c[11]===o[11]&&c[12]===o[12]&&c[13]===o[13]&&c[14]===o[14]&&c[15]===o[15]},u.aa=function(c){const o={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,f,g,x)=>{const b=g||x;return o[f]=!b||b.toLowerCase(),""}),o["max-age"]){const h=parseInt(o["max-age"],10);isNaN(h)?delete o["max-age"]:o["max-age"]=h}return o},u.ab=function(c,o){const h=[];for(const f in c)f in o||h.push(f);return h},u.ac=Ce,u.ad=function(c,o,h){var f=Math.sin(h),g=Math.cos(h),x=o[0],b=o[1],A=o[2],S=o[3],M=o[4],B=o[5],O=o[6],U=o[7];return o!==c&&(c[8]=o[8],c[9]=o[9],c[10]=o[10],c[11]=o[11],c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15]),c[0]=x*g+M*f,c[1]=b*g+B*f,c[2]=A*g+O*f,c[3]=S*g+U*f,c[4]=M*g-x*f,c[5]=B*g-b*f,c[6]=O*g-A*f,c[7]=U*g-S*f,c},u.ae=function(c){var o=new Gu(16);return o[0]=c[0],o[1]=c[1],o[2]=c[2],o[3]=c[3],o[4]=c[4],o[5]=c[5],o[6]=c[6],o[7]=c[7],o[8]=c[8],o[9]=c[9],o[10]=c[10],o[11]=c[11],o[12]=c[12],o[13]=c[13],o[14]=c[14],o[15]=c[15],o},u.af=jm,u.ag=function(c,o){let h=0,f=0;if(c.kind==="constant")f=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:g,minZoom:x,maxZoom:b}=c,A=g?Ce(pr.interpolationFactor(g,o,x,b),0,1):0;c.kind==="camera"?f=fr.number(c.minSize,c.maxSize,A):h=A}return{uSizeT:h,uSize:f}},u.ai=function(c,{uSize:o,uSizeT:h},{lowerSize:f,upperSize:g}){return c.kind==="source"?f/Fo:c.kind==="composite"?fr.number(f/Fo,g/Fo,h):o},u.aj=tv,u.ak=function(c,o,h,f){const g=o.y-c.y,x=o.x-c.x,b=f.y-h.y,A=f.x-h.x,S=b*x-A*g;if(S===0)return null;const M=(A*(c.y-h.y)-b*(c.x-h.x))/S;return new I(c.x+M*x,c.y+M*g)},u.al=nE,u.am=GA,u.an=F0,u.ao=function(c){let o=1/0,h=1/0,f=-1/0,g=-1/0;for(const x of c)o=Math.min(o,x.x),h=Math.min(h,x.y),f=Math.max(f,x.x),g=Math.max(g,x.y);return[o,h,f,g]},u.ap=fn,u.ar=ev,u.as=function(c,o){var h=o[0],f=o[1],g=o[2],x=o[3],b=o[4],A=o[5],S=o[6],M=o[7],B=o[8],O=o[9],U=o[10],j=o[11],G=o[12],Z=o[13],se=o[14],le=o[15],Ee=h*A-f*b,_e=h*S-g*b,be=h*M-x*b,Oe=f*S-g*A,He=f*M-x*A,ot=g*M-x*S,wt=B*Z-O*G,rt=B*se-U*G,it=B*le-j*G,gt=O*se-U*Z,dt=O*le-j*Z,lt=U*le-j*se,Ne=Ee*lt-_e*dt+be*gt+Oe*it-He*rt+ot*wt;return Ne?(c[0]=(A*lt-S*dt+M*gt)*(Ne=1/Ne),c[1]=(g*dt-f*lt-x*gt)*Ne,c[2]=(Z*ot-se*He+le*Oe)*Ne,c[3]=(U*He-O*ot-j*Oe)*Ne,c[4]=(S*it-b*lt-M*rt)*Ne,c[5]=(h*lt-g*it+x*rt)*Ne,c[6]=(se*be-G*ot-le*_e)*Ne,c[7]=(B*ot-U*be+j*_e)*Ne,c[8]=(b*dt-A*it+M*wt)*Ne,c[9]=(f*it-h*dt-x*wt)*Ne,c[10]=(G*He-Z*be+le*Ee)*Ne,c[11]=(O*be-B*He-j*Ee)*Ne,c[12]=(A*rt-b*gt-S*wt)*Ne,c[13]=(h*gt-f*rt+g*wt)*Ne,c[14]=(Z*_e-G*Oe-se*Ee)*Ne,c[15]=(B*Oe-O*_e+U*Ee)*Ne,c):null},u.at=cv,u.au=Q0,u.av=uv,u.aw=function(){const c={},o=Pe.$version;for(const h in Pe.$root){const f=Pe.$root[h];if(f.required){let g=null;g=h==="version"?o:f.type==="array"?[]:{},g!=null&&(c[h]=g)}}return c},u.ax=qd,u.ay=dn,u.az=function(c){c=c.slice();const o=Object.create(null);for(let h=0;h<c.length;h++)o[c[h].id]=c[h];for(let h=0;h<c.length;h++)"ref"in c[h]&&(c[h]=Io(c[h],o[c[h].ref]));return c},u.b=sn,u.b0=function(c,o){return c[0]=o[0],c[1]=o[1],c[2]=o[2],c[3]=o[3],c[4]=o[4],c[5]=o[5],c[6]=o[6],c[7]=o[7],c[8]=o[8],c[9]=o[9],c[10]=o[10],c[11]=o[11],c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15],c},u.b1=function(c,o,h){return c[0]=o[0]*h[0],c[1]=o[1]*h[1],c[2]=o[2]*h[2],c[3]=o[3]*h[3],c},u.b2=function(c,o){return c[0]*o[0]+c[1]*o[1]+c[2]*o[2]+c[3]*o[3]},u.b3=Be,u.b4=ZT,u.b5=qT,u.b6=function(c,o,h,f,g){var x,b=1/Math.tan(o/2);return c[0]=b/h,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=b,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,g!=null&&g!==1/0?(c[10]=(g+f)*(x=1/(f-g)),c[14]=2*g*f*x):(c[10]=-1,c[14]=-2*f),c},u.b7=function(c,o,h){var f=Math.sin(h),g=Math.cos(h),x=o[4],b=o[5],A=o[6],S=o[7],M=o[8],B=o[9],O=o[10],U=o[11];return o!==c&&(c[0]=o[0],c[1]=o[1],c[2]=o[2],c[3]=o[3],c[12]=o[12],c[13]=o[13],c[14]=o[14],c[15]=o[15]),c[4]=x*g+M*f,c[5]=b*g+B*f,c[6]=A*g+O*f,c[7]=S*g+U*f,c[8]=M*g-x*f,c[9]=B*g-b*f,c[10]=O*g-A*f,c[11]=U*g-S*f,c},u.b8=Q,u.b9=me,u.bA=wT,u.bB=function(c){return c.message===Ut},u.bC=Ka,u.bD=Or,u.ba=function(c){return c*Math.PI/180},u.bb=function(c,o){const{x:h,y:f}=mf.fromLngLat(o);return!(c<0||c>25||f<0||f>=1||h<0||h>=1)},u.bc=function(c,o){return c[0]=o[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=o[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=o[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},u.bd=class extends D{},u.be=sv,u.bf=mk,u.bh=Jt,u.bi=function(c,o){Ji.REGISTERED_PROTOCOLS[c]=o},u.bj=function(c){delete Ji.REGISTERED_PROTOCOLS[c]},u.bk=function(c,o){const h={};for(let g=0;g<c.length;g++){const x=o&&o[c[g].id]||Sm(c[g]);o&&(o[c[g].id]=x);let b=h[x];b||(b=h[x]=[]),b.push(c[g])}const f=[];for(const g in h)f.push(h[g]);return f},u.bl=ct,u.bm=JT,u.bn=eE,u.bo=MT,u.bp=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=ln/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const o=c.bucket.layers[0],h=o.layout,f=o._unevaluatedLayout._values,g={layoutIconSize:f["icon-size"].possiblyEvaluate(new Ai(c.bucket.zoom+1),c.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new Ai(c.bucket.zoom+1),c.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new Ai(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:B}=c.bucket.textSizeData;g.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Ai(M),c.canonical),f["text-size"].possiblyEvaluate(new Ai(B),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:B}=c.bucket.iconSizeData;g.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Ai(M),c.canonical),f["icon-size"].possiblyEvaluate(new Ai(B),c.canonical)]}const x=h.get("text-line-height")*fn,b=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",A=h.get("text-keep-upright"),S=h.get("text-size");for(const M of c.bucket.features){const B=h.get("text-font").evaluate(M,{},c.canonical).join(","),O=S.evaluate(M,{},c.canonical),U=g.layoutTextSize.evaluate(M,{},c.canonical),j=g.layoutIconSize.evaluate(M,{},c.canonical),G={horizontal:{},vertical:void 0},Z=M.text;let se,le=[0,0];if(Z){const be=Z.toString(),Oe=h.get("text-letter-spacing").evaluate(M,{},c.canonical)*fn,He=E0(be)?Oe:0,ot=h.get("text-anchor").evaluate(M,{},c.canonical),wt=dE(o,M,c.canonical);if(!wt){const dt=h.get("text-radial-offset").evaluate(M,{},c.canonical);le=dt?hE(ot,[dt*fn,lv]):h.get("text-offset").evaluate(M,{},c.canonical).map(lt=>lt*fn)}let rt=b?"center":h.get("text-justify").evaluate(M,{},c.canonical);const it=h.get("symbol-placement")==="point"?h.get("text-max-width").evaluate(M,{},c.canonical)*fn:1/0,gt=()=>{c.bucket.allowVerticalPlacement&&Kd(be)&&(G.vertical=qm(Z,c.glyphMap,c.glyphPositions,c.imagePositions,B,it,x,ot,"left",He,le,u.ah.vertical,!0,U,O))};if(!b&&wt){const dt=new Set;if(rt==="auto")for(let Ne=0;Ne<wt.values.length;Ne+=2)dt.add(cv(wt.values[Ne]));else dt.add(rt);let lt=!1;for(const Ne of dt)if(!G.horizontal[Ne])if(lt)G.horizontal[Ne]=G.horizontal[0];else{const yt=qm(Z,c.glyphMap,c.glyphPositions,c.imagePositions,B,it,x,"center",Ne,He,le,u.ah.horizontal,!1,U,O);yt&&(G.horizontal[Ne]=yt,lt=yt.positionedLines.length===1)}gt()}else{rt==="auto"&&(rt=cv(ot));const dt=qm(Z,c.glyphMap,c.glyphPositions,c.imagePositions,B,it,x,ot,rt,He,le,u.ah.horizontal,!1,U,O);dt&&(G.horizontal[rt]=dt),gt(),Kd(be)&&b&&A&&(G.vertical=qm(Z,c.glyphMap,c.glyphPositions,c.imagePositions,B,it,x,ot,rt,He,le,u.ah.vertical,!1,U,O))}}let Ee=!1;if(M.icon&&M.icon.name){const be=c.imageMap[M.icon.name];be&&(se=YO(c.imagePositions[M.icon.name],h.get("icon-offset").evaluate(M,{},c.canonical),h.get("icon-anchor").evaluate(M,{},c.canonical)),Ee=!!be.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=Ee:c.bucket.sdfIcons!==Ee&&Pt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(be.pixelRatio!==c.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const _e=pE(G.horizontal)||G.vertical;c.bucket.iconsInText=!!_e&&_e.iconsInText,(_e||se)&&fk(c.bucket,M,G,se,c.imageMap,g,U,j,le,Ee,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},u.bq=X0,u.br=$0,u.bs=W0,u.bt=dl,u.bu=K0,u.bv=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},u.bw=function(c,o,h,f,g){return l(this,void 0,void 0,function*(){if($())try{return yield Et(c,o,h,f,g)}catch{}return function(x,b,A,S,M){const B=x.width,O=x.height;At&&Ft||(At=new OffscreenCanvas(B,O),Ft=At.getContext("2d",{willReadFrequently:!0})),At.width=B,At.height=O,Ft.drawImage(x,0,0,B,O);const U=Ft.getImageData(b,A,S,M);return Ft.clearRect(0,0,B,O),U.data}(c,o,h,f,g)})},u.bx=YT,u.by=_,u.bz=w,u.c=Yn,u.d=c=>l(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const o=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(o)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=Fe,u.f=c=>new Promise((o,h)=>{const f=new Image;f.onload=()=>{o(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=ut})},f.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(c)],{type:"image/png"});f.src=c.byteLength?URL.createObjectURL(g):ut}),u.g=mn,u.h=(c,o)=>pi(Fe(c,{type:"json"}),o),u.i=_i,u.j=hr,u.k=ur,u.l=(c,o)=>pi(Fe(c,{type:"arrayBuffer"}),o),u.m=pi,u.n=function(c){return new K0(c).readFields($O,[])},u.o=sf,u.p=PT,u.q=v,u.r=A0,u.s=$i,u.t=Wd,u.u=ma,u.v=Pe,u.w=Pt,u.x=function([c,o,h]){return o+=90,o*=Math.PI/180,h*=Math.PI/180,{x:c*Math.cos(o)*Math.sin(h),y:c*Math.sin(o)*Math.sin(h),z:c*Math.cos(h)}},u.y=fr,u.z=Ai}),r("worker",["./shared"],function(u){class l{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,z){for(const ne of V){this._layerConfigs[ne.id]=ne;const ge=this._layers[ne.id]=u.aA(ne);ge._featureFilter=u.a7(ge.filter),this.keyCache[ne.id]&&delete this.keyCache[ne.id]}for(const ne of z)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const Y=u.bk(Object.values(this._layerConfigs),this.keyCache);for(const ne of Y){const ge=ne.map(Me=>this._layers[Me.id]),ve=ge[0];if(ve.visibility==="none")continue;const Te=ve.source||"";let he=this.familiesBySource[Te];he||(he=this.familiesBySource[Te]={});const ke=ve.sourceLayer||"_geojsonTileLayer";let Ue=he[ke];Ue||(Ue=he[ke]=[]),Ue.push(ge)}}}class _{constructor(V){const z={},Y=[];for(const Te in V){const he=V[Te],ke=z[Te]={};for(const Ue in he){const Me=he[+Ue];if(!Me||Me.bitmap.width===0||Me.bitmap.height===0)continue;const Xe={x:0,y:0,w:Me.bitmap.width+2,h:Me.bitmap.height+2};Y.push(Xe),ke[Ue]={rect:Xe,metrics:Me.metrics}}}const{w:ne,h:ge}=u.p(Y),ve=new u.o({width:ne||1,height:ge||1});for(const Te in V){const he=V[Te];for(const ke in he){const Ue=he[+ke];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const Me=z[Te][ke].rect;u.o.copy(Ue.bitmap,ve,{x:0,y:0},{x:Me.x+1,y:Me.y+1},Ue.bitmap)}}this.image=ve,this.positions=z}}u.bl("GlyphAtlas",_);class w{constructor(V){this.tileID=new u.S(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[]}parse(V,z,Y,ne){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new u.a5;const ge=new u.bm(Object.keys(V.layers).sort()),ve=new u.bn(this.tileID,this.promoteId);ve.bucketLayerIDs=[];const Te={},he={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Y},ke=z.familiesBySource[this.source];for(const Dt in ke){const qt=V.layers[Dt];if(!qt)continue;qt.version===1&&u.w(`Vector tile source "${this.source}" layer "${Dt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ri=ge.encode(Dt),Ni=[];for(let Qi=0;Qi<qt.length;Qi++){const Sn=qt.feature(Qi),Mo=ve.getId(Sn,Dt);Ni.push({feature:Sn,id:Mo,index:Qi,sourceLayerIndex:ri})}for(const Qi of ke[Dt]){const Sn=Qi[0];Sn.source!==this.source&&u.w(`layer.source = ${Sn.source} does not equal this.source = ${this.source}`),Sn.minzoom&&this.zoom<Math.floor(Sn.minzoom)||Sn.maxzoom&&this.zoom>=Sn.maxzoom||Sn.visibility!=="none"&&(E(Qi,this.zoom,Y),(Te[Sn.id]=Sn.createBucket({index:ve.bucketLayerIDs.length,layers:Qi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ri,sourceID:this.source})).populate(Ni,he,this.tileID.canonical),ve.bucketLayerIDs.push(Qi.map(Mo=>Mo.id)))}}const Ue=u.aF(he.glyphDependencies,Dt=>Object.keys(Dt).map(Number));this.inFlightDependencies.forEach(Dt=>Dt==null?void 0:Dt.abort()),this.inFlightDependencies=[];let Me=Promise.resolve({});if(Object.keys(Ue).length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),Me=ne.sendAsync({type:"GG",data:{stacks:Ue,source:this.source,tileID:this.tileID,type:"glyphs"}},Dt)}const Xe=Object.keys(he.iconDependencies);let _t=Promise.resolve({});if(Xe.length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),_t=ne.sendAsync({type:"GI",data:{icons:Xe,source:this.source,tileID:this.tileID,type:"icons"}},Dt)}const xt=Object.keys(he.patternDependencies);let Wt=Promise.resolve({});if(xt.length){const Dt=new AbortController;this.inFlightDependencies.push(Dt),Wt=ne.sendAsync({type:"GI",data:{icons:xt,source:this.source,tileID:this.tileID,type:"patterns"}},Dt)}const[Bt,Ht,Nt]=yield Promise.all([Me,_t,Wt]),Fi=new _(Bt),yi=new u.bo(Ht,Nt);for(const Dt in Te){const qt=Te[Dt];qt instanceof u.a6?(E(qt.layers,this.zoom,Y),u.bp({bucket:qt,glyphMap:Bt,glyphPositions:Fi.positions,imageMap:Ht,imagePositions:yi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):qt.hasPattern&&(qt instanceof u.bq||qt instanceof u.br||qt instanceof u.bs)&&(E(qt.layers,this.zoom,Y),qt.addFeatures(he,this.tileID.canonical,yi.patternPositions))}return this.status="done",{buckets:Object.values(Te).filter(Dt=>!Dt.isEmpty()),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Fi.image,imageAtlas:yi,glyphMap:this.returnDependencies?Bt:null,iconMap:this.returnDependencies?Ht:null,glyphPositions:this.returnDependencies?Fi.positions:null}})}}function E(ae,V,z){const Y=new u.z(V);for(const ne of ae)ne.recalculate(Y,z)}class I{constructor(V,z,Y){this.actor=V,this.layerIndex=z,this.availableImages=Y,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(V,z){return u._(this,void 0,void 0,function*(){const Y=yield u.l(V.request,z);try{return{vectorTile:new u.bt.VectorTile(new u.bu(Y.data)),rawData:Y.data,cacheControl:Y.cacheControl,expires:Y.expires}}catch(ne){const ge=new Uint8Array(Y.data);let ve=`Unable to parse the tile at ${V.request.url}, `;throw ve+=ge[0]===31&&ge[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ne.message}`,new Error(ve)}})}loadTile(V){return u._(this,void 0,void 0,function*(){const z=V.uid,Y=!!(V&&V.request&&V.request.collectResourceTiming)&&new u.bv(V.request),ne=new w(V);this.loading[z]=ne;const ge=new AbortController;ne.abort=ge;try{const ve=yield this.loadVectorTile(V,ge);if(delete this.loading[z],!ve)return null;const Te=ve.rawData,he={};ve.expires&&(he.expires=ve.expires),ve.cacheControl&&(he.cacheControl=ve.cacheControl);const ke={};if(Y){const Me=Y.finish();Me&&(ke.resourceTiming=JSON.parse(JSON.stringify(Me)))}ne.vectorTile=ve.vectorTile;const Ue=ne.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[z]=ne,this.fetching[z]={rawTileData:Te,cacheControl:he,resourceTiming:ke};try{const Me=yield Ue;return u.e({rawTileData:Te.slice(0)},Me,he,ke)}finally{delete this.fetching[z]}}catch(ve){throw delete this.loading[z],ne.status="done",this.loaded[z]=ne,ve}})}reloadTile(V){return u._(this,void 0,void 0,function*(){const z=V.uid;if(!this.loaded||!this.loaded[z])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Y=this.loaded[z];if(Y.showCollisionBoxes=V.showCollisionBoxes,Y.status==="parsing"){const ne=yield Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor);let ge;if(this.fetching[z]){const{rawTileData:ve,cacheControl:Te,resourceTiming:he}=this.fetching[z];delete this.fetching[z],ge=u.e({rawTileData:ve.slice(0)},ne,Te,he)}else ge=ne;return ge}if(Y.status==="done"&&Y.vectorTile)return Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(V){return u._(this,void 0,void 0,function*(){const z=this.loading,Y=V.uid;z&&z[Y]&&z[Y].abort&&(z[Y].abort.abort(),delete z[Y])})}removeTile(V){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]})}}class R{constructor(){this.loaded={}}loadTile(V){return u._(this,void 0,void 0,function*(){const{uid:z,encoding:Y,rawImageData:ne,redFactor:ge,greenFactor:ve,blueFactor:Te,baseShift:he}=V,ke=ne.width+2,Ue=ne.height+2,Me=u.b(ne)?new u.R({width:ke,height:Ue},yield u.bw(ne,-1,-1,ke,Ue)):ne,Xe=new u.bx(z,Me,Y,ge,ve,Te,he);return this.loaded=this.loaded||{},this.loaded[z]=Xe,Xe})}removeTile(V){const z=this.loaded,Y=V.uid;z&&z[Y]&&delete z[Y]}}function L(ae,V){if(ae.length!==0){W(ae[0],V);for(var z=1;z<ae.length;z++)W(ae[z],!V)}}function W(ae,V){for(var z=0,Y=0,ne=0,ge=ae.length,ve=ge-1;ne<ge;ve=ne++){var Te=(ae[ne][0]-ae[ve][0])*(ae[ve][1]+ae[ne][1]),he=z+Te;Y+=Math.abs(z)>=Math.abs(Te)?z-he+Te:Te-he+z,z=he}z+Y>=0!=!!V&&ae.reverse()}var K=u.by(function ae(V,z){var Y,ne=V&&V.type;if(ne==="FeatureCollection")for(Y=0;Y<V.features.length;Y++)ae(V.features[Y],z);else if(ne==="GeometryCollection")for(Y=0;Y<V.geometries.length;Y++)ae(V.geometries[Y],z);else if(ne==="Feature")ae(V.geometry,z);else if(ne==="Polygon")L(V.coordinates,z);else if(ne==="MultiPolygon")for(Y=0;Y<V.coordinates.length;Y++)L(V.coordinates[Y],z);return V});const fe=u.bt.VectorTileFeature.prototype.toGeoJSON;var X={exports:{}},$=u.bz,Q=u.bt.VectorTileFeature,me=Ce;function Ce(ae,V){this.options=V||{},this.features=ae,this.length=ae.length}function Be(ae,V){this.id=typeof ae.id=="number"?ae.id:void 0,this.type=ae.type,this.rawGeometry=ae.type===1?[ae.geometry]:ae.geometry,this.properties=ae.tags,this.extent=V||4096}Ce.prototype.feature=function(ae){return new Be(this.features[ae],this.options.extent)},Be.prototype.loadGeometry=function(){var ae=this.rawGeometry;this.geometry=[];for(var V=0;V<ae.length;V++){for(var z=ae[V],Y=[],ne=0;ne<z.length;ne++)Y.push(new $(z[ne][0],z[ne][1]));this.geometry.push(Y)}return this.geometry},Be.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ae=this.geometry,V=1/0,z=-1/0,Y=1/0,ne=-1/0,ge=0;ge<ae.length;ge++)for(var ve=ae[ge],Te=0;Te<ve.length;Te++){var he=ve[Te];V=Math.min(V,he.x),z=Math.max(z,he.x),Y=Math.min(Y,he.y),ne=Math.max(ne,he.y)}return[V,Y,z,ne]},Be.prototype.toGeoJSON=Q.prototype.toGeoJSON;var Fe=u.bA,ze=me;function Ve(ae){var V=new Fe;return function(z,Y){for(var ne in z.layers)Y.writeMessage(3,je,z.layers[ne])}(ae,V),V.finish()}function je(ae,V){var z;V.writeVarintField(15,ae.version||1),V.writeStringField(1,ae.name||""),V.writeVarintField(5,ae.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(z=0;z<ae.length;z++)Y.feature=ae.feature(z),V.writeMessage(2,Ke,Y);var ne=Y.keys;for(z=0;z<ne.length;z++)V.writeStringField(3,ne[z]);var ge=Y.values;for(z=0;z<ge.length;z++)V.writeMessage(4,Zn,ge[z])}function Ke(ae,V){var z=ae.feature;z.id!==void 0&&V.writeVarintField(1,z.id),V.writeMessage(2,Lt,ae),V.writeVarintField(3,z.type),V.writeMessage(4,_i,z)}function Lt(ae,V){var z=ae.feature,Y=ae.keys,ne=ae.values,ge=ae.keycache,ve=ae.valuecache;for(var Te in z.properties){var he=z.properties[Te],ke=ge[Te];if(he!==null){ke===void 0&&(Y.push(Te),ge[Te]=ke=Y.length-1),V.writeVarint(ke);var Ue=typeof he;Ue!=="string"&&Ue!=="boolean"&&Ue!=="number"&&(he=JSON.stringify(he));var Me=Ue+":"+he,Xe=ve[Me];Xe===void 0&&(ne.push(he),ve[Me]=Xe=ne.length-1),V.writeVarint(Xe)}}}function Pt(ae,V){return(V<<3)+(7&ae)}function bt(ae){return ae<<1^ae>>31}function _i(ae,V){for(var z=ae.loadGeometry(),Y=ae.type,ne=0,ge=0,ve=z.length,Te=0;Te<ve;Te++){var he=z[Te],ke=1;Y===1&&(ke=he.length),V.writeVarint(Pt(1,ke));for(var Ue=Y===3?he.length-1:he.length,Me=0;Me<Ue;Me++){Me===1&&Y!==1&&V.writeVarint(Pt(2,Ue-1));var Xe=he[Me].x-ne,_t=he[Me].y-ge;V.writeVarint(bt(Xe)),V.writeVarint(bt(_t)),ne+=Xe,ge+=_t}Y===3&&V.writeVarint(Pt(7,1))}}function Zn(ae,V){var z=typeof ae;z==="string"?V.writeStringField(1,ae):z==="boolean"?V.writeBooleanField(7,ae):z==="number"&&(ae%1!=0?V.writeDoubleField(3,ae):ae<0?V.writeSVarintField(6,ae):V.writeVarintField(5,ae))}X.exports=Ve,X.exports.fromVectorTileJs=Ve,X.exports.fromGeojsonVt=function(ae,V){V=V||{};var z={};for(var Y in ae)z[Y]=new ze(ae[Y].features,V),z[Y].name=Y,z[Y].version=V.version,z[Y].extent=V.extent;return Ve({layers:z})},X.exports.GeoJSONWrapper=ze;var sn=u.by(X.exports);const ut={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ae=>ae},Et=Math.fround||(At=new Float32Array(1),ae=>(At[0]=+ae,At[0]));var At;const Ft=3,Ut=5,Yn=6;class Ji{constructor(V){this.options=Object.assign(Object.create(ut),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:z,minZoom:Y,maxZoom:ne}=this.options;z&&console.time("total time");const ge=`prepare ${V.length} points`;z&&console.time(ge),this.points=V;const ve=[];for(let he=0;he<V.length;he++){const ke=V[he];if(!ke.geometry)continue;const[Ue,Me]=ke.geometry.coordinates,Xe=Et(Jt(Ue)),_t=Et(dn(Me));ve.push(Xe,_t,1/0,he,-1,1),this.options.reduce&&ve.push(0)}let Te=this.trees[ne+1]=this._createTree(ve);z&&console.timeEnd(ge);for(let he=ne;he>=Y;he--){const ke=+Date.now();Te=this.trees[he]=this._createTree(this._cluster(Te,he)),z&&console.log("z%d: %d clusters in %dms",he,Te.numItems,+Date.now()-ke)}return z&&console.timeEnd("total time"),this}getClusters(V,z){let Y=((V[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,V[1]));let ge=V[2]===180?180:((V[2]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)Y=-180,ge=180;else if(Y>ge){const Me=this.getClusters([Y,ne,180,ve],z),Xe=this.getClusters([-180,ne,ge,ve],z);return Me.concat(Xe)}const Te=this.trees[this._limitZoom(z)],he=Te.range(Jt(Y),dn(ve),Jt(ge),dn(ne)),ke=Te.data,Ue=[];for(const Me of he){const Xe=this.stride*Me;Ue.push(ke[Xe+Ut]>1?mn(ke,Xe,this.clusterProps):this.points[ke[Xe+Ft]])}return Ue}getChildren(V){const z=this._getOriginId(V),Y=this._getOriginZoom(V),ne="No cluster with the specified id.",ge=this.trees[Y];if(!ge)throw new Error(ne);const ve=ge.data;if(z*this.stride>=ve.length)throw new Error(ne);const Te=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),he=ge.within(ve[z*this.stride],ve[z*this.stride+1],Te),ke=[];for(const Ue of he){const Me=Ue*this.stride;ve[Me+4]===V&&ke.push(ve[Me+Ut]>1?mn(ve,Me,this.clusterProps):this.points[ve[Me+Ft]])}if(ke.length===0)throw new Error(ne);return ke}getLeaves(V,z,Y){const ne=[];return this._appendLeaves(ne,V,z=z||10,Y=Y||0,0),ne}getTile(V,z,Y){const ne=this.trees[this._limitZoom(V)],ge=Math.pow(2,V),{extent:ve,radius:Te}=this.options,he=Te/ve,ke=(Y-he)/ge,Ue=(Y+1+he)/ge,Me={features:[]};return this._addTileFeatures(ne.range((z-he)/ge,ke,(z+1+he)/ge,Ue),ne.data,z,Y,ge,Me),z===0&&this._addTileFeatures(ne.range(1-he/ge,ke,1,Ue),ne.data,ge,Y,ge,Me),z===ge-1&&this._addTileFeatures(ne.range(0,ke,he/ge,Ue),ne.data,-1,Y,ge,Me),Me.features.length?Me:null}getClusterExpansionZoom(V){let z=this._getOriginZoom(V)-1;for(;z<=this.options.maxZoom;){const Y=this.getChildren(V);if(z++,Y.length!==1)break;V=Y[0].properties.cluster_id}return z}_appendLeaves(V,z,Y,ne,ge){const ve=this.getChildren(z);for(const Te of ve){const he=Te.properties;if(he&&he.cluster?ge+he.point_count<=ne?ge+=he.point_count:ge=this._appendLeaves(V,he.cluster_id,Y,ne,ge):ge<ne?ge++:V.push(Te),V.length===Y)break}return ge}_createTree(V){const z=new u.av(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Y=0;Y<V.length;Y+=this.stride)z.add(V[Y],V[Y+1]);return z.finish(),z.data=V,z}_addTileFeatures(V,z,Y,ne,ge,ve){for(const Te of V){const he=Te*this.stride,ke=z[he+Ut]>1;let Ue,Me,Xe;if(ke)Ue=On(z,he,this.clusterProps),Me=z[he],Xe=z[he+1];else{const Wt=this.points[z[he+Ft]];Ue=Wt.properties;const[Bt,Ht]=Wt.geometry.coordinates;Me=Jt(Bt),Xe=dn(Ht)}const _t={type:1,geometry:[[Math.round(this.options.extent*(Me*ge-Y)),Math.round(this.options.extent*(Xe*ge-ne))]],tags:Ue};let xt;xt=ke||this.options.generateId?z[he+Ft]:this.points[z[he+Ft]].id,xt!==void 0&&(_t.id=xt),ve.features.push(_t)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,z){const{radius:Y,extent:ne,reduce:ge,minPoints:ve}=this.options,Te=Y/(ne*Math.pow(2,z)),he=V.data,ke=[],Ue=this.stride;for(let Me=0;Me<he.length;Me+=Ue){if(he[Me+2]<=z)continue;he[Me+2]=z;const Xe=he[Me],_t=he[Me+1],xt=V.within(he[Me],he[Me+1],Te),Wt=he[Me+Ut];let Bt=Wt;for(const Ht of xt){const Nt=Ht*Ue;he[Nt+2]>z&&(Bt+=he[Nt+Ut])}if(Bt>Wt&&Bt>=ve){let Ht,Nt=Xe*Wt,Fi=_t*Wt,yi=-1;const Dt=((Me/Ue|0)<<5)+(z+1)+this.points.length;for(const qt of xt){const ri=qt*Ue;if(he[ri+2]<=z)continue;he[ri+2]=z;const Ni=he[ri+Ut];Nt+=he[ri]*Ni,Fi+=he[ri+1]*Ni,he[ri+4]=Dt,ge&&(Ht||(Ht=this._map(he,Me,!0),yi=this.clusterProps.length,this.clusterProps.push(Ht)),ge(Ht,this._map(he,ri)))}he[Me+4]=Dt,ke.push(Nt/Bt,Fi/Bt,1/0,Dt,-1,Bt),ge&&ke.push(yi)}else{for(let Ht=0;Ht<Ue;Ht++)ke.push(he[Me+Ht]);if(Bt>1)for(const Ht of xt){const Nt=Ht*Ue;if(!(he[Nt+2]<=z)){he[Nt+2]=z;for(let Fi=0;Fi<Ue;Fi++)ke.push(he[Nt+Fi])}}}}return ke}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,z,Y){if(V[z+Ut]>1){const ve=this.clusterProps[V[z+Yn]];return Y?Object.assign({},ve):ve}const ne=this.points[V[z+Ft]].properties,ge=this.options.map(ne);return Y&&ge===ne?Object.assign({},ge):ge}}function mn(ae,V,z){return{type:"Feature",id:ae[V+Ft],properties:On(ae,V,z),geometry:{type:"Point",coordinates:[(Y=ae[V],360*(Y-.5)),pi(ae[V+1])]}};var Y}function On(ae,V,z){const Y=ae[V+Ut],ne=Y>=1e4?`${Math.round(Y/1e3)}k`:Y>=1e3?Math.round(Y/100)/10+"k":Y,ge=ae[V+Yn],ve=ge===-1?{}:Object.assign({},z[ge]);return Object.assign(ve,{cluster:!0,cluster_id:ae[V+Ft],point_count:Y,point_count_abbreviated:ne})}function Jt(ae){return ae/360+.5}function dn(ae){const V=Math.sin(ae*Math.PI/180),z=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return z<0?0:z>1?1:z}function pi(ae){const V=(180-360*ae)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function $i(ae,V,z,Y){let ne=Y;const ge=V+(z-V>>1);let ve,Te=z-V;const he=ae[V],ke=ae[V+1],Ue=ae[z],Me=ae[z+1];for(let Xe=V+3;Xe<z;Xe+=3){const _t=Bs(ae[Xe],ae[Xe+1],he,ke,Ue,Me);if(_t>ne)ve=Xe,ne=_t;else if(_t===ne){const xt=Math.abs(Xe-ge);xt<Te&&(ve=Xe,Te=xt)}}ne>Y&&(ve-V>3&&$i(ae,V,ve,Y),ae[ve+2]=ne,z-ve>3&&$i(ae,ve,z,Y))}function Bs(ae,V,z,Y,ne,ge){let ve=ne-z,Te=ge-Y;if(ve!==0||Te!==0){const he=((ae-z)*ve+(V-Y)*Te)/(ve*ve+Te*Te);he>1?(z=ne,Y=ge):he>0&&(z+=ve*he,Y+=Te*he)}return ve=ae-z,Te=V-Y,ve*ve+Te*Te}function Jn(ae,V,z,Y){const ne={id:ae??null,type:V,geometry:z,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")ur(ne,z);else if(V==="Polygon")ur(ne,z[0]);else if(V==="MultiLineString")for(const ge of z)ur(ne,ge);else if(V==="MultiPolygon")for(const ge of z)ur(ne,ge[0]);return ne}function ur(ae,V){for(let z=0;z<V.length;z+=3)ae.minX=Math.min(ae.minX,V[z]),ae.minY=Math.min(ae.minY,V[z+1]),ae.maxX=Math.max(ae.maxX,V[z]),ae.maxY=Math.max(ae.maxY,V[z+1])}function hr(ae,V,z,Y){if(!V.geometry)return;const ne=V.geometry.coordinates;if(ne&&ne.length===0)return;const ge=V.geometry.type,ve=Math.pow(z.tolerance/((1<<z.maxZoom)*z.extent),2);let Te=[],he=V.id;if(z.promoteId?he=V.properties[z.promoteId]:z.generateId&&(he=Y||0),ge==="Point")jr(ne,Te);else if(ge==="MultiPoint")for(const ke of ne)jr(ke,Te);else if(ge==="LineString")Pe(ne,Te,ve,!1);else if(ge==="MultiLineString"){if(z.lineMetrics){for(const ke of ne)Te=[],Pe(ke,Te,ve,!1),ae.push(Jn(he,"LineString",Te,V.properties));return}Qn(ne,Te,ve,!1)}else if(ge==="Polygon")Qn(ne,Te,ve,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(const ke of V.geometry.geometries)hr(ae,{id:he,geometry:ke,properties:V.properties},z,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ke of ne){const Ue=[];Qn(ke,Ue,ve,!0),Te.push(Ue)}}ae.push(Jn(he,ge,Te,V.properties))}function jr(ae,V){V.push(Io(ae[0]),Xt(ae[1]),0)}function Pe(ae,V,z,Y){let ne,ge,ve=0;for(let he=0;he<ae.length;he++){const ke=Io(ae[he][0]),Ue=Xt(ae[he][1]);V.push(ke,Ue,0),he>0&&(ve+=Y?(ne*Ue-ke*ge)/2:Math.sqrt(Math.pow(ke-ne,2)+Math.pow(Ue-ge,2))),ne=ke,ge=Ue}const Te=V.length-3;V[2]=1,$i(V,0,Te,z),V[Te+2]=1,V.size=Math.abs(ve),V.start=0,V.end=V.size}function Qn(ae,V,z,Y){for(let ne=0;ne<ae.length;ne++){const ge=[];Pe(ae[ne],ge,z,Y),V.push(ge)}}function Io(ae){return ae/360+.5}function Xt(ae){const V=Math.sin(ae*Math.PI/180),z=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return z<0?0:z>1?1:z}function mi(ae,V,z,Y,ne,ge,ve,Te){if(Y/=V,ge>=(z/=V)&&ve<Y)return ae;if(ve<z||ge>=Y)return null;const he=[];for(const ke of ae){const Ue=ke.geometry;let Me=ke.type;const Xe=ne===0?ke.minX:ke.minY,_t=ne===0?ke.maxX:ke.maxY;if(Xe>=z&&_t<Y){he.push(ke);continue}if(_t<z||Xe>=Y)continue;let xt=[];if(Me==="Point"||Me==="MultiPoint")gn(Ue,xt,z,Y,ne);else if(Me==="LineString")Ds(Ue,xt,z,Y,ne,!1,Te.lineMetrics);else if(Me==="MultiLineString")Ro(Ue,xt,z,Y,ne,!1);else if(Me==="Polygon")Ro(Ue,xt,z,Y,ne,!0);else if(Me==="MultiPolygon")for(const Wt of Ue){const Bt=[];Ro(Wt,Bt,z,Y,ne,!0),Bt.length&&xt.push(Bt)}if(xt.length){if(Te.lineMetrics&&Me==="LineString"){for(const Wt of xt)he.push(Jn(ke.id,Me,Wt,ke.tags));continue}Me!=="LineString"&&Me!=="MultiLineString"||(xt.length===1?(Me="LineString",xt=xt[0]):Me="MultiLineString"),Me!=="Point"&&Me!=="MultiPoint"||(Me=xt.length===3?"Point":"MultiPoint"),he.push(Jn(ke.id,Me,xt,ke.tags))}}return he.length?he:null}function gn(ae,V,z,Y,ne){for(let ge=0;ge<ae.length;ge+=3){const ve=ae[ge+ne];ve>=z&&ve<=Y&&dr(V,ae[ge],ae[ge+1],ae[ge+2])}}function Ds(ae,V,z,Y,ne,ge,ve){let Te=ls(ae);const he=ne===0?ra:Po;let ke,Ue,Me=ae.start;for(let Bt=0;Bt<ae.length-3;Bt+=3){const Ht=ae[Bt],Nt=ae[Bt+1],Fi=ae[Bt+2],yi=ae[Bt+3],Dt=ae[Bt+4],qt=ne===0?Ht:Nt,ri=ne===0?yi:Dt;let Ni=!1;ve&&(ke=Math.sqrt(Math.pow(Ht-yi,2)+Math.pow(Nt-Dt,2))),qt<z?ri>z&&(Ue=he(Te,Ht,Nt,yi,Dt,z),ve&&(Te.start=Me+ke*Ue)):qt>Y?ri<Y&&(Ue=he(Te,Ht,Nt,yi,Dt,Y),ve&&(Te.start=Me+ke*Ue)):dr(Te,Ht,Nt,Fi),ri<z&&qt>=z&&(Ue=he(Te,Ht,Nt,yi,Dt,z),Ni=!0),ri>Y&&qt<=Y&&(Ue=he(Te,Ht,Nt,yi,Dt,Y),Ni=!0),!ge&&Ni&&(ve&&(Te.end=Me+ke*Ue),V.push(Te),Te=ls(ae)),ve&&(Me+=ke)}let Xe=ae.length-3;const _t=ae[Xe],xt=ae[Xe+1],Wt=ne===0?_t:xt;Wt>=z&&Wt<=Y&&dr(Te,_t,xt,ae[Xe+2]),Xe=Te.length-3,ge&&Xe>=3&&(Te[Xe]!==Te[0]||Te[Xe+1]!==Te[1])&&dr(Te,Te[0],Te[1],Te[2]),Te.length&&V.push(Te)}function ls(ae){const V=[];return V.size=ae.size,V.start=ae.start,V.end=ae.end,V}function Ro(ae,V,z,Y,ne,ge){for(const ve of ae)Ds(ve,V,z,Y,ne,ge,!1)}function dr(ae,V,z,Y){ae.push(V,z,Y)}function ra(ae,V,z,Y,ne,ge){const ve=(ge-V)/(Y-V);return dr(ae,ge,z+(ne-z)*ve,1),ve}function Po(ae,V,z,Y,ne,ge){const ve=(ge-z)/(ne-z);return dr(ae,V+(Y-V)*ve,ge,1),ve}function We(ae,V){const z=[];for(let Y=0;Y<ae.length;Y++){const ne=ae[Y],ge=ne.type;let ve;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")ve=Pr(ne.geometry,V);else if(ge==="MultiLineString"||ge==="Polygon"){ve=[];for(const Te of ne.geometry)ve.push(Pr(Te,V))}else if(ge==="MultiPolygon"){ve=[];for(const Te of ne.geometry){const he=[];for(const ke of Te)he.push(Pr(ke,V));ve.push(he)}}z.push(Jn(ne.id,ge,ve,ne.tags))}return z}function Pr(ae,V){const z=[];z.size=ae.size,ae.start!==void 0&&(z.start=ae.start,z.end=ae.end);for(let Y=0;Y<ae.length;Y+=3)z.push(ae[Y]+V,ae[Y+1],ae[Y+2]);return z}function _n(ae,V){if(ae.transformed)return ae;const z=1<<ae.z,Y=ae.x,ne=ae.y;for(const ge of ae.features){const ve=ge.geometry,Te=ge.type;if(ge.geometry=[],Te===1)for(let he=0;he<ve.length;he+=2)ge.geometry.push(er(ve[he],ve[he+1],V,z,Y,ne));else for(let he=0;he<ve.length;he++){const ke=[];for(let Ue=0;Ue<ve[he].length;Ue+=2)ke.push(er(ve[he][Ue],ve[he][Ue+1],V,z,Y,ne));ge.geometry.push(ke)}}return ae.transformed=!0,ae}function er(ae,V,z,Y,ne,ge){return[Math.round(z*(ae*Y-ne)),Math.round(z*(V*Y-ge))]}function Hr(ae,V,z,Y,ne){const ge=V===ne.maxZoom?0:ne.tolerance/((1<<V)*ne.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:ae.length,source:null,x:z,y:Y,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Te of ae)Qe(ve,Te,ge,ne);return ve}function Qe(ae,V,z,Y){const ne=V.geometry,ge=V.type,ve=[];if(ae.minX=Math.min(ae.minX,V.minX),ae.minY=Math.min(ae.minY,V.minY),ae.maxX=Math.max(ae.maxX,V.maxX),ae.maxY=Math.max(ae.maxY,V.maxY),ge==="Point"||ge==="MultiPoint")for(let Te=0;Te<ne.length;Te+=3)ve.push(ne[Te],ne[Te+1]),ae.numPoints++,ae.numSimplified++;else if(ge==="LineString")Ot(ve,ne,ae,z,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(let Te=0;Te<ne.length;Te++)Ot(ve,ne[Te],ae,z,ge==="Polygon",Te===0);else if(ge==="MultiPolygon")for(let Te=0;Te<ne.length;Te++){const he=ne[Te];for(let ke=0;ke<he.length;ke++)Ot(ve,he[ke],ae,z,!0,ke===0)}if(ve.length){let Te=V.tags||null;if(ge==="LineString"&&Y.lineMetrics){Te={};for(const ke in V.tags)Te[ke]=V.tags[ke];Te.mapbox_clip_start=ne.start/ne.size,Te.mapbox_clip_end=ne.end/ne.size}const he={geometry:ve,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:Te};V.id!==null&&(he.id=V.id),ae.features.push(he)}}function Ot(ae,V,z,Y,ne,ge){const ve=Y*Y;if(Y>0&&V.size<(ne?ve:Y))return void(z.numPoints+=V.length/3);const Te=[];for(let he=0;he<V.length;he+=3)(Y===0||V[he+2]>ve)&&(z.numSimplified++,Te.push(V[he],V[he+1])),z.numPoints++;ne&&function(he,ke){let Ue=0;for(let Me=0,Xe=he.length,_t=Xe-2;Me<Xe;_t=Me,Me+=2)Ue+=(he[Me]-he[_t])*(he[Me+1]+he[_t+1]);if(Ue>0===ke)for(let Me=0,Xe=he.length;Me<Xe/2;Me+=2){const _t=he[Me],xt=he[Me+1];he[Me]=he[Xe-2-Me],he[Me+1]=he[Xe-1-Me],he[Xe-2-Me]=_t,he[Xe-1-Me]=xt}}(Te,ge),ae.push(Te)}const St={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class kn{constructor(V,z){const Y=(z=this.options=function(ge,ve){for(const Te in ve)ge[Te]=ve[Te];return ge}(Object.create(St),z)).debug;if(Y&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");let ne=function(ge,ve){const Te=[];if(ge.type==="FeatureCollection")for(let he=0;he<ge.features.length;he++)hr(Te,ge.features[he],ve,he);else hr(Te,ge.type==="Feature"?ge:{geometry:ge},ve);return Te}(V,z);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ne=function(ge,ve){const Te=ve.buffer/ve.extent;let he=ge;const ke=mi(ge,1,-1-Te,Te,0,-1,2,ve),Ue=mi(ge,1,1-Te,2+Te,0,-1,2,ve);return(ke||Ue)&&(he=mi(ge,1,-Te,1+Te,0,-1,2,ve)||[],ke&&(he=We(ke,1).concat(he)),Ue&&(he=he.concat(We(Ue,-1)))),he}(ne,z),ne.length&&this.splitTile(ne,0,0,0),Y&&(ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,z,Y,ne,ge,ve,Te){const he=[V,z,Y,ne],ke=this.options,Ue=ke.debug;for(;he.length;){ne=he.pop(),Y=he.pop(),z=he.pop(),V=he.pop();const Me=1<<z,Xe=Mr(z,Y,ne);let _t=this.tiles[Xe];if(!_t&&(Ue>1&&console.time("creation"),_t=this.tiles[Xe]=Hr(V,z,Y,ne,ke),this.tileCoords.push({z,x:Y,y:ne}),Ue)){Ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,Y,ne,_t.numFeatures,_t.numPoints,_t.numSimplified),console.timeEnd("creation"));const Ni=`z${z}`;this.stats[Ni]=(this.stats[Ni]||0)+1,this.total++}if(_t.source=V,ge==null){if(z===ke.indexMaxZoom||_t.numPoints<=ke.indexMaxPoints)continue}else{if(z===ke.maxZoom||z===ge)continue;if(ge!=null){const Ni=ge-z;if(Y!==ve>>Ni||ne!==Te>>Ni)continue}}if(_t.source=null,V.length===0)continue;Ue>1&&console.time("clipping");const xt=.5*ke.buffer/ke.extent,Wt=.5-xt,Bt=.5+xt,Ht=1+xt;let Nt=null,Fi=null,yi=null,Dt=null,qt=mi(V,Me,Y-xt,Y+Bt,0,_t.minX,_t.maxX,ke),ri=mi(V,Me,Y+Wt,Y+Ht,0,_t.minX,_t.maxX,ke);V=null,qt&&(Nt=mi(qt,Me,ne-xt,ne+Bt,1,_t.minY,_t.maxY,ke),Fi=mi(qt,Me,ne+Wt,ne+Ht,1,_t.minY,_t.maxY,ke),qt=null),ri&&(yi=mi(ri,Me,ne-xt,ne+Bt,1,_t.minY,_t.maxY,ke),Dt=mi(ri,Me,ne+Wt,ne+Ht,1,_t.minY,_t.maxY,ke),ri=null),Ue>1&&console.timeEnd("clipping"),he.push(Nt||[],z+1,2*Y,2*ne),he.push(Fi||[],z+1,2*Y,2*ne+1),he.push(yi||[],z+1,2*Y+1,2*ne),he.push(Dt||[],z+1,2*Y+1,2*ne+1)}}getTile(V,z,Y){V=+V,z=+z,Y=+Y;const ne=this.options,{extent:ge,debug:ve}=ne;if(V<0||V>24)return null;const Te=1<<V,he=Mr(V,z=z+Te&Te-1,Y);if(this.tiles[he])return _n(this.tiles[he],ge);ve>1&&console.log("drilling down to z%d-%d-%d",V,z,Y);let ke,Ue=V,Me=z,Xe=Y;for(;!ke&&Ue>0;)Ue--,Me>>=1,Xe>>=1,ke=this.tiles[Mr(Ue,Me,Xe)];return ke&&ke.source?(ve>1&&(console.log("found parent tile z%d-%d-%d",Ue,Me,Xe),console.time("drilling down")),this.splitTile(ke.source,Ue,Me,Xe,V,z,Y),ve>1&&console.timeEnd("drilling down"),this.tiles[he]?_n(this.tiles[he],ge):null):null}}function Mr(ae,V,z){return 32*((1<<ae)*z+V)+ae}function Ct(ae,V){return V?ae.properties[V]:ae.id}function $r(ae,V){if(ae==null)return!0;if(ae.type==="Feature")return Ct(ae,V)!=null;if(ae.type==="FeatureCollection"){const z=new Set;for(const Y of ae.features){const ne=Ct(Y,V);if(ne==null||z.has(ne))return!1;z.add(ne)}return!0}return!1}function cs(ae,V){const z=new Map;if(ae!=null)if(ae.type==="Feature")z.set(Ct(ae,V),ae);else for(const Y of ae.features)z.set(Ct(Y,V),Y);return z}class us extends I{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(V,z){return u._(this,void 0,void 0,function*(){const Y=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ne=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!ne)return null;const ge=new class{constructor(Te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.X,this.length=Te.length,this._features=Te}feature(Te){return new class{constructor(he){this._feature=he,this.extent=u.X,this.type=he.type,this.properties=he.tags,"id"in he&&!isNaN(he.id)&&(this.id=parseInt(he.id,10))}loadGeometry(){if(this._feature.type===1){const he=[];for(const ke of this._feature.geometry)he.push([new u.P(ke[0],ke[1])]);return he}{const he=[];for(const ke of this._feature.geometry){const Ue=[];for(const Me of ke)Ue.push(new u.P(Me[0],Me[1]));he.push(Ue)}return he}}toGeoJSON(he,ke,Ue){return fe.call(this,he,ke,Ue)}}(this._features[Te])}}(ne.features);let ve=sn(ge);return ve.byteOffset===0&&ve.byteLength===ve.buffer.byteLength||(ve=new Uint8Array(ve)),{vectorTile:ge,rawData:ve.buffer}})}loadData(V){return u._(this,void 0,void 0,function*(){var z;(z=this._pendingRequest)===null||z===void 0||z.abort();const Y=!!(V&&V.request&&V.request.collectResourceTiming)&&new u.bv(V.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(V,this._pendingRequest),this._geoJSONIndex=V.cluster?new Ji(function({superclusterOptions:ve,clusterProperties:Te}){if(!Te||!ve)return ve;const he={},ke={},Ue={accumulated:null,zoom:0},Me={properties:null},Xe=Object.keys(Te);for(const _t of Xe){const[xt,Wt]=Te[_t],Bt=u.bC(Wt),Ht=u.bC(typeof xt=="string"?[xt,["accumulated"],["get",_t]]:xt);he[_t]=Bt.value,ke[_t]=Ht.value}return ve.map=_t=>{Me.properties=_t;const xt={};for(const Wt of Xe)xt[Wt]=he[Wt].evaluate(Ue,Me);return xt},ve.reduce=(_t,xt)=>{Me.properties=xt;for(const Wt of Xe)Ue.accumulated=_t[Wt],_t[Wt]=ke[Wt].evaluate(Ue,Me)},ve}(V)).load((yield this._pendingData).features):(ne=yield this._pendingData,new kn(ne,V.geojsonVtOptions)),this.loaded={};const ge={};if(Y){const ve=Y.finish();ve&&(ge.resourceTiming={},ge.resourceTiming[V.source]=JSON.parse(JSON.stringify(ve)))}return ge}catch(ge){if(delete this._pendingRequest,u.bB(ge))return{abandoned:!0};throw ge}var ne})}getData(){return u._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(V){const z=this.loaded;return z&&z[V.uid]?super.reloadTile(V):this.loadTile(V)}loadAndProcessGeoJSON(V,z){return u._(this,void 0,void 0,function*(){let Y=yield this.loadGeoJSON(V,z);if(delete this._pendingRequest,typeof Y!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(K(Y,!0),V.filter){const ne=u.bC(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ne.result==="error")throw new Error(ne.value.map(ve=>`${ve.key}: ${ve.message}`).join(", "));Y={type:"FeatureCollection",features:Y.features.filter(ve=>ne.value.evaluate({zoom:0},ve))}}return Y})}loadGeoJSON(V,z){return u._(this,void 0,void 0,function*(){const{promoteId:Y}=V;if(V.request){const ne=yield u.h(V.request,z);return this._dataUpdateable=$r(ne.data,Y)?cs(ne.data,Y):void 0,ne.data}if(typeof V.data=="string")try{const ne=JSON.parse(V.data);return this._dataUpdateable=$r(ne,Y)?cs(ne,Y):void 0,ne}catch{throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`)}if(!V.dataDiff)throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${V.source}`);return function(ne,ge,ve){var Te,he,ke,Ue;if(ge.removeAll&&ne.clear(),ge.remove)for(const Me of ge.remove)ne.delete(Me);if(ge.add)for(const Me of ge.add){const Xe=Ct(Me,ve);Xe!=null&&ne.set(Xe,Me)}if(ge.update)for(const Me of ge.update){let Xe=ne.get(Me.id);if(Xe==null)continue;const _t=!Me.removeAllProperties&&(((Te=Me.removeProperties)===null||Te===void 0?void 0:Te.length)>0||((he=Me.addOrUpdateProperties)===null||he===void 0?void 0:he.length)>0);if((Me.newGeometry||Me.removeAllProperties||_t)&&(Xe=Object.assign({},Xe),ne.set(Me.id,Xe),_t&&(Xe.properties=Object.assign({},Xe.properties))),Me.newGeometry&&(Xe.geometry=Me.newGeometry),Me.removeAllProperties)Xe.properties={};else if(((ke=Me.removeProperties)===null||ke===void 0?void 0:ke.length)>0)for(const xt of Me.removeProperties)Object.prototype.hasOwnProperty.call(Xe.properties,xt)&&delete Xe.properties[xt];if(((Ue=Me.addOrUpdateProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const{key:xt,value:Wt}of Me.addOrUpdateProperties)Xe.properties[xt]=Wt}}(this._dataUpdateable,V.dataDiff,Y),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(V){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}class Br{constructor(V){this.self=V,this.actor=new u.F(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(z,Y)=>{if(this.externalWorkerSourceTypes[z])throw new Error(`Worker source with name "${z}" already registered.`);this.externalWorkerSourceTypes[z]=Y},this.self.addProtocol=u.bi,this.self.removeProtocol=u.bj,this.self.registerRTLTextPlugin=z=>{if(u.bD.isParsed())throw new Error("RTL text plugin already registered.");u.bD.setMethods(z)},this.actor.registerMessageHandler("LDT",(z,Y)=>this._getDEMWorkerSource(z,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RDT",(z,Y)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(z,Y.source).removeTile(Y)})),this.actor.registerMessageHandler("GCEZ",(z,Y)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(z,Y.type,Y.source).getClusterExpansionZoom(Y)})),this.actor.registerMessageHandler("GCC",(z,Y)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(z,Y.type,Y.source).getClusterChildren(Y)})),this.actor.registerMessageHandler("GCL",(z,Y)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(z,Y.type,Y.source).getClusterLeaves(Y)})),this.actor.registerMessageHandler("LD",(z,Y)=>this._getWorkerSource(z,Y.type,Y.source).loadData(Y)),this.actor.registerMessageHandler("GD",(z,Y)=>this._getWorkerSource(z,Y.type,Y.source).getData()),this.actor.registerMessageHandler("LT",(z,Y)=>this._getWorkerSource(z,Y.type,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RT",(z,Y)=>this._getWorkerSource(z,Y.type,Y.source).reloadTile(Y)),this.actor.registerMessageHandler("AT",(z,Y)=>this._getWorkerSource(z,Y.type,Y.source).abortTile(Y)),this.actor.registerMessageHandler("RMT",(z,Y)=>this._getWorkerSource(z,Y.type,Y.source).removeTile(Y)),this.actor.registerMessageHandler("RS",(z,Y)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[z]||!this.workerSources[z][Y.type]||!this.workerSources[z][Y.type][Y.source])return;const ne=this.workerSources[z][Y.type][Y.source];delete this.workerSources[z][Y.type][Y.source],ne.removeSource!==void 0&&ne.removeSource(Y)})),this.actor.registerMessageHandler("RM",z=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[z],delete this.availableImages[z],delete this.workerSources[z],delete this.demWorkerSources[z]})),this.actor.registerMessageHandler("SR",(z,Y)=>u._(this,void 0,void 0,function*(){this.referrer=Y})),this.actor.registerMessageHandler("SRPS",(z,Y)=>this._syncRTLPluginState(z,Y)),this.actor.registerMessageHandler("IS",(z,Y)=>u._(this,void 0,void 0,function*(){this.self.importScripts(Y)})),this.actor.registerMessageHandler("SI",(z,Y)=>this._setImages(z,Y)),this.actor.registerMessageHandler("UL",(z,Y)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(z).update(Y.layers,Y.removedIds)})),this.actor.registerMessageHandler("SL",(z,Y)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(z).replace(Y)}))}_setImages(V,z){return u._(this,void 0,void 0,function*(){this.availableImages[V]=z;for(const Y in this.workerSources[V]){const ne=this.workerSources[V][Y];for(const ge in ne)ne[ge].availableImages=z}})}_syncRTLPluginState(V,z){return u._(this,void 0,void 0,function*(){if(u.bD.isParsed())return u.bD.getState();if(z.pluginStatus!=="loading")return u.bD.setState(z),z;const Y=z.pluginURL;if(this.self.importScripts(Y),u.bD.isParsed()){const ne={pluginStatus:"loaded",pluginURL:Y};return u.bD.setState(ne),ne}throw u.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${Y}`)})}_getAvailableImages(V){let z=this.availableImages[V];return z||(z=[]),z}_getLayerIndex(V){let z=this.layerIndexes[V];return z||(z=this.layerIndexes[V]=new l),z}_getWorkerSource(V,z,Y){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][z]||(this.workerSources[V][z]={}),!this.workerSources[V][z][Y]){const ne={sendAsync:(ge,ve)=>(ge.targetMapId=V,this.actor.sendAsync(ge,ve))};switch(z){case"vector":this.workerSources[V][z][Y]=new I(ne,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][z][Y]=new us(ne,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][z][Y]=new this.externalWorkerSourceTypes[z](ne,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][z][Y]}_getDEMWorkerSource(V,z){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][z]||(this.demWorkerSources[V][z]=new R),this.demWorkerSources[V][z]}}return u.i(self)&&(self.worker=new Br(self)),Br}),r("index",["exports","./shared"],function(u,l){var _="4.7.1";let w,E;const I={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:v=>new Promise((s,d)=>{const p=requestAnimationFrame(s);v.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),d(l.c())})}),getImageData(v,s=0){return this.getImageCanvasContext(v).getImageData(-s,-s,v.width+2*s,v.height+2*s)},getImageCanvasContext(v){const s=window.document.createElement("canvas"),d=s.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return s.width=v.width,s.height=v.height,d.drawImage(v,0,0,v.width,v.height),d},resolveURL:v=>(w||(w=document.createElement("a")),w.href=v,w.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(E==null&&(E=matchMedia("(prefers-reduced-motion: reduce)")),E.matches)}};class R{static testProp(s){if(!R.docStyle)return s[0];for(let d=0;d<s.length;d++)if(s[d]in R.docStyle)return s[d];return s[0]}static create(s,d,p){const m=window.document.createElement(s);return d!==void 0&&(m.className=d),p&&p.appendChild(m),m}static createNS(s,d){return window.document.createElementNS(s,d)}static disableDrag(){R.docStyle&&R.selectProp&&(R.userSelect=R.docStyle[R.selectProp],R.docStyle[R.selectProp]="none")}static enableDrag(){R.docStyle&&R.selectProp&&(R.docStyle[R.selectProp]=R.userSelect)}static setTransform(s,d){s.style[R.transformProp]=d}static addEventListener(s,d,p,m={}){s.addEventListener(d,p,"passive"in m?m:m.capture)}static removeEventListener(s,d,p,m={}){s.removeEventListener(d,p,"passive"in m?m:m.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",R.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",R.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",R.suppressClickInternal,!0)},0)}static getScale(s){const d=s.getBoundingClientRect();return{x:d.width/s.offsetWidth||1,y:d.height/s.offsetHeight||1,boundingClientRect:d}}static getPoint(s,d,p){const m=d.boundingClientRect;return new l.P((p.clientX-m.left)/d.x-s.clientLeft,(p.clientY-m.top)/d.y-s.clientTop)}static mousePos(s,d){const p=R.getScale(s);return R.getPoint(s,p,d)}static touchPos(s,d){const p=[],m=R.getScale(s);for(let y=0;y<d.length;y++)p.push(R.getPoint(s,m,d[y]));return p}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}R.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,R.selectProp=R.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),R.transformProp=R.testProp(["transform","WebkitTransform"]);const L={supported:!1,testSupport:function(v){!fe&&K&&(X?$(v):W=v)}};let W,K,fe=!1,X=!1;function $(v){const s=v.createTexture();v.bindTexture(v.TEXTURE_2D,s);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,K),v.isContextLost())return;L.supported=!0}catch{}v.deleteTexture(s),fe=!0}var Q;typeof document<"u"&&(K=document.createElement("img"),K.onload=()=>{W&&$(W),W=null,X=!0},K.onerror=()=>{fe=!0,W=null},K.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let s,d,p,m;v.resetRequestQueue=()=>{s=[],d=0,p=0,m={}},v.addThrottleControl=P=>{const D=p++;return m[D]=P,D},v.removeThrottleControl=P=>{delete m[P],T()},v.getImage=(P,D,F=!0)=>new Promise((N,H)=>{L.supported&&(P.headers||(P.headers={}),P.headers.accept="image/webp,*/*"),l.e(P,{type:"image"}),s.push({abortController:D,requestParameters:P,supportImageRefresh:F,state:"queued",onError:J=>{H(J)},onSuccess:J=>{N(J)}}),T()});const y=P=>l._(this,void 0,void 0,function*(){P.state="running";const{requestParameters:D,supportImageRefresh:F,onError:N,onSuccess:H,abortController:J}=P,te=F===!1&&!l.i(self)&&!l.g(D.url)&&(!D.headers||Object.keys(D.headers).reduce((ue,pe)=>ue&&pe==="accept",!0));d++;const oe=te?C(D,J):l.m(D,J);try{const ue=yield oe;delete P.abortController,P.state="completed",ue.data instanceof HTMLImageElement||l.b(ue.data)?H(ue):ue.data&&H({data:yield(ce=ue.data,typeof createImageBitmap=="function"?l.d(ce):l.f(ce)),cacheControl:ue.cacheControl,expires:ue.expires})}catch(ue){delete P.abortController,N(ue)}finally{d--,T()}var ce}),T=()=>{const P=(()=>{for(const D of Object.keys(m))if(m[D]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=d;D<P&&s.length>0;D++){const F=s.shift();F.abortController.signal.aborted?D--:y(F)}},C=(P,D)=>new Promise((F,N)=>{const H=new Image,J=P.url,te=P.credentials;te&&te==="include"?H.crossOrigin="use-credentials":(te&&te==="same-origin"||!l.s(J))&&(H.crossOrigin="anonymous"),D.signal.addEventListener("abort",()=>{H.src="",N(l.c())}),H.fetchPriority="high",H.onload=()=>{H.onerror=H.onload=null,F({data:H})},H.onerror=()=>{H.onerror=H.onload=null,D.signal.aborted||N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},H.src=J})}(Q||(Q={})),Q.resetRequestQueue();class me{constructor(s){this._transformRequestFn=s}transformRequest(s,d){return this._transformRequestFn&&this._transformRequestFn(s,d)||{url:s}}setTransformRequest(s){this._transformRequestFn=s}}function Ce(v){var s=new l.A(3);return s[0]=v[0],s[1]=v[1],s[2]=v[2],s}var Be,Fe=function(v,s,d){return v[0]=s[0]-d[0],v[1]=s[1]-d[1],v[2]=s[2]-d[2],v};Be=new l.A(3),l.A!=Float32Array&&(Be[0]=0,Be[1]=0,Be[2]=0);var ze=function(v){var s=v[0],d=v[1];return s*s+d*d};function Ve(v){const s=[];if(typeof v=="string")s.push({id:"default",url:v});else if(v&&v.length>0){const d=[];for(const{id:p,url:m}of v){const y=`${p}${m}`;d.indexOf(y)===-1&&(d.push(y),s.push({id:p,url:m}))}}return s}function je(v,s,d){const p=v.split("?");return p[0]+=`${s}${d}`,p.join("?")}(function(){var v=new l.A(2);l.A!=Float32Array&&(v[0]=0,v[1]=0)})();class Ke{constructor(s,d,p,m){this.context=s,this.format=p,this.texture=s.gl.createTexture(),this.update(d,m)}update(s,d,p){const{width:m,height:y}=s,T=!(this.size&&this.size[0]===m&&this.size[1]===y||p),{context:C}=this,{gl:P}=C;if(this.useMipmap=!!(d&&d.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!d||d.premultiply!==!1)),T)this.size=[m,y],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.b(s)?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,s):P.texImage2D(P.TEXTURE_2D,0,this.format,m,y,0,this.format,P.UNSIGNED_BYTE,s.data);else{const{x:D,y:F}=p||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.b(s)?P.texSubImage2D(P.TEXTURE_2D,0,D,F,P.RGBA,P.UNSIGNED_BYTE,s):P.texSubImage2D(P.TEXTURE_2D,0,D,F,m,y,P.RGBA,P.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)}bind(s,d,p){const{context:m}=this,{gl:y}=m;y.bindTexture(y.TEXTURE_2D,this.texture),p!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=y.LINEAR),s!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,s),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,p||s),this.filter=s),d!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,d),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function Lt(v){const{userImage:s}=v;return!!(s&&s.render&&s.render())&&(v.data.replace(new Uint8Array(s.data.buffer)),!0)}class Pt extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:d,promiseResolve:p}of this.requestors)p(this._getImagesForIds(d));this.requestors=[]}}getImage(s){const d=this.images[s];if(d&&!d.data&&d.spriteData){const p=d.spriteData;d.data=new l.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),d.spriteData=null}return d}addImage(s,d){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,d)&&(this.images[s]=d)}_validate(s,d){let p=!0;const m=d.data||d.spriteData;return this._validateStretch(d.stretchX,m&&m.width)||(this.fire(new l.j(new Error(`Image "${s}" has invalid "stretchX" value`))),p=!1),this._validateStretch(d.stretchY,m&&m.height)||(this.fire(new l.j(new Error(`Image "${s}" has invalid "stretchY" value`))),p=!1),this._validateContent(d.content,d)||(this.fire(new l.j(new Error(`Image "${s}" has invalid "content" value`))),p=!1),p}_validateStretch(s,d){if(!s)return!0;let p=0;for(const m of s){if(m[0]<p||m[1]<m[0]||d<m[1])return!1;p=m[1]}return!0}_validateContent(s,d){if(!s)return!0;if(s.length!==4)return!1;const p=d.spriteData,m=p&&p.width||d.data.width,y=p&&p.height||d.data.height;return!(s[0]<0||m<s[0]||s[1]<0||y<s[1]||s[2]<0||m<s[2]||s[3]<0||y<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,d,p=!0){const m=this.getImage(s);if(p&&(m.data.width!==d.data.width||m.data.height!==d.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=m.version+1,this.images[s]=d,this.updatedImages[s]=!0}removeImage(s){const d=this.images[s];delete this.images[s],delete this.patterns[s],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise((d,p)=>{let m=!0;if(!this.isLoaded())for(const y of s)this.images[y]||(m=!1);this.isLoaded()||m?d(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:d})})}_getImagesForIds(s){const d={};for(const p of s){let m=this.getImage(p);m||(this.fire(new l.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?d[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:l.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:s,height:d}=this.atlasImage;return{width:s,height:d}}getPattern(s){const d=this.patterns[s],p=this.getImage(s);if(!p)return null;if(d&&d.position.version===p.version)return d.position;if(d)d.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},y=new l.I(m,p);this.patterns[s]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const d=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ke(s,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const y in this.patterns)s.push(this.patterns[y].bin);const{w:d,h:p}=l.p(s),m=this.atlasImage;m.resize({width:d||1,height:p||1});for(const y in this.patterns){const{bin:T}=this.patterns[y],C=T.x+1,P=T.y+1,D=this.getImage(y).data,F=D.width,N=D.height;l.R.copy(D,m,{x:0,y:0},{x:C,y:P},{width:F,height:N}),l.R.copy(D,m,{x:0,y:N-1},{x:C,y:P-1},{width:F,height:1}),l.R.copy(D,m,{x:0,y:0},{x:C,y:P+N},{width:F,height:1}),l.R.copy(D,m,{x:F-1,y:0},{x:C-1,y:P},{width:1,height:N}),l.R.copy(D,m,{x:0,y:0},{x:C+F,y:P},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const d of s){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const p=this.getImage(d);p||l.w(`Image with ID: "${d}" was not found`),Lt(p)&&this.updateImage(d,p)}}}const bt=1e20;function _i(v,s,d,p,m,y,T,C,P){for(let D=s;D<s+p;D++)Zn(v,d*y+D,y,m,T,C,P);for(let D=d;D<d+m;D++)Zn(v,D*y+s,1,p,T,C,P)}function Zn(v,s,d,p,m,y,T){y[0]=0,T[0]=-bt,T[1]=bt,m[0]=v[s];for(let C=1,P=0,D=0;C<p;C++){m[C]=v[s+C*d];const F=C*C;do{const N=y[P];D=(m[C]-m[N]+F-N*N)/(C-N)/2}while(D<=T[P]&&--P>-1);P++,y[P]=C,T[P]=D,T[P+1]=bt}for(let C=0,P=0;C<p;C++){for(;T[P+1]<C;)P++;const D=y[P],F=C-D;v[s+C*d]=m[D]+F*F}}class sn{constructor(s,d){this.requestManager=s,this.localIdeographFontFamily=d,this.entries={}}setURL(s){this.url=s}getGlyphs(s){return l._(this,void 0,void 0,function*(){const d=[];for(const y in s)for(const T of s[y])d.push(this._getAndCacheGlyphsPromise(y,T));const p=yield Promise.all(d),m={};for(const{stack:y,id:T,glyph:C}of p)m[y]||(m[y]={}),m[y][T]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return m})}_getAndCacheGlyphsPromise(s,d){return l._(this,void 0,void 0,function*(){let p=this.entries[s];p||(p=this.entries[s]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[d];if(m!==void 0)return{stack:s,id:d,glyph:m};if(m=this._tinySDF(p,s,d),m)return p.glyphs[d]=m,{stack:s,id:d,glyph:m};const y=Math.floor(d/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[y])return{stack:s,id:d,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[y]){const C=sn.loadGlyphRange(s,y,this.url,this.requestManager);p.requests[y]=C}const T=yield p.requests[y];for(const C in T)this._doesCharSupportLocalGlyph(+C)||(p.glyphs[+C]=T[+C]);return p.ranges[y]=!0,{stack:s,id:d,glyph:T[d]||null}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(s))}_tinySDF(s,d,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let y=s.tinySDF;if(!y){let C="400";/bold/i.test(d)?C="900":/medium/i.test(d)?C="500":/light/i.test(d)&&(C="200"),y=s.tinySDF=new sn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:C})}const T=y.draw(String.fromCharCode(p));return{id:p,bitmap:new l.o({width:T.width||60,height:T.height||60},T.data),metrics:{width:T.glyphWidth/2||24,height:T.glyphHeight/2||24,left:T.glyphLeft/2+.5||0,top:T.glyphTop/2-27.5||-8,advance:T.glyphAdvance/2||24,isDoubleResolution:!0}}}}sn.loadGlyphRange=function(v,s,d,p){return l._(this,void 0,void 0,function*(){const m=256*s,y=m+255,T=p.transformRequest(d.replace("{fontstack}",v).replace("{range}",`${m}-${y}`),"Glyphs"),C=yield l.l(T,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${s}, ${m}-${y}`);const P={};for(const D of l.n(C.data))P[D.id]=D;return P})},sn.TinySDF=class{constructor({fontSize:v=24,buffer:s=3,radius:d=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:T="normal"}={}){this.buffer=s,this.cutoff=p,this.radius=d;const C=this.size=v+4*s,P=this._createCanvas(C),D=this.ctx=P.getContext("2d",{willReadFrequently:!0});D.font=`${T} ${y} ${v}px ${m}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(v){const s=document.createElement("canvas");return s.width=s.height=v,s}draw(v){const{width:s,actualBoundingBoxAscent:d,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(v),T=Math.ceil(d),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-m))),P=Math.min(this.size-this.buffer,T+Math.ceil(p)),D=C+2*this.buffer,F=P+2*this.buffer,N=Math.max(D*F,0),H=new Uint8ClampedArray(N),J={data:H,width:D,height:F,glyphWidth:C,glyphHeight:P,glyphTop:T,glyphLeft:0,glyphAdvance:s};if(C===0||P===0)return J;const{ctx:te,buffer:oe,gridInner:ce,gridOuter:ue}=this;te.clearRect(oe,oe,C,P),te.fillText(v,oe,oe+T);const pe=te.getImageData(oe,oe,C,P);ue.fill(bt,0,N),ce.fill(0,0,N);for(let re=0;re<P;re++)for(let ye=0;ye<C;ye++){const xe=pe.data[4*(re*C+ye)+3]/255;if(xe===0)continue;const Se=(re+oe)*D+ye+oe;if(xe===1)ue[Se]=0,ce[Se]=bt;else{const Le=.5-xe;ue[Se]=Le>0?Le*Le:0,ce[Se]=Le<0?Le*Le:0}}_i(ue,0,0,D,F,D,this.f,this.v,this.z),_i(ce,oe,oe,C,P,D,this.f,this.v,this.z);for(let re=0;re<N;re++){const ye=Math.sqrt(ue[re])-Math.sqrt(ce[re]);H[re]=Math.round(255-255*(ye/this.radius+this.cutoff))}return J}};class ut{constructor(){this.specification=l.v.light.position}possiblyEvaluate(s,d){return l.x(s.expression.evaluate(d))}interpolate(s,d,p){return{x:l.y.number(s.x,d.x,p),y:l.y.number(s.y,d.y,p),z:l.y.number(s.z,d.z,p)}}}let Et;class At extends l.E{constructor(s){super(),Et=Et||new l.q({anchor:new l.D(l.v.light.anchor),position:new ut,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Et),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,d={}){if(!this._validate(l.r,s,d))for(const p in s){const m=s[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,d,p){return(!p||p.validate!==!1)&&l.t(this,s.call(l.u,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const Ft=new l.q({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class Ut extends l.E{constructor(s){super(),this._transitionable=new l.T(Ft),this.setSky(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.z(0))}setSky(s,d={}){if(!this._validate(l.B,s,d)){s||(s={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const p in s){const m=s[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,d,p={}){return(p==null?void 0:p.validate)!==!1&&l.t(this,s.call(l.u,l.e({value:d,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(s){return s<60?0:s<70?(s-60)/10:1}}class Yn{constructor(s,d){this.width=s,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,d){const p=s.join(",")+String(d);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(s,d)),this.dashEntry[p]}getDashRanges(s,d,p){const m=[];let y=s.length%2==1?-s[s.length-1]*p:0,T=s[0]*p,C=!0;m.push({left:y,right:T,isDash:C,zeroLength:s[0]===0});let P=s[0];for(let D=1;D<s.length;D++){C=!C;const F=s[D];y=P*p,P+=F,T=P*p,m.push({left:y,right:T,isDash:C,zeroLength:F===0})}return m}addRoundDash(s,d,p){const m=d/2;for(let y=-p;y<=p;y++){const T=this.width*(this.nextRow+p+y);let C=0,P=s[C];for(let D=0;D<this.width;D++){D/P.right>1&&(P=s[++C]);const F=Math.abs(D-P.left),N=Math.abs(D-P.right),H=Math.min(F,N);let J;const te=y/p*(m+1);if(P.isDash){const oe=m-Math.abs(te);J=Math.sqrt(H*H+oe*oe)}else J=m-Math.sqrt(H*H+te*te);this.data[T+D]=Math.max(0,Math.min(255,J+128))}}}addRegularDash(s){for(let C=s.length-1;C>=0;--C){const P=s[C],D=s[C+1];P.zeroLength?s.splice(C,1):D&&D.isDash===P.isDash&&(D.left=P.left,s.splice(C,1))}const d=s[0],p=s[s.length-1];d.isDash===p.isDash&&(d.left=p.left-this.width,p.right=d.right+this.width);const m=this.width*this.nextRow;let y=0,T=s[y];for(let C=0;C<this.width;C++){C/T.right>1&&(T=s[++y]);const P=Math.abs(C-T.left),D=Math.abs(C-T.right),F=Math.min(P,D);this.data[m+C]=Math.max(0,Math.min(255,(T.isDash?F:-F)+128))}}addDash(s,d){const p=d?7:0,m=2*p+1;if(this.nextRow+m>this.height)return l.w("LineAtlas out of space"),null;let y=0;for(let C=0;C<s.length;C++)y+=s[C];if(y!==0){const C=this.width/y,P=this.getDashRanges(s,this.width,C);d?this.addRoundDash(P,C,p):this.addRegularDash(P)}const T={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:y};return this.nextRow+=m,this.dirty=!0,T}bind(s){const d=s.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const Ji="maplibre_preloaded_worker_pool";class mn{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<mn.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ji]}numActive(){return Object.keys(this.active).length}}const On=Math.floor(I.hardwareConcurrency/2);let Jt,dn;function pi(){return Jt||(Jt=new mn),Jt}mn.workerCount=l.C(globalThis)?Math.max(Math.min(On,3),1):1;class $i{constructor(s,d){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=d;const p=this.workerPool.acquire(d);for(let m=0;m<p.length;m++){const y=new l.F(p[m],d);y.name=`Worker ${m}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,d){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:s,data:d}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(d=>{d.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,d){for(const p of this.actors)p.registerMessageHandler(s,d)}}function Bs(){return dn||(dn=new $i(pi(),l.G),dn.registerMessageHandler("GR",(v,s,d)=>l.m(s,d))),dn}function Jn(v,s){const d=l.H();return l.J(d,d,[1,1,0]),l.K(d,d,[.5*v.width,.5*v.height,1]),l.L(d,d,v.calculatePosMatrix(s.toUnwrapped()))}function ur(v,s,d,p,m,y){const T=function(N,H,J){if(N)for(const te of N){const oe=H[te];if(oe&&oe.source===J&&oe.type==="fill-extrusion")return!0}else for(const te in H){const oe=H[te];if(oe.source===J&&oe.type==="fill-extrusion")return!0}return!1}(m&&m.layers,s,v.id),C=y.maxPitchScaleFactor(),P=v.tilesIn(p,C,T);P.sort(hr);const D=[];for(const N of P)D.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(s,d,v._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,m,y,C,Jn(v.transform,N.tileID))});const F=function(N){const H={},J={};for(const te of N){const oe=te.queryResults,ce=te.wrappedTileID,ue=J[ce]=J[ce]||{};for(const pe in oe){const re=oe[pe],ye=ue[pe]=ue[pe]||{},xe=H[pe]=H[pe]||[];for(const Se of re)ye[Se.featureIndex]||(ye[Se.featureIndex]=!0,xe.push(Se))}}return H}(D);for(const N in F)F[N].forEach(H=>{const J=H.feature,te=v.getFeatureState(J.layer["source-layer"],J.id);J.source=J.layer.source,J.layer["source-layer"]&&(J.sourceLayer=J.layer["source-layer"]),J.state=te});return F}function hr(v,s){const d=v.tileID,p=s.tileID;return d.overscaledZ-p.overscaledZ||d.canonical.y-p.canonical.y||d.wrap-p.wrap||d.canonical.x-p.canonical.x}function jr(v,s,d){return l._(this,void 0,void 0,function*(){let p=v;if(v.url?p=(yield l.h(s.transformRequest(v.url,"Source"),d)).data:yield I.frameAsync(d),!p)return null;const m=l.M(l.e(p,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(y=>y.id)),m})}class Pe{constructor(s,d){s&&(d?this.setSouthWest(s).setNorthEast(d):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof l.N?new l.N(s.lng,s.lat):l.N.convert(s),this}setSouthWest(s){return this._sw=s instanceof l.N?new l.N(s.lng,s.lat):l.N.convert(s),this}extend(s){const d=this._sw,p=this._ne;let m,y;if(s instanceof l.N)m=s,y=s;else{if(!(s instanceof Pe))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Pe.convert(s)):this.extend(l.N.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(l.N.convert(s)):this;if(m=s._sw,y=s._ne,!m||!y)return this}return d||p?(d.lng=Math.min(m.lng,d.lng),d.lat=Math.min(m.lat,d.lat),p.lng=Math.max(y.lng,p.lng),p.lat=Math.max(y.lat,p.lat)):(this._sw=new l.N(m.lng,m.lat),this._ne=new l.N(y.lng,y.lat)),this}getCenter(){return new l.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.N(this.getWest(),this.getNorth())}getSouthEast(){return new l.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:d,lat:p}=l.N.convert(s);let m=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(s){return s instanceof Pe?s:s&&new Pe(s)}static fromLngLat(s,d=0){const p=360*d/40075017,m=p/Math.cos(Math.PI/180*s.lat);return new Pe(new l.N(s.lng-m,s.lat-p),new l.N(s.lng+m,s.lat+p))}adjustAntiMeridian(){const s=new l.N(this._sw.lng,this._sw.lat),d=new l.N(this._ne.lng,this._ne.lat);return new Pe(s,s.lng>d.lng?new l.N(d.lng+360,d.lat):d)}}class Qn{constructor(s,d,p){this.bounds=Pe.convert(this.validateBounds(s)),this.minzoom=d||0,this.maxzoom=p||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const d=Math.pow(2,s.z),p=Math.floor(l.O(this.bounds.getWest())*d),m=Math.floor(l.Q(this.bounds.getNorth())*d),y=Math.ceil(l.O(this.bounds.getEast())*d),T=Math.ceil(l.Q(this.bounds.getSouth())*d);return s.x>=p&&s.x<y&&s.y>=m&&s.y<T}}class Io extends l.E{constructor(s,d,p,m){if(super(),this.id=s,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.M(d,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield jr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s&&(l.e(this,s),s.bounds&&(this.tileBounds=new Qn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new l.j(s))}})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(s){return l._(this,void 0,void 0,function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(d,"Tile"),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise((y,T)=>{s.reloadPromise={resolve:y,reject:T}})}else s.actor=this.dispatcher.getActor(),m="LT";s.abortController=new AbortController;try{const y=yield s.actor.sendAsync({type:m,data:p},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,y)}catch(y){if(delete s.abortController,s.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(s,null)}})}_afterTileLoadWorkerResponse(s,d){if(d&&d.resourceTiming&&(s.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&s.setExpiryData(d),s.loadVectorData(d,this.map.painter),s.reloadPromise){const p=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(p.resolve).catch(p.reject)}}abortTile(s){return l._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"AT",data:{uid:s.uid,type:this.type,source:this.id}}))})}unloadTile(s){return l._(this,void 0,void 0,function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Xt extends l.E{constructor(s,d,p,m){super(),this.id=s,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},d),l.e(this,l.M(d,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield jr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(l.e(this,s),s.bounds&&(this.tileBounds=new Qn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new l.j(s))}})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}serialize(){return l.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return l._(this,void 0,void 0,function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{const p=yield Q.getImage(this.map._requestManager.transformRequest(d,"Tile"),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&s.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,y=m.gl,T=p.data;s.texture=this.map.painter.getTileTexture(T.width),s.texture?s.texture.update(T,{useMipmap:!0}):(s.texture=new Ke(m,T,y.RGBA,{useMipmap:!0}),s.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),s.state="loaded"}}catch(p){if(delete s.abortController,s.aborted)s.state="unloaded";else if(p)throw s.state="errored",p}})}abortTile(s){return l._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)})}unloadTile(s){return l._(this,void 0,void 0,function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)})}hasTransition(){return!1}}class mi extends Xt{constructor(s,d,p,m){super(s,d,p,m),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(s){return l._(this,void 0,void 0,function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(d,"Tile");s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{const m=yield Q.getImage(p,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(m&&m.data){const y=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&s.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const T=l.b(y)&&l.U()?y:yield this.readImageNow(y),C={type:this.type,uid:s.uid,source:this.id,rawImageData:T,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();const P=yield s.actor.sendAsync({type:"LDT",data:C});s.dem=P,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(m){if(delete s.abortController,s.aborted)s.state="unloaded";else if(m)throw s.state="errored",m}})}readImageNow(s){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.V()){const d=s.width+2,p=s.height+2;try{return new l.R({width:d,height:p},yield l.W(s,-1,-1,d,p))}catch{}}return I.getImageData(s,1)})}_getNeighboringTiles(s){const d=s.canonical,p=Math.pow(2,d.z),m=(d.x-1+p)%p,y=d.x===0?s.wrap-1:s.wrap,T=(d.x+1+p)%p,C=d.x+1===p?s.wrap+1:s.wrap,P={};return P[new l.S(s.overscaledZ,y,d.z,m,d.y).key]={backfilled:!1},P[new l.S(s.overscaledZ,C,d.z,T,d.y).key]={backfilled:!1},d.y>0&&(P[new l.S(s.overscaledZ,y,d.z,m,d.y-1).key]={backfilled:!1},P[new l.S(s.overscaledZ,s.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},P[new l.S(s.overscaledZ,C,d.z,T,d.y-1).key]={backfilled:!1}),d.y+1<p&&(P[new l.S(s.overscaledZ,y,d.z,m,d.y+1).key]={backfilled:!1},P[new l.S(s.overscaledZ,s.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},P[new l.S(s.overscaledZ,C,d.z,T,d.y+1).key]={backfilled:!1}),P}unloadTile(s){return l._(this,void 0,void 0,function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"RDT",data:{type:this.type,uid:s.uid,source:this.id}}))})}}class gn extends l.E{constructor(s,d,p,m){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=d.data,this._options=l.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const y=l.X/this.tileSize;d.clusterMaxZoom!==void 0&&this.maxzoom<=d.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${d.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*y,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*y,extent:l.X,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:l.X,radius:(d.clusterRadius||50)*y,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}getData(){return l._(this,void 0,void 0,function*(){const s=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:s})})}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,d,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:s,limit:d,offset:p}})}_updateWorkerData(s){return l._(this,void 0,void 0,function*(){const d=l.e({type:this.type},this.workerOptions);s?d.dataDiff=s:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(I.resolveURL(this._data),"Source"),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:d});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&l.e(y,{resourceTiming:m}),this.fire(new l.k("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(s){return l._(this,void 0,void 0,function*(){const d=s.actor?"RT":"LT";s.actor=this.actor;const p={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.abortController=new AbortController;const m=yield this.actor.sendAsync({type:d,data:p},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(m,this.map.painter,d==="RT")})}abortTile(s){return l._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0})}unloadTile(s){return l._(this,void 0,void 0,function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ds=l.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ls extends l.E{constructor(s,d,p,m){super(),this.id=s,this.dispatcher=p,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=d}load(s){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield Q.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,s&&(this.coordinates=s),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,this.fire(new l.j(d))}})}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;const d=s.map(l.Z.fromLngLat);this.tileID=function(m){let y=1/0,T=1/0,C=-1/0,P=-1/0;for(const H of m)y=Math.min(y,H.x),T=Math.min(T,H.y),C=Math.max(C,H.x),P=Math.max(P,H.y);const D=Math.max(C-y,P-T),F=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),N=Math.pow(2,F);return new l.a1(F,Math.floor((y+C)/2*N),Math.floor((T+P)/2*N))}(d),this.minzoom=this.maxzoom=this.tileID.z;const p=d.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new l.$,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,l.X,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,l.X),this._boundsArray.emplaceBack(p[2].x,p[2].y,l.X,l.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,d=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Ds.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ke(s,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,p=!0)}p&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ro extends ls{constructor(s,d,p,m){super(s,d,p,m),this.roundZoom=!0,this.type="video",this.options=d}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const s=this.options;this.urls=[];for(const d of s.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield l.a3(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new l.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const d=this.video.seekable;s<d.start(0)||s>d.end(0)?this.fire(new l.j(new l.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,d=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Ds.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new Ke(s,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,p=!0)}p&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class dr extends ls{constructor(s,d,p,m){super(s,d,p,m),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(T=>typeof T!="number"))||this.fire(new l.j(new l.a2(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a2(`sources.${s}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new l.j(new l.a2(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a2(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a2(`sources.${s}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,p=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Ds.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ke(d,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const y in this.tiles){const T=this.tiles[y];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const ra={},Po=v=>{switch(v){case"geojson":return gn;case"image":return ls;case"raster":return Xt;case"raster-dem":return mi;case"vector":return Io;case"video":return Ro;case"canvas":return dr}return ra[v]},We="RTLPluginLoaded";class Pr extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Bs()}_syncState(s){return this.status=s,this.dispatcher.broadcast("SRPS",{pluginStatus:s,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return l._(this,arguments,void 0,function*(d,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=I.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(We))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let _n=null;function er(){return _n||(_n=new Pr),_n}class Hr{constructor(s,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=l.a4(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const d=s+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,d,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(m,y){const T={};if(!y)return T;for(const C of m){const P=C.layerIds.map(D=>y.getLayer(D)).filter(Boolean);if(P.length!==0){C.layers=P,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(D=>P.filter(F=>F.id===D)[0]));for(const D of P)T[D.id]=C}}return T}(s.buckets,d.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof l.a6){if(this.hasSymbolBuckets=!0,!p)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof l.a6&&y.hasRTLText){this.hasRTLText=!0,er().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(m).queryRadius(y))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new l.a5}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(s)}const d=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ke(s,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ke(s,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,d,p,m,y,T,C,P,D,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:y,scale:T,tileSize:this.tileSize,pixelPosMatrix:F,transform:P,params:C,queryPadding:this.queryPadding*D},s,d,p):{}}querySourceFeatures(s,d){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),y=d&&d.sourceLayer?d.sourceLayer:"",T=m._geojsonTileLayer||m[y];if(!T)return;const C=l.a7(d&&d.filter),{z:P,x:D,y:F}=this.tileID.canonical,N={z:P,x:D,y:F};for(let H=0;H<T.length;H++){const J=T.feature(H);if(C.needGeometry){const ce=l.a8(J,!0);if(!C.filter(new l.z(this.tileID.overscaledZ),ce,this.tileID.canonical))continue}else if(!C.filter(new l.z(this.tileID.overscaledZ),J))continue;const te=p.getId(J,y),oe=new l.a9(J,P,D,F,te);oe.tile=N,s.push(oe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const d=this.expirationTime;if(s.cacheControl){const p=l.aa(s.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(d)if(this.expirationTime<d)m=!0;else{const y=this.expirationTime-d;y?this.expirationTime=p+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!d.style.hasLayer(m))continue;const y=this.buckets[m],T=y.layers[0].sourceLayer||"_geojsonTileLayer",C=p[T],P=s[T];if(!C||!P||Object.keys(P).length===0)continue;y.update(P,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=d&&d.style&&d.style.getLayer(m);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<I.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=I.now()+s}setDependencies(s,d){const p={};for(const m of d)p[m]=!0;this.dependencies[s]=p}hasDependency(s,d){for(const p of s){const m=this.dependencies[p];if(m){for(const y of d)if(m[y])return!0}}return!1}}class Qe{constructor(s,d){this.max=s,this.onRemove=d,this.reset()}reset(){for(const s in this.data)for(const d of this.data[s])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(s,d,p){const m=s.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:d,timeout:void 0};if(p!==void 0&&(y.timeout=setTimeout(()=>{this.remove(s,y)},p)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const d=this.data[s].shift();return d.timeout&&clearTimeout(d.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),d.value}getByKey(s){const d=this.data[s];return d?d[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,d){if(!this.has(s))return this;const p=s.wrapped().key,m=d===void 0?0:this.data[p].indexOf(d),y=this.data[p][m];return this.data[p].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(y.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(s){const d=[];for(const p in this.data)for(const m of this.data[p])s(m.value)||d.push(m);for(const p of d)this.remove(p.value.tileID,p)}}class Ot{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,d,p){const m=String(d);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][m]=this.stateChanges[s][m]||{},l.e(this.stateChanges[s][m],p),this.deletedStates[s]===null){this.deletedStates[s]={};for(const y in this.state[s])y!==m&&(this.deletedStates[s][y]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][m]===null){this.deletedStates[s][m]={};for(const y in this.state[s][m])p[y]||(this.deletedStates[s][m][y]=null)}else for(const y in p)this.deletedStates[s]&&this.deletedStates[s][m]&&this.deletedStates[s][m][y]===null&&delete this.deletedStates[s][m][y]}removeFeatureState(s,d,p){if(this.deletedStates[s]===null)return;const m=String(d);if(this.deletedStates[s]=this.deletedStates[s]||{},p&&d!==void 0)this.deletedStates[s][m]!==null&&(this.deletedStates[s][m]=this.deletedStates[s][m]||{},this.deletedStates[s][m][p]=null);else if(d!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][m])for(p in this.deletedStates[s][m]={},this.stateChanges[s][m])this.deletedStates[s][m][p]=null;else this.deletedStates[s][m]=null;else this.deletedStates[s]=null}getState(s,d){const p=String(d),m=l.e({},(this.state[s]||{})[p],(this.stateChanges[s]||{})[p]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const y=this.deletedStates[s][d];if(y===null)return{};for(const T in y)delete m[T]}return m}initializeTileState(s,d){s.setFeatureState(this.state,d)}coalesceChanges(s,d){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const T in this.stateChanges[m])this.state[m][T]||(this.state[m][T]={}),l.e(this.state[m][T],this.stateChanges[m][T]),y[T]=this.state[m][T];p[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(this.deletedStates[m]===null)for(const T in this.state[m])y[T]={},this.state[m][T]={};else for(const T in this.deletedStates[m]){if(this.deletedStates[m][T]===null)this.state[m][T]={};else for(const C of Object.keys(this.deletedStates[m][T]))delete this.state[m][T][C];y[T]=this.state[m][T]}p[m]=p[m]||{},l.e(p[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in s)s[m].setFeatureState(p,d)}}class St extends l.E{constructor(s,d,p){super(),this.id=s,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,y,T,C)=>{const P=new(Po(y.type))(m,y,T,C);if(P.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${P.id}`);return P})(s,d,p,this),this._tiles={},this._cache=new Qe(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ot,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const d=this._tiles[s];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,d,p){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,d,p)}catch(m){s.state="errored",m.status!==404?this._source.fire(new l.j(m,{tile:s})):this.update(this.transform,this.terrain)}})}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new l.k("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const p=this._tiles[d];p.upload(s),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(kn).map(s=>s.key)}getRenderableIds(s){const d=[];for(const p in this._tiles)this._isIdRenderable(p,s)&&d.push(this._tiles[p]);return s?d.sort((p,m)=>{const y=p.tileID,T=m.tileID,C=new l.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),P=new l.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-T.overscaledZ||P.y-C.y||P.x-C.x}).map(p=>p.tileID.key):d.map(p=>p.tileID).sort(kn).map(p=>p.key)}hasRenderableParent(s){const d=this.findLoadedParent(s,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(s,d){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(d||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,d){return l._(this,void 0,void 0,function*(){const p=this._tiles[s];p&&(p.state!=="loading"&&(p.state=d),yield this._loadTile(p,s,d))})}_tileLoaded(s,d,p){s.timeAdded=I.now(),p==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(d,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const d=this.getRenderableIds();for(let m=0;m<d.length;m++){const y=d[m];if(s.neighboringTiles&&s.neighboringTiles[y]){const T=this.getTileByID(y);p(s,T),p(T,s)}}function p(m,y){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let T=y.tileID.canonical.x-m.tileID.canonical.x;const C=y.tileID.canonical.y-m.tileID.canonical.y,P=Math.pow(2,m.tileID.canonical.z),D=y.tileID.key;T===0&&C===0||Math.abs(C)>1||(Math.abs(T)>1&&(Math.abs(T+P)===1?T+=P:Math.abs(T-P)===1&&(T-=P)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,T,C),m.neighboringTiles&&m.neighboringTiles[D]&&(m.neighboringTiles[D].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,d,p,m){for(const y in this._tiles){let T=this._tiles[y];if(m[y]||!T.hasData()||T.tileID.overscaledZ<=d||T.tileID.overscaledZ>p)continue;let C=T.tileID;for(;T&&T.tileID.overscaledZ>d+1;){const D=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[D.key],T&&T.hasData()&&(C=D)}let P=C;for(;P.overscaledZ>d;)if(P=P.scaledTo(P.overscaledZ-1),s[P.key]){m[C.key]=C;break}}}findLoadedParent(s,d){if(s.key in this._loadedParentTiles){const p=this._loadedParentTiles[s.key];return p&&p.tileID.overscaledZ>=d?p:null}for(let p=s.overscaledZ-1;p>=d;p--){const m=s.scaledTo(p),y=this._getLoadedTile(m);if(y)return y}}findLoadedSibling(s){return this._getLoadedTile(s)}_getLoadedTile(s){const d=this._tiles[s.key];return d&&d.hasData()?d:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const d=Math.ceil(s.width/this._source.tileSize)+1,p=Math.ceil(s.height/this._source.tileSize)+1,m=Math.floor(d*p*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(s){const d=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,d){const p={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+d),p[y.tileID.key]=y}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(s,d,p,m,y,T){const C={},P={},D=Object.keys(s),F=I.now();for(const N of D){const H=s[N],J=this._tiles[N];if(!J||J.fadeEndTime!==0&&J.fadeEndTime<=F)continue;const te=this.findLoadedParent(H,d),oe=this.findLoadedSibling(H),ce=te||oe||null;ce&&(this._addTile(ce.tileID),C[ce.tileID.key]=ce.tileID),P[N]=H}this._retainLoadedChildren(P,m,p,s);for(const N in C)s[N]||(this._coveredTiles[N]=!0,s[N]=C[N]);if(T){const N={},H={};for(const J of y)this._tiles[J.key].hasData()?N[J.key]=J:H[J.key]=J;for(const J in H){const te=H[J].children(this._source.maxzoom);this._tiles[te[0].key]&&this._tiles[te[1].key]&&this._tiles[te[2].key]&&this._tiles[te[3].key]&&(N[te[0].key]=s[te[0].key]=te[0],N[te[1].key]=s[te[1].key]=te[1],N[te[2].key]=s[te[2].key]=te[2],N[te[3].key]=s[te[3].key]=te[3],delete H[J])}for(const J in H){const te=H[J],oe=this.findLoadedParent(te,this._source.minzoom),ce=this.findLoadedSibling(te),ue=oe||ce||null;if(ue){N[ue.tileID.key]=s[ue.tileID.key]=ue.tileID;for(const pe in N)N[pe].isChildOf(ue.tileID)&&delete N[pe]}}for(const J in this._tiles)N[J]||(this._coveredTiles[J]=!0)}}update(s,d){if(!this._sourceLoaded||this._paused)return;let p;this.transform=s,this.terrain=d,this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new l.S(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(p=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(p=p.filter(F=>this._source.hasTile(F)))):p=[];const m=s.coveringZoomLevel(this._source),y=Math.max(m-St.maxOverzooming,this._source.minzoom),T=Math.max(m+St.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const N of p)if(N.canonical.z>this._source.minzoom){const H=N.scaledTo(N.canonical.z-1);F[H.key]=H;const J=N.scaledTo(Math.max(this._source.minzoom,Math.min(N.canonical.z,5)));F[J.key]=J}p=p.concat(Object.values(F))}const C=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,C&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const P=this._updateRetainedTiles(p,m);Mr(this._source.type)&&this._updateCoveredAndRetainedTiles(P,y,T,m,p,d);for(const F in P)this._tiles[F].clearFadeHold();const D=l.ab(this._tiles,P);for(const F of D){const N=this._tiles[F];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,d){var p;const m={},y={},T=Math.max(d-St.maxOverzooming,this._source.minzoom),C=Math.max(d+St.maxUnderzooming,this._source.minzoom),P={};for(const D of s){const F=this._addTile(D);m[D.key]=D,F.hasData()||d<this._source.maxzoom&&(P[D.key]=D)}this._retainLoadedChildren(P,d,C,m);for(const D of s){let F=this._tiles[D.key];if(F.hasData())continue;if(d+1>this._source.maxzoom){const H=D.children(this._source.maxzoom)[0],J=this.getTile(H);if(J&&J.hasData()){m[H.key]=H;continue}}else{const H=D.children(this._source.maxzoom);if(m[H[0].key]&&m[H[1].key]&&m[H[2].key]&&m[H[3].key])continue}let N=F.wasRequested();for(let H=D.overscaledZ-1;H>=T;--H){const J=D.scaledTo(H);if(y[J.key])break;if(y[J.key]=!0,F=this.getTile(J),!F&&N&&(F=this._addTile(J)),F){const te=F.hasData();if((te||!(!((p=this.map)===null||p===void 0)&&p.cancelPendingTileRequestsWhileZooming)||N)&&(m[J.key]=J),N=F.wasRequested(),te)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const d=[];let p,m=this._tiles[s].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}d.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(y),p)break;m=y}for(const y of d)this._loadedParentTiles[y]=p}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const s in this._tiles){const d=this._tiles[s].tileID,p=this._getLoadedTile(d);this._loadedSiblingTiles[d.key]=p}}_addTile(s){let d=this._tiles[s.key];if(d)return d;d=this._cache.getAndRemove(s),d&&(this._setTileReloadTimer(s.key,d),d.tileID=s,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,d)));const p=d;return d||(d=new Hr(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(d,s.key,d.state)),d.uses++,this._tiles[s.key]=d,p||this._source.fire(new l.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(s,d){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const p=d.getExpiryTimeout();p&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},p))}_removeTile(s){const d=this._tiles[s];d&&(d.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(s){const d=s.sourceDataType;s.dataType==="source"&&d==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&s.dataType==="source"&&d==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,d,p){const m=[],y=this.transform;if(!y)return m;const T=p?y.getCameraQueryGeometry(s):s,C=s.map(te=>y.pointCoordinate(te,this.terrain)),P=T.map(te=>y.pointCoordinate(te,this.terrain)),D=this.getIds();let F=1/0,N=1/0,H=-1/0,J=-1/0;for(const te of P)F=Math.min(F,te.x),N=Math.min(N,te.y),H=Math.max(H,te.x),J=Math.max(J,te.y);for(let te=0;te<D.length;te++){const oe=this._tiles[D[te]];if(oe.holdingForFade())continue;const ce=oe.tileID,ue=Math.pow(2,y.zoom-oe.tileID.overscaledZ),pe=d*oe.queryPadding*l.X/oe.tileSize/ue,re=[ce.getTilePoint(new l.Z(F,N)),ce.getTilePoint(new l.Z(H,J))];if(re[0].x-pe<l.X&&re[0].y-pe<l.X&&re[1].x+pe>=0&&re[1].y+pe>=0){const ye=C.map(Se=>ce.getTilePoint(Se)),xe=P.map(Se=>ce.getTilePoint(Se));m.push({tile:oe,tileID:ce,queryGeometry:ye,cameraQueryGeometry:xe,scale:ue})}}return m}getVisibleCoordinates(s){const d=this.getRenderableIds(s).map(p=>this._tiles[p].tileID);for(const p of d)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(Mr(this._source.type)){const s=I.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=s)return!0}return!1}setFeatureState(s,d,p){this._state.updateState(s=s||"_geojsonTileLayer",d,p)}removeFeatureState(s,d,p){this._state.removeFeatureState(s=s||"_geojsonTileLayer",d,p)}getFeatureState(s,d){return this._state.getState(s=s||"_geojsonTileLayer",d)}setDependencies(s,d,p){const m=this._tiles[s];m&&m.setDependencies(d,p)}reloadTilesForDependencies(s,d){for(const p in this._tiles)this._tiles[p].hasDependency(s,d)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(s,d))}}function kn(v,s){const d=Math.abs(2*v.wrap)-+(v.wrap<0),p=Math.abs(2*s.wrap)-+(s.wrap<0);return v.overscaledZ-s.overscaledZ||p-d||s.canonical.y-v.canonical.y||s.canonical.x-v.canonical.x}function Mr(v){return v==="raster"||v==="image"||v==="video"}St.maxOverzooming=10,St.maxUnderzooming=3;class Ct{constructor(s,d){this.reset(s,d)}reset(s,d){this.points=s||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=l.ac(s,0,1);let d=1,p=this._distances[d];const m=s*this.paddedLength+this.padding;for(;p<m&&d<this._distances.length;)p=this._distances[++d];const y=d-1,T=this._distances[y],C=p-T,P=C>0?(m-T)/C:0;return this.points[y].mult(1-P).add(this.points[d].mult(P))}}function $r(v,s){let d=!0;return v==="always"||v!=="never"&&s!=="never"||(d=!1),d}class cs{constructor(s,d,p){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(s/p),this.yCellCount=Math.ceil(d/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=d,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,d,p,m,y){this._forEachCell(d,p,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(s,d,p,m){this._forEachCell(d-m,p-m,d+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(d),this.circles.push(p),this.circles.push(m)}_insertBoxCell(s,d,p,m,y,T){this.boxCells[y].push(T)}_insertCircleCell(s,d,p,m,y,T){this.circleCells[y].push(T)}_query(s,d,p,m,y,T,C){if(p<0||s>this.width||m<0||d>this.height)return[];const P=[];if(s<=0&&d<=0&&this.width<=p&&this.height<=m){if(y)return[{key:null,x1:s,y1:d,x2:p,y2:m}];for(let D=0;D<this.boxKeys.length;D++)P.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const F=this.circles[3*D],N=this.circles[3*D+1],H=this.circles[3*D+2];P.push({key:this.circleKeys[D],x1:F-H,y1:N-H,x2:F+H,y2:N+H})}}else this._forEachCell(s,d,p,m,this._queryCell,P,{hitTest:y,overlapMode:T,seenUids:{box:{},circle:{}}},C);return P}query(s,d,p,m){return this._query(s,d,p,m,!1,null)}hitTest(s,d,p,m,y,T){return this._query(s,d,p,m,!0,y,T).length>0}hitTestCircle(s,d,p,m,y){const T=s-p,C=s+p,P=d-p,D=d+p;if(C<0||T>this.width||D<0||P>this.height)return!1;const F=[];return this._forEachCell(T,P,C,D,this._queryCellCircle,F,{hitTest:!0,overlapMode:m,circle:{x:s,y:d,radius:p},seenUids:{box:{},circle:{}}},y),F.length>0}_queryCell(s,d,p,m,y,T,C,P){const{seenUids:D,hitTest:F,overlapMode:N}=C,H=this.boxCells[y];if(H!==null){const te=this.bboxes;for(const oe of H)if(!D.box[oe]){D.box[oe]=!0;const ce=4*oe,ue=this.boxKeys[oe];if(s<=te[ce+2]&&d<=te[ce+3]&&p>=te[ce+0]&&m>=te[ce+1]&&(!P||P(ue))&&(!F||!$r(N,ue.overlapMode))&&(T.push({key:ue,x1:te[ce],y1:te[ce+1],x2:te[ce+2],y2:te[ce+3]}),F))return!0}}const J=this.circleCells[y];if(J!==null){const te=this.circles;for(const oe of J)if(!D.circle[oe]){D.circle[oe]=!0;const ce=3*oe,ue=this.circleKeys[oe];if(this._circleAndRectCollide(te[ce],te[ce+1],te[ce+2],s,d,p,m)&&(!P||P(ue))&&(!F||!$r(N,ue.overlapMode))){const pe=te[ce],re=te[ce+1],ye=te[ce+2];if(T.push({key:ue,x1:pe-ye,y1:re-ye,x2:pe+ye,y2:re+ye}),F)return!0}}}return!1}_queryCellCircle(s,d,p,m,y,T,C,P){const{circle:D,seenUids:F,overlapMode:N}=C,H=this.boxCells[y];if(H!==null){const te=this.bboxes;for(const oe of H)if(!F.box[oe]){F.box[oe]=!0;const ce=4*oe,ue=this.boxKeys[oe];if(this._circleAndRectCollide(D.x,D.y,D.radius,te[ce+0],te[ce+1],te[ce+2],te[ce+3])&&(!P||P(ue))&&!$r(N,ue.overlapMode))return T.push(!0),!0}}const J=this.circleCells[y];if(J!==null){const te=this.circles;for(const oe of J)if(!F.circle[oe]){F.circle[oe]=!0;const ce=3*oe,ue=this.circleKeys[oe];if(this._circlesCollide(te[ce],te[ce+1],te[ce+2],D.x,D.y,D.radius)&&(!P||P(ue))&&!$r(N,ue.overlapMode))return T.push(!0),!0}}}_forEachCell(s,d,p,m,y,T,C,P){const D=this._convertToXCellCoord(s),F=this._convertToYCellCoord(d),N=this._convertToXCellCoord(p),H=this._convertToYCellCoord(m);for(let J=D;J<=N;J++)for(let te=F;te<=H;te++)if(y.call(this,s,d,p,m,this.xCellCount*te+J,T,C,P))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,d,p,m,y,T){const C=m-s,P=y-d,D=p+T;return D*D>C*C+P*P}_circleAndRectCollide(s,d,p,m,y,T,C){const P=(T-m)/2,D=Math.abs(s-(m+P));if(D>P+p)return!1;const F=(C-y)/2,N=Math.abs(d-(y+F));if(N>F+p)return!1;if(D<=P||N<=F)return!0;const H=D-P,J=N-F;return H*H+J*J<=p*p}}function us(v,s,d,p,m){const y=l.H();return s?(l.K(y,y,[1/m,1/m,1]),d||l.ad(y,y,p.angle)):l.L(y,p.labelPlaneMatrix,v),y}function Br(v,s,d,p,m){if(s){const y=l.ae(v);return l.K(y,y,[m,m,1]),d||l.ad(y,y,-p.angle),y}return p.glCoordMatrix}function ae(v,s,d,p){let m;p?(m=[v,s,p(v,s),1],l.af(m,m,d)):(m=[v,s,0,1],Wt(m,m,d));const y=m[3];return{point:new l.P(m[0]/y,m[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function V(v,s){return .5+v/s*.5}function z(v,s){return v.x>=-s[0]&&v.x<=s[0]&&v.y>=-s[1]&&v.y<=s[1]}function Y(v,s,d,p,m,y,T,C,P,D,F,N,H,J,te){const oe=p?v.textSizeData:v.iconSizeData,ce=l.ag(oe,d.transform.zoom),ue=[256/d.width*2+1,256/d.height*2+1],pe=p?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;pe.clear();const re=v.lineVertexArray,ye=p?v.text.placedSymbolArray:v.icon.placedSymbolArray,xe=d.transform.width/d.transform.height;let Se=!1;for(let Le=0;Le<ye.length;Le++){const Ge=ye.get(Le);if(Ge.hidden||Ge.writingMode===l.ah.vertical&&!Se){xt(Ge.numGlyphs,pe);continue}Se=!1;const nt=ae(Ge.anchorX,Ge.anchorY,s,te);if(!z(nt.point,ue)){xt(Ge.numGlyphs,pe);continue}const at=V(d.transform.cameraToCenterDistance,nt.signedDistanceFromCamera),et=l.ai(oe,ce,Ge),Ye=T?et/at:et*at,pt={getElevation:te,labelPlaneMatrix:m,lineVertexArray:re,pitchWithMap:T,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:D,tileAnchorPoint:new l.P(Ge.anchorX,Ge.anchorY),unwrappedTileID:F,width:N,height:H,translation:J},Mt=ve(pt,Ge,Ye,!1,C,s,y,v.glyphOffsetArray,pe,xe,P);Se=Mt.useVertical,(Mt.notEnoughRoom||Se||Mt.needsFlipping&&ve(pt,Ge,Ye,!0,C,s,y,v.glyphOffsetArray,pe,xe,P).notEnoughRoom)&&xt(Ge.numGlyphs,pe)}p?v.text.dynamicLayoutVertexBuffer.updateData(pe):v.icon.dynamicLayoutVertexBuffer.updateData(pe)}function ne(v,s,d,p,m,y,T,C){const P=y.glyphStartIndex+y.numGlyphs,D=y.lineStartIndex,F=y.lineStartIndex+y.lineLength,N=s.getoffsetX(y.glyphStartIndex),H=s.getoffsetX(P-1),J=Xe(v*N,d,p,m,y.segment,D,F,C,T);if(!J)return null;const te=Xe(v*H,d,p,m,y.segment,D,F,C,T);return te?C.projectionCache.anyProjectionOccluded?null:{first:J,last:te}:null}function ge(v,s,d,p){return v===l.ah.horizontal&&Math.abs(d.y-s.y)>Math.abs(d.x-s.x)*p?{useVertical:!0}:(v===l.ah.vertical?s.y<d.y:s.x>d.x)?{needsFlipping:!0}:null}function ve(v,s,d,p,m,y,T,C,P,D,F){const N=d/24,H=s.lineOffsetX*N,J=s.lineOffsetY*N;let te;if(s.numGlyphs>1){const oe=s.glyphStartIndex+s.numGlyphs,ce=s.lineStartIndex,ue=s.lineStartIndex+s.lineLength,pe=ne(N,C,H,J,p,s,F,v);if(!pe)return{notEnoughRoom:!0};const re=ae(pe.first.point.x,pe.first.point.y,T,v.getElevation).point,ye=ae(pe.last.point.x,pe.last.point.y,T,v.getElevation).point;if(m&&!p){const xe=ge(s.writingMode,re,ye,D);if(xe)return xe}te=[pe.first];for(let xe=s.glyphStartIndex+1;xe<oe-1;xe++)te.push(Xe(N*C.getoffsetX(xe),H,J,p,s.segment,ce,ue,v,F));te.push(pe.last)}else{if(m&&!p){const ce=ae(v.tileAnchorPoint.x,v.tileAnchorPoint.y,y,v.getElevation).point,ue=s.lineStartIndex+s.segment+1,pe=new l.P(v.lineVertexArray.getx(ue),v.lineVertexArray.gety(ue)),re=ae(pe.x,pe.y,y,v.getElevation),ye=re.signedDistanceFromCamera>0?re.point:function(Se,Le,Ge,nt,at,et){return Te(Se,Le,Ge,1,at,et)}(v.tileAnchorPoint,pe,ce,0,y,v),xe=ge(s.writingMode,ce,ye,D);if(xe)return xe}const oe=Xe(N*C.getoffsetX(s.glyphStartIndex),H,J,p,s.segment,s.lineStartIndex,s.lineStartIndex+s.lineLength,v,F);if(!oe||v.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};te=[oe]}for(const oe of te)l.aj(P,oe.point,oe.angle);return{}}function Te(v,s,d,p,m,y){const T=v.add(v.sub(s)._unit()),C=m!==void 0?ae(T.x,T.y,m,y.getElevation).point:ke(T.x,T.y,y).point,P=d.sub(C);return d.add(P._mult(p/P.mag()))}function he(v,s,d){const p=s.projectionCache;if(p.projections[v])return p.projections[v];const m=new l.P(s.lineVertexArray.getx(v),s.lineVertexArray.gety(v)),y=ke(m.x,m.y,s);if(y.signedDistanceFromCamera>0)return p.projections[v]=y.point,p.anyProjectionOccluded=p.anyProjectionOccluded||y.isOccluded,y.point;const T=v-d.direction;return function(C,P,D,F,N){return Te(C,P,D,F,void 0,N)}(d.distanceFromAnchor===0?s.tileAnchorPoint:new l.P(s.lineVertexArray.getx(T),s.lineVertexArray.gety(T)),m,d.previousVertex,d.absOffsetX-d.distanceFromAnchor+1,s)}function ke(v,s,d){const p=v+d.translation[0],m=s+d.translation[1];let y;return!d.pitchWithMap&&d.projection.useSpecialProjectionForSymbols?(y=d.projection.projectTileCoordinates(p,m,d.unwrappedTileID,d.getElevation),y.point.x=(.5*y.point.x+.5)*d.width,y.point.y=(.5*-y.point.y+.5)*d.height):(y=ae(p,m,d.labelPlaneMatrix,d.getElevation),y.isOccluded=!1),y}function Ue(v,s,d){return v._unit()._perp()._mult(s*d)}function Me(v,s,d,p,m,y,T,C,P){if(C.projectionCache.offsets[v])return C.projectionCache.offsets[v];const D=d.add(s);if(v+P.direction<p||v+P.direction>=m)return C.projectionCache.offsets[v]=D,D;const F=he(v+P.direction,C,P),N=Ue(F.sub(d),T,P.direction),H=d.add(N),J=F.add(N);return C.projectionCache.offsets[v]=l.ak(y,D,H,J)||D,C.projectionCache.offsets[v]}function Xe(v,s,d,p,m,y,T,C,P){const D=p?v-s:v+s;let F=D>0?1:-1,N=0;p&&(F*=-1,N=Math.PI),F<0&&(N+=Math.PI);let H,J=F>0?y+m:y+m+1;C.projectionCache.cachedAnchorPoint?H=C.projectionCache.cachedAnchorPoint:(H=ke(C.tileAnchorPoint.x,C.tileAnchorPoint.y,C).point,C.projectionCache.cachedAnchorPoint=H);let te,oe,ce=H,ue=H,pe=0,re=0;const ye=Math.abs(D),xe=[];let Se;for(;pe+re<=ye;){if(J+=F,J<y||J>=T)return null;pe+=re,ue=ce,oe=te;const nt={absOffsetX:ye,direction:F,distanceFromAnchor:pe,previousVertex:ue};if(ce=he(J,C,nt),d===0)xe.push(ue),Se=ce.sub(ue);else{let at;const et=ce.sub(ue);at=et.mag()===0?Ue(he(J+F,C,nt).sub(ce),d,F):Ue(et,d,F),oe||(oe=ue.add(at)),te=Me(J,at,ce,y,T,oe,d,C,nt),xe.push(oe),Se=te.sub(oe)}re=Se.mag()}const Le=Se._mult((ye-pe)/re)._add(oe||ue),Ge=N+Math.atan2(ce.y-ue.y,ce.x-ue.x);return xe.push(Le),{point:Le,angle:P?Ge:0,path:xe}}const _t=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function xt(v,s){for(let d=0;d<v;d++){const p=s.length;s.resize(p+4),s.float32.set(_t,3*p)}}function Wt(v,s,d){const p=s[0],m=s[1];return v[0]=d[0]*p+d[4]*m+d[12],v[1]=d[1]*p+d[5]*m+d[13],v[3]=d[3]*p+d[7]*m+d[15],v}const Bt=100;class Ht{constructor(s,d,p=new cs(s.width+200,s.height+200,25),m=new cs(s.width+200,s.height+200,25)){this.transform=s,this.mapProjection=d,this.grid=p,this.ignoredGrid=m,this.pitchFactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Bt,this.screenBottomBoundary=s.height+Bt,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,d,p,m,y,T,C,P,D,F,N){const H=s.anchorPointX+P[0],J=s.anchorPointY+P[1],te=this.projectAndGetPerspectiveRatio(m,H,J,y,F),oe=p*te.perspectiveRatio;let ce;if(T||C)ce=this._projectCollisionBox(s,oe,m,y,T,C,P,te,F,N);else{const xe=te.point.x+(N?N.x*oe:0),Se=te.point.y+(N?N.y*oe:0);ce={allPointsOccluded:!1,box:[xe+s.x1*oe,Se+s.y1*oe,xe+s.x2*oe,Se+s.y2*oe]}}const[ue,pe,re,ye]=ce.box;return this.mapProjection.useSpecialProjectionForSymbols&&(T?ce.allPointsOccluded:this.mapProjection.isOccluded(H,J,y))||te.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ue,pe,re,ye)||d!=="always"&&this.grid.hitTest(ue,pe,re,ye,d,D)?{box:[ue,pe,re,ye],placeable:!1,offscreen:!1}:{box:[ue,pe,re,ye],placeable:!0,offscreen:this.isOffscreen(ue,pe,re,ye)}}placeCollisionCircles(s,d,p,m,y,T,C,P,D,F,N,H,J,te,oe,ce){const ue=[],pe=new l.P(d.anchorX,d.anchorY),re=this.getPerspectiveRatio(T,pe.x,pe.y,C,ce),ye=(N?y/re:y*re)/l.ap,xe={getElevation:ce,labelPlaneMatrix:P,lineVertexArray:p,pitchWithMap:N,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:pe,unwrappedTileID:C,width:this.transform.width,height:this.transform.height,translation:oe},Se=ne(ye,m,d.lineOffsetX*ye,d.lineOffsetY*ye,!1,d,!1,xe);let Le=!1,Ge=!1,nt=!0;if(Se){const at=.5*J*re+te,et=new l.P(-100,-100),Ye=new l.P(this.screenRightBoundary,this.screenBottomBoundary),pt=new Ct,Mt=Se.first,tt=Se.last;let st=[];for(let kt=Mt.path.length-1;kt>=1;kt--)st.push(Mt.path[kt]);for(let kt=1;kt<tt.path.length;kt++)st.push(tt.path[kt]);const It=2.5*at;if(D){const kt=this.projectPathToScreenSpace(st,xe,D);st=kt.some(jt=>jt.signedDistanceFromCamera<=0)?[]:kt.map(jt=>jt.point)}let Ti=[];if(st.length>0){const kt=st[0].clone(),jt=st[0].clone();for(let Ei=1;Ei<st.length;Ei++)kt.x=Math.min(kt.x,st[Ei].x),kt.y=Math.min(kt.y,st[Ei].y),jt.x=Math.max(jt.x,st[Ei].x),jt.y=Math.max(jt.y,st[Ei].y);Ti=kt.x>=et.x&&jt.x<=Ye.x&&kt.y>=et.y&&jt.y<=Ye.y?[st]:jt.x<et.x||kt.x>Ye.x||jt.y<et.y||kt.y>Ye.y?[]:l.al([st],et.x,et.y,Ye.x,Ye.y)}for(const kt of Ti){pt.reset(kt,.25*at);let jt=0;jt=pt.length<=.5*at?1:Math.ceil(pt.paddedLength/It)+1;for(let Ei=0;Ei<jt;Ei++){const zn=Ei/Math.max(jt-1,1),fs=pt.lerp(zn),Si=fs.x+Bt,mr=fs.y+Bt;ue.push(Si,mr,at,0);const ir=Si-at,Vn=mr-at,nr=Si+at,Vs=mr+at;if(nt=nt&&this.isOffscreen(ir,Vn,nr,Vs),Ge=Ge||this.isInsideGrid(ir,Vn,nr,Vs),s!=="always"&&this.grid.hitTestCircle(Si,mr,at,s,H)&&(Le=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Le}}}}return{circles:!F&&Le||!Ge||re<this.perspectiveRatioCutoff?[]:ue,offscreen:nt,collisionDetected:Le}}projectPathToScreenSpace(s,d,p){return s.map(m=>ae(m.x,m.y,p,d.getElevation))}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let p=1/0,m=1/0,y=-1/0,T=-1/0;for(const F of s){const N=new l.P(F.x+Bt,F.y+Bt);p=Math.min(p,N.x),m=Math.min(m,N.y),y=Math.max(y,N.x),T=Math.max(T,N.y),d.push(N)}const C=this.grid.query(p,m,y,T).concat(this.ignoredGrid.query(p,m,y,T)),P={},D={};for(const F of C){const N=F.key;if(P[N.bucketInstanceId]===void 0&&(P[N.bucketInstanceId]={}),P[N.bucketInstanceId][N.featureIndex])continue;const H=[new l.P(F.x1,F.y1),new l.P(F.x2,F.y1),new l.P(F.x2,F.y2),new l.P(F.x1,F.y2)];l.am(d,H)&&(P[N.bucketInstanceId][N.featureIndex]=!0,D[N.bucketInstanceId]===void 0&&(D[N.bucketInstanceId]=[]),D[N.bucketInstanceId].push(N.featureIndex))}return D}insertCollisionBox(s,d,p,m,y,T){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:T,overlapMode:d},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,d,p,m,y,T){const C=p?this.ignoredGrid:this.grid,P={bucketInstanceId:m,featureIndex:y,collisionGroupID:T,overlapMode:d};for(let D=0;D<s.length;D+=4)C.insertCircle(P,s[D],s[D+1],s[D+2])}projectAndGetPerspectiveRatio(s,d,p,m,y){let T;y?(T=[d,p,y(d,p),1],l.af(T,T,s)):(T=[d,p,0,1],Wt(T,T,s));const C=T[3];return{point:new l.P((T[0]/C+1)/2*this.transform.width+Bt,(-T[1]/C+1)/2*this.transform.height+Bt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/C*.5,isOccluded:!1,signedDistanceFromCamera:C}}getPerspectiveRatio(s,d,p,m,y){const T=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(d,p,m,y):ae(d,p,s,y);return .5+this.transform.cameraToCenterDistance/T.signedDistanceFromCamera*.5}isOffscreen(s,d,p,m){return p<Bt||s>=this.screenRightBoundary||m<Bt||d>this.screenBottomBoundary}isInsideGrid(s,d,p,m){return p>=0&&s<this.gridRightBoundary&&m>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const s=l.an([]);return l.J(s,s,[-100,-100,0]),s}_projectCollisionBox(s,d,p,m,y,T,C,P,D,F){let N=new l.P(1,0),H=new l.P(0,1);const J=new l.P(s.anchorPointX+C[0],s.anchorPointY+C[1]);if(T&&!y){const nt=this.projectAndGetPerspectiveRatio(p,J.x+1,J.y,m,D).point.sub(P.point).unit(),at=Math.atan(nt.y/nt.x)+(nt.x<0?Math.PI:0),et=Math.sin(at),Ye=Math.cos(at);N=new l.P(Ye,et),H=new l.P(-et,Ye)}else if(!T&&y){const nt=-this.transform.angle,at=Math.sin(nt),et=Math.cos(nt);N=new l.P(et,at),H=new l.P(-at,et)}let te=P.point,oe=d;if(y){te=J;const nt=this.transform.zoom-Math.floor(this.transform.zoom);oe=Math.pow(2,-nt),oe*=this.mapProjection.getPitchedTextCorrection(this.transform,J,m),F||(oe*=l.ac(.5+P.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}F&&(te=te.add(N.mult(F.x*oe)).add(H.mult(F.y*oe)));const ce=s.x1*oe,ue=s.x2*oe,pe=(ce+ue)/2,re=s.y1*oe,ye=s.y2*oe,xe=(re+ye)/2,Se=[{offsetX:ce,offsetY:re},{offsetX:pe,offsetY:re},{offsetX:ue,offsetY:re},{offsetX:ue,offsetY:xe},{offsetX:ue,offsetY:ye},{offsetX:pe,offsetY:ye},{offsetX:ce,offsetY:ye},{offsetX:ce,offsetY:xe}];let Le=[];for(const{offsetX:nt,offsetY:at}of Se)Le.push(new l.P(te.x+N.x*nt+H.x*at,te.y+N.y*nt+H.y*at));let Ge=!1;if(y){const nt=Le.map(at=>this.projectAndGetPerspectiveRatio(p,at.x,at.y,m,D));Ge=nt.some(at=>!at.isOccluded),Le=nt.map(at=>at.point)}else Ge=!0;return{box:l.ao(Le),allPointsOccluded:!Ge}}}function Nt(v,s,d){return s*(l.X/(v.tileSize*Math.pow(2,d-v.tileID.overscaledZ)))}class Fi{constructor(s,d,p,m){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?d:-d))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class yi{constructor(s,d,p,m,y){this.text=new Fi(s?s.text:null,d,p,y),this.icon=new Fi(s?s.icon:null,d,m,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Dt{constructor(s,d,p){this.text=s,this.icon=d,this.skipFade=p}}class qt{constructor(){this.invProjMatrix=l.H(),this.viewportMatrix=l.H(),this.circles=[]}}class ri{constructor(s,d,p,m,y){this.bucketInstanceId=s,this.featureIndex=d,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=y}}class Ni{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const d=++this.maxGroupID;this.collisionGroups[s]={ID:d,predicate:p=>p.collisionGroupID===d}}return this.collisionGroups[s]}}function Qi(v,s,d,p,m){const{horizontalAlign:y,verticalAlign:T}=l.au(v);return new l.P(-(y-.5)*s+p[0]*m,-(T-.5)*d+p[1]*m)}class Sn{constructor(s,d,p,m,y,T){this.transform=s.clone(),this.terrain=p,this.collisionIndex=new Ht(this.transform,d),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Ni(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=T,T&&(T.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(s){const d=this.terrain;return d?(p,m)=>d.getElevation(s,p,m):null}getBucketParts(s,d,p,m){const y=p.getBucket(d),T=p.latestFeatureIndex;if(!y||!T||d.id!==y.layerIds[0])return;const C=p.collisionBoxArray,P=y.layers[0].layout,D=y.layers[0].paint,F=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),N=p.tileSize/l.X,H=p.tileID.toUnwrapped(),J=this.transform.calculatePosMatrix(H),te=P.get("text-pitch-alignment")==="map",oe=P.get("text-rotation-alignment")==="map",ce=Nt(p,1,this.transform.zoom),ue=this.collisionIndex.mapProjection.translatePosition(this.transform,p,D.get("text-translate"),D.get("text-translate-anchor")),pe=this.collisionIndex.mapProjection.translatePosition(this.transform,p,D.get("icon-translate"),D.get("icon-translate-anchor")),re=us(J,te,oe,this.transform,ce);let ye=null;if(te){const Se=Br(J,te,oe,this.transform,ce);ye=l.L([],this.transform.labelPlaneMatrix,Se)}this.retainedQueryData[y.bucketInstanceId]=new ri(y.bucketInstanceId,T,y.sourceLayerIndex,y.index,p.tileID);const xe={bucket:y,layout:P,translationText:ue,translationIcon:pe,posMatrix:J,unwrappedTileID:H,textLabelPlaneMatrix:re,labelToScreenMatrix:ye,scale:F,textPixelRatio:N,holdingForFade:p.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:l.ag(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const Se of y.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:Ge,symbolInstanceEnd:nt}=Se;s.push({sortKey:Le,symbolInstanceStart:Ge,symbolInstanceEnd:nt,parameters:xe})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:xe})}attemptAnchorPlacement(s,d,p,m,y,T,C,P,D,F,N,H,J,te,oe,ce,ue,pe,re){const ye=l.aq[s.textAnchor],xe=[s.textOffset0,s.textOffset1],Se=Qi(ye,p,m,xe,y),Le=this.collisionIndex.placeCollisionBox(d,H,P,D,F,C,T,ce,N.predicate,re,Se);if((!pe||this.collisionIndex.placeCollisionBox(pe,H,P,D,F,C,T,ue,N.predicate,re,Se).placeable)&&Le.placeable){let Ge;if(this.prevPlacement&&this.prevPlacement.variableOffsets[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID].text&&(Ge=this.prevPlacement.variableOffsets[J.crossTileID].anchor),J.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[J.crossTileID]={textOffset:xe,width:p,height:m,anchor:ye,textBoxScale:y,prevAnchor:Ge},this.markUsedJustification(te,ye,J,oe),te.allowVerticalPlacement&&(this.markUsedOrientation(te,oe,J),this.placedOrientations[J.crossTileID]=oe),{shift:Se,placedGlyphBoxes:Le}}}placeLayerBucketPart(s,d,p){const{bucket:m,layout:y,translationText:T,translationIcon:C,posMatrix:P,unwrappedTileID:D,textLabelPlaneMatrix:F,labelToScreenMatrix:N,textPixelRatio:H,holdingForFade:J,collisionBoxArray:te,partiallyEvaluatedTextSize:oe,collisionGroup:ce}=s.parameters,ue=y.get("text-optional"),pe=y.get("icon-optional"),re=l.ar(y,"text-overlap","text-allow-overlap"),ye=re==="always",xe=l.ar(y,"icon-overlap","icon-allow-overlap"),Se=xe==="always",Le=y.get("text-rotation-alignment")==="map",Ge=y.get("text-pitch-alignment")==="map",nt=y.get("icon-text-fit")!=="none",at=y.get("symbol-z-order")==="viewport-y",et=ye&&(Se||!m.hasIconData()||pe),Ye=Se&&(ye||!m.hasTextData()||ue);!m.collisionArrays&&te&&m.deserializeCollisionBoxes(te);const pt=this._getTerrainElevationFunc(this.retainedQueryData[m.bucketInstanceId].tileID),Mt=(tt,st,It)=>{var Ti,kt;if(d[tt.crossTileID])return;if(J)return void(this.placements[tt.crossTileID]=new Dt(!1,!1,!1));let jt=!1,Ei=!1,zn=!0,fs=null,Si={box:null,placeable:!1,offscreen:null},mr={box:null,placeable:!1,offscreen:null},ir=null,Vn=null,nr=null,Vs=0,ol=0,Lu=0;st.textFeatureIndex?Vs=st.textFeatureIndex:tt.useRuntimeCollisionCircles&&(Vs=tt.featureIndex),st.verticalTextFeatureIndex&&(ol=st.verticalTextFeatureIndex);const al=st.textBox;if(al){const Zr=Rn=>{let jn=l.ah.horizontal;if(m.allowVerticalPlacement&&!Rn&&this.prevPlacement){const kr=this.prevPlacement.placedOrientations[tt.crossTileID];kr&&(this.placedOrientations[tt.crossTileID]=kr,jn=kr,this.markUsedOrientation(m,jn,tt))}return jn},Yr=(Rn,jn)=>{if(m.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&st.verticalTextBox){for(const kr of m.writingModes)if(kr===l.ah.vertical?(Si=jn(),mr=Si):Si=Rn(),Si&&Si.placeable)break}else Si=Rn()},Oo=tt.textAnchorOffsetStartIndex,ps=tt.textAnchorOffsetEndIndex;if(ps===Oo){const Rn=(jn,kr)=>{const Gt=this.collisionIndex.placeCollisionBox(jn,re,H,P,D,Ge,Le,T,ce.predicate,pt);return Gt&&Gt.placeable&&(this.markUsedOrientation(m,kr,tt),this.placedOrientations[tt.crossTileID]=kr),Gt};Yr(()=>Rn(al,l.ah.horizontal),()=>{const jn=st.verticalTextBox;return m.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&jn?Rn(jn,l.ah.vertical):{box:null,offscreen:null}}),Zr(Si&&Si.placeable)}else{let Rn=l.aq[(kt=(Ti=this.prevPlacement)===null||Ti===void 0?void 0:Ti.variableOffsets[tt.crossTileID])===null||kt===void 0?void 0:kt.anchor];const jn=(Gt,ga,ll)=>{const cl=Gt.x2-Gt.x1,km=Gt.y2-Gt.y1,P0=tt.textBoxScale,Fm=nt&&xe==="never"?ga:null;let ko=null,Nm=re==="never"?1:2,zu="never";Rn&&Nm++;for(let bc=0;bc<Nm;bc++){for(let Vu=Oo;Vu<ps;Vu++){const ju=m.textAnchorOffsets.get(Vu);if(Rn&&ju.textAnchor!==Rn)continue;const ul=this.attemptAnchorPlacement(ju,Gt,cl,km,P0,Le,Ge,H,P,D,ce,zu,tt,m,ll,T,C,Fm,pt);if(ul&&(ko=ul.placedGlyphBoxes,ko&&ko.placeable))return jt=!0,fs=ul.shift,ko}Rn?Rn=null:zu=re}return p&&!ko&&(ko={box:this.collisionIndex.placeCollisionBox(al,"always",H,P,D,Ge,Le,T,ce.predicate,pt,new l.P(0,0)).box,offscreen:!1,placeable:!1}),ko};Yr(()=>jn(al,st.iconBox,l.ah.horizontal),()=>{const Gt=st.verticalTextBox;return m.allowVerticalPlacement&&(!Si||!Si.placeable)&&tt.numVerticalGlyphVertices>0&&Gt?jn(Gt,st.verticalIconBox,l.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Si&&(jt=Si.placeable,zn=Si.offscreen);const kr=Zr(Si&&Si.placeable);if(!jt&&this.prevPlacement){const Gt=this.prevPlacement.variableOffsets[tt.crossTileID];Gt&&(this.variableOffsets[tt.crossTileID]=Gt,this.markUsedJustification(m,Gt.anchor,tt,kr))}}}if(ir=Si,jt=ir&&ir.placeable,zn=ir&&ir.offscreen,tt.useRuntimeCollisionCircles){const Zr=m.text.placedSymbolArray.get(tt.centerJustifiedTextSymbolIndex),Yr=l.ai(m.textSizeData,oe,Zr),Oo=y.get("text-padding");Vn=this.collisionIndex.placeCollisionCircles(re,Zr,m.lineVertexArray,m.glyphOffsetArray,Yr,P,D,F,N,p,Ge,ce.predicate,tt.collisionCircleDiameter,Oo,T,pt),Vn.circles.length&&Vn.collisionDetected&&!p&&l.w("Collisions detected, but collision boxes are not shown"),jt=ye||Vn.circles.length>0&&!Vn.collisionDetected,zn=zn&&Vn.offscreen}if(st.iconFeatureIndex&&(Lu=st.iconFeatureIndex),st.iconBox){const Zr=Yr=>this.collisionIndex.placeCollisionBox(Yr,xe,H,P,D,Ge,Le,C,ce.predicate,pt,nt&&fs?fs:void 0);mr&&mr.placeable&&st.verticalIconBox?(nr=Zr(st.verticalIconBox),Ei=nr.placeable):(nr=Zr(st.iconBox),Ei=nr.placeable),zn=zn&&nr.offscreen}const Kr=ue||tt.numHorizontalGlyphVertices===0&&tt.numVerticalGlyphVertices===0,Uu=pe||tt.numIconVertices===0;Kr||Uu?Uu?Kr||(Ei=Ei&&jt):jt=Ei&&jt:Ei=jt=Ei&&jt;const ef=Ei&&nr.placeable;if(jt&&ir.placeable&&this.collisionIndex.insertCollisionBox(ir.box,re,y.get("text-ignore-placement"),m.bucketInstanceId,mr&&mr.placeable&&ol?ol:Vs,ce.ID),ef&&this.collisionIndex.insertCollisionBox(nr.box,xe,y.get("icon-ignore-placement"),m.bucketInstanceId,Lu,ce.ID),Vn&&jt&&this.collisionIndex.insertCollisionCircles(Vn.circles,re,y.get("text-ignore-placement"),m.bucketInstanceId,Vs,ce.ID),p&&this.storeCollisionData(m.bucketInstanceId,It,st,ir,nr,Vn),tt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[tt.crossTileID]=new Dt(jt||et,Ei||Ye,zn||m.justReloaded),d[tt.crossTileID]=!0};if(at){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const tt=m.getSortedSymbolIndexes(this.transform.angle);for(let st=tt.length-1;st>=0;--st){const It=tt[st];Mt(m.symbolInstances.get(It),m.collisionArrays[It],It)}}else for(let tt=s.symbolInstanceStart;tt<s.symbolInstanceEnd;tt++)Mt(m.symbolInstances.get(tt),m.collisionArrays[tt],tt);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const tt=this.collisionCircleArrays[m.bucketInstanceId];l.as(tt.invProjMatrix,P),tt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}storeCollisionData(s,d,p,m,y,T){if(p.textBox||p.iconBox){let C,P;this.collisionBoxArrays.has(s)?C=this.collisionBoxArrays.get(s):(C=new Map,this.collisionBoxArrays.set(s,C)),C.has(d)?P=C.get(d):(P={text:null,icon:null},C.set(d,P)),p.textBox&&(P.text=m.box),p.iconBox&&(P.icon=y.box)}if(T){let C=this.collisionCircleArrays[s];C===void 0&&(C=this.collisionCircleArrays[s]=new qt);for(let P=0;P<T.circles.length;P+=4)C.circles.push(T.circles[P+0]),C.circles.push(T.circles[P+1]),C.circles.push(T.circles[P+2]),C.circles.push(T.collisionDetected?1:0)}}markUsedJustification(s,d,p,m){let y;y=m===l.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[l.at(d)];const T=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const C of T)C>=0&&(s.text.placedSymbolArray.get(C).crossTileID=y>=0&&C!==y?0:p.crossTileID)}markUsedOrientation(s,d,p){const m=d===l.ah.horizontal||d===l.ah.horizontalOnly?d:0,y=d===l.ah.vertical?d:0,T=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const C of T)s.text.placedSymbolArray.get(C).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let p=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const m=d?d.symbolFadeChange(s):1,y=d?d.opacities:{},T=d?d.variableOffsets:{},C=d?d.placedOrientations:{};for(const P in this.placements){const D=this.placements[P],F=y[P];F?(this.opacities[P]=new yi(F,m,D.text,D.icon),p=p||D.text!==F.text.placed||D.icon!==F.icon.placed):(this.opacities[P]=new yi(null,m,D.text,D.icon,D.skipFade),p=p||D.text||D.icon)}for(const P in y){const D=y[P];if(!this.opacities[P]){const F=new yi(D,m,!1,!1);F.isHidden()||(this.opacities[P]=F,p=p||D.text.placed||D.icon.placed)}}for(const P in T)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=T[P]);for(const P in C)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=C[P]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:s)}updateLayerOpacities(s,d){const p={};for(const m of d){const y=m.getBucket(s);y&&m.latestFeatureIndex&&s.id===y.layerIds[0]&&this.updateBucketOpacities(y,m.tileID,p,m.collisionBoxArray)}}updateBucketOpacities(s,d,p,m){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const y=s.layers[0],T=y.layout,C=new yi(null,0,!1,!1,!0),P=T.get("text-allow-overlap"),D=T.get("icon-allow-overlap"),F=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),N=T.get("text-rotation-alignment")==="map",H=T.get("text-pitch-alignment")==="map",J=T.get("icon-text-fit")!=="none",te=new yi(null,0,P&&(D||!s.hasIconData()||T.get("icon-optional")),D&&(P||!s.hasTextData()||T.get("text-optional")),!0);!s.collisionArrays&&m&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(m);const oe=(ue,pe,re)=>{for(let ye=0;ye<pe/4;ye++)ue.opacityVertexArray.emplaceBack(re);ue.hasVisibleVertices=ue.hasVisibleVertices||re!==io},ce=this.collisionBoxArrays.get(s.bucketInstanceId);for(let ue=0;ue<s.symbolInstances.length;ue++){const pe=s.symbolInstances.get(ue),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:ye,crossTileID:xe}=pe;let Se=this.opacities[xe];p[xe]?Se=C:Se||(Se=te,this.opacities[xe]=Se),p[xe]=!0;const Le=pe.numIconVertices>0,Ge=this.placedOrientations[pe.crossTileID],nt=Ge===l.ah.vertical,at=Ge===l.ah.horizontal||Ge===l.ah.horizontalOnly;if(re>0||ye>0){const Ye=zi(Se.text);oe(s.text,re,nt?io:Ye),oe(s.text,ye,at?io:Ye);const pt=Se.text.isHidden();[pe.rightJustifiedTextSymbolIndex,pe.centerJustifiedTextSymbolIndex,pe.leftJustifiedTextSymbolIndex].forEach(st=>{st>=0&&(s.text.placedSymbolArray.get(st).hidden=pt||nt?1:0)}),pe.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(pe.verticalPlacedTextSymbolIndex).hidden=pt||at?1:0);const Mt=this.variableOffsets[pe.crossTileID];Mt&&this.markUsedJustification(s,Mt.anchor,pe,Ge);const tt=this.placedOrientations[pe.crossTileID];tt&&(this.markUsedJustification(s,"left",pe,tt),this.markUsedOrientation(s,tt,pe))}if(Le){const Ye=zi(Se.icon),pt=!(J&&pe.verticalPlacedIconSymbolIndex&&nt);pe.placedIconSymbolIndex>=0&&(oe(s.icon,pe.numIconVertices,pt?Ye:io),s.icon.placedSymbolArray.get(pe.placedIconSymbolIndex).hidden=Se.icon.isHidden()),pe.verticalPlacedIconSymbolIndex>=0&&(oe(s.icon,pe.numVerticalIconVertices,pt?io:Ye),s.icon.placedSymbolArray.get(pe.verticalPlacedIconSymbolIndex).hidden=Se.icon.isHidden())}const et=ce&&ce.has(ue)?ce.get(ue):{text:null,icon:null};if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Ye=s.collisionArrays[ue];if(Ye){let pt=new l.P(0,0);if(Ye.textBox||Ye.verticalTextBox){let Mt=!0;if(F){const tt=this.variableOffsets[xe];tt?(pt=Qi(tt.anchor,tt.width,tt.height,tt.textOffset,tt.textBoxScale),N&&pt._rotate(H?this.transform.angle:-this.transform.angle)):Mt=!1}if(Ye.textBox||Ye.verticalTextBox){let tt;Ye.textBox&&(tt=nt),Ye.verticalTextBox&&(tt=at),Mo(s.textCollisionBox.collisionVertexArray,Se.text.placed,!Mt||tt,et.text,pt.x,pt.y)}}if(Ye.iconBox||Ye.verticalIconBox){const Mt=!!(!at&&Ye.verticalIconBox);let tt;Ye.iconBox&&(tt=Mt),Ye.verticalIconBox&&(tt=!Mt),Mo(s.iconCollisionBox.collisionVertexArray,Se.icon.placed,tt,et.icon,J?pt.x:0,J?pt.y:0)}}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const ue=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ue.invProjMatrix,s.placementViewportMatrix=ue.viewportMatrix,s.collisionCircleArray=ue.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,d){const p=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*p>s}setStale(){this.stale=!0}}function Mo(v,s,d,p,m,y){p&&p.length!==0||(p=[0,0,0,0]);const T=p[0]-Bt,C=p[1]-Bt,P=p[2]-Bt,D=p[3]-Bt;v.emplaceBack(s?1:0,d?1:0,m||0,y||0,T,C),v.emplaceBack(s?1:0,d?1:0,m||0,y||0,P,C),v.emplaceBack(s?1:0,d?1:0,m||0,y||0,P,D),v.emplaceBack(s?1:0,d?1:0,m||0,y||0,T,D)}const Zt=Math.pow(2,25),Fn=Math.pow(2,24),Os=Math.pow(2,17),Gi=Math.pow(2,16),Li=Math.pow(2,9),sa=Math.pow(2,8),Ui=Math.pow(2,1);function zi(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const s=v.placed?1:0,d=Math.floor(127*v.opacity);return d*Zt+s*Fn+d*Os+s*Gi+d*Li+s*sa+d*Ui+s}const io=0;function ks(){return{isOccluded:(v,s,d)=>!1,getPitchedTextCorrection:(v,s,d)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(v,s,d,p){throw new Error("Not implemented.")},translatePosition:(v,s,d,p)=>function(m,y,T,C,P=!1){if(!T[0]&&!T[1])return[0,0];const D=P?C==="map"?m.angle:0:C==="viewport"?-m.angle:0;if(D){const F=Math.sin(D),N=Math.cos(D);T=[T[0]*N-T[1]*F,T[0]*F+T[1]*N]}return[P?T[0]:Nt(y,T[0],m.zoom),P?T[1]:Nt(y,T[1],m.zoom)]}(v,s,d,p),getCircleRadiusCorrection:v=>1}}class Mi{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,d,p,m,y){const T=this._bucketParts;for(;this._currentTileIndex<s.length;)if(d.getBucketParts(T,m,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((C,P)=>C.sortKey-P.sortKey));this._currentPartIndex<T.length;)if(d.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,y())return!0;return!1}}class Cn{constructor(s,d,p,m,y,T,C,P){this.placement=new Sn(s,ks(),d,T,C,P),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(s,d,p){const m=I.now(),y=()=>!this._forceFullPlacement&&I.now()-m>2;for(;this._currentPlacementIndex>=0;){const T=d[s[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=C)&&(!T.maxzoom||T.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Mi(T)),this._inProgressLayer.continuePlacement(p[T.source],this.placement,this._showCollisionBoxes,T,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Nn=512/l.X/2;class Bi{constructor(s,d,p){this.tileID=s,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let y=0;y<d.length;y++){const T=d.get(y),C=T.key,P=m.get(C);P?P.push(T):m.set(C,[T])}for(const[y,T]of m){const C={positions:T.map(P=>({x:Math.floor(P.anchorX*Nn),y:Math.floor(P.anchorY*Nn)})),crossTileIDs:T.map(P=>P.crossTileID)};if(C.positions.length>128){const P=new l.av(C.positions.length,16,Uint16Array);for(const{x:D,y:F}of C.positions)P.add(D,F);P.finish(),delete C.positions,C.index=P}this._symbolsByKey[y]=C}}getScaledCoordinates(s,d){const{x:p,y:m,z:y}=this.tileID.canonical,{x:T,y:C,z:P}=d.canonical,D=Nn/Math.pow(2,P-y),F=(C*l.X+s.anchorY)*D,N=m*l.X*Nn;return{x:Math.floor((T*l.X+s.anchorX)*D-p*l.X*Nn),y:Math.floor(F-N)}}findMatches(s,d,p){const m=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let y=0;y<s.length;y++){const T=s.get(y);if(T.crossTileID)continue;const C=this._symbolsByKey[T.key];if(!C)continue;const P=this.getScaledCoordinates(T,d);if(C.index){const D=C.index.range(P.x-m,P.y-m,P.x+m,P.y+m).sort();for(const F of D){const N=C.crossTileIDs[F];if(!p[N]){p[N]=!0,T.crossTileID=N;break}}}else if(C.positions)for(let D=0;D<C.positions.length;D++){const F=C.positions[D],N=C.crossTileIDs[D];if(Math.abs(F.x-P.x)<=m&&Math.abs(F.y-P.y)<=m&&!p[N]){p[N]=!0,T.crossTileID=N;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class Bo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class tr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const d=Math.round((s-this.lng)/360);if(d!==0)for(const p in this.indexes){const m=this.indexes[p],y={};for(const T in m){const C=m[T];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+d),y[C.tileID.key]=C}this.indexes[p]=y}this.lng=s}addBucket(s,d,p){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let y=0;y<d.symbolInstances.length;y++)d.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const m=this.usedCrossTileIDs[s.overscaledZ];for(const y in this.indexes){const T=this.indexes[y];if(Number(y)>s.overscaledZ)for(const C in T){const P=T[C];P.tileID.isChildOf(s)&&P.findMatches(d.symbolInstances,s,m)}else{const C=T[s.scaledTo(Number(y)).key];C&&C.findMatches(d.symbolInstances,s,m)}}for(let y=0;y<d.symbolInstances.length;y++){const T=d.symbolInstances.get(y);T.crossTileID||(T.crossTileID=p.generate(),m[T.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Bi(s,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(s,d){for(const p of d.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[s][m]}removeStaleBuckets(s){let d=!1;for(const p in this.indexes){const m=this.indexes[p];for(const y in m)s[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[y]),delete m[y],d=!0)}return d}}class oa{constructor(){this.layerIndexes={},this.crossTileIDs=new Bo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,d,p){let m=this.layerIndexes[s.id];m===void 0&&(m=this.layerIndexes[s.id]=new tr);let y=!1;const T={};m.handleWrapJump(p);for(const C of d){const P=C.getBucket(s);P&&s.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(C.tileID,P,this.crossTileIDs)&&(y=!0),T[P.bucketInstanceId]=!0)}return m.removeStaleBuckets(T)&&(y=!0),y}pruneUnusedLayers(s){const d={};s.forEach(p=>{d[p]=!0});for(const p in this.layerIndexes)d[p]||delete this.layerIndexes[p]}}const Ln=(v,s)=>l.t(v,s&&s.filter(d=>d.identifier!=="source.canvas")),Fs=l.aw();class Va extends l.E{constructor(s,d={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=s,this.dispatcher=new $i(pi(),s._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new Pt,this.imageManager.setEventedParent(this),this.glyphManager=new sn(s._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Yn(256,512),this.crossTileSymbolIndex=new oa,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ay()),er().on(We,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const y=m.getSource();if(y&&y.vectorLayerIds)for(const T in this._layers){const C=this._layers[T];C.source===y.id&&this._validateLayer(C)}})}loadURL(s,d={},p){this.fire(new l.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const m=this.map._requestManager.transformRequest(s,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;l.h(m,this._loadStyleRequest).then(T=>{this._loadStyleRequest=null,this._load(T.data,d,p)}).catch(T=>{this._loadStyleRequest=null,T&&!y.signal.aborted&&this.fire(new l.j(T))})}loadJSON(s,d={},p){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,I.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(s,d,p)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(Fs,{validate:!1})}_load(s,d,p){var m;const y=d.transformStyle?d.transformStyle(p,s):s;if(!d.validate||!Ln(this,l.u(y))){this._loaded=!0,this.stylesheet=y;for(const T in y.sources)this.addSource(T,y.sources[T],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new At(this.stylesheet.light),this.sky=new Ut(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const s=l.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",s),this._order=s.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of s){const p=l.aA(d);p.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=p}}_loadSprite(s,d=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(y,T,C,P){return l._(this,void 0,void 0,function*(){const D=Ve(y),F=C>1?"@2x":"",N={},H={};for(const{id:J,url:te}of D){const oe=T.transformRequest(je(te,F,".json"),"SpriteJSON");N[J]=l.h(oe,P);const ce=T.transformRequest(je(te,F,".png"),"SpriteImage");H[J]=Q.getImage(ce,P)}return yield Promise.all([...Object.values(N),...Object.values(H)]),function(J,te){return l._(this,void 0,void 0,function*(){const oe={};for(const ce in J){oe[ce]={};const ue=I.getImageCanvasContext((yield te[ce]).data),pe=(yield J[ce]).data;for(const re in pe){const{width:ye,height:xe,x:Se,y:Le,sdf:Ge,pixelRatio:nt,stretchX:at,stretchY:et,content:Ye,textFitWidth:pt,textFitHeight:Mt}=pe[re];oe[ce][re]={data:null,pixelRatio:nt,sdf:Ge,stretchX:at,stretchY:et,content:Ye,textFitWidth:pt,textFitHeight:Mt,spriteData:{width:ye,height:xe,x:Se,y:Le,context:ue}}}}return oe})}(N,H)})}(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(y=>{if(this._spriteRequest=null,y)for(const T in y){this._spritesImagesIds[T]=[];const C=this._spritesImagesIds[T]?this._spritesImagesIds[T].filter(P=>!(P in y)):[];for(const P of C)this.imageManager.removeImage(P),this._changedImages[P]=!0;for(const P in y[T]){const D=T==="default"?P:`${T}:${P}`;this._spritesImagesIds[T].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,y[T][P],!1):this.imageManager.addImage(D,y[T][P]),d&&(this._changedImages[D]=!0)}}}).catch(y=>{this._spriteRequest=null,m=y,this.fire(new l.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(s){const d=this.sourceCaches[s.source];if(!d)return;const p=s.sourceLayer;if(!p)return;const m=d.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s,d=!1){const p=this._serializedAllLayers();if(!s||s.length===0)return Object.values(d?l.aB(p):p);const m=[];for(const y of s)if(p[y]){const T=d?l.aB(p[y]):p[y];m.push(T)}return m}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const d=Object.keys(this._layers);for(const p of d){const m=this._layers[p];m.type!=="custom"&&(s[p]=m.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const d=this._changed;if(d){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const T in this._updatedSources){const C=this._updatedSources[T];if(C==="reload")this._reloadSource(T);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(s);this.light.updateTransitions(s),this.sky.updateTransitions(s),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const y=this.sourceCaches[m];p[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];y.recalculate(s,this._availableImages),!y.isHidden(s.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const m in p){const y=this.sourceCaches[m];!!p[m]!=!!y.used&&y.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(s),this.sky.recalculate(s),this.z=s.zoom,d&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(s,!1),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,d={}){var p;this._checkLoaded();const m=this.serialize();if(s=d.transformStyle?d.transformStyle(m,s):s,((p=d.validate)===null||p===void 0||p)&&Ln(this,l.u(s)))return!1;(s=l.aB(s)).layers=l.az(s.layers);const y=l.aC(m,s),T=this._getOperationsToPerform(y);if(T.unimplemented.length>0)throw new Error(`Unimplemented: ${T.unimplemented.join(", ")}.`);if(T.operations.length===0)return!1;for(const C of T.operations)C();return this.stylesheet=s,this._serializedLayers=null,!0}_getOperationsToPerform(s){const d=[],p=[];for(const m of s)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":d.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":d.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,m.args));break;case"setSky":d.push(()=>this.setSky.apply(this,m.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":d.push(()=>{});break;default:p.push(m.command)}return{operations:d,unimplemented:p}}addImage(s,d){if(this.getImage(s))return this.fire(new l.j(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,d),this._afterImageUpdated(s)}updateImage(s,d){this.imageManager.updateImage(s,d)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new l.j(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,d,p={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(l.u.source,`sources.${s}`,d,null,p))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const m=this.sourceCaches[s]=new St(s,d,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:s})),m.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===s)return this.fire(new l.j(new Error(`Source "${s}" cannot be removed while layer "${p}" is using it.`)));const d=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],d.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,d){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const p=this.sourceCaches[s].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(d),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,d,p={}){this._checkLoaded();const m=s.id;if(this.getLayer(m))return void this.fire(new l.j(new Error(`Layer "${m}" already exists on this map.`)));let y;if(s.type==="custom"){if(Ln(this,l.aD(s)))return;y=l.aA(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(m,s.source),s=l.aB(s),s=l.e(s,{source:m})),this._validate(l.u.layer,`layers.${m}`,s,{arrayIndex:-1},p))return;y=l.aA(s),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}})}const T=d?this._order.indexOf(d):this._order.length;if(d&&T===-1)this.fire(new l.j(new Error(`Cannot add layer "${m}" before non-existing layer "${d}".`)));else{if(this._order.splice(T,0,m),this._layerOrderChanged=!0,this._layers[m]=y,this._removedLayers[m]&&y.source&&y.type!=="custom"){const C=this._removedLayers[m];delete this._removedLayers[m],C.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(s,d){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new l.j(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===d)return;const p=this._order.indexOf(s);this._order.splice(p,1);const m=d?this._order.indexOf(d):this._order.length;d&&m===-1?this.fire(new l.j(new Error(`Cannot move layer "${s}" before non-existing layer "${d}".`))):(this._order.splice(m,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const d=this._layers[s];if(!d)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${s}".`)));d.setEventedParent(null);const p=this._order.indexOf(s);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=d,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],d.onRemove&&d.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,d,p){this._checkLoaded();const m=this.getLayer(s);m?m.minzoom===d&&m.maxzoom===p||(d!=null&&(m.minzoom=d),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,d,p={}){this._checkLoaded();const m=this.getLayer(s);if(m){if(!l.aE(m.filter,d))return d==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(l.u.filter,`layers.${m.id}.filter`,d,null,p)||(m.filter=l.aB(d),this._updateLayer(m)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return l.aB(this.getLayer(s).filter)}setLayoutProperty(s,d,p,m={}){this._checkLoaded();const y=this.getLayer(s);y?l.aE(y.getLayoutProperty(d),p)||(y.setLayoutProperty(d,p,m),this._updateLayer(y)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,d){const p=this.getLayer(s);if(p)return p.getLayoutProperty(d);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,d,p,m={}){this._checkLoaded();const y=this.getLayer(s);y?l.aE(y.getPaintProperty(d),p)||(y.setPaintProperty(d,p,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[s]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,d){return this.getLayer(s).getPaintProperty(d)}setFeatureState(s,d){this._checkLoaded();const p=s.source,m=s.sourceLayer,y=this.sourceCaches[p];if(y===void 0)return void this.fire(new l.j(new Error(`The source '${p}' does not exist in the map's style.`)));const T=y.getSource().type;T==="geojson"&&m?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||m?(s.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(m,s.id,d)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,d){this._checkLoaded();const p=s.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new l.j(new Error(`The source '${p}' does not exist in the map's style.`)));const y=m.getSource().type,T=y==="vector"?s.sourceLayer:void 0;y!=="vector"||T?d&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(T,s.id,d):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const d=s.source,p=s.sourceLayer,m=this.sourceCaches[d];if(m!==void 0)return m.getSource().type!=="vector"||p?(s.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,s.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=l.aF(this.sourceCaches,y=>y.serialize()),d=this._serializeByIds(this._order,!0),p=this.map.getTerrain()||void 0,m=this.stylesheet;return l.aG({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:s,layers:d,terrain:p},y=>y!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const d=T=>this._layers[T].type==="fill-extrusion",p={},m=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(d(C)){p[C]=T;for(const P of s){const D=P[C];if(D)for(const F of D)m.push(F)}}}m.sort((T,C)=>C.intersectionZ-T.intersectionZ);const y=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(d(C))for(let P=m.length-1;P>=0;P--){const D=m[P].feature;if(p[D.layer.id]<T)break;y.push(D),m.pop()}else for(const P of s){const D=P[C];if(D)for(const F of D)y.push(F.feature)}}return y}queryRenderedFeatures(s,d,p){d&&d.filter&&this._validate(l.u.filter,"queryRenderedFeatures.filter",d.filter,null,d);const m={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const C of d.layers){const P=this._layers[C];if(!P)return this.fire(new l.j(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];m[P.source]=!0}}const y=[];d.availableImages=this._availableImages;const T=this._serializedAllLayers();for(const C in this.sourceCaches)d.layers&&!m[C]||y.push(ur(this.sourceCaches[C],this._layers,T,s,d,p));return this.placement&&y.push(function(C,P,D,F,N,H,J){const te={},oe=H.queryRenderedSymbols(F),ce=[];for(const ue of Object.keys(oe).map(Number))ce.push(J[ue]);ce.sort(hr);for(const ue of ce){const pe=ue.featureIndex.lookupSymbolFeatures(oe[ue.bucketInstanceId],P,ue.bucketIndex,ue.sourceLayerIndex,N.filter,N.layers,N.availableImages,C);for(const re in pe){const ye=te[re]=te[re]||[],xe=pe[re];xe.sort((Se,Le)=>{const Ge=ue.featureSortOrder;if(Ge){const nt=Ge.indexOf(Se.featureIndex);return Ge.indexOf(Le.featureIndex)-nt}return Le.featureIndex-Se.featureIndex});for(const Se of xe)ye.push(Se)}}for(const ue in te)te[ue].forEach(pe=>{const re=pe.feature,ye=D[C[ue].source].getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=ye});return te}(this._layers,T,this.sourceCaches,s,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(s,d){d&&d.filter&&this._validate(l.u.filter,"querySourceFeatures.filter",d.filter,null,d);const p=this.sourceCaches[s];return p?function(m,y){const T=m.getRenderableIds().map(D=>m.getTileByID(D)),C=[],P={};for(let D=0;D<T.length;D++){const F=T[D],N=F.tileID.canonical.key;P[N]||(P[N]=!0,F.querySourceFeatures(C,y))}return C}(p,d):[]}getLight(){return this.light.getLight()}setLight(s,d={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const T in s)if(!l.aE(s[T],p[T])){m=!0;break}if(!m)return;const y={now:I.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,d),this.light.updateTransitions(y)}getSky(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.sky}setSky(s,d={}){const p=this.getSky();let m=!1;if(!s&&!p)return;if(s&&!p)m=!0;else if(!s&&p)m=!0;else for(const T in s)if(!l.aE(s[T],p[T])){m=!0;break}if(!m)return;const y={now:I.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=s,this.sky.setSky(s,d),this.sky.updateTransitions(y)}_validate(s,d,p,m,y={}){return(!y||y.validate!==!1)&&Ln(this,s.call(l.u,l.e({key:d,style:this.serialize(),value:p,styleSpec:l.v},m)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),er().off(We,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const p=this.sourceCaches[d];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const d in this.sourceCaches)this.sourceCaches[d].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,d,p,m,y=!1){let T=!1,C=!1;const P={};for(const D of this._order){const F=this._layers[D];if(F.type!=="symbol")continue;if(!P[F.source]){const H=this.sourceCaches[F.source];P[F.source]=H.getRenderableIds(!0).map(J=>H.getTileByID(J)).sort((J,te)=>te.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(te.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(F,P[F.source],s.center.lng);T=T||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(I.now(),s.zoom))&&(this.pauseablePlacement=new Cn(s,this.map.terrain,this._order,y,d,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(I.now()),C=!0),T&&this.pauseablePlacement.placement.setStale()),C||T)for(const D of this._order){const F=this._layers[D];F.type==="symbol"&&this.placement.updateLayerOpacities(F,P[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(I.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,d){return l._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[d.source];return m&&m.setDependencies(d.tileID.key,d.type,d.icons),p})}getGlyphs(s,d){return l._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(d.stacks),m=this.sourceCaches[d.source];return m&&m.setDependencies(d.tileID.key,d.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,d={}){this._checkLoaded(),s&&this._validate(l.u.glyphs,"glyphs",s,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,d,p={},m){this._checkLoaded();const y=[{id:s,url:d}],T=[...Ve(this.stylesheet.sprite),...y];this._validate(l.u.sprite,"sprite",T,null,p)||(this.stylesheet.sprite=T,this._loadSprite(y,!0,m))}removeSprite(s){this._checkLoaded();const d=Ve(this.stylesheet.sprite);if(d.find(p=>p.id===s)){if(this._spritesImagesIds[s])for(const p of this._spritesImagesIds[s])this.imageManager.removeImage(p),this._changedImages[p]=!0;d.splice(d.findIndex(p=>p.id===s),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return Ve(this.stylesheet.sprite)}setSprite(s,d={},p){this._checkLoaded(),s&&this._validate(l.u.sprite,"sprite",s,null,d)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,p):(this._unloadSprite(),p&&p(null)))}}var Ns=l.Y([{name:"a_pos",type:"Int16",components:2}]);const Gr={prelude:Kt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Kt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Kt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Kt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Kt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Kt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Kt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Kt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Kt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Kt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Kt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Kt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Kt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Kt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Kt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Kt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Kt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Kt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Kt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Kt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Kt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Kt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Kt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Kt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Kt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Kt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Kt(v,s){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=s.match(/attribute ([\w]+) ([\w]+)/g),m=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=y?y.concat(m):m,C={};return{fragmentSource:v=v.replace(d,(P,D,F,N,H)=>(C[H]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${H}
varying ${F} ${N} ${H};
#else
uniform ${F} ${N} u_${H};
#endif
`:`
#ifdef HAS_UNIFORM_u_${H}
    ${F} ${N} ${H} = u_${H};
#endif
`)),vertexSource:s=s.replace(d,(P,D,F,N,H)=>{const J=N==="float"?"vec2":"vec4",te=H.match(/color/)?"color":J;return C[H]?D==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${F} ${J} a_${H};
varying ${F} ${N} ${H};
#else
uniform ${F} ${N} u_${H};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${F} ${N} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${te}(a_${H}, u_${H}_t);
#else
    ${F} ${N} ${H} = u_${H};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${F} ${J} a_${H};
#else
uniform ${F} ${N} u_${H};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${F} ${N} ${H} = a_${H};
#else
    ${F} ${N} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${F} ${N} ${H} = unpack_mix_${te}(a_${H}, u_${H}_t);
#else
    ${F} ${N} ${H} = u_${H};
#endif
`}),staticAttributes:p,staticUniforms:T}}class nc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,d,p,m,y,T,C,P,D){this.context=s;let F=this.boundPaintVertexBuffers.length!==m.length;for(let N=0;!F&&N<m.length;N++)this.boundPaintVertexBuffers[N]!==m[N]&&(F=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==p||F||this.boundIndexBuffer!==y||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==P||this.boundDynamicVertexBuffer3!==D?this.freshBind(d,p,m,y,T,C,P,D):(s.bindVertexArray.set(this.vao),C&&C.bind(),y&&y.dynamicDraw&&y.bind(),P&&P.bind(),D&&D.bind())}freshBind(s,d,p,m,y,T,C,P){const D=s.numAttributes,F=this.context,N=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=P,d.enableAttributes(N,s);for(const H of p)H.enableAttributes(N,s);T&&T.enableAttributes(N,s),C&&C.enableAttributes(N,s),P&&P.enableAttributes(N,s),d.bind(),d.setVertexAttribPointers(N,s,y);for(const H of p)H.bind(),H.setVertexAttribPointers(N,s,y);T&&(T.bind(),T.setVertexAttribPointers(N,s,y)),m&&m.bind(),C&&(C.bind(),C.setVertexAttribPointers(N,s,y)),P&&(P.bind(),P.setVertexAttribPointers(N,s,y)),F.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const rc=(v,s,d,p,m)=>({u_matrix:v,u_texture:0,u_ele_delta:s,u_fog_matrix:d,u_fog_color:p?p.properties.get("fog-color"):l.aM.white,u_fog_ground_blend:p?p.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?p.calculateFogBlendOpacity(m):0,u_horizon_color:p?p.properties.get("horizon-color"):l.aM.white,u_horizon_fog_blend:p?p.properties.get("horizon-fog-blend"):1});function q(v){const s=[];for(let d=0;d<v.length;d++){if(v[d]===null)continue;const p=v[d].split(" ");s.push(p.pop())}return s}class ee{constructor(s,d,p,m,y,T){const C=s.gl;this.program=C.createProgram();const P=q(d.staticAttributes),D=p?p.getBinderAttributes():[],F=P.concat(D),N=Gr.prelude.staticUniforms?q(Gr.prelude.staticUniforms):[],H=d.staticUniforms?q(d.staticUniforms):[],J=p?p.getBinderUniforms():[],te=N.concat(H).concat(J),oe=[];for(const Se of te)oe.indexOf(Se)<0&&oe.push(Se);const ce=p?p.defines():[];y&&ce.push("#define OVERDRAW_INSPECTOR;"),T&&ce.push("#define TERRAIN3D;");const ue=ce.concat(Gr.prelude.fragmentSource,d.fragmentSource).join(`
`),pe=ce.concat(Gr.prelude.vertexSource,d.vertexSource).join(`
`),re=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(re,ue),C.compileShader(re),!C.getShaderParameter(re,C.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${C.getShaderInfoLog(re)}`);C.attachShader(this.program,re);const ye=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(ye,pe),C.compileShader(ye),!C.getShaderParameter(ye,C.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${C.getShaderInfoLog(ye)}`);C.attachShader(this.program,ye),this.attributes={};const xe={};this.numAttributes=F.length;for(let Se=0;Se<this.numAttributes;Se++)F[Se]&&(C.bindAttribLocation(this.program,Se,F[Se]),this.attributes[F[Se]]=Se);if(C.linkProgram(this.program),!C.getProgramParameter(this.program,C.LINK_STATUS))throw new Error(`Program failed to link: ${C.getProgramInfoLog(this.program)}`);C.deleteShader(ye),C.deleteShader(re);for(let Se=0;Se<oe.length;Se++){const Le=oe[Se];if(Le&&!xe[Le]){const Ge=C.getUniformLocation(this.program,Le);Ge&&(xe[Le]=Ge)}}this.fixedUniforms=m(s,xe),this.terrainUniforms=((Se,Le)=>({u_depth:new l.aH(Se,Le.u_depth),u_terrain:new l.aH(Se,Le.u_terrain),u_terrain_dim:new l.aI(Se,Le.u_terrain_dim),u_terrain_matrix:new l.aJ(Se,Le.u_terrain_matrix),u_terrain_unpack:new l.aK(Se,Le.u_terrain_unpack),u_terrain_exaggeration:new l.aI(Se,Le.u_terrain_exaggeration)}))(s,xe),this.binderUniforms=p?p.getUniforms(s,xe):[]}draw(s,d,p,m,y,T,C,P,D,F,N,H,J,te,oe,ce,ue,pe){const re=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(p),s.setStencilMode(m),s.setColorMode(y),s.setCullFace(T),P){s.activeTexture.set(re.TEXTURE2),re.bindTexture(re.TEXTURE_2D,P.depthTexture),s.activeTexture.set(re.TEXTURE3),re.bindTexture(re.TEXTURE_2D,P.texture);for(const xe in this.terrainUniforms)this.terrainUniforms[xe].set(P[xe])}for(const xe in this.fixedUniforms)this.fixedUniforms[xe].set(C[xe]);oe&&oe.setUniforms(s,this.binderUniforms,J,{zoom:te});let ye=0;switch(d){case re.LINES:ye=2;break;case re.TRIANGLES:ye=3;break;case re.LINE_STRIP:ye=1}for(const xe of H.get()){const Se=xe.vaos||(xe.vaos={});(Se[D]||(Se[D]=new nc)).bind(s,this,F,oe?oe.getPaintVertexBuffers():[],N,xe.vertexOffset,ce,ue,pe),re.drawElements(d,xe.primitiveLength*ye,re.UNSIGNED_SHORT,xe.primitiveOffset*ye*2)}}}function de(v,s,d){const p=1/Nt(d,1,s.transform.tileZoom),m=Math.pow(2,d.tileID.overscaledZ),y=d.tileSize*Math.pow(2,s.transform.tileZoom)/m,T=y*(d.tileID.canonical.x+d.tileID.wrap*m),C=y*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[p,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[T>>16,C>>16],u_pixel_coord_lower:[65535&T,65535&C]}}const De=(v,s,d,p)=>{const m=s.style.light,y=m.properties.get("position"),T=[y.x,y.y,y.z],C=function(){var D=new l.A(9);return l.A!=Float32Array&&(D[1]=0,D[2]=0,D[3]=0,D[5]=0,D[6]=0,D[7]=0),D[0]=1,D[4]=1,D[8]=1,D}();m.properties.get("anchor")==="viewport"&&function(D,F){var N=Math.sin(F),H=Math.cos(F);D[0]=H,D[1]=N,D[2]=0,D[3]=-N,D[4]=H,D[5]=0,D[6]=0,D[7]=0,D[8]=1}(C,-s.transform.angle),function(D,F,N){var H=F[0],J=F[1],te=F[2];D[0]=H*N[0]+J*N[3]+te*N[6],D[1]=H*N[1]+J*N[4]+te*N[7],D[2]=H*N[2]+J*N[5]+te*N[8]}(T,T,C);const P=m.properties.get("color");return{u_matrix:v,u_lightpos:T,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+d,u_opacity:p}},$e=(v,s,d,p,m,y,T)=>l.e(De(v,s,d,p),de(y,s,T),{u_height_factor:-Math.pow(2,m.overscaledZ)/T.tileSize/8}),ht=v=>({u_matrix:v}),Vt=(v,s,d,p)=>l.e(ht(v),de(d,s,p)),on=(v,s)=>({u_matrix:v,u_world:s}),an=(v,s,d,p,m)=>l.e(Vt(v,s,d,p),{u_world:m}),In=(v,s,d,p)=>{const m=v.transform;let y,T;if(p.paint.get("circle-pitch-alignment")==="map"){const C=Nt(d,1,m.zoom);y=!0,T=[C,C]}else y=!1,T=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:v.translatePosMatrix(s.posMatrix,d,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:T}},yn=(v,s,d)=>({u_matrix:v,u_inv_matrix:s,u_camera_to_center_distance:d.cameraToCenterDistance,u_viewport_size:[d.width,d.height]}),sc=(v,s,d=1)=>({u_matrix:v,u_color:s,u_overlay:0,u_overlay_scale:d}),fr=v=>({u_matrix:v}),pr=(v,s,d,p)=>({u_matrix:v,u_extrude_scale:Nt(s,1,d),u_intensity:p}),hu=(v,s,d,p)=>{const m=l.H();l.aP(m,0,v.width,v.height,0,0,1);const y=v.context.gl;return{u_matrix:m,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:d,u_color_ramp:p,u_opacity:s.paint.get("heatmap-opacity")}};function du(v,s){const d=Math.pow(2,s.canonical.z),p=s.canonical.y;return[new l.Z(0,p/d).toLngLat().lat,new l.Z(0,(p+1)/d).toLngLat().lat]}const fu=(v,s,d,p)=>{const m=v.transform;return{u_matrix:om(v,s,d,p),u_ratio:1/Nt(s,1,m.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},rm=(v,s,d,p,m)=>l.e(fu(v,s,d,m),{u_image:0,u_image_height:p}),ja=(v,s,d,p,m)=>{const y=v.transform,T=sm(s,y);return{u_matrix:om(v,s,d,m),u_texsize:s.imageAtlasTexture.size,u_ratio:1/Nt(s,1,y.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[T,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},l0=(v,s,d,p,m,y)=>{const T=v.lineAtlas,C=sm(s,v.transform),P=d.layout.get("line-cap")==="round",D=T.getDash(p.from,P),F=T.getDash(p.to,P),N=D.width*m.fromScale,H=F.width*m.toScale;return l.e(fu(v,s,d,y),{u_patternscale_a:[C/N,-D.height/2],u_patternscale_b:[C/H,-F.height/2],u_sdfgamma:T.width/(256*Math.min(N,H)*v.pixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:F.y,u_mix:m.t})};function sm(v,s){return 1/Nt(v,1,s.tileZoom)}function om(v,s,d,p){return v.translatePosMatrix(p?p.posMatrix:s.tileID.posMatrix,s,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const c0=(v,s,d,p,m)=>{return{u_matrix:v,u_tl_parent:s,u_scale_parent:d,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(T=m.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(y=m.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:u0(m.paint.get("raster-hue-rotate"))};var y,T};function u0(v){v*=Math.PI/180;const s=Math.sin(v),d=Math.cos(v);return[(2*d+1)/3,(-Math.sqrt(3)*s-d+1)/3,(Math.sqrt(3)*s-d+1)/3]}const am=(v,s,d,p,m,y,T,C,P,D,F,N,H,J)=>{const te=T.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:te.cameraToCenterDistance,u_pitch:te.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:te.width/te.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:P,u_coord_matrix:D,u_is_text:+N,u_pitch_with_map:+p,u_is_along_line:m,u_is_variable_anchor:y,u_texsize:H,u_texture:0,u_translation:F,u_pitched_scale:J}},oc=(v,s,d,p,m,y,T,C,P,D,F,N,H,J,te)=>{const oe=T.transform;return l.e(am(v,s,d,p,m,y,T,C,P,D,F,N,H,te),{u_gamma_scale:p?Math.cos(oe._pitch)*oe.cameraToCenterDistance:1,u_device_pixel_ratio:T.pixelRatio,u_is_halo:+J})},_d=(v,s,d,p,m,y,T,C,P,D,F,N,H,J)=>l.e(oc(v,s,d,p,m,y,T,C,P,D,F,!0,N,!0,J),{u_texsize_icon:H,u_texture_icon:1}),pu=(v,s,d)=>({u_matrix:v,u_opacity:s,u_color:d}),yd=(v,s,d,p,m,y)=>l.e(function(T,C,P,D){const F=P.imageManager.getPattern(T.from.toString()),N=P.imageManager.getPattern(T.to.toString()),{width:H,height:J}=P.imageManager.getPixelSize(),te=Math.pow(2,D.tileID.overscaledZ),oe=D.tileSize*Math.pow(2,P.transform.tileZoom)/te,ce=oe*(D.tileID.canonical.x+D.tileID.wrap*te),ue=oe*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[H,J],u_mix:C.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/Nt(D,1,P.transform.tileZoom),u_pixel_coord_upper:[ce>>16,ue>>16],u_pixel_coord_lower:[65535&ce,65535&ue]}}(p,y,d,m),{u_matrix:v,u_opacity:s}),vd={fillExtrusion:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_lightpos:new l.aN(v,s.u_lightpos),u_lightintensity:new l.aI(v,s.u_lightintensity),u_lightcolor:new l.aN(v,s.u_lightcolor),u_vertical_gradient:new l.aI(v,s.u_vertical_gradient),u_opacity:new l.aI(v,s.u_opacity)}),fillExtrusionPattern:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_lightpos:new l.aN(v,s.u_lightpos),u_lightintensity:new l.aI(v,s.u_lightintensity),u_lightcolor:new l.aN(v,s.u_lightcolor),u_vertical_gradient:new l.aI(v,s.u_vertical_gradient),u_height_factor:new l.aI(v,s.u_height_factor),u_image:new l.aH(v,s.u_image),u_texsize:new l.aO(v,s.u_texsize),u_pixel_coord_upper:new l.aO(v,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(v,s.u_pixel_coord_lower),u_scale:new l.aN(v,s.u_scale),u_fade:new l.aI(v,s.u_fade),u_opacity:new l.aI(v,s.u_opacity)}),fill:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix)}),fillPattern:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_image:new l.aH(v,s.u_image),u_texsize:new l.aO(v,s.u_texsize),u_pixel_coord_upper:new l.aO(v,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(v,s.u_pixel_coord_lower),u_scale:new l.aN(v,s.u_scale),u_fade:new l.aI(v,s.u_fade)}),fillOutline:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_world:new l.aO(v,s.u_world)}),fillOutlinePattern:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_world:new l.aO(v,s.u_world),u_image:new l.aH(v,s.u_image),u_texsize:new l.aO(v,s.u_texsize),u_pixel_coord_upper:new l.aO(v,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(v,s.u_pixel_coord_lower),u_scale:new l.aN(v,s.u_scale),u_fade:new l.aI(v,s.u_fade)}),circle:(v,s)=>({u_camera_to_center_distance:new l.aI(v,s.u_camera_to_center_distance),u_scale_with_map:new l.aH(v,s.u_scale_with_map),u_pitch_with_map:new l.aH(v,s.u_pitch_with_map),u_extrude_scale:new l.aO(v,s.u_extrude_scale),u_device_pixel_ratio:new l.aI(v,s.u_device_pixel_ratio),u_matrix:new l.aJ(v,s.u_matrix)}),collisionBox:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_pixel_extrude_scale:new l.aO(v,s.u_pixel_extrude_scale)}),collisionCircle:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_inv_matrix:new l.aJ(v,s.u_inv_matrix),u_camera_to_center_distance:new l.aI(v,s.u_camera_to_center_distance),u_viewport_size:new l.aO(v,s.u_viewport_size)}),debug:(v,s)=>({u_color:new l.aL(v,s.u_color),u_matrix:new l.aJ(v,s.u_matrix),u_overlay:new l.aH(v,s.u_overlay),u_overlay_scale:new l.aI(v,s.u_overlay_scale)}),clippingMask:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix)}),heatmap:(v,s)=>({u_extrude_scale:new l.aI(v,s.u_extrude_scale),u_intensity:new l.aI(v,s.u_intensity),u_matrix:new l.aJ(v,s.u_matrix)}),heatmapTexture:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_world:new l.aO(v,s.u_world),u_image:new l.aH(v,s.u_image),u_color_ramp:new l.aH(v,s.u_color_ramp),u_opacity:new l.aI(v,s.u_opacity)}),hillshade:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_image:new l.aH(v,s.u_image),u_latrange:new l.aO(v,s.u_latrange),u_light:new l.aO(v,s.u_light),u_shadow:new l.aL(v,s.u_shadow),u_highlight:new l.aL(v,s.u_highlight),u_accent:new l.aL(v,s.u_accent)}),hillshadePrepare:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_image:new l.aH(v,s.u_image),u_dimension:new l.aO(v,s.u_dimension),u_zoom:new l.aI(v,s.u_zoom),u_unpack:new l.aK(v,s.u_unpack)}),line:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_ratio:new l.aI(v,s.u_ratio),u_device_pixel_ratio:new l.aI(v,s.u_device_pixel_ratio),u_units_to_pixels:new l.aO(v,s.u_units_to_pixels)}),lineGradient:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_ratio:new l.aI(v,s.u_ratio),u_device_pixel_ratio:new l.aI(v,s.u_device_pixel_ratio),u_units_to_pixels:new l.aO(v,s.u_units_to_pixels),u_image:new l.aH(v,s.u_image),u_image_height:new l.aI(v,s.u_image_height)}),linePattern:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_texsize:new l.aO(v,s.u_texsize),u_ratio:new l.aI(v,s.u_ratio),u_device_pixel_ratio:new l.aI(v,s.u_device_pixel_ratio),u_image:new l.aH(v,s.u_image),u_units_to_pixels:new l.aO(v,s.u_units_to_pixels),u_scale:new l.aN(v,s.u_scale),u_fade:new l.aI(v,s.u_fade)}),lineSDF:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_ratio:new l.aI(v,s.u_ratio),u_device_pixel_ratio:new l.aI(v,s.u_device_pixel_ratio),u_units_to_pixels:new l.aO(v,s.u_units_to_pixels),u_patternscale_a:new l.aO(v,s.u_patternscale_a),u_patternscale_b:new l.aO(v,s.u_patternscale_b),u_sdfgamma:new l.aI(v,s.u_sdfgamma),u_image:new l.aH(v,s.u_image),u_tex_y_a:new l.aI(v,s.u_tex_y_a),u_tex_y_b:new l.aI(v,s.u_tex_y_b),u_mix:new l.aI(v,s.u_mix)}),raster:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_tl_parent:new l.aO(v,s.u_tl_parent),u_scale_parent:new l.aI(v,s.u_scale_parent),u_buffer_scale:new l.aI(v,s.u_buffer_scale),u_fade_t:new l.aI(v,s.u_fade_t),u_opacity:new l.aI(v,s.u_opacity),u_image0:new l.aH(v,s.u_image0),u_image1:new l.aH(v,s.u_image1),u_brightness_low:new l.aI(v,s.u_brightness_low),u_brightness_high:new l.aI(v,s.u_brightness_high),u_saturation_factor:new l.aI(v,s.u_saturation_factor),u_contrast_factor:new l.aI(v,s.u_contrast_factor),u_spin_weights:new l.aN(v,s.u_spin_weights)}),symbolIcon:(v,s)=>({u_is_size_zoom_constant:new l.aH(v,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(v,s.u_is_size_feature_constant),u_size_t:new l.aI(v,s.u_size_t),u_size:new l.aI(v,s.u_size),u_camera_to_center_distance:new l.aI(v,s.u_camera_to_center_distance),u_pitch:new l.aI(v,s.u_pitch),u_rotate_symbol:new l.aH(v,s.u_rotate_symbol),u_aspect_ratio:new l.aI(v,s.u_aspect_ratio),u_fade_change:new l.aI(v,s.u_fade_change),u_matrix:new l.aJ(v,s.u_matrix),u_label_plane_matrix:new l.aJ(v,s.u_label_plane_matrix),u_coord_matrix:new l.aJ(v,s.u_coord_matrix),u_is_text:new l.aH(v,s.u_is_text),u_pitch_with_map:new l.aH(v,s.u_pitch_with_map),u_is_along_line:new l.aH(v,s.u_is_along_line),u_is_variable_anchor:new l.aH(v,s.u_is_variable_anchor),u_texsize:new l.aO(v,s.u_texsize),u_texture:new l.aH(v,s.u_texture),u_translation:new l.aO(v,s.u_translation),u_pitched_scale:new l.aI(v,s.u_pitched_scale)}),symbolSDF:(v,s)=>({u_is_size_zoom_constant:new l.aH(v,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(v,s.u_is_size_feature_constant),u_size_t:new l.aI(v,s.u_size_t),u_size:new l.aI(v,s.u_size),u_camera_to_center_distance:new l.aI(v,s.u_camera_to_center_distance),u_pitch:new l.aI(v,s.u_pitch),u_rotate_symbol:new l.aH(v,s.u_rotate_symbol),u_aspect_ratio:new l.aI(v,s.u_aspect_ratio),u_fade_change:new l.aI(v,s.u_fade_change),u_matrix:new l.aJ(v,s.u_matrix),u_label_plane_matrix:new l.aJ(v,s.u_label_plane_matrix),u_coord_matrix:new l.aJ(v,s.u_coord_matrix),u_is_text:new l.aH(v,s.u_is_text),u_pitch_with_map:new l.aH(v,s.u_pitch_with_map),u_is_along_line:new l.aH(v,s.u_is_along_line),u_is_variable_anchor:new l.aH(v,s.u_is_variable_anchor),u_texsize:new l.aO(v,s.u_texsize),u_texture:new l.aH(v,s.u_texture),u_gamma_scale:new l.aI(v,s.u_gamma_scale),u_device_pixel_ratio:new l.aI(v,s.u_device_pixel_ratio),u_is_halo:new l.aH(v,s.u_is_halo),u_translation:new l.aO(v,s.u_translation),u_pitched_scale:new l.aI(v,s.u_pitched_scale)}),symbolTextAndIcon:(v,s)=>({u_is_size_zoom_constant:new l.aH(v,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(v,s.u_is_size_feature_constant),u_size_t:new l.aI(v,s.u_size_t),u_size:new l.aI(v,s.u_size),u_camera_to_center_distance:new l.aI(v,s.u_camera_to_center_distance),u_pitch:new l.aI(v,s.u_pitch),u_rotate_symbol:new l.aH(v,s.u_rotate_symbol),u_aspect_ratio:new l.aI(v,s.u_aspect_ratio),u_fade_change:new l.aI(v,s.u_fade_change),u_matrix:new l.aJ(v,s.u_matrix),u_label_plane_matrix:new l.aJ(v,s.u_label_plane_matrix),u_coord_matrix:new l.aJ(v,s.u_coord_matrix),u_is_text:new l.aH(v,s.u_is_text),u_pitch_with_map:new l.aH(v,s.u_pitch_with_map),u_is_along_line:new l.aH(v,s.u_is_along_line),u_is_variable_anchor:new l.aH(v,s.u_is_variable_anchor),u_texsize:new l.aO(v,s.u_texsize),u_texsize_icon:new l.aO(v,s.u_texsize_icon),u_texture:new l.aH(v,s.u_texture),u_texture_icon:new l.aH(v,s.u_texture_icon),u_gamma_scale:new l.aI(v,s.u_gamma_scale),u_device_pixel_ratio:new l.aI(v,s.u_device_pixel_ratio),u_is_halo:new l.aH(v,s.u_is_halo),u_translation:new l.aO(v,s.u_translation),u_pitched_scale:new l.aI(v,s.u_pitched_scale)}),background:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_opacity:new l.aI(v,s.u_opacity),u_color:new l.aL(v,s.u_color)}),backgroundPattern:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_opacity:new l.aI(v,s.u_opacity),u_image:new l.aH(v,s.u_image),u_pattern_tl_a:new l.aO(v,s.u_pattern_tl_a),u_pattern_br_a:new l.aO(v,s.u_pattern_br_a),u_pattern_tl_b:new l.aO(v,s.u_pattern_tl_b),u_pattern_br_b:new l.aO(v,s.u_pattern_br_b),u_texsize:new l.aO(v,s.u_texsize),u_mix:new l.aI(v,s.u_mix),u_pattern_size_a:new l.aO(v,s.u_pattern_size_a),u_pattern_size_b:new l.aO(v,s.u_pattern_size_b),u_scale_a:new l.aI(v,s.u_scale_a),u_scale_b:new l.aI(v,s.u_scale_b),u_pixel_coord_upper:new l.aO(v,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(v,s.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aI(v,s.u_tile_units_to_pixels)}),terrain:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_texture:new l.aH(v,s.u_texture),u_ele_delta:new l.aI(v,s.u_ele_delta),u_fog_matrix:new l.aJ(v,s.u_fog_matrix),u_fog_color:new l.aL(v,s.u_fog_color),u_fog_ground_blend:new l.aI(v,s.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.aI(v,s.u_fog_ground_blend_opacity),u_horizon_color:new l.aL(v,s.u_horizon_color),u_horizon_fog_blend:new l.aI(v,s.u_horizon_fog_blend)}),terrainDepth:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_ele_delta:new l.aI(v,s.u_ele_delta)}),terrainCoords:(v,s)=>({u_matrix:new l.aJ(v,s.u_matrix),u_texture:new l.aH(v,s.u_texture),u_terrain_coords_id:new l.aI(v,s.u_terrain_coords_id),u_ele_delta:new l.aI(v,s.u_ele_delta)}),sky:(v,s)=>({u_sky_color:new l.aL(v,s.u_sky_color),u_horizon_color:new l.aL(v,s.u_horizon_color),u_horizon:new l.aI(v,s.u_horizon),u_sky_horizon_blend:new l.aI(v,s.u_sky_horizon_blend)})};class Ls{constructor(s,d,p){this.context=s;const m=s.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const h0={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class xd{constructor(s,d,p,m){this.length=d.length,this.attributes=p,this.itemSize=d.bytesPerElement,this.dynamicDraw=m,this.context=s;const y=s.gl;this.buffer=y.createBuffer(),s.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,d){for(let p=0;p<this.attributes.length;p++){const m=d.attributes[this.attributes[p].name];m!==void 0&&s.enableVertexAttribArray(m)}}setVertexAttribPointers(s,d,p){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],T=d.attributes[y.name];T!==void 0&&s.vertexAttribPointer(T,y.components,s[h0[y.type]],!1,this.itemSize,y.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const aa=new WeakMap;function Do(v){var s;if(aa.has(v))return aa.get(v);{const d=(s=v.getParameter(v.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return aa.set(v,d),d}}class ni{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class mu extends ni{getDefault(){return l.aM.transparent}set(s){const d=this.current;(s.r!==d.r||s.g!==d.g||s.b!==d.b||s.a!==d.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class d0 extends ni{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Ha extends ni{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class f0 extends ni{getDefault(){return[!0,!0,!0,!0]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||s[3]!==d[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class lm extends ni{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class p0 extends ni{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class cm extends ni{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const d=this.current;(s.func!==d.func||s.ref!==d.ref||s.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class bd extends ni{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class um extends ni{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=s,this.dirty=!1}}class hm extends ni{getDefault(){return[0,1]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class dm extends ni{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=s,this.dirty=!1}}class fm extends ni{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class la extends ni{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.BLEND):d.disable(d.BLEND),this.current=s,this.dirty=!1}}class pm extends ni{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class m0 extends ni{getDefault(){return l.aM.transparent}set(s){const d=this.current;(s.r!==d.r||s.g!==d.g||s.b!==d.b||s.a!==d.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class mm extends ni{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class ac extends ni{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=s,this.dirty=!1}}class g0 extends ni{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class gu extends ni{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class _0 extends ni{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class y0 extends ni{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class gm extends ni{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||s[3]!==d[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class _m extends ni{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class ym extends ni{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class wd extends ni{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class vm extends ni{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class _u extends ni{getDefault(){return null}set(s){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class no extends ni{getDefault(){return null}set(s){var d;if(s===this.current&&!this.dirty)return;const p=this.gl;Do(p)?p.bindVertexArray(s):(d=p.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class Ad extends ni{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Td extends ni{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Ed extends ni{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class yu extends ni{constructor(s,d){super(s),this.context=s,this.parent=d}getDefault(){return null}}class Sd extends yu{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class ca extends yu{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Cd extends yu{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class v0{constructor(s,d,p,m,y){this.context=s,this.width=d,this.height=p;const T=s.gl,C=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new Sd(s,C),m)this.depthAttachment=y?new Cd(s,C):new ca(s,C);else if(y)throw new Error("Stencil cannot be set without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,d=this.colorAttachment.get();if(d&&s.deleteTexture(d),this.depthAttachment){const p=this.depthAttachment.get();p&&s.deleteRenderbuffer(p)}s.deleteFramebuffer(this.framebuffer)}}class Wi{constructor(s,d,p){this.blendFunction=s,this.blendColor=d,this.mask=p}}Wi.Replace=[1,0],Wi.disabled=new Wi(Wi.Replace,l.aM.transparent,[!1,!1,!1,!1]),Wi.unblended=new Wi(Wi.Replace,l.aM.transparent,[!0,!0,!0,!0]),Wi.alphaBlended=new Wi([1,771],l.aM.transparent,[!0,!0,!0,!0]);class x0{constructor(s){var d,p;if(this.gl=s,this.clearColor=new mu(this),this.clearDepth=new d0(this),this.clearStencil=new Ha(this),this.colorMask=new f0(this),this.depthMask=new lm(this),this.stencilMask=new p0(this),this.stencilFunc=new cm(this),this.stencilOp=new bd(this),this.stencilTest=new um(this),this.depthRange=new hm(this),this.depthTest=new dm(this),this.depthFunc=new fm(this),this.blend=new la(this),this.blendFunc=new pm(this),this.blendColor=new m0(this),this.blendEquation=new mm(this),this.cullFace=new ac(this),this.cullFaceSide=new g0(this),this.frontFace=new gu(this),this.program=new _0(this),this.activeTexture=new y0(this),this.viewport=new gm(this),this.bindFramebuffer=new _m(this),this.bindRenderbuffer=new ym(this),this.bindTexture=new wd(this),this.bindVertexBuffer=new vm(this),this.bindElementBuffer=new _u(this),this.bindVertexArray=new no(this),this.pixelStoreUnpack=new Ad(this),this.pixelStoreUnpackPremultiplyAlpha=new Td(this),this.pixelStoreUnpackFlipY=new Ed(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),Do(s)){this.HALF_FLOAT=s.HALF_FLOAT;const m=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=s.RGBA16F)!==null&&d!==void 0?d:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=s.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const m=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,d){return new Ls(this,s,d)}createVertexBuffer(s,d,p){return new xd(this,s,d,p)}createRenderbuffer(s,d,p){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,s,d,p),this.bindRenderbuffer.set(null),y}createFramebuffer(s,d,p,m){return new v0(this,s,d,p,m)}clear({color:s,depth:d,stencil:p}){const m=this.gl;let y=0;s&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),p!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(y)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){l.aE(s.blendFunction,Wi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return Do(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var d;return Do(this.gl)?this.gl.deleteVertexArray(s):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class zt{constructor(s,d,p){this.func=s,this.mask=d,this.range=p}}zt.ReadOnly=!1,zt.ReadWrite=!0,zt.disabled=new zt(519,zt.ReadOnly,[0,1]);const vu=7680;class vi{constructor(s,d,p,m,y,T){this.test=s,this.ref=d,this.mask=p,this.fail=m,this.depthFail=y,this.pass=T}}vi.disabled=new vi({func:519,mask:0},0,0,vu,vu,vu);class ci{constructor(s,d,p){this.enable=s,this.mode=d,this.frontFace=p}}let ua;function lc(v,s,d,p,m){const y=v.context,T=y.gl,C=v.useProgram("collisionBox"),P=[];let D=0,F=0;for(let ue=0;ue<p.length;ue++){const pe=p[ue],re=s.getTile(pe).getBucket(d);if(!re)continue;const ye=m?re.textCollisionBox:re.iconCollisionBox,xe=re.collisionCircleArray;if(xe.length>0){const Se=l.H();l.aQ(Se,re.placementInvProjMatrix,v.transform.glCoordMatrix),l.aQ(Se,Se,re.placementViewportMatrix),P.push({circleArray:xe,circleOffset:F,transform:pe.posMatrix,invTransform:Se,coord:pe}),D+=xe.length/4,F=D}ye&&C.draw(y,T.LINES,zt.disabled,vi.disabled,v.colorModeForRenderPass(),ci.disabled,{u_matrix:pe.posMatrix,u_pixel_extrude_scale:[1/(N=v.transform).width,1/N.height]},v.style.map.terrain&&v.style.map.terrain.getTerrainData(pe),d.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,null,v.transform.zoom,null,null,ye.collisionVertexBuffer)}var N;if(!m||!P.length)return;const H=v.useProgram("collisionCircle"),J=new l.aR;J.resize(4*D),J._trim();let te=0;for(const ue of P)for(let pe=0;pe<ue.circleArray.length/4;pe++){const re=4*pe,ye=ue.circleArray[re+0],xe=ue.circleArray[re+1],Se=ue.circleArray[re+2],Le=ue.circleArray[re+3];J.emplace(te++,ye,xe,Se,Le,0),J.emplace(te++,ye,xe,Se,Le,1),J.emplace(te++,ye,xe,Se,Le,2),J.emplace(te++,ye,xe,Se,Le,3)}(!ua||ua.length<2*D)&&(ua=function(ue){const pe=2*ue,re=new l.aT;re.resize(pe),re._trim();for(let ye=0;ye<pe;ye++){const xe=6*ye;re.uint16[xe+0]=4*ye+0,re.uint16[xe+1]=4*ye+1,re.uint16[xe+2]=4*ye+2,re.uint16[xe+3]=4*ye+2,re.uint16[xe+4]=4*ye+3,re.uint16[xe+5]=4*ye+0}return re}(D));const oe=y.createIndexBuffer(ua,!0),ce=y.createVertexBuffer(J,l.aS.members,!0);for(const ue of P){const pe=yn(ue.transform,ue.invTransform,v.transform);H.draw(y,T.TRIANGLES,zt.disabled,vi.disabled,v.colorModeForRenderPass(),ci.disabled,pe,v.style.map.terrain&&v.style.map.terrain.getTerrainData(ue.coord),d.id,ce,oe,l.a0.simpleSegment(0,2*ue.circleOffset,ue.circleArray.length,ue.circleArray.length/2),null,v.transform.zoom,null,null,null)}ce.destroy(),oe.destroy()}ci.disabled=new ci(!1,1029,2305),ci.backCCW=new ci(!0,1029,2305);const cc=l.an(new Float32Array(16));function Id(v,s,d,p,m,y){const{horizontalAlign:T,verticalAlign:C}=l.au(v);return new l.P((-(T-.5)*s/m+p[0])*y,(-(C-.5)*d/m+p[1])*y)}function ha(v,s,d,p,m,y){const T=s.tileAnchorPoint.add(new l.P(s.translation[0],s.translation[1]));if(s.pitchWithMap){let C=p.mult(y);d||(C=C.rotate(-m));const P=T.add(C);return ae(P.x,P.y,s.labelPlaneMatrix,s.getElevation).point}if(d){const C=ke(s.tileAnchorPoint.x+1,s.tileAnchorPoint.y,s).point.sub(v),P=Math.atan(C.y/C.x)+(C.x<0?Math.PI:0);return v.add(p.rotate(P))}return v.add(p)}function $a(v,s,d,p,m,y,T,C,P,D,F,N,H,J){const te=v.text.placedSymbolArray,oe=v.text.dynamicLayoutVertexArray,ce=v.icon.dynamicLayoutVertexArray,ue={};oe.clear();for(let pe=0;pe<te.length;pe++){const re=te.get(pe),ye=re.hidden||!re.crossTileID||v.allowVerticalPlacement&&!re.placedOrientation?null:p[re.crossTileID];if(ye){const xe=new l.P(re.anchorX,re.anchorY),Se={getElevation:J,width:m.width,height:m.height,labelPlaneMatrix:y,lineVertexArray:null,pitchWithMap:d,projection:F,projectionCache:null,tileAnchorPoint:xe,translation:N,unwrappedTileID:H},Le=d?ae(xe.x,xe.y,T,J):ke(xe.x,xe.y,Se),Ge=V(m.cameraToCenterDistance,Le.signedDistanceFromCamera);let nt=l.ai(v.textSizeData,P,re)*Ge/l.ap;d&&(nt*=v.tilePixelRatio/C);const{width:at,height:et,anchor:Ye,textOffset:pt,textBoxScale:Mt}=ye,tt=Id(Ye,at,et,pt,Mt,nt),st=F.getPitchedTextCorrection(m,xe.add(new l.P(N[0],N[1])),H),It=ha(Le.point,Se,s,tt,m.angle,st),Ti=v.allowVerticalPlacement&&re.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let kt=0;kt<re.numGlyphs;kt++)l.aj(oe,It,Ti);D&&re.associatedIconIndex>=0&&(ue[re.associatedIconIndex]={shiftedAnchor:It,angle:Ti})}else xt(re.numGlyphs,oe)}if(D){ce.clear();const pe=v.icon.placedSymbolArray;for(let re=0;re<pe.length;re++){const ye=pe.get(re);if(ye.hidden)xt(ye.numGlyphs,ce);else{const xe=ue[re];if(xe)for(let Se=0;Se<ye.numGlyphs;Se++)l.aj(ce,xe.shiftedAnchor,xe.angle);else xt(ye.numGlyphs,ce)}}v.icon.dynamicLayoutVertexBuffer.updateData(ce)}v.text.dynamicLayoutVertexBuffer.updateData(oe)}function Wr(v,s,d){return d.iconsInText&&s?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function Rd(v,s,d,p,m,y,T,C,P,D,F,N){const H=v.context,J=H.gl,te=v.transform,oe=ks(),ce=C==="map",ue=P==="map",pe=C!=="viewport"&&d.layout.get("symbol-placement")!=="point",re=ce&&!ue&&!pe,ye=!ue&&pe,xe=!d.layout.get("symbol-sort-key").isConstant();let Se=!1;const Le=v.depthModeForSublayer(0,zt.ReadOnly),Ge=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),nt=[],at=oe.getCircleRadiusCorrection(te);for(const et of p){const Ye=s.getTile(et),pt=Ye.getBucket(d);if(!pt)continue;const Mt=m?pt.text:pt.icon;if(!Mt||!Mt.segments.get().length||!Mt.hasVisibleVertices)continue;const tt=Mt.programConfigurations.get(d.id),st=m||pt.sdfIcons,It=m?pt.textSizeData:pt.iconSizeData,Ti=ue||te.pitch!==0,kt=v.useProgram(Wr(st,m,pt),tt),jt=l.ag(It,te.zoom),Ei=v.style.map.terrain&&v.style.map.terrain.getTerrainData(et);let zn,fs,Si,mr,ir=[0,0],Vn=null;if(m)fs=Ye.glyphAtlasTexture,Si=J.LINEAR,zn=Ye.glyphAtlasTexture.size,pt.iconsInText&&(ir=Ye.imageAtlasTexture.size,Vn=Ye.imageAtlasTexture,mr=Ti||v.options.rotating||v.options.zooming||It.kind==="composite"||It.kind==="camera"?J.LINEAR:J.NEAREST);else{const Gt=d.layout.get("icon-size").constantOr(0)!==1||pt.iconsNeedLinear;fs=Ye.imageAtlasTexture,Si=st||v.options.rotating||v.options.zooming||Gt||Ti?J.LINEAR:J.NEAREST,zn=Ye.imageAtlasTexture.size}const nr=Nt(Ye,1,v.transform.zoom),Vs=ye?et.posMatrix:cc,ol=us(Vs,ue,ce,v.transform,nr),Lu=Br(Vs,ue,ce,v.transform,nr),al=Br(et.posMatrix,ue,ce,v.transform,nr),Kr=oe.translatePosition(v.transform,Ye,y,T),Uu=Ge&&pt.hasTextData(),ef=d.layout.get("icon-text-fit")!=="none"&&Uu&&pt.hasIconData();if(pe){const Gt=v.style.map.terrain?(ll,cl)=>v.style.map.terrain.getElevation(et,ll,cl):null,ga=d.layout.get("text-rotation-alignment")==="map";Y(pt,et.posMatrix,v,m,ol,al,ue,D,ga,oe,et.toUnwrapped(),te.width,te.height,Kr,Gt)}const Zr=et.posMatrix,Yr=m&&Ge||ef,Oo=pe||Yr?cc:ol,ps=Lu,Rn=st&&d.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let jn;jn=st?pt.iconsInText?_d(It.kind,jt,re,ue,pe,Yr,v,Zr,Oo,ps,Kr,zn,ir,at):oc(It.kind,jt,re,ue,pe,Yr,v,Zr,Oo,ps,Kr,m,zn,!0,at):am(It.kind,jt,re,ue,pe,Yr,v,Zr,Oo,ps,Kr,m,zn,at);const kr={program:kt,buffers:Mt,uniformValues:jn,atlasTexture:fs,atlasTextureIcon:Vn,atlasInterpolation:Si,atlasInterpolationIcon:mr,isSDF:st,hasHalo:Rn};if(xe&&pt.canOverlap){Se=!0;const Gt=Mt.segments.get();for(const ga of Gt)nt.push({segments:new l.a0([ga]),sortKey:ga.sortKey,state:kr,terrainData:Ei})}else nt.push({segments:Mt.segments,sortKey:0,state:kr,terrainData:Ei})}Se&&nt.sort((et,Ye)=>et.sortKey-Ye.sortKey);for(const et of nt){const Ye=et.state;if(H.activeTexture.set(J.TEXTURE0),Ye.atlasTexture.bind(Ye.atlasInterpolation,J.CLAMP_TO_EDGE),Ye.atlasTextureIcon&&(H.activeTexture.set(J.TEXTURE1),Ye.atlasTextureIcon&&Ye.atlasTextureIcon.bind(Ye.atlasInterpolationIcon,J.CLAMP_TO_EDGE)),Ye.isSDF){const pt=Ye.uniformValues;Ye.hasHalo&&(pt.u_is_halo=1,Pd(Ye.buffers,et.segments,d,v,Ye.program,Le,F,N,pt,et.terrainData)),pt.u_is_halo=0}Pd(Ye.buffers,et.segments,d,v,Ye.program,Le,F,N,Ye.uniformValues,et.terrainData)}}function Pd(v,s,d,p,m,y,T,C,P,D){const F=p.context;m.draw(F,F.gl.TRIANGLES,y,T,C,ci.disabled,P,D,d.id,v.layoutVertexBuffer,v.indexBuffer,s,d.paint,p.transform.zoom,v.programConfigurations.get(d.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function Md(v,s,d,p){const m=v.context,y=m.gl,T=vi.disabled,C=new Wi([y.ONE,y.ONE],l.aM.transparent,[!0,!0,!0,!0]),P=s.getBucket(d);if(!P)return;const D=p.key;let F=d.heatmapFbos.get(D);F||(F=uc(m,s.tileSize,s.tileSize),d.heatmapFbos.set(D,F)),m.bindFramebuffer.set(F.framebuffer),m.viewport.set([0,0,s.tileSize,s.tileSize]),m.clear({color:l.aM.transparent});const N=P.programConfigurations.get(d.id),H=v.useProgram("heatmap",N),J=v.style.map.terrain.getTerrainData(p);H.draw(m,y.TRIANGLES,zt.disabled,T,C,ci.disabled,pr(p.posMatrix,s,v.transform.zoom,d.paint.get("heatmap-intensity")),J,d.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,d.paint,v.transform.zoom,N)}function da(v,s,d){const p=v.context,m=p.gl;p.setColorMode(v.colorModeForRenderPass());const y=hc(p,s),T=d.key,C=s.heatmapFbos.get(T);C&&(p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,C.colorAttachment.get()),p.activeTexture.set(m.TEXTURE1),y.bind(m.LINEAR,m.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(p,m.TRIANGLES,zt.disabled,vi.disabled,v.colorModeForRenderPass(),ci.disabled,hu(v,s,0,1),null,s.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,s.paint,v.transform.zoom),C.destroy(),s.heatmapFbos.delete(T))}function uc(v,s,d){var p,m;const y=v.gl,T=y.createTexture();y.bindTexture(y.TEXTURE_2D,T),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const C=(p=v.HALF_FLOAT)!==null&&p!==void 0?p:y.UNSIGNED_BYTE,P=(m=v.RGBA16F)!==null&&m!==void 0?m:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,P,s,d,0,y.RGBA,C,null);const D=v.createFramebuffer(s,d,!1,!1);return D.colorAttachment.set(T),D}function hc(v,s){return s.colorRampTexture||(s.colorRampTexture=new Ke(v,s.colorRamp,v.gl.RGBA)),s.colorRampTexture}function Ga(v,s,d,p,m){if(!d||!p||!p.imageAtlas)return;const y=p.imageAtlas.patternPositions;let T=y[d.to.toString()],C=y[d.from.toString()];if(!T&&C&&(T=C),!C&&T&&(C=T),!T||!C){const P=m.getPaintProperty(s);T=y[P],C=y[P]}T&&C&&v.setConstantPatternPositions(T,C)}function dc(v,s,d,p,m,y,T){const C=v.context.gl,P="fill-pattern",D=d.paint.get(P),F=D&&D.constantOr(1),N=d.getCrossfadeParameters();let H,J,te,oe,ce;T?(J=F&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=C.LINES):(J=F?"fillPattern":"fill",H=C.TRIANGLES);const ue=D.constantOr(null);for(const pe of p){const re=s.getTile(pe);if(F&&!re.patternsLoaded())continue;const ye=re.getBucket(d);if(!ye)continue;const xe=ye.programConfigurations.get(d.id),Se=v.useProgram(J,xe),Le=v.style.map.terrain&&v.style.map.terrain.getTerrainData(pe);F&&(v.context.activeTexture.set(C.TEXTURE0),re.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),xe.updatePaintBuffers(N)),Ga(xe,P,ue,re,d);const Ge=Le?pe:null,nt=v.translatePosMatrix(Ge?Ge.posMatrix:pe.posMatrix,re,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(T){oe=ye.indexBuffer2,ce=ye.segments2;const at=[C.drawingBufferWidth,C.drawingBufferHeight];te=J==="fillOutlinePattern"&&F?an(nt,v,N,re,at):on(nt,at)}else oe=ye.indexBuffer,ce=ye.segments,te=F?Vt(nt,v,N,re):ht(nt);Se.draw(v.context,H,m,v.stencilModeForClipping(pe),y,ci.disabled,te,Le,d.id,ye.layoutVertexBuffer,oe,ce,d.paint,v.transform.zoom,xe)}}function xu(v,s,d,p,m,y,T){const C=v.context,P=C.gl,D="fill-extrusion-pattern",F=d.paint.get(D),N=F.constantOr(1),H=d.getCrossfadeParameters(),J=d.paint.get("fill-extrusion-opacity"),te=F.constantOr(null);for(const oe of p){const ce=s.getTile(oe),ue=ce.getBucket(d);if(!ue)continue;const pe=v.style.map.terrain&&v.style.map.terrain.getTerrainData(oe),re=ue.programConfigurations.get(d.id),ye=v.useProgram(N?"fillExtrusionPattern":"fillExtrusion",re);N&&(v.context.activeTexture.set(P.TEXTURE0),ce.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),re.updatePaintBuffers(H)),Ga(re,D,te,ce,d);const xe=v.translatePosMatrix(oe.posMatrix,ce,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Se=d.paint.get("fill-extrusion-vertical-gradient"),Le=N?$e(xe,v,Se,J,oe,H,ce):De(xe,v,Se,J);ye.draw(C,C.gl.TRIANGLES,m,y,T,ci.backCCW,Le,pe,d.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,d.paint,v.transform.zoom,re,v.style.map.terrain&&ue.centroidVertexBuffer)}}function Wa(v,s,d,p,m,y,T){const C=v.context,P=C.gl,D=d.fbo;if(!D)return;const F=v.useProgram("hillshade"),N=v.style.map.terrain&&v.style.map.terrain.getTerrainData(s);C.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,D.colorAttachment.get()),F.draw(C,P.TRIANGLES,m,y,T,ci.disabled,((H,J,te,oe)=>{const ce=te.paint.get("hillshade-shadow-color"),ue=te.paint.get("hillshade-highlight-color"),pe=te.paint.get("hillshade-accent-color");let re=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);te.paint.get("hillshade-illumination-anchor")==="viewport"&&(re-=H.transform.angle);const ye=!H.options.moving;return{u_matrix:oe?oe.posMatrix:H.transform.calculatePosMatrix(J.tileID.toUnwrapped(),ye),u_image:0,u_latrange:du(0,J.tileID),u_light:[te.paint.get("hillshade-exaggeration"),re],u_shadow:ce,u_highlight:ue,u_accent:pe}})(v,d,p,N?s:null),N,p.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}function Xa(v,s,d,p,m,y){const T=v.context,C=T.gl,P=s.dem;if(P&&P.data){const D=P.dim,F=P.stride,N=P.getPixels();if(T.activeTexture.set(C.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||v.getTileTexture(F),s.demTexture){const J=s.demTexture;J.update(N,{premultiply:!1}),J.bind(C.NEAREST,C.CLAMP_TO_EDGE)}else s.demTexture=new Ke(T,N,C.RGBA,{premultiply:!1}),s.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);T.activeTexture.set(C.TEXTURE0);let H=s.fbo;if(!H){const J=new Ke(T,{width:D,height:D,data:null},C.RGBA);J.bind(C.LINEAR,C.CLAMP_TO_EDGE),H=s.fbo=T.createFramebuffer(D,D,!0,!1),H.colorAttachment.set(J.texture)}T.bindFramebuffer.set(H.framebuffer),T.viewport.set([0,0,D,D]),v.useProgram("hillshadePrepare").draw(T,C.TRIANGLES,p,m,y,ci.disabled,((J,te)=>{const oe=te.stride,ce=l.H();return l.aP(ce,0,l.X,-l.X,0,0,1),l.J(ce,ce,[0,-l.X,0]),{u_matrix:ce,u_image:1,u_dimension:[oe,oe],u_zoom:J.overscaledZ,u_unpack:te.getUnpackVector()}})(s.tileID,P),null,d.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function xm(v,s,d,p,m,y){const T=p.paint.get("raster-fade-duration");if(!y&&T>0){const C=I.now(),P=(C-v.timeAdded)/T,D=s?(C-s.timeAdded)/T:-1,F=d.getSource(),N=m.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),H=!s||Math.abs(s.tileID.overscaledZ-N)>Math.abs(v.tileID.overscaledZ-N),J=H&&v.refreshedUponExpiration?1:l.ac(H?P:1-D,0,1);return v.refreshedUponExpiration&&P>=1&&(v.refreshedUponExpiration=!1),s?{opacity:1,mix:1-J}:{opacity:J,mix:0}}return{opacity:1,mix:0}}const Bd=new l.aM(1,0,0,1),Qt=new l.aM(0,1,0,1),bu=new l.aM(0,0,1,1),b0=new l.aM(1,0,1,1),bm=new l.aM(0,1,1,1);function qa(v,s,d,p){wu(v,0,s+d/2,v.transform.width,d,p)}function wm(v,s,d,p){wu(v,s-d/2,0,d,v.transform.height,p)}function wu(v,s,d,p,m,y){const T=v.context,C=T.gl;C.enable(C.SCISSOR_TEST),C.scissor(s*v.pixelRatio,d*v.pixelRatio,p*v.pixelRatio,m*v.pixelRatio),T.clear({color:y}),C.disable(C.SCISSOR_TEST)}function Am(v,s,d){const p=v.context,m=p.gl,y=d.posMatrix,T=v.useProgram("debug"),C=zt.disabled,P=vi.disabled,D=v.colorModeForRenderPass(),F="$debug",N=v.style.map.terrain&&v.style.map.terrain.getTerrainData(d);p.activeTexture.set(m.TEXTURE0);const H=s.getTileByID(d.key).latestRawTileData,J=Math.floor((H&&H.byteLength||0)/1024),te=s.getTile(d).tileSize,oe=512/Math.min(te,512)*(d.overscaledZ/v.transform.zoom)*.5;let ce=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ce+=` => ${d.overscaledZ}`),function(ue,pe){ue.initDebugOverlayCanvas();const re=ue.debugOverlayCanvas,ye=ue.context.gl,xe=ue.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,re.width,re.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(pe,5,5),xe.strokeText(pe,5,5),ue.debugOverlayTexture.update(re),ue.debugOverlayTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE)}(v,`${ce} ${J}kB`),T.draw(p,m.TRIANGLES,C,P,Wi.alphaBlended,ci.disabled,sc(y,l.aM.transparent,oe),null,F,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),T.draw(p,m.LINE_STRIP,C,P,D,ci.disabled,sc(y,l.aM.red),N,F,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function Tm(v,s,d){const p=v.context,m=p.gl,y=v.colorModeForRenderPass(),T=new zt(m.LEQUAL,zt.ReadWrite,v.depthRangeFor3D),C=v.useProgram("terrain"),P=s.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,v.width,v.height]);for(const D of d){const F=v.renderToTexture.getTexture(D),N=s.getTerrainData(D.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,F.texture);const H=v.transform.calculatePosMatrix(D.tileID.toUnwrapped()),J=s.getMeshFrameDelta(v.transform.zoom),te=v.transform.calculateFogMatrix(D.tileID.toUnwrapped()),oe=rc(H,J,te,v.style.sky,v.transform.pitch);C.draw(p,m.TRIANGLES,T,vi.disabled,y,ci.backCCW,oe,N,"terrain",P.vertexBuffer,P.indexBuffer,P.segments)}}class Au{constructor(s,d,p){this.vertexBuffer=s,this.indexBuffer=d,this.segments=p}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Tu{constructor(s,d){this.context=new x0(s),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=St.maxUnderzooming+St.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new oa}resize(s,d,p){if(this.width=Math.floor(s*p),this.height=Math.floor(d*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const s=this.context,d=new l.aX;d.emplaceBack(0,0),d.emplaceBack(l.X,0),d.emplaceBack(0,l.X),d.emplaceBack(l.X,l.X),this.tileExtentBuffer=s.createVertexBuffer(d,Ns.members),this.tileExtentSegments=l.a0.simpleSegment(0,0,4,2);const p=new l.aX;p.emplaceBack(0,0),p.emplaceBack(l.X,0),p.emplaceBack(0,l.X),p.emplaceBack(l.X,l.X),this.debugBuffer=s.createVertexBuffer(p,Ns.members),this.debugSegments=l.a0.simpleSegment(0,0,4,5);const m=new l.$;m.emplaceBack(0,0,0,0),m.emplaceBack(l.X,0,l.X,0),m.emplaceBack(0,l.X,0,l.X),m.emplaceBack(l.X,l.X,l.X,l.X),this.rasterBoundsBuffer=s.createVertexBuffer(m,Ds.members),this.rasterBoundsSegments=l.a0.simpleSegment(0,0,4,2);const y=new l.aX;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(y,Ns.members),this.viewportSegments=l.a0.simpleSegment(0,0,4,2);const T=new l.aZ;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(T);const C=new l.aY;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(C);const P=this.context.gl;this.stencilClearMode=new vi({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO)}clearStencil(){const s=this.context,d=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=l.H();l.aP(p,0,this.width,this.height,0,0,1),l.K(p,p,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,d.TRIANGLES,zt.disabled,this.stencilClearMode,Wi.disabled,ci.disabled,fr(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,d){if(this.currentStencilSource===s.source||!s.isTileClipped()||!d||!d.length)return;this.currentStencilSource=s.source;const p=this.context,m=p.gl;this.nextStencilID+d.length>256&&this.clearStencil(),p.setColorMode(Wi.disabled),p.setDepthMode(zt.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of d){const C=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T);y.draw(p,m.TRIANGLES,zt.disabled,new vi({func:m.ALWAYS,mask:0},C,255,m.KEEP,m.KEEP,m.REPLACE),Wi.disabled,ci.disabled,fr(T.posMatrix),P,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,d=this.context.gl;return new vi({func:d.NOTEQUAL,mask:255},s,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(s){const d=this.context.gl;return new vi({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(s){const d=this.context.gl,p=s.sort((T,C)=>C.overscaledZ-T.overscaledZ),m=p[p.length-1].overscaledZ,y=p[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const T={};for(let C=0;C<y;C++)T[C+m]=new vi({func:d.GEQUAL,mask:255},C+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=y,[T,p]}return[{[m]:vi.disabled},p]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Wi([s.CONSTANT_COLOR,s.ONE],new l.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Wi.unblended:Wi.alphaBlended}depthModeForSublayer(s,d,p){if(!this.opaquePassEnabledForLayer())return zt.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new zt(p||this.context.gl.LEQUAL,d,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,d){this.style=s,this.options=d,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(I.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,y={},T={},C={};for(const P in m){const D=m[P];D.used&&D.prepare(this.context),y[P]=D.getVisibleCoordinates(),T[P]=y[P].slice().reverse(),C[P]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<p.length;P++)if(this.style._layers[p[P]].is3D()){this.opaquePassCutoff=P;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const P of p){const D=this.style._layers[P];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const F=T[D.source];(D.type==="custom"||F.length)&&this.renderLayer(this,m[D.source],D,F)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?l.aM.black:l.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(P,D){const F=P.context,N=F.gl,H=((ue,pe,re)=>({u_sky_color:ue.properties.get("sky-color"),u_horizon_color:ue.properties.get("horizon-color"),u_horizon:(pe.height/2+pe.getHorizon())*re,u_sky_horizon_blend:ue.properties.get("sky-horizon-blend")*pe.height/2*re}))(D,P.style.map.transform,P.pixelRatio),J=new zt(N.LEQUAL,zt.ReadWrite,[0,1]),te=vi.disabled,oe=P.colorModeForRenderPass(),ce=P.useProgram("sky");if(!D.mesh){const ue=new l.aX;ue.emplaceBack(-1,-1),ue.emplaceBack(1,-1),ue.emplaceBack(1,1),ue.emplaceBack(-1,1);const pe=new l.aY;pe.emplaceBack(0,1,2),pe.emplaceBack(0,2,3),D.mesh=new Au(F.createVertexBuffer(ue,Ns.members),F.createIndexBuffer(pe),l.a0.simpleSegment(0,0,ue.length,pe.length))}ce.draw(F,N.TRIANGLES,J,te,oe,ci.disabled,H,void 0,"sky",D.mesh.vertexBuffer,D.mesh.indexBuffer,D.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[p[this.currentLayer]],D=m[P.source],F=y[P.source];this._renderTileClippingMasks(P,F),this.renderLayer(this,D,P,F)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const P=this.style._layers[p[this.currentLayer]],D=m[P.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(P))continue;const F=(P.type==="symbol"?C:T)[P.source];this._renderTileClippingMasks(P,y[P.source]),this.renderLayer(this,D,P,F)}if(this.options.showTileBoundaries){const P=function(D,F){let N=null;const H=Object.values(D._layers).flatMap(ce=>ce.source&&!ce.isHidden(F)?[D.sourceCaches[ce.source]]:[]),J=H.filter(ce=>ce.getSource().type==="vector"),te=H.filter(ce=>ce.getSource().type!=="vector"),oe=ce=>{(!N||N.getSource().maxzoom<ce.getSource().maxzoom)&&(N=ce)};return J.forEach(ce=>oe(ce)),N||te.forEach(ce=>oe(ce)),N}(this.style,this.transform.zoom);P&&function(D,F,N){for(let H=0;H<N.length;H++)Am(D,F,N[H])}(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const D=P.transform.padding;qa(P,P.transform.height-(D.top||0),3,Bd),qa(P,D.bottom||0,3,Qt),wm(P,D.left||0,3,bu),wm(P,P.transform.width-(D.right||0),3,b0);const F=P.transform.centerPoint;(function(N,H,J,te){wu(N,H-1,J-10,2,20,te),wu(N,H-10,J-1,20,2,te)})(P,F.x,P.transform.height-F.y,bm)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,p=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=s?!l.a_(d,p):!l.a$(d,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(l.b0(d,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(y,T){const C=y.context,P=C.gl,D=Wi.unblended,F=new zt(P.LEQUAL,zt.ReadWrite,[0,1]),N=T.getTerrainMesh(),H=T.sourceCache.getRenderableTiles(),J=y.useProgram("terrainDepth");C.bindFramebuffer.set(T.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),C.clear({color:l.aM.transparent,depth:1});for(const te of H){const oe=T.getTerrainData(te.tileID),ce={u_matrix:y.transform.calculatePosMatrix(te.tileID.toUnwrapped()),u_ele_delta:T.getMeshFrameDelta(y.transform.zoom)};J.draw(C,P.TRIANGLES,F,vi.disabled,D,ci.backCCW,ce,oe,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain),function(y,T){const C=y.context,P=C.gl,D=Wi.unblended,F=new zt(P.LEQUAL,zt.ReadWrite,[0,1]),N=T.getTerrainMesh(),H=T.getCoordsTexture(),J=T.sourceCache.getRenderableTiles(),te=y.useProgram("terrainCoords");C.bindFramebuffer.set(T.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),C.clear({color:l.aM.transparent,depth:1}),T.coordsIndex=[];for(const oe of J){const ce=T.getTerrainData(oe.tileID);C.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,H.texture);const ue={u_matrix:y.transform.calculatePosMatrix(oe.tileID.toUnwrapped()),u_terrain_coords_id:(255-T.coordsIndex.length)/255,u_texture:0,u_ele_delta:T.getMeshFrameDelta(y.transform.zoom)};te.draw(C,P.TRIANGLES,F,vi.disabled,D,ci.backCCW,ue,ce,"terrain",N.vertexBuffer,N.indexBuffer,N.segments),T.coordsIndex.push(oe.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain))}renderLayer(s,d,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(y,T,C,P,D){if(y.renderPass!=="translucent")return;const F=vi.disabled,N=y.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(H,J,te,oe,ce,ue,pe,re,ye){const xe=J.transform,Se=ks(),Le=ce==="map",Ge=ue==="map";for(const nt of H){const at=oe.getTile(nt),et=at.getBucket(te);if(!et||!et.text||!et.text.segments.get().length)continue;const Ye=l.ag(et.textSizeData,xe.zoom),pt=Nt(at,1,J.transform.zoom),Mt=us(nt.posMatrix,Ge,Le,J.transform,pt),tt=te.layout.get("icon-text-fit")!=="none"&&et.hasIconData();if(Ye){const st=Math.pow(2,xe.zoom-at.tileID.overscaledZ),It=J.style.map.terrain?(kt,jt)=>J.style.map.terrain.getElevation(nt,kt,jt):null,Ti=Se.translatePosition(xe,at,pe,re);$a(et,Le,Ge,ye,xe,Mt,nt.posMatrix,st,Ye,tt,Se,Ti,nt.toUnwrapped(),It)}}}(P,y,C,T,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),D),C.paint.get("icon-opacity").constantOr(1)!==0&&Rd(y,T,C,P,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),F,N),C.paint.get("text-opacity").constantOr(1)!==0&&Rd(y,T,C,P,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),F,N),T.map.showCollisionBoxes&&(lc(y,T,C,P,!0),lc(y,T,C,P,!1))})(s,d,p,m,this.style.placement.variableOffsets);break;case"circle":(function(y,T,C,P){if(y.renderPass!=="translucent")return;const D=C.paint.get("circle-opacity"),F=C.paint.get("circle-stroke-width"),N=C.paint.get("circle-stroke-opacity"),H=!C.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(F.constantOr(1)===0||N.constantOr(1)===0))return;const J=y.context,te=J.gl,oe=y.depthModeForSublayer(0,zt.ReadOnly),ce=vi.disabled,ue=y.colorModeForRenderPass(),pe=[];for(let re=0;re<P.length;re++){const ye=P[re],xe=T.getTile(ye),Se=xe.getBucket(C);if(!Se)continue;const Le=Se.programConfigurations.get(C.id),Ge=y.useProgram("circle",Le),nt=Se.layoutVertexBuffer,at=Se.indexBuffer,et=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ye),Ye={programConfiguration:Le,program:Ge,layoutVertexBuffer:nt,indexBuffer:at,uniformValues:In(y,ye,xe,C),terrainData:et};if(H){const pt=Se.segments.get();for(const Mt of pt)pe.push({segments:new l.a0([Mt]),sortKey:Mt.sortKey,state:Ye})}else pe.push({segments:Se.segments,sortKey:0,state:Ye})}H&&pe.sort((re,ye)=>re.sortKey-ye.sortKey);for(const re of pe){const{programConfiguration:ye,program:xe,layoutVertexBuffer:Se,indexBuffer:Le,uniformValues:Ge,terrainData:nt}=re.state;xe.draw(J,te.TRIANGLES,oe,ce,ue,ci.disabled,Ge,nt,C.id,Se,Le,re.segments,C.paint,y.transform.zoom,ye)}})(s,d,p,m);break;case"heatmap":(function(y,T,C,P){if(C.paint.get("heatmap-opacity")===0)return;const D=y.context;if(y.style.map.terrain){for(const F of P){const N=T.getTile(F);T.hasRenderableParent(F)||(y.renderPass==="offscreen"?Md(y,N,C,F):y.renderPass==="translucent"&&da(y,C,F))}D.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?function(F,N,H,J){const te=F.context,oe=te.gl,ce=vi.disabled,ue=new Wi([oe.ONE,oe.ONE],l.aM.transparent,[!0,!0,!0,!0]);(function(pe,re,ye){const xe=pe.gl;pe.activeTexture.set(xe.TEXTURE1),pe.viewport.set([0,0,re.width/4,re.height/4]);let Se=ye.heatmapFbos.get(l.aU);Se?(xe.bindTexture(xe.TEXTURE_2D,Se.colorAttachment.get()),pe.bindFramebuffer.set(Se.framebuffer)):(Se=uc(pe,re.width/4,re.height/4),ye.heatmapFbos.set(l.aU,Se))})(te,F,H),te.clear({color:l.aM.transparent});for(let pe=0;pe<J.length;pe++){const re=J[pe];if(N.hasRenderableParent(re))continue;const ye=N.getTile(re),xe=ye.getBucket(H);if(!xe)continue;const Se=xe.programConfigurations.get(H.id),Le=F.useProgram("heatmap",Se),{zoom:Ge}=F.transform;Le.draw(te,oe.TRIANGLES,zt.disabled,ce,ue,ci.disabled,pr(re.posMatrix,ye,Ge,H.paint.get("heatmap-intensity")),null,H.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,H.paint,F.transform.zoom,Se)}te.viewport.set([0,0,F.width,F.height])}(y,T,C,P):y.renderPass==="translucent"&&function(F,N){const H=F.context,J=H.gl;H.setColorMode(F.colorModeForRenderPass());const te=N.heatmapFbos.get(l.aU);te&&(H.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,te.colorAttachment.get()),H.activeTexture.set(J.TEXTURE1),hc(H,N).bind(J.LINEAR,J.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(H,J.TRIANGLES,zt.disabled,vi.disabled,F.colorModeForRenderPass(),ci.disabled,hu(F,N,0,1),null,N.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,N.paint,F.transform.zoom))}(y,C)})(s,d,p,m);break;case"line":(function(y,T,C,P){if(y.renderPass!=="translucent")return;const D=C.paint.get("line-opacity"),F=C.paint.get("line-width");if(D.constantOr(1)===0||F.constantOr(1)===0)return;const N=y.depthModeForSublayer(0,zt.ReadOnly),H=y.colorModeForRenderPass(),J=C.paint.get("line-dasharray"),te=C.paint.get("line-pattern"),oe=te.constantOr(1),ce=C.paint.get("line-gradient"),ue=C.getCrossfadeParameters(),pe=oe?"linePattern":J?"lineSDF":ce?"lineGradient":"line",re=y.context,ye=re.gl;let xe=!0;for(const Se of P){const Le=T.getTile(Se);if(oe&&!Le.patternsLoaded())continue;const Ge=Le.getBucket(C);if(!Ge)continue;const nt=Ge.programConfigurations.get(C.id),at=y.context.program.get(),et=y.useProgram(pe,nt),Ye=xe||et.program!==at,pt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Se),Mt=te.constantOr(null);if(Mt&&Le.imageAtlas){const It=Le.imageAtlas,Ti=It.patternPositions[Mt.to.toString()],kt=It.patternPositions[Mt.from.toString()];Ti&&kt&&nt.setConstantPatternPositions(Ti,kt)}const tt=pt?Se:null,st=oe?ja(y,Le,C,ue,tt):J?l0(y,Le,C,J,ue,tt):ce?rm(y,Le,C,Ge.lineClipsArray.length,tt):fu(y,Le,C,tt);if(oe)re.activeTexture.set(ye.TEXTURE0),Le.imageAtlasTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),nt.updatePaintBuffers(ue);else if(J&&(Ye||y.lineAtlas.dirty))re.activeTexture.set(ye.TEXTURE0),y.lineAtlas.bind(re);else if(ce){const It=Ge.gradients[C.id];let Ti=It.texture;if(C.gradientVersion!==It.version){let kt=256;if(C.stepInterpolant){const jt=T.getSource().maxzoom,Ei=Se.canonical.z===jt?Math.ceil(1<<y.transform.maxZoom-Se.canonical.z):1;kt=l.ac(l.aV(Ge.maxLineLength/l.X*1024*Ei),256,re.maxTextureSize)}It.gradient=l.aW({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:kt,image:It.gradient||void 0,clips:Ge.lineClipsArray}),It.texture?It.texture.update(It.gradient):It.texture=new Ke(re,It.gradient,ye.RGBA),It.version=C.gradientVersion,Ti=It.texture}re.activeTexture.set(ye.TEXTURE0),Ti.bind(C.stepInterpolant?ye.NEAREST:ye.LINEAR,ye.CLAMP_TO_EDGE)}et.draw(re,ye.TRIANGLES,N,y.stencilModeForClipping(Se),H,ci.disabled,st,pt,C.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,C.paint,y.transform.zoom,nt,Ge.layoutVertexBuffer2),xe=!1}})(s,d,p,m);break;case"fill":(function(y,T,C,P){const D=C.paint.get("fill-color"),F=C.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const N=y.colorModeForRenderPass(),H=C.paint.get("fill-pattern"),J=y.opaquePassEnabledForLayer()&&!H.constantOr(1)&&D.constantOr(l.aM.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===J){const te=y.depthModeForSublayer(1,y.renderPass==="opaque"?zt.ReadWrite:zt.ReadOnly);dc(y,T,C,P,te,N,!1)}if(y.renderPass==="translucent"&&C.paint.get("fill-antialias")){const te=y.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,zt.ReadOnly);dc(y,T,C,P,te,N,!0)}})(s,d,p,m);break;case"fill-extrusion":(function(y,T,C,P){const D=C.paint.get("fill-extrusion-opacity");if(D!==0&&y.renderPass==="translucent"){const F=new zt(y.context.gl.LEQUAL,zt.ReadWrite,y.depthRangeFor3D);if(D!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))xu(y,T,C,P,F,vi.disabled,Wi.disabled),xu(y,T,C,P,F,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const N=y.colorModeForRenderPass();xu(y,T,C,P,F,vi.disabled,N)}}})(s,d,p,m);break;case"hillshade":(function(y,T,C,P){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const D=y.context,F=y.depthModeForSublayer(0,zt.ReadOnly),N=y.colorModeForRenderPass(),[H,J]=y.renderPass==="translucent"?y.stencilConfigForOverlap(P):[{},P];for(const te of J){const oe=T.getTile(te);oe.needsHillshadePrepare!==void 0&&oe.needsHillshadePrepare&&y.renderPass==="offscreen"?Xa(y,oe,C,F,vi.disabled,N):y.renderPass==="translucent"&&Wa(y,te,oe,C,F,H[te.overscaledZ],N)}D.viewport.set([0,0,y.width,y.height])})(s,d,p,m);break;case"raster":(function(y,T,C,P){if(y.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!P.length)return;const D=y.context,F=D.gl,N=T.getSource(),H=y.useProgram("raster"),J=y.colorModeForRenderPass(),[te,oe]=N instanceof ls?[{},P]:y.stencilConfigForOverlap(P),ce=oe[oe.length-1].overscaledZ,ue=!y.options.moving;for(const pe of oe){const re=y.depthModeForSublayer(pe.overscaledZ-ce,C.paint.get("raster-opacity")===1?zt.ReadWrite:zt.ReadOnly,F.LESS),ye=T.getTile(pe);ye.registerFadeDuration(C.paint.get("raster-fade-duration"));const xe=T.findLoadedParent(pe,0),Se=T.findLoadedSibling(pe),Le=xm(ye,xe||Se||null,T,C,y.transform,y.style.map.terrain);let Ge,nt;const at=C.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;D.activeTexture.set(F.TEXTURE0),ye.texture.bind(at,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(F.TEXTURE1),xe?(xe.texture.bind(at,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),Ge=Math.pow(2,xe.tileID.overscaledZ-ye.tileID.overscaledZ),nt=[ye.tileID.canonical.x*Ge%1,ye.tileID.canonical.y*Ge%1]):ye.texture.bind(at,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),ye.texture.useMipmap&&D.extTextureFilterAnisotropic&&y.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const et=y.style.map.terrain&&y.style.map.terrain.getTerrainData(pe),Ye=et?pe:null,pt=Ye?Ye.posMatrix:y.transform.calculatePosMatrix(pe.toUnwrapped(),ue),Mt=c0(pt,nt||[0,0],Ge||1,Le,C);N instanceof ls?H.draw(D,F.TRIANGLES,re,vi.disabled,J,ci.disabled,Mt,et,C.id,N.boundsBuffer,y.quadTriangleIndexBuffer,N.boundsSegments):H.draw(D,F.TRIANGLES,re,te[pe.overscaledZ],J,ci.disabled,Mt,et,C.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(s,d,p,m);break;case"background":(function(y,T,C,P){const D=C.paint.get("background-color"),F=C.paint.get("background-opacity");if(F===0)return;const N=y.context,H=N.gl,J=y.transform,te=J.tileSize,oe=C.paint.get("background-pattern");if(y.isPatternMissing(oe))return;const ce=!oe&&D.a===1&&F===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ce)return;const ue=vi.disabled,pe=y.depthModeForSublayer(0,ce==="opaque"?zt.ReadWrite:zt.ReadOnly),re=y.colorModeForRenderPass(),ye=y.useProgram(oe?"backgroundPattern":"background"),xe=P||J.coveringTiles({tileSize:te,terrain:y.style.map.terrain});oe&&(N.activeTexture.set(H.TEXTURE0),y.imageManager.bind(y.context));const Se=C.getCrossfadeParameters();for(const Le of xe){const Ge=P?Le.posMatrix:y.transform.calculatePosMatrix(Le.toUnwrapped()),nt=oe?yd(Ge,F,y,oe,{tileID:Le,tileSize:te},Se):pu(Ge,F,D),at=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Le);ye.draw(N,H.TRIANGLES,pe,ue,re,ci.disabled,nt,at,C.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(s,0,p,m);break;case"custom":(function(y,T,C){const P=y.context,D=C.implementation;if(y.renderPass==="offscreen"){const F=D.prerender;F&&(y.setCustomLayerDefaults(),P.setColorMode(y.colorModeForRenderPass()),F.call(D,P.gl,y.transform.customLayerMatrix()),P.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),P.setColorMode(y.colorModeForRenderPass()),P.setStencilMode(vi.disabled);const F=D.renderingMode==="3d"?new zt(y.context.gl.LEQUAL,zt.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,zt.ReadOnly);P.setDepthMode(F),D.render(P.gl,y.transform.customLayerMatrix(),{farZ:y.transform.farZ,nearZ:y.transform.nearZ,fov:y.transform._fov,modelViewProjectionMatrix:y.transform.modelViewProjectionMatrix,projectionMatrix:y.transform.projectionMatrix}),P.setDirty(),y.setBaseState(),P.bindFramebuffer.set(null)}})(s,0,p)}}translatePosMatrix(s,d,p,m,y){if(!p[0]&&!p[1])return s;const T=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(T){const D=Math.sin(T),F=Math.cos(T);p=[p[0]*F-p[1]*D,p[0]*D+p[1]*F]}const C=[y?p[0]:Nt(d,p[0],this.transform.zoom),y?p[1]:Nt(d,p[1],this.transform.zoom),0],P=new Float32Array(16);return l.J(P,s,C),P}saveTileTexture(s){const d=this._tileTextures[s.size[0]];d?d.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const d=this._tileTextures[s];return d&&d.length>0?d.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const d=this.imageManager.getPattern(s.from.toString()),p=this.imageManager.getPattern(s.to.toString());return!d||!p}useProgram(s,d){this.cache=this.cache||{};const p=s+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new ee(this.context,Gr[s],d,vd[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ke(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:d}=this.context.gl;return this.width!==s||this.height!==d}}class Ka{constructor(s,d){this.points=s,this.planes=d}static fromInvProjectionMatrix(s,d,p){const m=Math.pow(2,p),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const P=1/(C=l.af([],C,s))[3]/d*m;return l.b1(C,C,[P,P,1/C[3],P])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const P=function(H,J){var te=J[0],oe=J[1],ce=J[2],ue=te*te+oe*oe+ce*ce;return ue>0&&(ue=1/Math.sqrt(ue)),H[0]=J[0]*ue,H[1]=J[1]*ue,H[2]=J[2]*ue,H}([],function(H,J,te){var oe=J[0],ce=J[1],ue=J[2],pe=te[0],re=te[1],ye=te[2];return H[0]=ce*ye-ue*re,H[1]=ue*pe-oe*ye,H[2]=oe*re-ce*pe,H}([],Fe([],y[C[0]],y[C[1]]),Fe([],y[C[2]],y[C[1]]))),D=-((F=P)[0]*(N=y[C[1]])[0]+F[1]*N[1]+F[2]*N[2]);var F,N;return P.concat(D)});return new Ka(y,T)}}class Za{constructor(s,d){this.min=s,this.max=d,this.center=function(p,m,y){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,y){return p[0]=m[0]+y[0],p[1]=m[1]+y[1],p[2]=m[2]+y[2],p}([],this.min,this.max))}quadrant(s){const d=[s%2==0,s<2],p=Ce(this.min),m=Ce(this.max);for(let y=0;y<d.length;y++)p[y]=d[y]?this.min[y]:this.center[y],m[y]=d[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new Za(p,m)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<s.planes.length;m++){const y=s.planes[m];let T=0;for(let C=0;C<d.length;C++)l.b2(y,d[C])>=0&&T++;if(T===0)return 0;T!==d.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let y=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let C=0;C<s.points.length;C++){const P=s.points[C][m]-this.min[m];y=Math.min(y,P),T=Math.max(T,P)}if(T<0||y>this.max[m]-this.min[m])return 0}return 1}}class Ya{constructor(s=0,d=0,p=0,m=0){if(isNaN(s)||s<0||isNaN(d)||d<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=d,this.left=p,this.right=m}interpolate(s,d,p){return d.top!=null&&s.top!=null&&(this.top=l.y.number(s.top,d.top,p)),d.bottom!=null&&s.bottom!=null&&(this.bottom=l.y.number(s.bottom,d.bottom,p)),d.left!=null&&s.left!=null&&(this.left=l.y.number(s.left,d.left,p)),d.right!=null&&s.right!=null&&(this.right=l.y.number(s.right,d.right,p)),this}getCenter(s,d){const p=l.ac((this.left+s-this.right)/2,0,s),m=l.ac((this.top+d-this.bottom)/2,0,d);return new l.P(p,m)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Ya(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Dd=85.051129;class Ja{constructor(s,d,p,m,y){this.tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=s||0,this._maxZoom=d||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ya,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const s=new Ja(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.lngRange=s.lngRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this.minElevationForCurrentTile=s.minElevationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const d=-l.b3(s,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var p=new l.A(4);return l.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,y){var T=m[0],C=m[1],P=m[2],D=m[3],F=Math.sin(y),N=Math.cos(y);p[0]=T*N+P*F,p[1]=C*N+D*F,p[2]=T*-F+P*N,p[3]=C*-F+D*N}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const d=l.ac(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const d=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,d,p){this._unmodified=!1,this._edgeInsets.interpolate(s,d,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const d=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(s){const d=[new l.b4(0,s)];if(this._renderWorldCopies){const p=this.pointCoordinate(new l.P(0,0)),m=this.pointCoordinate(new l.P(this.width,0)),y=this.pointCoordinate(new l.P(this.width,this.height)),T=this.pointCoordinate(new l.P(0,this.height)),C=Math.floor(Math.min(p.x,m.x,y.x,T.x)),P=Math.floor(Math.max(p.x,m.x,y.x,T.x)),D=1;for(let F=C-D;F<=P+D;F++)F!==0&&d.push(new l.b4(F,s))}return d}coveringTiles(s){var d,p;let m=this.coveringZoomLevel(s);const y=m;if(s.minzoom!==void 0&&m<s.minzoom)return[];s.maxzoom!==void 0&&m>s.maxzoom&&(m=s.maxzoom);const T=this.pointCoordinate(this.getCameraPoint()),C=l.Z.fromLngLat(this.center),P=Math.pow(2,m),D=[P*T.x,P*T.y,0],F=[P*C.x,P*C.y,0],N=Ka.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,m);let H=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(H=m);const J=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,te=re=>({aabb:new Za([re*P,0,0],[(re+1)*P,P,0]),zoom:0,x:0,y:0,wrap:re,fullyVisible:!1}),oe=[],ce=[],ue=m,pe=s.reparseOverscaled?y:m;if(this._renderWorldCopies)for(let re=1;re<=3;re++)oe.push(te(-re)),oe.push(te(re));for(oe.push(te(0));oe.length>0;){const re=oe.pop(),ye=re.x,xe=re.y;let Se=re.fullyVisible;if(!Se){const et=re.aabb.intersects(N);if(et===0)continue;Se=et===2}const Le=s.terrain?D:F,Ge=re.aabb.distanceX(Le),nt=re.aabb.distanceY(Le),at=Math.max(Math.abs(Ge),Math.abs(nt));if(re.zoom===ue||at>J+(1<<ue-re.zoom)-2&&re.zoom>=H){const et=ue-re.zoom,Ye=D[0]-.5-(ye<<et),pt=D[1]-.5-(xe<<et);ce.push({tileID:new l.S(re.zoom===ue?pe:re.zoom,re.wrap,re.zoom,ye,xe),distanceSq:ze([F[0]-.5-ye,F[1]-.5-xe]),tileDistanceToCamera:Math.sqrt(Ye*Ye+pt*pt)})}else for(let et=0;et<4;et++){const Ye=(ye<<1)+et%2,pt=(xe<<1)+(et>>1),Mt=re.zoom+1;let tt=re.aabb.quadrant(et);if(s.terrain){const st=new l.S(Mt,re.wrap,Mt,Ye,pt),It=s.terrain.getMinMaxElevation(st),Ti=(d=It.minElevation)!==null&&d!==void 0?d:this.elevation,kt=(p=It.maxElevation)!==null&&p!==void 0?p:this.elevation;tt=new Za([tt.min[0],tt.min[1],Ti],[tt.max[0],tt.max[1],kt])}oe.push({aabb:tt,zoom:Mt,x:Ye,y:pt,wrap:re.wrap,fullyVisible:Se})}}return ce.sort((re,ye)=>re.distanceSq-ye.distanceSq).map(re=>re.tileID)}resize(s,d){this.width=s,this.height=d,this.pixelsToGLUnits=[2/s,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const d=l.ac(s.lat,-85.051129,Dd);return new l.P(l.O(s.lng)*this.worldSize,l.Q(d)*this.worldSize)}unproject(s){return new l.Z(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const d=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,s),y=s.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-y))return;const T=p+d-y,C=Math.cos(this._pitch)*this.cameraToCenterDistance/T/l.b5(1,m.lat),P=this.scaleZoom(C/this.tileSize);this._elevation=y,this._center=m,this.zoom=P}setLocationAtPoint(s,d){const p=this.pointCoordinate(d),m=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(s),T=new l.Z(y.x-(p.x-m.x),y.y-(p.y-m.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,d){return d?this.coordinatePoint(this.locationCoordinate(s),d.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,d){return this.coordinateLocation(this.pointCoordinate(s,d))}locationCoordinate(s){return l.Z.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,d){if(d){const H=d.pointCoordinate(s);if(H!=null)return H}const p=[s.x,s.y,0,1],m=[s.x,s.y,1,1];l.af(p,p,this.pixelMatrixInverse),l.af(m,m,this.pixelMatrixInverse);const y=p[3],T=m[3],C=p[1]/y,P=m[1]/T,D=p[2]/y,F=m[2]/T,N=D===F?0:(0-D)/(F-D);return new l.Z(l.y.number(p[0]/y,m[0]/T,N)/this.worldSize,l.y.number(C,P,N)/this.worldSize)}coordinatePoint(s,d=0,p=this.pixelMatrix){const m=[s.x*this.worldSize,s.y*this.worldSize,d,1];return l.af(m,m,p),new l.P(m[0]/m[3],m[1]/m[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new Pe().extend(this.pointLocation(new l.P(0,s))).extend(this.pointLocation(new l.P(this.width,s))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Pe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Dd])}calculateTileMatrix(s){const d=s.canonical,p=this.worldSize/this.zoomScale(d.z),m=d.x+Math.pow(2,d.z)*s.wrap,y=l.an(new Float64Array(16));return l.J(y,y,[m*p,d.y*p,0]),l.K(y,y,[p/l.X,p/l.X,1]),y}calculatePosMatrix(s,d=!1){const p=s.key,m=d?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const y=this.calculateTileMatrix(s);return l.L(y,d?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,y),m[p]=new Float32Array(y),m[p]}calculateFogMatrix(s){const d=s.key,p=this._fogMatrixCache;if(p[d])return p[d];const m=this.calculateTileMatrix(s);return l.L(m,this.fogMatrix,m),p[d]=new Float32Array(m),p[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(s,d){d=l.ac(+d,this.minZoom,this.maxZoom);const p={center:new l.N(s.lng,s.lat),zoom:d};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const re=179.9999999999;m=[-re,re]}const y=this.tileSize*this.zoomScale(p.zoom);let T=0,C=y,P=0,D=y,F=0,N=0;const{x:H,y:J}=this.size;if(this.latRange){const re=this.latRange;T=l.Q(re[1])*y,C=l.Q(re[0])*y,C-T<J&&(F=J/(C-T))}m&&(P=l.b3(l.O(m[0])*y,0,y),D=l.b3(l.O(m[1])*y,0,y),D<P&&(D+=y),D-P<H&&(N=H/(D-P)));const{x:te,y:oe}=this.project.call({worldSize:y},s);let ce,ue;const pe=Math.max(N||0,F||0);if(pe){const re=new l.P(N?(D+P)/2:te,F?(C+T)/2:oe);return p.center=this.unproject.call({worldSize:y},re).wrap(),p.zoom+=this.scaleZoom(pe),p}if(this.latRange){const re=J/2;oe-re<T&&(ue=T+re),oe+re>C&&(ue=C-re)}if(m){const re=(P+D)/2;let ye=te;this._renderWorldCopies&&(ye=l.b3(te,re-y/2,re+y/2));const xe=H/2;ye-xe<P&&(ce=P+xe),ye+xe>D&&(ce=D-xe)}if(ce!==void 0||ue!==void 0){const re=new l.P(ce??te,ue??oe);p.center=this.unproject.call({worldSize:y},re).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this._unmodified,{center:d,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=p,this._unmodified=s,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,d=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b5(1,this.center.lat)*this.worldSize;let m=l.an(new Float64Array(16));l.K(m,m,[this.width/2,-this.height/2,1]),l.J(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=l.an(new Float64Array(16)),l.K(m,m,[1,-1,1]),l.J(m,m,[-1,-1,0]),l.K(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),T=Math.min(this.elevation,this.minElevationForCurrentTile),C=y-T*this._pixelPerMeter/Math.cos(this._pitch),P=T<0?C:y,D=Math.PI/2+this._pitch,F=this._fov*(.5+s.y/this.height),N=Math.sin(F)*P/Math.sin(l.ac(Math.PI-D-F,.01,Math.PI-.01)),H=this.getHorizon(),J=2*Math.atan(H/this.cameraToCenterDistance)*(.5+s.y/(2*H)),te=Math.sin(J)*P/Math.sin(l.ac(Math.PI-D-J,.01,Math.PI-.01)),oe=Math.min(N,te);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*oe+P),this.nearZ=this.height/50,m=new Float64Array(16),l.b6(m,this._fov,this.width/this.height,this.nearZ,this.farZ),m[8]=2*-s.x/this.width,m[9]=2*s.y/this.height,this.projectionMatrix=l.ae(m),l.K(m,m,[1,-1,1]),l.J(m,m,[0,0,-this.cameraToCenterDistance]),l.b7(m,m,this._pitch),l.ad(m,m,this.angle),l.J(m,m,[-d,-p,0]),this.mercatorMatrix=l.K([],m,[this.worldSize,this.worldSize,this.worldSize]),l.K(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.L(new Float64Array(16),this.labelPlaneMatrix,m),l.J(m,m,[0,0,-this.elevation]),this.modelViewProjectionMatrix=m,this.invModelViewProjectionMatrix=l.as([],m),this.fogMatrix=new Float64Array(16),l.b6(this.fogMatrix,this._fov,this.width/this.height,y,this.farZ),this.fogMatrix[8]=2*-s.x/this.width,this.fogMatrix[9]=2*s.y/this.height,l.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),l.b7(this.fogMatrix,this.fogMatrix,this._pitch),l.ad(this.fogMatrix,this.fogMatrix,this.angle),l.J(this.fogMatrix,this.fogMatrix,[-d,-p,0]),l.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=l.L(new Float64Array(16),this.labelPlaneMatrix,m);const ce=this.width%2/2,ue=this.height%2/2,pe=Math.cos(this.angle),re=Math.sin(this.angle),ye=d-Math.round(d)+pe*ce+re*ue,xe=p-Math.round(p)+pe*ue+re*ce,Se=new Float64Array(m);if(l.J(Se,Se,[ye>.5?ye-1:ye,xe>.5?xe-1:xe,0]),this.alignedModelViewProjectionMatrix=Se,m=l.as(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new l.P(0,0)),d=[s.x*this.worldSize,s.y*this.worldSize,0,1];return l.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,s))}getCameraQueryGeometry(s){const d=this.getCameraPoint();if(s.length===1)return[s[0],d];{let p=d.x,m=d.y,y=d.x,T=d.y;for(const C of s)p=Math.min(p,C.x),m=Math.min(m,C.y),y=Math.max(y,C.x),T=Math.max(T,C.y);return[new l.P(p,m),new l.P(y,m),new l.P(y,T),new l.P(p,T),new l.P(p,m)]}}lngLatToCameraDepth(s,d){const p=this.locationCoordinate(s),m=[p.x*this.worldSize,p.y*this.worldSize,d,1];return l.af(m,m,this.modelViewProjectionMatrix),m[2]/m[3]}}function fc(v,s){let d,p=!1,m=null,y=null;const T=()=>{m=null,p&&(v.apply(y,d),m=setTimeout(T,s),p=!1)};return(...C)=>(p=!0,y=this,d=C,m||T(),m)}class Eu{constructor(s){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let p;return d.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:p,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,d)},this._removeHash=()=>{const d=this._getCurrentHash();if(d.length===0)return;const p=d.join("/");let m=p;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${p}`);let y=window.location.hash.replace(m,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let T=window.location.href.replace(/(#.+)?$/,y);T=T.replace("&&","&"),window.history.replaceState(window.history.state,null,T)},this._updateHash=fc(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(s){const d=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),T=Math.round(d.lng*y)/y,C=Math.round(d.lat*y)/y,P=this._map.getBearing(),D=this._map.getPitch();let F="";if(F+=s?`/${T}/${C}/${p}`:`${p}/${C}/${T}`,(P||D)&&(F+="/"+Math.round(10*P)/10),D&&(F+=`/${Math.round(D)}`),this._hashName){const N=this._hashName;let H=!1;const J=window.location.hash.slice(1).split("&").map(te=>{const oe=te.split("=")[0];return oe===N?(H=!0,`${oe}=${F}`):te}).filter(te=>te);return H||J.push(`${N}=${F}`),`#${J.join("&")}`}return`#${F}`}}const Su={linearity:.3,easing:l.b8(0,0,.3,1)},Od=l.e({deceleration:2500,maxSpeed:1400},Su),w0=l.e({deceleration:20,maxSpeed:1400},Su),Em=l.e({deceleration:1e3,maxSpeed:360},Su),Cu=l.e({deceleration:1e3,maxSpeed:90},Su);class kd{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:I.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,d=I.now();for(;s.length>0&&d-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)d.zoom+=y.zoomDelta||0,d.bearing+=y.bearingDelta||0,d.pitch+=y.pitchDelta||0,y.panDelta&&d.pan._add(y.panDelta),y.around&&(d.around=y.around),y.pinchAround&&(d.pinchAround=y.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(d.pan.mag()){const y=mc(d.pan.mag(),p,l.e({},Od,s||{}));m.offset=d.pan.mult(y.amount/d.pan.mag()),m.center=this._map.transform.center,pc(m,y)}if(d.zoom){const y=mc(d.zoom,p,w0);m.zoom=this._map.transform.zoom+y.amount,pc(m,y)}if(d.bearing){const y=mc(d.bearing,p,Em);m.bearing=this._map.transform.bearing+l.ac(y.amount,-179,179),pc(m,y)}if(d.pitch){const y=mc(d.pitch,p,Cu);m.pitch=this._map.transform.pitch+y.amount,pc(m,y)}if(m.zoom||m.bearing){const y=d.pinchAround===void 0?d.around:d.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),l.e(m,{noMoveStart:!0})}}function pc(v,s){(!v.duration||v.duration<s.duration)&&(v.duration=s.duration,v.easing=s.easing)}function mc(v,s,d){const{maxSpeed:p,linearity:m,deceleration:y}=d,T=l.ac(v*m/(s/1e3),-p,p),C=Math.abs(T)/(y*m);return{easing:d.easing,duration:1e3*C,amount:T*(C/2)}}class Un extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,p,m={}){const y=R.mousePos(d.getCanvas(),p),T=d.unproject(y);super(s,l.e({point:y,lngLat:T,originalEvent:p},m)),this._defaultPrevented=!1,this.target=d}}class fa extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,p){const m=s==="touchend"?p.changedTouches:p.touches,y=R.touchPos(d.getCanvasContainer(),m),T=y.map(P=>d.unproject(P)),C=y.reduce((P,D,F,N)=>P.add(D.div(N.length)),new l.P(0,0));super(s,{points:y,point:C,lngLats:T,lngLat:d.unproject(C),originalEvent:p}),this._defaultPrevented=!1}}class Sm extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,p){super(s,{originalEvent:p}),this._defaultPrevented=!1}}class Cm{constructor(s,d){this._map=s,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Sm(s.type,this._map,s))}mousedown(s,d){return this._mousedownPos=d,this._firePreventable(new Un(s.type,this._map,s))}mouseup(s){this._map.fire(new Un(s.type,this._map,s))}click(s,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Un(s.type,this._map,s))}dblclick(s){return this._firePreventable(new Un(s.type,this._map,s))}mouseover(s){this._map.fire(new Un(s.type,this._map,s))}mouseout(s){this._map.fire(new Un(s.type,this._map,s))}touchstart(s){return this._firePreventable(new fa(s.type,this._map,s))}touchmove(s){this._map.fire(new fa(s.type,this._map,s))}touchend(s){this._map.fire(new fa(s.type,this._map,s))}touchcancel(s){this._map.fire(new fa(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xi{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new Un(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Un("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new Un(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hs{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(l.P.convert(s),this._map.terrain)}}class Dr{constructor(s,d){this._map=s,this._tr=new hs(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,d){this.isEnabled()&&s.shiftKey&&s.button===0&&(R.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(s,d){if(!this._active)return;const p=d;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=R.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const y=Math.min(m.x,p.x),T=Math.max(m.x,p.x),C=Math.min(m.y,p.y),P=Math.max(m.y,p.y);R.setTransform(this._box,`translate(${y}px,${C}px)`),this._box.style.width=T-y+"px",this._box.style.height=P-C+"px"}mouseupWindow(s,d){if(!this._active||s.button!==0)return;const p=this._startPos,m=d;if(this.reset(),R.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:s})),{cameraAnimation:y=>y.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(R.remove(this._box),this._box=null),R.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,d){return this._map.fire(new l.k(s,{originalEvent:d}))}}function gc(v,s){if(v.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${s.length}`);const d={};for(let p=0;p<v.length;p++)d[v[p].identifier]=s[p];return d}class Fd{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,d,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const y=new l.P(0,0);for(const T of m)y._add(T);return y.div(m.length)}(d),this.touches=gc(p,d)))}touchmove(s,d,p){if(this.aborted||!this.centroid)return;const m=gc(p,d);for(const y in this.touches){const T=m[y];(!T||T.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(s,d,p){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Iu{constructor(s){this.singleTap=new Fd(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,d,p){this.singleTap.touchstart(s,d,p)}touchmove(s,d,p){this.singleTap.touchmove(s,d,p)}touchend(s,d,p){const m=this.singleTap.touchend(s,d,p);if(m){const y=s.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(m)<30;if(y&&T||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Qa{constructor(s){this._tr=new hs(s),this._zoomIn=new Iu({numTouches:1,numTaps:2}),this._zoomOut=new Iu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,d,p){this._zoomIn.touchstart(s,d,p),this._zoomOut.touchstart(s,d,p)}touchmove(s,d,p){this._zoomIn.touchmove(s,d,p),this._zoomOut.touchmove(s,d,p)}touchend(s,d,p){const m=this._zoomIn.touchend(s,d,p),y=this._zoomOut.touchend(s,d,p),T=this._tr;return m?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(m)},{originalEvent:s})}):y?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(y)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ro{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const d=this._moveFunction(...s);if(d.bearingDelta||d.pitchDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(s,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,d){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const m=d.length?d[0]:d;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&R.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Nd={0:1,2:2};class Ru{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const d=R.mouseButton(s);this._eventButton=d}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(d,p){const m=Nd[p];return d.buttons===void 0||(d.buttons&m)!==m}(s,this._eventButton)}isValidEndEvent(s){return R.mouseButton(s)===this._eventButton}}class Ld{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const Pu=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=s=>{s.preventDefault()}},Ud=({enable:v,clickTolerance:s,bearingDegreesPerPixelMoved:d=.8})=>{const p=new Ru({checkCorrectEvent:m=>R.mouseButton(m)===0&&m.ctrlKey||R.mouseButton(m)===2});return new ro({clickTolerance:s,move:(m,y)=>({bearingDelta:(y.x-m.x)*d}),moveStateManager:p,enable:v,assignEvents:Pu})},zd=({enable:v,clickTolerance:s,pitchDegreesPerPixelMoved:d=-.5})=>{const p=new Ru({checkCorrectEvent:m=>R.mouseButton(m)===0&&m.ctrlKey||R.mouseButton(m)===2});return new ro({clickTolerance:s,move:(m,y)=>({pitchDelta:(y.y-m.y)*d}),moveStateManager:p,enable:v,assignEvents:Pu})};class pa{constructor(s,d){this._clickTolerance=s.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(s){return s<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(s,d,p){return this._calculateTransform(s,d,p)}touchmove(s,d,p){if(this._active){if(!this._shouldBePrevented(p.length))return s.preventDefault(),this._calculateTransform(s,d,p);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",s)}}touchend(s,d,p){this._calculateTransform(s,d,p),this._active&&this._shouldBePrevented(p.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,d,p){p.length>0&&(this._active=!0);const m=gc(p,d),y=new l.P(0,0),T=new l.P(0,0);let C=0;for(const D in m){const F=m[D],N=this._touches[D];N&&(y._add(F),T._add(F.sub(N)),C++,m[D]=F)}if(this._touches=m,this._shouldBePrevented(C)||!T.mag())return;const P=T.div(C);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(C),panDelta:P}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,d,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([d[0],d[1]]))}touchmove(s,d,p){if(!this._firstTwoTouches)return;s.preventDefault();const[m,y]=this._firstTwoTouches,T=_c(p,d,m),C=_c(p,d,y);if(!T||!C)return;const P=this._aroundCenter?null:T.add(C).div(2);return this._move([T,C],P,s)}touchend(s,d,p){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,T=_c(p,d,m),C=_c(p,d,y);T&&C||(this._active&&R.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function _c(v,s,d){for(let p=0;p<v.length;p++)if(v[p].identifier===d)return s[p]}function Vd(v,s){return Math.log(v/s)/Math.LN2}class jd extends Mu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,d){const p=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Vd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Vd(this._distance,p),pinchAround:d}}}function Hd(v,s){return 180*v.angleWith(s)/Math.PI}class $d extends Mu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,d,p){const m=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Hd(this._vector,m),pinchAround:d}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const d=25/(Math.PI*this._minDiameter)*360,p=Hd(s,this._startVector);return Math.abs(p)<d}}function Bu(v){return Math.abs(v.y)>Math.abs(v.x)}class el extends Mu{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,d,p){super.touchstart(s,d,p),this._currentTouchCount=p.length}_start(s){this._lastPoints=s,Bu(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,d,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=s[0].sub(this._lastPoints[0]),y=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,y,p.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(s,d,p){if(this._valid!==void 0)return this._valid;const m=s.mag()>=2,y=d.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=s.y>0==d.y>0;return Bu(s)&&Bu(d)&&T}}const Im={panStep:100,bearingStep:15,pitchStep:10};class Xr{constructor(s){this._tr=new hs(s);const d=Im;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let d=0,p=0,m=0,y=0,T=0;switch(s.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:s.shiftKey?p=-1:(s.preventDefault(),y=-1);break;case 39:s.shiftKey?p=1:(s.preventDefault(),y=1);break;case 38:s.shiftKey?m=1:(s.preventDefault(),T=-1);break;case 40:s.shiftKey?m=-1:(s.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:C=>{const P=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:Us,zoom:d?Math.round(P.zoom)+d*(s.shiftKey?2:1):P.zoom,bearing:P.bearing+p*this._bearingStep,pitch:P.pitch+m*this._pitchStep,offset:[-y*this._panStep,-T*this._panStep],center:P.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Us(v){return v*(2-v)}const Gd=4.000244140625;class ds{constructor(s,d){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=s,this._tr=new hs(s),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(s){return!!this._map.cooperativeGestures.isEnabled()&&!(s.ctrlKey||this._map.cooperativeGestures.isBypassed(s))}wheel(s){if(!this.isEnabled())return;if(this._shouldBePrevented(s))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",s);let d=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const p=I.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,d!==0&&d%Gd==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(m*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),s.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=s,this._delta-=d,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=R.mousePos(this._map.getCanvas(),s),p=this._tr;this._around=d.y>p.transform.height/2-p.transform.getHorizon()?l.N.convert(this._aroundCenter?p.center:p.unproject(d)):l.N.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Gd?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&D!==0&&(D=1/D);const F=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(F*D))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,p=this._startZoom,m=this._easing;let y,T=!1;const C=I.now()-this._lastWheelEventTime;if(this._type==="wheel"&&p&&m&&C){const P=Math.min(C/200,1),D=m(P);y=l.y.number(p,d,D),P<1?this._frameId||(this._frameId=!0):T=!0}else y=d,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:y-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let d=l.b9;if(this._prevEase){const p=this._prevEase,m=(I.now()-p.start)/p.duration,y=p.easing(m+.01)-p.easing(m),T=.27/Math.sqrt(y*y+1e-4)*.01,C=Math.sqrt(.0729-T*T);d=l.b8(T,C,.25,1)}return this._prevEase={start:I.now(),duration:s,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ma{constructor(s,d){this._clickZoom=s,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class A0{constructor(s){this._tr=new hs(s),this.reset()}reset(){this._active=!1}dblclick(s,d){return s.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class T0{constructor(){this._tap=new Iu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,d,p){if(!this._swipePoint)if(this._tapTime){const m=d[0],y=s.timeStamp-this._tapTime<500,T=this._tapPoint.dist(m)<30;y&&T?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(s,d,p)}touchmove(s,d,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=d[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,s.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(s,d,p)}touchend(s,d,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(s,d,p);m&&(this._tapTime=s.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rm{constructor(s,d,p){this._el=s,this._mousePan=d,this._touchPan=p}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Pm{constructor(s,d,p){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=d,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Wd{constructor(s,d,p,m){this._el=s,this._touchZoom=d,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class tl{constructor(s,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=R.create("div","maplibregl-cooperative-gesture-screen",s);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=d,this._container.appendChild(m);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=p,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(R.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(s){return s[this._bypassKey]}notifyGestureBlocked(s,d){this._enabled&&(this._map.fire(new l.k("cooperativegestureprevented",{gestureType:s,originalEvent:d})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const qr=v=>v.zoom||v.drag||v.pitch||v.rotate;class ct extends l.k{}function Du(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class Xd{constructor(s,d){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,y)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=m.type==="renderFrame"?void 0:m,C={needsRenderFrame:!1},P={},D={},F=m.touches,N=F?this._getMapTouches(F):void 0,H=N?R.touchPos(this._map.getCanvas(),N):R.mousePos(this._map.getCanvas(),m);for(const{handlerName:oe,handler:ce,allowed:ue}of this._handlers){if(!ce.isEnabled())continue;let pe;this._blockedByActive(D,ue,oe)?ce.reset():ce[y||m.type]&&(pe=ce[y||m.type](m,H,N),this.mergeHandlerResult(C,P,pe,oe,T),pe&&pe.needsRenderFrame&&this._triggerRenderFrame()),(pe||ce.isActive())&&(D[oe]=ce)}const J={};for(const oe in this._previousActiveHandlers)D[oe]||(J[oe]=T);this._previousActiveHandlers=D,(Object.keys(J).length||Du(C))&&(this._changes.push([C,P,J]),this._triggerRenderFrame()),(Object.keys(D).length||Du(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:te}=C;te&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],te(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new kd(s),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,y,T]of this._listeners)R.addEventListener(m,y,m===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[s,d,p]of this._listeners)R.removeEventListener(s,d,s===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(s){const d=this._map,p=d.getCanvasContainer();this._add("mapEvent",new Cm(d,s));const m=d.boxZoom=new Dr(d,s);this._add("boxZoom",m),s.interactive&&s.boxZoom&&m.enable();const y=d.cooperativeGestures=new tl(d,s.cooperativeGestures);this._add("cooperativeGestures",y),s.cooperativeGestures&&y.enable();const T=new Qa(d),C=new A0(d);d.doubleClickZoom=new ma(C,T),this._add("tapZoom",T),this._add("clickZoom",C),s.interactive&&s.doubleClickZoom&&d.doubleClickZoom.enable();const P=new T0;this._add("tapDragZoom",P);const D=d.touchPitch=new el(d);this._add("touchPitch",D),s.interactive&&s.touchPitch&&d.touchPitch.enable(s.touchPitch);const F=Ud(s),N=zd(s);d.dragRotate=new Pm(s,F,N),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]),s.interactive&&s.dragRotate&&d.dragRotate.enable();const H=(({enable:pe,clickTolerance:re})=>{const ye=new Ru({checkCorrectEvent:xe=>R.mouseButton(xe)===0&&!xe.ctrlKey});return new ro({clickTolerance:re,move:(xe,Se)=>({around:Se,panDelta:Se.sub(xe)}),activateOnStart:!0,moveStateManager:ye,enable:pe,assignEvents:Pu})})(s),J=new pa(s,d);d.dragPan=new Rm(p,H,J),this._add("mousePan",H),this._add("touchPan",J,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&d.dragPan.enable(s.dragPan);const te=new $d,oe=new jd;d.touchZoomRotate=new Wd(p,oe,te,P),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&d.touchZoomRotate.enable(s.touchZoomRotate);const ce=d.scrollZoom=new ds(d,()=>this._triggerRenderFrame());this._add("scrollZoom",ce,["mousePan"]),s.interactive&&s.scrollZoom&&d.scrollZoom.enable(s.scrollZoom);const ue=d.keyboard=new Xr(d);this._add("keyboard",ue),s.interactive&&s.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new Xi(d))}_add(s,d,p){this._handlers.push({handlerName:s,handler:d,allowed:p}),this._handlersById[s]=d}stop(s){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qr(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,d,p){for(const m in s)if(m!==p&&(!d||d.indexOf(m)<0))return!0;return!1}_getMapTouches(s){const d=[];for(const p of s)this._el.contains(p.target)&&d.push(p);return d}mergeHandlerResult(s,d,p,m,y){if(!p)return;l.e(s,p);const T={handlerName:m,originalEvent:p.originalEvent||y};p.zoomDelta!==void 0&&(d.zoom=T),p.panDelta!==void 0&&(d.drag=T),p.pitchDelta!==void 0&&(d.pitch=T),p.bearingDelta!==void 0&&(d.rotate=T)}_applyChanges(){const s={},d={},p={};for(const[m,y,T]of this._changes)m.panDelta&&(s.panDelta=(s.panDelta||new l.P(0,0))._add(m.panDelta)),m.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(s.around=m.around),m.pinchAround!==void 0&&(s.pinchAround=m.pinchAround),m.noInertia&&(s.noInertia=m.noInertia),l.e(d,y),l.e(p,T);this._updateMapTransform(s,d,p),this._changes=[]}_updateMapTransform(s,d,p){const m=this._map,y=m._getTransformForUpdate(),T=m.terrain;if(!(Du(s)||T&&this._terrainMovement))return this._fireEvents(d,p,!0);let{panDelta:C,zoomDelta:P,bearingDelta:D,pitchDelta:F,around:N,pinchAround:H}=s;H!==void 0&&(N=H),m._stop(!0),N=N||m.transform.centerPoint;const J=y.pointLocation(C?N.sub(C):N);D&&(y.bearing+=D),F&&(y.pitch+=F),P&&(y.zoom+=P),T?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(C)):y.setLocationAtPoint(J,N):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(J,N)):y.setLocationAtPoint(J,N),m._applyUpdatedTransform(y),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(d,p,!0)}_fireEvents(s,d,p){const m=qr(this._eventsInProgress),y=qr(s),T={};for(const N in s){const{originalEvent:H}=s[N];this._eventsInProgress[N]||(T[`${N}start`]=H),this._eventsInProgress[N]=s[N]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const N in T)this._fireEvent(N,T[N]);y&&this._fireEvent("move",y.originalEvent);for(const N in s){const{originalEvent:H}=s[N];this._fireEvent(N,H)}const C={};let P;for(const N in this._eventsInProgress){const{handlerName:H,originalEvent:J}=this._eventsInProgress[N];this._handlersById[H].isActive()||(delete this._eventsInProgress[N],P=d[H]||J,C[`${N}end`]=P)}for(const N in C)this._fireEvent(N,C[N]);const D=qr(this._eventsInProgress),F=(m||y)&&!D;if(F&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const N=this._map._getTransformForUpdate();N.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(N)}if(p&&F){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=J=>J!==0&&-this._bearingSnap<J&&J<this._bearingSnap;!N||!N.essential&&I.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:P})),H(this._map.getBearing())&&this._map.resetNorth()):(H(N.bearing||this._map.getBearing())&&(N.bearing=0),N.freezeElevation=!0,this._map.easeTo(N,{originalEvent:P})),this._updatingCamera=!1}}_fireEvent(s,d){this._map.fire(new l.k(s,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new ct("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Mm extends l.E{constructor(s,d){super(),this._renderFrameCallback=()=>{const p=Math.min((I.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.N(this.transform.center.lng,this.transform.center.lat)}setCenter(s,d){return this.jumpTo({center:s},d)}panBy(s,d,p){return s=l.P.convert(s).mult(-1),this.panTo(this.transform.center,l.e({offset:s},d),p)}panTo(s,d,p){return this.easeTo(l.e({center:s},d),p)}getZoom(){return this.transform.zoom}setZoom(s,d){return this.jumpTo({zoom:s},d),this}zoomTo(s,d,p){return this.easeTo(l.e({zoom:s},d),p)}zoomIn(s,d){return this.zoomTo(this.getZoom()+1,s,d),this}zoomOut(s,d){return this.zoomTo(this.getZoom()-1,s,d),this}getBearing(){return this.transform.bearing}setBearing(s,d){return this.jumpTo({bearing:s},d),this}getPadding(){return this.transform.padding}setPadding(s,d){return this.jumpTo({padding:s},d),this}rotateTo(s,d,p){return this.easeTo(l.e({bearing:s},d),p)}resetNorth(s,d){return this.rotateTo(0,l.e({duration:1e3},s),d),this}resetNorthPitch(s,d){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},s),d),this}snapToNorth(s,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,d):this}getPitch(){return this.transform.pitch}setPitch(s,d){return this.jumpTo({pitch:s},d),this}cameraForBounds(s,d){s=Pe.convert(s).adjustAntiMeridian();const p=d&&d.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),p,d)}_cameraForBoxAndBearing(s,d,p,m){const y={top:0,bottom:0,right:0,left:0};if(typeof(m=l.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const et=m.padding;m.padding={top:et,bottom:et,right:et,left:et}}m.padding=l.e(y,m.padding);const T=this.transform,C=T.padding,P=new Pe(s,d),D=T.project(P.getNorthWest()),F=T.project(P.getNorthEast()),N=T.project(P.getSouthEast()),H=T.project(P.getSouthWest()),J=l.ba(-p),te=D.rotate(J),oe=F.rotate(J),ce=N.rotate(J),ue=H.rotate(J),pe=new l.P(Math.max(te.x,oe.x,ue.x,ce.x),Math.max(te.y,oe.y,ue.y,ce.y)),re=new l.P(Math.min(te.x,oe.x,ue.x,ce.x),Math.min(te.y,oe.y,ue.y,ce.y)),ye=pe.sub(re),xe=(T.width-(C.left+C.right+m.padding.left+m.padding.right))/ye.x,Se=(T.height-(C.top+C.bottom+m.padding.top+m.padding.bottom))/ye.y;if(Se<0||xe<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Le=Math.min(T.scaleZoom(T.scale*Math.min(xe,Se)),m.maxZoom),Ge=l.P.convert(m.offset),nt=new l.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(l.ba(p)),at=Ge.add(nt).mult(T.scale/T.zoomScale(Le));return{center:T.unproject(D.add(N).div(2).sub(at)),zoom:Le,bearing:p}}fitBounds(s,d,p){return this._fitInternal(this.cameraForBounds(s,d),d,p)}fitScreenCoordinates(s,d,p,m,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(s)),this.transform.pointLocation(l.P.convert(d)),p,m),m,y)}_fitInternal(s,d,p){return s?(delete(d=l.e(s,d)).padding,d.linear?this.easeTo(d,p):this.flyTo(d,p)):this}jumpTo(s,d){this.stop();const p=this._getTransformForUpdate();let m=!1,y=!1,T=!1;return"zoom"in s&&p.zoom!==+s.zoom&&(m=!0,p.zoom=+s.zoom),s.center!==void 0&&(p.center=l.N.convert(s.center)),"bearing"in s&&p.bearing!==+s.bearing&&(y=!0,p.bearing=+s.bearing),"pitch"in s&&p.pitch!==+s.pitch&&(T=!0,p.pitch=+s.pitch),s.padding==null||p.isPaddingEqual(s.padding)||(p.padding=s.padding),this._applyUpdatedTransform(p),this.fire(new l.k("movestart",d)).fire(new l.k("move",d)),m&&this.fire(new l.k("zoomstart",d)).fire(new l.k("zoom",d)).fire(new l.k("zoomend",d)),y&&this.fire(new l.k("rotatestart",d)).fire(new l.k("rotate",d)).fire(new l.k("rotateend",d)),T&&this.fire(new l.k("pitchstart",d)).fire(new l.k("pitch",d)).fire(new l.k("pitchend",d)),this.fire(new l.k("moveend",d))}calculateCameraOptionsFromTo(s,d,p,m=0){const y=l.Z.fromLngLat(s,d),T=l.Z.fromLngLat(p,m),C=T.x-y.x,P=T.y-y.y,D=T.z-y.z,F=Math.hypot(C,P,D);if(F===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(C,P),H=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),J=180*Math.atan2(C,-P)/Math.PI;let te=180*Math.acos(N/F)/Math.PI;return te=D<0?90-te:90+te,{center:T.toLngLat(),zoom:H,pitch:te,bearing:J}}easeTo(s,d){var p;this._stop(!1,s.easeId),((s=l.e({offset:[0,0],duration:500,easing:l.b9},s)).animate===!1||!s.essential&&I.prefersReducedMotion)&&(s.duration=0);const m=this._getTransformForUpdate(),y=m.zoom,T=m.bearing,C=m.pitch,P=m.padding,D="bearing"in s?this._normalizeBearing(s.bearing,T):T,F="pitch"in s?+s.pitch:C,N="padding"in s?s.padding:m.padding,H=l.P.convert(s.offset);let J=m.centerPoint.add(H);const te=m.pointLocation(J),{center:oe,zoom:ce}=m.getConstrained(l.N.convert(s.center||te),(p=s.zoom)!==null&&p!==void 0?p:y);this._normalizeCenter(oe,m);const ue=m.project(te),pe=m.project(oe).sub(ue),re=m.zoomScale(ce-y);let ye,xe;s.around&&(ye=l.N.convert(s.around),xe=m.locationPoint(ye));const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ce!==y,this._rotating=this._rotating||T!==D,this._pitching=this._pitching||F!==C,this._padding=!m.isPaddingEqual(N),this._easeId=s.easeId,this._prepareEase(d,s.noMoveStart,Se),this.terrain&&this._prepareElevation(oe),this._ease(Le=>{if(this._zooming&&(m.zoom=l.y.number(y,ce,Le)),this._rotating&&(m.bearing=l.y.number(T,D,Le)),this._pitching&&(m.pitch=l.y.number(C,F,Le)),this._padding&&(m.interpolatePadding(P,N,Le),J=m.centerPoint.add(H)),this.terrain&&!s.freezeElevation&&this._updateElevation(Le),ye)m.setLocationAtPoint(ye,xe);else{const Ge=m.zoomScale(m.zoom-y),nt=ce>y?Math.min(2,re):Math.max(.5,re),at=Math.pow(nt,1-Le),et=m.unproject(ue.add(pe.mult(Le*at)).mult(Ge));m.setLocationAtPoint(m.renderWorldCopies?et.wrap():et,J)}this._applyUpdatedTransform(m),this._fireMoveEvents(d)},Le=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(d,Le)},s),this}_prepareEase(s,d,p={}){this._moving=!0,d||p.moving||this.fire(new l.k("movestart",s)),this._zooming&&!p.zooming&&this.fire(new l.k("zoomstart",s)),this._rotating&&!p.rotating&&this.fire(new l.k("rotatestart",s)),this._pitching&&!p.pitching&&this.fire(new l.k("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&d!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(p-(d-(p*s+this._elevationStart))/(1-s)),this._elevationTarget=d}this.transform.elevation=l.y.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(s){const d=s.getCameraPosition(),p=this.terrain.getElevationForLngLatZoom(d.lngLat,s.zoom);if(d.altitude<p){const m=this.calculateCameraOptionsFromTo(d.lngLat,p,s.center,s.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(s){const d=[];if(this.terrain&&d.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&d.push(m=>this.transformCameraUpdate(m)),!d.length)return;const p=s.clone();for(const m of d){const y=p.clone(),{center:T,zoom:C,pitch:P,bearing:D,elevation:F}=m(y);T&&(y.center=T),C!==void 0&&(y.zoom=C),P!==void 0&&(y.pitch=P),D!==void 0&&(y.bearing=D),F!==void 0&&(y.elevation=F),p.apply(y)}this.transform.apply(p)}_fireMoveEvents(s){this.fire(new l.k("move",s)),this._zooming&&this.fire(new l.k("zoom",s)),this._rotating&&this.fire(new l.k("rotate",s)),this._pitching&&this.fire(new l.k("pitch",s))}_afterEase(s,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const p=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.k("zoomend",s)),m&&this.fire(new l.k("rotateend",s)),y&&this.fire(new l.k("pitchend",s)),this.fire(new l.k("moveend",s))}flyTo(s,d){var p;if(!s.essential&&I.prefersReducedMotion){const st=l.M(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(st,d)}this.stop(),s=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b9},s);const m=this._getTransformForUpdate(),y=m.zoom,T=m.bearing,C=m.pitch,P=m.padding,D="bearing"in s?this._normalizeBearing(s.bearing,T):T,F="pitch"in s?+s.pitch:C,N="padding"in s?s.padding:m.padding,H=l.P.convert(s.offset);let J=m.centerPoint.add(H);const te=m.pointLocation(J),{center:oe,zoom:ce}=m.getConstrained(l.N.convert(s.center||te),(p=s.zoom)!==null&&p!==void 0?p:y);this._normalizeCenter(oe,m);const ue=m.zoomScale(ce-y),pe=m.project(te),re=m.project(oe).sub(pe);let ye=s.curve;const xe=Math.max(m.width,m.height),Se=xe/ue,Le=re.mag();if("minZoom"in s){const st=l.ac(Math.min(s.minZoom,y,ce),m.minZoom,m.maxZoom),It=xe/m.zoomScale(st-y);ye=Math.sqrt(It/Le*2)}const Ge=ye*ye;function nt(st){const It=(Se*Se-xe*xe+(st?-1:1)*Ge*Ge*Le*Le)/(2*(st?Se:xe)*Ge*Le);return Math.log(Math.sqrt(It*It+1)-It)}function at(st){return(Math.exp(st)-Math.exp(-st))/2}function et(st){return(Math.exp(st)+Math.exp(-st))/2}const Ye=nt(!1);let pt=function(st){return et(Ye)/et(Ye+ye*st)},Mt=function(st){return xe*((et(Ye)*(at(It=Ye+ye*st)/et(It))-at(Ye))/Ge)/Le;var It},tt=(nt(!0)-Ye)/ye;if(Math.abs(Le)<1e-6||!isFinite(tt)){if(Math.abs(xe-Se)<1e-6)return this.easeTo(s,d);const st=Se<xe?-1:1;tt=Math.abs(Math.log(Se/xe))/ye,Mt=()=>0,pt=It=>Math.exp(st*ye*It)}return s.duration="duration"in s?+s.duration:1e3*tt/("screenSpeed"in s?+s.screenSpeed/ye:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=T!==D,this._pitching=F!==C,this._padding=!m.isPaddingEqual(N),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(oe),this._ease(st=>{const It=st*tt,Ti=1/pt(It);m.zoom=st===1?ce:y+m.scaleZoom(Ti),this._rotating&&(m.bearing=l.y.number(T,D,st)),this._pitching&&(m.pitch=l.y.number(C,F,st)),this._padding&&(m.interpolatePadding(P,N,st),J=m.centerPoint.add(H)),this.terrain&&!s.freezeElevation&&this._updateElevation(st);const kt=st===1?oe:m.unproject(pe.add(re.mult(Mt(It))).mult(Ti));m.setLocationAtPoint(m.renderWorldCopies?kt.wrap():kt,J),this._applyUpdatedTransform(m),this._fireMoveEvents(d)},()=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(d)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,d){var p;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,d)}return s||(p=this.handlers)===null||p===void 0||p.stop(!1),this}_ease(s,d,p){p.animate===!1||p.duration===0?(s(1),d()):(this._easeStart=I.now(),this._easeOptions=p,this._onEaseFrame=s,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,d){s=l.b3(s,-180,180);const p=Math.abs(s-d);return Math.abs(s-360-d)<p&&(s-=360),Math.abs(s+360-d)<p&&(s+=360),s}_normalizeCenter(s,d){if(!d.renderWorldCopies||d.lngRange)return;const p=s.lng-d.center.lng;s.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(l.N.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}const il={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class nl{constructor(s=il){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=R.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=R.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,d){const p=this._map._getUIString(`AttributionControl.${d}`);s.title=p,s.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const d=this._map.style.sourceCaches;for(const m in d){const y=d[m];if(y.used||y.usedForTerrain){const T=y.getSource();T.attribution&&s.indexOf(T.attribution)<0&&s.push(T.attribution)}}s=s.filter(m=>String(m).trim()),s.sort((m,y)=>m.length-y.length),s=s.filter((m,y)=>{for(let T=y+1;T<s.length;T++)if(s[T].indexOf(m)>=0)return!1;return!0});const p=s.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,s.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class qd{constructor(s={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const p=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=R.create("div","maplibregl-ctrl");const d=R.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){R.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class $t{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const d=++this._id;return this._queue.push({callback:s,id:d,cancelled:!1}),d}remove(s){const d=this._currentlyRunning,p=d?this._queue.concat(d):this._queue;for(const m of p)if(m.id===s)return void(m.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const p of d)if(!p.cancelled&&(p.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Kd=l.Y([{name:"a_pos3d",type:"Int16",components:3}]);class E0 extends l.E{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,d){this.sourceCache.update(s,d),this._renderableTilesKeys=[];const p={};for(const m of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),l.aP(m.posMatrix,0,l.X,0,l.X,0,1),this._tiles[m.key]=new Hr(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(s){for(const d in this._tiles){const p=this._tiles[d];(!s||p.tileID.equals(s)||p.tileID.isChildOf(s)||s.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const d={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(s.canonical)){const y=s.clone();y.posMatrix=new Float64Array(16),l.aP(y.posMatrix,0,l.X,0,l.X,0,1),d[p]=y}else if(m.canonical.isChildOf(s.canonical)){const y=s.clone();y.posMatrix=new Float64Array(16);const T=m.canonical.z-s.canonical.z,C=m.canonical.x-(m.canonical.x>>T<<T),P=m.canonical.y-(m.canonical.y>>T<<T),D=l.X>>T;l.aP(y.posMatrix,0,D,0,D,0,1),l.J(y.posMatrix,y.posMatrix,[-C*D,-P*D,0]),d[p]=y}else if(s.canonical.isChildOf(m.canonical)){const y=s.clone();y.posMatrix=new Float64Array(16);const T=s.canonical.z-m.canonical.z,C=s.canonical.x-(s.canonical.x>>T<<T),P=s.canonical.y-(s.canonical.y>>T<<T),D=l.X>>T;l.aP(y.posMatrix,0,l.X,0,l.X,0,1),l.J(y.posMatrix,y.posMatrix,[C*D,P*D,0]),l.K(y.posMatrix,y.posMatrix,[1/2**T,1/2**T,0]),d[p]=y}}return d}getSourceTile(s,d){const p=this.sourceCache._source;let m=s.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(m).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!y||!y.dem)&&d)for(;m>=p.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(s.scaledTo(m--).key);return y}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(d=>d.timeAdded>=s)}}class Zd{constructor(s,d,p){this.painter=s,this.sourceCache=new E0(d),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,d,p,m=l.X){var y;if(!(d>=0&&d<m&&p>=0&&p<m))return 0;const T=this.getTerrainData(s),C=(y=T.tile)===null||y===void 0?void 0:y.dem;if(!C)return 0;const P=function(te,oe,ce){var ue=oe[0],pe=oe[1];return te[0]=ce[0]*ue+ce[4]*pe+ce[12],te[1]=ce[1]*ue+ce[5]*pe+ce[13],te}([],[d/m*l.X,p/m*l.X],T.u_terrain_matrix),D=[P[0]*C.dim,P[1]*C.dim],F=Math.floor(D[0]),N=Math.floor(D[1]),H=D[0]-F,J=D[1]-N;return C.get(F,N)*(1-H)*(1-J)+C.get(F+1,N)*H*(1-J)+C.get(F,N+1)*(1-H)*J+C.get(F+1,N+1)*H*J}getElevationForLngLatZoom(s,d){if(!l.bb(d,s.wrap()))return 0;const{tileID:p,mercatorX:m,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(s,d);return this.getElevation(p,m%l.X,y%l.X,l.X)}getElevation(s,d,p,m=l.X){return this.getDEMElevation(s,d,p,m)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const m=this.painter.context,y=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ke(m,y,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ke(m,new l.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const d=this.sourceCache.getSourceTile(s,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const m=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new Ke(m,d.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),d.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const p=d&&d+d.tileID.key+s.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let y=s.canonical.z-d.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=m?y=s.canonical.z-m:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=s.canonical.x-(s.canonical.x>>y<<y),C=s.canonical.y-(s.canonical.y>>y<<y),P=l.bc(new Float64Array(16),[1/(l.X<<y),1/(l.X<<y),0]);l.J(P,P,[T*l.X,C*l.X,0]),this._demMatrixCache[s.key]={matrix:P,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(s){const d=this.painter,p=d.width/devicePixelRatio,m=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ke(d.context,{width:p,height:m,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ke(d.context,{width:p,height:m,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,T=0;y<this._coordsTextureSize;y++)for(let C=0;C<this._coordsTextureSize;C++,T+=4)d[T+0]=255&C,d[T+1]=255&y,d[T+2]=C>>8<<4|y>>8,d[T+3]=0;const p=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),m=new Ke(s,p,s.gl.RGBA,{premultiply:!1});return m.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(s){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),p=this.painter.context,m=p.gl,y=Math.round(s.x*this.painter.pixelRatio/devicePixelRatio),T=Math.round(s.y*this.painter.pixelRatio/devicePixelRatio),C=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(y,C-T-1,1,1,m.RGBA,m.UNSIGNED_BYTE,d),p.bindFramebuffer.set(null);const P=d[0]+(d[2]>>4<<8),D=d[1]+((15&d[2])<<8),F=this.coordsIndex[255-d[3]],N=F&&this.sourceCache.getTileByID(F);if(!N)return null;const H=this._coordsTextureSize,J=(1<<N.tileID.canonical.z)*H;return new l.Z((N.tileID.canonical.x*H+P)/J+N.tileID.wrap,(N.tileID.canonical.y*H+D)/J,this.getElevation(N.tileID,P,D,H))}depthAtPoint(s){const d=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,d),p.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,d=new l.bd,p=new l.aY,m=this.meshSize,y=l.X/m,T=m*m;for(let N=0;N<=m;N++)for(let H=0;H<=m;H++)d.emplaceBack(H*y,N*y,0);for(let N=0;N<T;N+=m+1)for(let H=0;H<m;H++)p.emplaceBack(H+N,m+H+N+1,m+H+N+2),p.emplaceBack(H+N,m+H+N+2,H+N+1);const C=d.length,P=C+2*(m+1);for(const N of[0,1])for(let H=0;H<=m;H++)for(const J of[0,1])d.emplaceBack(H*y,N*l.X,J);for(let N=0;N<2*m;N+=2)p.emplaceBack(P+N,P+N+1,P+N+3),p.emplaceBack(P+N,P+N+3,P+N+2),p.emplaceBack(C+N,C+N+3,C+N+1),p.emplaceBack(C+N,C+N+2,C+N+3);const D=d.length,F=D+2*(m+1);for(const N of[0,1])for(let H=0;H<=m;H++)for(const J of[0,1])d.emplaceBack(N*l.X,H*y,J);for(let N=0;N<2*m;N+=2)p.emplaceBack(D+N,D+N+1,D+N+3),p.emplaceBack(D+N,D+N+3,D+N+2),p.emplaceBack(F+N,F+N+3,F+N+1),p.emplaceBack(F+N,F+N+2,F+N+3);return this._mesh=new Au(s.createVertexBuffer(d,Kd.members),s.createIndexBuffer(p),l.a0.simpleSegment(0,0,d.length,p.length)),this._mesh}getMeshFrameDelta(s){return 2*Math.PI*l.be/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,d){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(s,d);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(s){const d=this.getTerrainData(s).tile,p={minElevation:null,maxElevation:null};return d&&d.dem&&(p.minElevation=d.dem.min*this.exaggeration,p.maxElevation=d.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(s,d){const p=l.Z.fromLngLat(s.wrap()),m=(1<<d)*l.X,y=p.x*m,T=p.y*m,C=Math.floor(y/l.X),P=Math.floor(T/l.X);return{tileID:new l.S(d,0,d,C,P),mercatorX:y,mercatorY:T}}}class S0{constructor(s,d,p){this._context=s,this._size=d,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new Ke(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(p.texture),{id:s,fbo:d,texture:p,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>s.id!==d),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const rl={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Bm{constructor(s,d){this.painter=s,this.terrain=d,this.pool=new S0(s.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(p=>!s._layers[p].isHidden(d)),this._coordsDescendingInv={};for(const p in s.sourceCaches){this._coordsDescendingInv[p]={};const m=s.sourceCaches[p].getVisibleCoordinates();for(const y of m){const T=this.terrain.sourceCache.getTerrainCoords(y);for(const C in T)this._coordsDescendingInv[p][C]||(this._coordsDescendingInv[p][C]=[]),this._coordsDescendingInv[p][C].push(T[C])}}this._coordsDescendingInvStr={};for(const p of s._order){const m=s._layers[p],y=m.source;if(rl[m.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const T in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][T]=this._coordsDescendingInv[y][T].map(C=>C.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[m][p.tileID.key];y&&y!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const d=s.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(rl[d]&&(this._prevType&&rl[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(s.id),!m))return!0;if(rl[this._prevType]||rl[d]&&m){this._prevType=d;const y=this._stacks.length-1,T=this._stacks[y]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(Tm(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[y]){const D=this.pool.getObjectForId(C.rtt[y].id);if(D.stamp===C.rtt[y].stamp){this.pool.useObject(D);continue}}const P=this.pool.getOrCreateFreeObject();this.pool.useObject(P),this.pool.stampObject(P),C.rtt[y]={id:P.id,stamp:P.stamp},p.context.bindFramebuffer.set(P.fbo.framebuffer),p.context.clear({color:l.aM.transparent,stencil:0}),p.currentStencilSource=void 0;for(let D=0;D<T.length;D++){const F=p.style._layers[T[D]],N=F.source?this._coordsDescendingInv[F.source][C.tileID.key]:[C.tileID];p.context.viewport.set([0,0,P.fbo.width,P.fbo.height]),p._renderTileClippingMasks(F,N),p.renderLayer(p,p.style.sourceCaches[F.source],F,N),F.source&&(C.rttCoords[F.source]=this._coordsDescendingInvStr[F.source][C.tileID.key])}}return Tm(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),rl[d]}return!1}}const Yd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Dm=_,C0={hash:!1,interactive:!0,bearingSnap:7,attributionControl:il,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Jd=v=>{v.touchstart=v.dragStart,v.touchmoveWindow=v.dragMove,v.touchend=v.dragEnd},I0={showCompass:!0,showZoom:!0,visualizePitch:!1};class R0{constructor(s,d,p=!1){this.mousedown=T=>{this.startMouse(l.e({},T,{ctrlKey:!0,preventDefault:()=>T.preventDefault()}),R.mousePos(this.element,T)),R.addEventListener(window,"mousemove",this.mousemove),R.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=T=>{this.moveMouse(T,R.mousePos(this.element,T))},this.mouseup=T=>{this.mouseRotate.dragEnd(T),this.mousePitch&&this.mousePitch.dragEnd(T),this.offTemp()},this.touchstart=T=>{T.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=R.touchPos(this.element,T.targetTouches)[0],this.startTouch(T,this._startPos),R.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.addEventListener(window,"touchend",this.touchend))},this.touchmove=T=>{T.targetTouches.length!==1?this.reset():(this._lastPos=R.touchPos(this.element,T.targetTouches)[0],this.moveTouch(T,this._lastPos))},this.touchend=T=>{T.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=s.dragRotate._mouseRotate.getClickTolerance(),y=s.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=Ud({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:T,clickTolerance:C,bearingDegreesPerPixelMoved:P=.8})=>{const D=new Ld;return new ro({clickTolerance:C,move:(F,N)=>({bearingDelta:(N.x-F.x)*P}),moveStateManager:D,enable:T,assignEvents:Jd})})({clickTolerance:m,enable:!0}),this.map=s,p&&(this.mousePitch=zd({clickTolerance:y,enable:!0}),this.touchPitch=(({enable:T,clickTolerance:C,pitchDegreesPerPixelMoved:P=-.5})=>{const D=new Ld;return new ro({clickTolerance:C,move:(F,N)=>({pitchDelta:(N.y-F.y)*P}),moveStateManager:D,enable:T,assignEvents:Jd})})({clickTolerance:y,enable:!0})),R.addEventListener(d,"mousedown",this.mousedown),R.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),R.addEventListener(d,"touchcancel",this.reset)}startMouse(s,d){this.mouseRotate.dragStart(s,d),this.mousePitch&&this.mousePitch.dragStart(s,d),R.disableDrag()}startTouch(s,d){this.touchRotate.dragStart(s,d),this.touchPitch&&this.touchPitch.dragStart(s,d),R.disableDrag()}moveMouse(s,d){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(s,d)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(s,d)||{};y&&p.setPitch(p.getPitch()+y)}}moveTouch(s,d){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(s,d)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(s,d)||{};y&&p.setPitch(p.getPitch()+y)}}off(){const s=this.element;R.removeEventListener(s,"mousedown",this.mousedown),R.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend),R.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){R.enableDrag(),R.removeEventListener(window,"mousemove",this.mousemove),R.removeEventListener(window,"mouseup",this.mouseup),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend)}}let Or;function Ai(v,s,d){const p=new l.N(v.lng,v.lat);if(v=new l.N(v.lng,v.lat),s){const m=new l.N(v.lng-360,v.lat),y=new l.N(v.lng+360,v.lat),T=d.locationPoint(v).distSqr(s);d.locationPoint(m).distSqr(s)<T?v=m:d.locationPoint(y).distSqr(s)<T&&(v=y)}for(;Math.abs(v.lng-d.center.lng)>180;){const m=d.locationPoint(v);if(m.x>=0&&m.y>=0&&m.x<=d.width&&m.y<=d.height)break;v.lng>d.center.lng?v.lng-=360:v.lng+=360}return v.lng!==p.lng&&d.locationPoint(v).y>d.height/2-d.getHorizon()?v:p}const sl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ou(v,s,d){const p=v.classList;for(const m in sl)p.remove(`maplibregl-${d}-anchor-${m}`);p.add(`maplibregl-${d}-anchor-${s}`)}class ku extends l.E{constructor(s){if(super(),this._onKeyPress=d=>{const p=d.code,m=d.charCode||d.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=d=>{const p=d.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=d=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ai(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let T="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?T="rotateX(0deg)":this._pitchAlignment==="map"&&(T=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||d&&d.type!=="moveend"||(this._pos=this._pos.round()),R.setTransform(this._element,`${sl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${T} ${y}`),I.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._subpixelPositioning=s&&s.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(s==null?void 0:s.opacity,s==null?void 0:s.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=l.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=R.create("div");const d=R.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${p}px`),d.setAttributeNS(null,"width",`${m}px`),d.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const y=R.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const T=R.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const C=R.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ue of P){const pe=R.createNS("http://www.w3.org/2000/svg","ellipse");pe.setAttributeNS(null,"opacity","0.04"),pe.setAttributeNS(null,"cx","10.5"),pe.setAttributeNS(null,"cy","5.80029008"),pe.setAttributeNS(null,"rx",ue.rx),pe.setAttributeNS(null,"ry",ue.ry),C.appendChild(pe)}const D=R.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const F=R.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(F);const N=R.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"fill","#000000");const H=R.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),N.appendChild(H);const J=R.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(6.0, 7.0)"),J.setAttributeNS(null,"fill","#FFFFFF");const te=R.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(8.0, 8.0)");const oe=R.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#000000"),oe.setAttributeNS(null,"opacity","0.25"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962");const ce=R.createNS("http://www.w3.org/2000/svg","circle");ce.setAttributeNS(null,"fill","#FFFFFF"),ce.setAttributeNS(null,"cx","5.5"),ce.setAttributeNS(null,"cy","5.5"),ce.setAttributeNS(null,"r","5.4999962"),te.appendChild(oe),te.appendChild(ce),T.appendChild(C),T.appendChild(D),T.appendChild(N),T.appendChild(J),T.appendChild(te),d.appendChild(T),d.setAttributeNS(null,"height",p*this._scale+"px"),d.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(d),this._offset=l.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),Ou(this._element,this._anchor,"marker"),s&&s.className)for(const d of s.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(s){return this.remove(),this._map=s,this._element.setAttribute("aria-label",s._getUIString("Marker.Title")),s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),R.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=l.N.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const m=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(s){return this._subpixelPositioning=s,this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:s?(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map)),this):this}_updateOpacity(s=!1){var d,p;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,y=m.terrain.depthAtPoint(this._pos),T=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,T)-y<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/m.transform._pixelPerMeter,P=Math.sin(m.getPitch()*Math.PI/180)*C,D=m.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),F=m.transform.lngLatToCameraDepth(this._lngLat,T+P)-D>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=l.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,d){return s===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const Om={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let yc=0,vc=!1;const zs={maxWidth:100,unit:"metric"};function xc(v,s,d){const p=d&&d.maxWidth||100,m=v._container.clientHeight/2,y=v.unproject([0,m]),T=v.unproject([p,m]),C=y.distanceTo(T);if(d&&d.unit==="imperial"){const P=3.2808*C;P>5280?ft(s,p,P/5280,v._getUIString("ScaleControl.Miles")):ft(s,p,P,v._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?ft(s,p,C/1852,v._getUIString("ScaleControl.NauticalMiles")):C>=1e3?ft(s,p,C/1e3,v._getUIString("ScaleControl.Kilometers")):ft(s,p,C,v._getUIString("ScaleControl.Meters"))}function ft(v,s,d,p){const m=function(y){const T=Math.pow(10,`${Math.floor(y)}`.length-1);let C=y/T;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(P){const D=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*D)/D}(C),T*C}(d);v.style.width=s*(m/d)+"px",v.innerHTML=`${m}&nbsp;${p}`}const Tt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Fu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nu(v){if(v){if(typeof v=="number"){const s=Math.round(Math.abs(v)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,v),"top-left":new l.P(s,s),"top-right":new l.P(-s,s),bottom:new l.P(0,-v),"bottom-left":new l.P(s,-s),"bottom-right":new l.P(-s,-s),left:new l.P(v,0),right:new l.P(-v,0)}}if(v instanceof l.P||Array.isArray(v)){const s=l.P.convert(v);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:l.P.convert(v.center||[0,0]),top:l.P.convert(v.top||[0,0]),"top-left":l.P.convert(v["top-left"]||[0,0]),"top-right":l.P.convert(v["top-right"]||[0,0]),bottom:l.P.convert(v.bottom||[0,0]),"bottom-left":l.P.convert(v["bottom-left"]||[0,0]),"bottom-right":l.P.convert(v["bottom-right"]||[0,0]),left:l.P.convert(v.left||[0,0]),right:l.P.convert(v.right||[0,0])}}return Nu(new l.P(0,0))}const Qd=_;u.AJAXError=l.bh,u.Evented=l.E,u.LngLat=l.N,u.MercatorCoordinate=l.Z,u.Point=l.P,u.addProtocol=l.bi,u.config=l.a,u.removeProtocol=l.bj,u.AttributionControl=nl,u.BoxZoomHandler=Dr,u.CanvasSource=dr,u.CooperativeGesturesHandler=tl,u.DoubleClickZoomHandler=ma,u.DragPanHandler=Rm,u.DragRotateHandler=Pm,u.EdgeInsets=Ya,u.FullscreenControl=class extends l.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var s;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((s=d==null?void 0:d.shadowRoot)===null||s===void 0)&&s.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){R.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=R.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);R.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=gn,u.GeolocateControl=class extends l.E{constructor(v){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",s)),this._finish()}},this._updateCamera=s=>{const d=new l.N(s.coords.longitude,s.coords.latitude),p=s.coords.accuracy,m=this._map.getBearing(),y=l.e({bearing:m},this.options.fitBoundsOptions),T=Pe.fromLngLat(d,p);this._map.fitBounds(T,y,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const d=new l.N(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&vc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=R.create("button","maplibregl-ctrl-geolocate",this._container),R.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=s=>{if(this._map){if(s===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ku({element:this._dotElement}),this._circleElement=R.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ku({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")),this.fire(new l.k("userlocationlostfocus")))})}},this.options=l.e({},Om,v)}onAdd(v){return this._map=v,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return l._(this,arguments,void 0,function*(s=!1){if(Or!==void 0&&!s)return Or;if(window.navigator.permissions===void 0)return Or=!!window.navigator.geolocation,Or;try{Or=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Or=!!window.navigator.geolocation}return Or})}().then(s=>this._finishSetupUI(s)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),R.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,yc=0,vc=!1}_isOutOfMapMaxBounds(v){const s=this._map.getMaxBounds(),d=v.coords;return s&&(d.longitude<s.getWest()||d.longitude>s.getEast()||d.latitude<s.getSouth()||d.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const v=this._map.getBounds(),s=v.getSouthEast(),d=v.getNorthEast(),p=s.distanceTo(d),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":yc--,vc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart")),this.fire(new l.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),yc++,yc>1?(v={maximumAge:6e5,timeout:0},vc=!0):(v=this.options.positionOptions,vc=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=Eu,u.ImageSource=ls,u.KeyboardHandler=Xr,u.LngLatBounds=Pe,u.LogoControl=qd,u.Map=class extends Mm{constructor(v){l.bf.mark(l.bg.create);const s=Object.assign(Object.assign({},C0),v);if(s.minZoom!=null&&s.maxZoom!=null&&s.minZoom>s.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(s.minPitch!=null&&s.maxPitch!=null&&s.minPitch>s.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(s.minPitch!=null&&s.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(s.maxPitch!=null&&s.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ja(s.minZoom,s.maxZoom,s.minPitch,s.maxPitch,s.renderWorldCopies),{bearingSnap:s.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new $t,this._controls=[],this._mapId=l.a4(),this._contextLost=d=>{d.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:d}))},this._contextRestored=d=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:d}))},this._onMapScroll=d=>{if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=s.interactive,this._maxTileCacheSize=s.maxTileCacheSize,this._maxTileCacheZoomLevels=s.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=s.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=s.preserveDrawingBuffer===!0,this._antialias=s.antialias===!0,this._trackResize=s.trackResize===!0,this._bearingSnap=s.bearingSnap,this._refreshExpiredTiles=s.refreshExpiredTiles===!0,this._fadeDuration=s.fadeDuration,this._crossSourceCollisions=s.crossSourceCollisions===!0,this._collectResourceTiming=s.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Yd),s.locale),this._clickTolerance=s.clickTolerance,this._overridePixelRatio=s.pixelRatio,this._maxCanvasSize=s.maxCanvasSize,this.transformCameraUpdate=s.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=s.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Q.addThrottleControl(()=>this.isMoving()),this._requestManager=new me(s.transformRequest),typeof s.container=="string"){if(this._container=document.getElementById(s.container),!this._container)throw new Error(`Container '${s.container}' not found.`)}else{if(!(s.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=s.container}if(s.maxBounds&&this.setMaxBounds(s.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let d=!1;const p=fc(m=>{this._trackResize&&!this._removed&&(this.resize(m),this.redraw())},50);this._resizeObserver=new ResizeObserver(m=>{d?p(m):d=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Xd(this,s),this._hash=s.hash&&new Eu(typeof s.hash=="string"&&s.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch}),s.bounds&&(this.resize(),this.fitBounds(s.bounds,l.e({},s.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=s.localIdeographFontFamily,this._validateStyle=s.validateStyle,s.style&&this.setStyle(s.style,{localIdeographFontFamily:s.localIdeographFontFamily}),s.attributionControl&&this.addControl(new nl(typeof s.attributionControl=="boolean"?void 0:s.attributionControl)),s.maplibreLogo&&this.addControl(new qd,s.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new l.k(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new l.k(`${d.dataType}dataloading`,d))}),this.on("dataabort",d=>{this.fire(new l.k("sourcedataabort",d))})}_getMapId(){return this._mapId}addControl(v,s){if(s===void 0&&(s=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=v.onAdd(this);this._controls.push(v);const p=this._controlPositions[s];return s.indexOf("bottom")!==-1?p.insertBefore(d,p.firstChild):p.appendChild(d),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(v);return s>-1&&this._controls.splice(s,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,s,d,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,s,d,p)}resize(v){var s;const d=this._containerDimensions(),p=d[0],m=d[1],y=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,y),this.painter.resize(p,m,y),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const P=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,P),this.painter.resize(p,m,P)}this.transform.resize(p,m),(s=this._requestedCameraState)===null||s===void 0||s.resize(p,m);const T=!this._moving;return T&&(this.stop(),this.fire(new l.k("movestart",v)).fire(new l.k("move",v))),this.fire(new l.k("resize",v)),T&&this.fire(new l.k("moveend",v)),this}_getClampedPixelRatio(v,s){const{0:d,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),y=v*m,T=s*m;return Math.min(y>d?d/y:1,T>p?p/T:1)*m}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(Pe.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}project(v){return this.transform.locationPoint(l.N.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.pointLocation(l.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,s,d){if(v==="mouseenter"||v==="mouseover"){let p=!1;return{layers:s,listener:d,delegates:{mousemove:y=>{const T=s.filter(P=>this.getLayer(P)),C=T.length!==0?this.queryRenderedFeatures(y.point,{layers:T}):[];C.length?p||(p=!0,d.call(this,new Un(v,this,y.originalEvent,{features:C}))):p=!1},mouseout:()=>{p=!1}}}}if(v==="mouseleave"||v==="mouseout"){let p=!1;return{layers:s,listener:d,delegates:{mousemove:T=>{const C=s.filter(P=>this.getLayer(P));(C.length!==0?this.queryRenderedFeatures(T.point,{layers:C}):[]).length?p=!0:p&&(p=!1,d.call(this,new Un(v,this,T.originalEvent)))},mouseout:T=>{p&&(p=!1,d.call(this,new Un(v,this,T.originalEvent)))}}}}{const p=m=>{const y=s.filter(C=>this.getLayer(C)),T=y.length!==0?this.queryRenderedFeatures(m.point,{layers:y}):[];T.length&&(m.features=T,d.call(this,m),delete m.features)};return{layers:s,listener:d,delegates:{[v]:p}}}}_saveDelegatedListener(v,s){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(s)}_removeDelegatedListener(v,s,d){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const p=this._delegatedListeners[v];for(let m=0;m<p.length;m++){const y=p[m];if(y.listener===d&&y.layers.length===s.length&&y.layers.every(T=>s.includes(T))){for(const T in y.delegates)this.off(T,y.delegates[T]);return void p.splice(m,1)}}}on(v,s,d){if(d===void 0)return super.on(v,s);const p=this._createDelegatedListener(v,typeof s=="string"?[s]:s,d);this._saveDelegatedListener(v,p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(v,s,d){if(d===void 0)return super.once(v,s);const p=typeof s=="string"?[s]:s,m=this._createDelegatedListener(v,p,d);for(const y in m.delegates){const T=m.delegates[y];m.delegates[y]=(...C)=>{this._removeDelegatedListener(v,p,d),T(...C)}}this._saveDelegatedListener(v,m);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(v,s,d){return d===void 0?super.off(v,s):(this._removeDelegatedListener(v,typeof s=="string"?[s]:s,d),this)}queryRenderedFeatures(v,s){if(!this.style)return[];let d;const p=v instanceof l.P||Array.isArray(v),m=p?v:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(p?{}:v)||{},m instanceof l.P||typeof m[0]=="number")d=[l.P.convert(m)];else{const y=l.P.convert(m[0]),T=l.P.convert(m[1]);d=[y,new l.P(T.x,y.y),T,new l.P(y.x,T.y),y]}return this.style.queryRenderedFeatures(d,s,this.transform)}querySourceFeatures(v,s){return this.style.querySourceFeatures(v,s)}setStyle(v,s){return(s=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(v,s))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const s=this._locale[v];if(s==null)throw new Error(`Missing UI string '${v}'`);return s}_updateStyle(v,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,s));const d=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new Va(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,s,d):this.style.loadJSON(v,s,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Va(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,s){if(typeof v=="string"){const d=this._requestManager.transformRequest(v,"Style");l.h(d,new AbortController).then(p=>{this._updateDiff(p.data,s)}).catch(p=>{p&&this.fire(new l.j(p))})}else typeof v=="object"&&this._updateDiff(v,s)}_updateDiff(v,s){try{this.style.setState(v,s)&&this._update(!0)}catch(d){l.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(v,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(v,s){return this._lazyInitEmptyStyle(),this.style.addSource(v,s),this._update(!0)}isSourceLoaded(v){const s=this.style&&this.style.sourceCaches[v];if(s!==void 0)return s.loaded();this.fire(new l.j(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const s=this.style.sourceCaches[v.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&s.reload();for(const d in this.style._layers){const p=this.style._layers[d];p.type==="hillshade"&&p.source===v.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Zd(this.painter,s,v),this.painter.renderToTexture=new Bm(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==v.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:v})),this}getTerrain(){var v,s;return(s=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const s in v){const d=v[s]._tiles;for(const p in d){const m=d[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,s,d={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:y,stretchY:T,content:C,textFitWidth:P,textFitHeight:D}=d;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||l.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:F,height:N,data:H}=s,J=s;return this.style.addImage(v,{data:new l.R({width:F,height:N},new Uint8Array(H)),pixelRatio:p,stretchX:y,stretchY:T,content:C,textFitWidth:P,textFitHeight:D,sdf:m,version:0,userImage:J}),J.onAdd&&J.onAdd(this,v),this}}{const{width:F,height:N,data:H}=I.getImageData(s);this.style.addImage(v,{data:new l.R({width:F,height:N},H),pixelRatio:p,stretchX:y,stretchY:T,content:C,textFitWidth:P,textFitHeight:D,sdf:m,version:0})}}updateImage(v,s){const d=this.style.getImage(v);if(!d)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=s instanceof HTMLImageElement||l.b(s)?I.getImageData(s):s,{width:m,height:y,data:T}=p;if(m===void 0||y===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==d.data.width||y!==d.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(s instanceof HTMLImageElement||l.b(s));return d.data.replace(T,C),this.style.updateImage(v,d),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return Q.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,s){return this._lazyInitEmptyStyle(),this.style.addLayer(v,s),this._update(!0)}moveLayer(v,s){return this.style.moveLayer(v,s),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,s,d){return this.style.setLayerZoomRange(v,s,d),this._update(!0)}setFilter(v,s,d={}){return this.style.setFilter(v,s,d),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,s,d,p={}){return this.style.setPaintProperty(v,s,d,p),this._update(!0)}getPaintProperty(v,s){return this.style.getPaintProperty(v,s)}setLayoutProperty(v,s,d,p={}){return this.style.setLayoutProperty(v,s,d,p),this._update(!0)}getLayoutProperty(v,s){return this.style.getLayoutProperty(v,s)}setGlyphs(v,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,s,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,s,d,p=>{p||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,s,d=>{d||this._update(!0)}),this}setLight(v,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,s),this._update(!0)}getLight(){return this.style.getLight()}setSky(v){return this._lazyInitEmptyStyle(),this.style.setSky(v),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,s){return this.style.setFeatureState(v,s),this._update()}removeFeatureState(v,s){return this.style.removeFeatureState(v,s),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,s=0;return this._container&&(v=this._container.clientWidth||400,s=this._container.clientHeight||300),[v,s]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const s=this._canvasContainer=R.create("div","maplibregl-canvas-container",v);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=R.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),p=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],p);const m=this._controlContainer=R.create("div","maplibregl-control-container",v),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{y[T]=R.create("div",`maplibregl-ctrl-${T} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,s,d){this._canvas.width=Math.floor(d*v),this._canvas.height=Math.floor(d*s),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const v={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{s={requestedAttributes:v},p&&(s.statusMessage=p.statusMessage,s.type=p.type)},{once:!0});const d=this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v);if(!d){const p="Failed to initialize WebGL";throw s?(s.message=p,new Error(JSON.stringify(s))):new Error(p)}this.painter=new Tu(d,this.transform),L.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){const s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,y=I.now();this.style.zoomHistory.update(m,y);const T=new l.z(m,{now:y,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),C=T.crossFadingFactor();C===1&&C===this._crossFadingFactor||(d=!0,this._crossFadingFactor=C),this.style.update(T)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bf.mark(l.bg.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,l.bf.mark(l.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Q.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s!=null&&s.loseContext&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),R.remove(this._canvasContainer),R.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bf.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,I.frameAsync(this._frameRequest).then(v=>{l.bf.frame(v),this._frameRequest=null,this._render(v)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return Dm}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=Un,u.MapTouchEvent=fa,u.MapWheelEvent=Sm,u.Marker=ku,u.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const s=this._map.getZoom(),d=s===this._map.getMaxZoom(),p=s===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,d)=>{const p=this._map._getUIString(`NavigationControl.${d}`);s.title=p,s.setAttribute("aria-label",p)},this.options=l.e({},I0,v),this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),R.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),R.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=R.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new R0(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){R.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,s){const d=R.create("button",v,this._container);return d.type="button",d.addEventListener("click",s),d}},u.Popup=class extends l.E{constructor(v){super(),this.remove=()=>(this._content&&R.remove(this._content),this._container&&(R.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=R.create("div","maplibregl-popup",this._map.getContainer()),this._tip=R.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ai(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!s)return;const p=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const y=Nu(this.options.offset);if(!m){const C=this._container.offsetWidth,P=this._container.offsetHeight;let D;D=p.y+y.bottom.y<P?["top"]:p.y>this._map.transform.height-P?["bottom"]:[],p.x<C/2?D.push("left"):p.x>this._map.transform.width-C/2&&D.push("right"),m=D.length===0?"bottom":D.join("-")}let T=p.add(y[m]);this.options.subpixelPositioning||(T=T.round()),R.setTransform(this._container,`${sl[m]} translate(${T.x}px,${T.y}px)`),Ou(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Tt),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=l.N.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const s=document.createDocumentFragment(),d=document.createElement("body");let p;for(d.innerHTML=v;p=d.firstChild,p;)s.appendChild(p);return this.setDOMContent(s)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=R.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=R.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(Fu);v&&v.focus()}},u.RasterDEMTileSource=mi,u.RasterTileSource=Xt,u.ScaleControl=class{constructor(v){this._onMove=()=>{xc(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,xc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},zs),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){R.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=ds,u.Style=Va,u.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=R.create("button","maplibregl-ctrl-terrain",this._container),R.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){R.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=el,u.TwoFingersTouchRotateHandler=$d,u.TwoFingersTouchZoomHandler=jd,u.TwoFingersTouchZoomRotateHandler=Wd,u.VectorTileSource=Io,u.VideoSource=Ro,u.addSourceType=(v,s)=>l._(void 0,void 0,void 0,function*(){if(Po(v))throw new Error(`A source type called "${v}" already exists.`);((d,p)=>{ra[d]=p})(v,s)}),u.clearPrewarmedResources=function(){const v=Jt;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(Ji),Jt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return er().getRTLTextPluginStatus()},u.getVersion=function(){return Qd},u.getWorkerCount=function(){return mn.workerCount},u.getWorkerUrl=function(){return l.a.WORKER_URL},u.importScriptInWorkers=function(v){return Bs().broadcast("IS",v)},u.prewarm=function(){pi().acquire(Ji)},u.setMaxParallelImageRequests=function(v){l.a.MAX_PARALLEL_IMAGE_REQUESTS=v},u.setRTLTextPlugin=function(v,s){return er().setRTLTextPlugin(v,s)},u.setWorkerCount=function(v){mn.workerCount=v},u.setWorkerUrl=function(v){l.a.WORKER_URL=v}});var a=i;return a})})(M3);var lZ=M3.exports;const cZ=Vb(lZ);function uZ(){const t=Wk.useRef(null),e=kh.useRef(null),i=kh.useRef(null),n=.04,r=()=>{var l,_;if(!t.current)return;if(!((l=t==null?void 0:t.current)!=null&&l.getBearing()))return r();const a=(((_=t==null?void 0:t.current)==null?void 0:_.getBearing())+n)%360;t.current.setBearing(a);const u=t.current.getZoom();u>17.43&&t.current.setZoom(u-.001),requestAnimationFrame(r)};return kh.useEffect(()=>{if(!t.current)return;const a=new Kw({id:"tile3dlayer",pointSize:1.4,data:"http://localhost:8080/tileset.json",getPointColor:w=>[w.color[0],w.color[1],w.color[2],255],loader:qw,onDataLoad:w=>{console.log(w)},onTilesetLoad:w=>{console.log(w),_.flyTo({center:[w.cartographicCenter[0],w.cartographicCenter[1]],zoom:18})},pickable:!0}),u=new z_({id:"test-line",data:[[[-121.70453205014032,37.69990117683727,-16.20316425880268],[-121.70453453558238,37.69990254486633,5.455264936098173]]],getPath:w=>w,getWidth:.5,getColor:[255,0,0,0]}),l=new F$({interleaved:!0,layers:[a,u,new Pw({id:"point-cloud-layer",data:[],getPosition:w=>w.coordinates,getColor:w=>[255,255,0],getRadius:5})]});t.current=new cZ.Map({container:"map",zoom:18.5,center:[-83.019066,40.001378],pitch:46,bearing:-127,hash:!1,style:"https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json"});const _=t.current;return _.on("contextmenu",w=>{console.log(w.lngLat)}),_.on("load",()=>{_.addLayer({id:"measure",type:"line",source:{type:"geojson",data:{type:"FeatureCollection",features:[]}},paint:{"line-color":"#FF0000","line-width":2}}),_.addControl(l),r(),_.on("click",w=>{const E=l.pickObject({x:w.point.x,y:w.point.y,radius:10,layerIds:["tile3dlayer"],unproject3D:!0});if(console.log(E),E!=null&&E.coordinate){const[I,R,L]=E.coordinate;if(!e.current)e.current={x:I,y:R,z:L};else if(i.current)e.current={x:I,y:R,z:L},i.current=null,l.setProps({layers:[a,u]});else{i.current={x:I,y:R,z:L};const W=Math.abs(L-e.current.z);console.log(W),console.log(e.current,i.current),document.getElementById("measure-info").innerHTML=`Height difference: ${W.toFixed(2)} meters`,document.getElementById("measure-info").style.display="block",l.setProps({layers:[a,u,new z_({id:"measure-line-3d",data:[[[e.current.x,e.current.y,e.current.z],[i.current.x,i.current.y,i.current.z]]],getPath:K=>K,getWidth:.5,getColor:[255,255,0,255]})]})}}}),_.on("contextmenu",w=>{const I=_.getBounds().getCenter();console.log(I),e.current=null,i.current=null,l.setProps({layers:[a,u]}),document.getElementById("measure-info").innerHTML="",document.getElementById("measure-info").style.display="none"}),_.on("mousemove",w=>{const E=l.pickObject({x:w.point.x,y:w.point.y,radius:10,layerIds:["tile3dlayer"],unproject3D:!0});if(E!=null&&E.coordinate){const[I,R,L]=E.coordinate;document.getElementById("info").innerHTML=`x: ${I.toFixed(6)}, y: ${R.toFixed(6)}, z: ${(L+160).toFixed(2)}`}}),_.on("zoomend",()=>{const w=_.getZoom(),E={18:1.2,18.5:2,19:3,20:4},R=(W=>E[+W.toFixed(2)]||1.2)(w),L=a.clone({pointSize:R});R!==a.props.pointSize&&l.setProps({layers:[L,u]})})}),()=>{t.current.remove(),t.current=null}},[]),e_.jsxs("div",{id:"map",style:{width:"100%",height:"100vh",background:"#212121"},ref:t,children:[e_.jsx("div",{id:"info",style:{position:"absolute",top:"10px",left:"10px",padding:"5px",backgroundColor:"hsl(0 0% 20% / 1)",color:"white",zIndex:1e3,borderRadius:"5px",border:"solid thin #999",display:"none"}}),e_.jsx("div",{id:"measure-info",style:{position:"absolute",top:"60px",left:"10px",padding:"5px",backgroundColor:"hsl(0 0% 20% / 1)",color:"white",zIndex:1e3,borderRadius:"5px",border:"solid thin #999",display:"none"}})]})}var D3={exports:{}},Ps={},O3={exports:{}},k3={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(ut,Et){var At=ut.length;ut.push(Et);e:for(;0<At;){var Ft=At-1>>>1,Ut=ut[Ft];if(0<r(Ut,Et))ut[Ft]=Et,ut[At]=Ut,At=Ft;else break e}}function i(ut){return ut.length===0?null:ut[0]}function n(ut){if(ut.length===0)return null;var Et=ut[0],At=ut.pop();if(At!==Et){ut[0]=At;e:for(var Ft=0,Ut=ut.length,Yn=Ut>>>1;Ft<Yn;){var Ji=2*(Ft+1)-1,mn=ut[Ji],On=Ji+1,Jt=ut[On];if(0>r(mn,At))On<Ut&&0>r(Jt,mn)?(ut[Ft]=Jt,ut[On]=At,Ft=On):(ut[Ft]=mn,ut[Ji]=At,Ft=Ji);else if(On<Ut&&0>r(Jt,At))ut[Ft]=Jt,ut[On]=At,Ft=On;else break e}}return Et}function r(ut,Et){var At=ut.sortIndex-Et.sortIndex;return At!==0?At:ut.id-Et.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var u=Date,l=u.now();t.unstable_now=function(){return u.now()-l}}var _=[],w=[],E=1,I=null,R=3,L=!1,W=!1,K=!1,fe=typeof setTimeout=="function"?setTimeout:null,X=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Q(ut){for(var Et=i(w);Et!==null;){if(Et.callback===null)n(w);else if(Et.startTime<=ut)n(w),Et.sortIndex=Et.expirationTime,e(_,Et);else break;Et=i(w)}}function me(ut){if(K=!1,Q(ut),!W)if(i(_)!==null)W=!0,Zn(Ce);else{var Et=i(w);Et!==null&&sn(me,Et.startTime-ut)}}function Ce(ut,Et){W=!1,K&&(K=!1,X(ze),ze=-1),L=!0;var At=R;try{for(Q(Et),I=i(_);I!==null&&(!(I.expirationTime>Et)||ut&&!Ke());){var Ft=I.callback;if(typeof Ft=="function"){I.callback=null,R=I.priorityLevel;var Ut=Ft(I.expirationTime<=Et);Et=t.unstable_now(),typeof Ut=="function"?I.callback=Ut:I===i(_)&&n(_),Q(Et)}else n(_);I=i(_)}if(I!==null)var Yn=!0;else{var Ji=i(w);Ji!==null&&sn(me,Ji.startTime-Et),Yn=!1}return Yn}finally{I=null,R=At,L=!1}}var Be=!1,Fe=null,ze=-1,Ve=5,je=-1;function Ke(){return!(t.unstable_now()-je<Ve)}function Lt(){if(Fe!==null){var ut=t.unstable_now();je=ut;var Et=!0;try{Et=Fe(!0,ut)}finally{Et?Pt():(Be=!1,Fe=null)}}else Be=!1}var Pt;if(typeof $=="function")Pt=function(){$(Lt)};else if(typeof MessageChannel<"u"){var bt=new MessageChannel,_i=bt.port2;bt.port1.onmessage=Lt,Pt=function(){_i.postMessage(null)}}else Pt=function(){fe(Lt,0)};function Zn(ut){Fe=ut,Be||(Be=!0,Pt())}function sn(ut,Et){ze=fe(function(){ut(t.unstable_now())},Et)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(ut){ut.callback=null},t.unstable_continueExecution=function(){W||L||(W=!0,Zn(Ce))},t.unstable_forceFrameRate=function(ut){0>ut||125<ut?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ve=0<ut?Math.floor(1e3/ut):5},t.unstable_getCurrentPriorityLevel=function(){return R},t.unstable_getFirstCallbackNode=function(){return i(_)},t.unstable_next=function(ut){switch(R){case 1:case 2:case 3:var Et=3;break;default:Et=R}var At=R;R=Et;try{return ut()}finally{R=At}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(ut,Et){switch(ut){case 1:case 2:case 3:case 4:case 5:break;default:ut=3}var At=R;R=ut;try{return Et()}finally{R=At}},t.unstable_scheduleCallback=function(ut,Et,At){var Ft=t.unstable_now();switch(typeof At=="object"&&At!==null?(At=At.delay,At=typeof At=="number"&&0<At?Ft+At:Ft):At=Ft,ut){case 1:var Ut=-1;break;case 2:Ut=250;break;case 5:Ut=1073741823;break;case 4:Ut=1e4;break;default:Ut=5e3}return Ut=At+Ut,ut={id:E++,callback:Et,priorityLevel:ut,startTime:At,expirationTime:Ut,sortIndex:-1},At>Ft?(ut.sortIndex=At,e(w,ut),i(_)===null&&ut===i(w)&&(K?(X(ze),ze=-1):K=!0,sn(me,At-Ft))):(ut.sortIndex=Ut,e(_,ut),W||L||(W=!0,Zn(Ce))),ut},t.unstable_shouldYield=Ke,t.unstable_wrapCallback=function(ut){var Et=R;return function(){var At=R;R=Et;try{return ut.apply(this,arguments)}finally{R=At}}}})(k3);O3.exports=k3;var hZ=O3.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dZ=kh,Rs=hZ;function Ze(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var F3=new Set,Tp={};function cu(t,e){rd(t,e),rd(t+"Capture",e)}function rd(t,e){for(Tp[t]=e,t=0;t<e.length;t++)F3.add(e[t])}var ka=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Kx=Object.prototype.hasOwnProperty,fZ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Z2={},Y2={};function pZ(t){return Kx.call(Y2,t)?!0:Kx.call(Z2,t)?!1:fZ.test(t)?Y2[t]=!0:(Z2[t]=!0,!1)}function mZ(t,e,i,n){if(i!==null&&i.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:i!==null?!i.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function gZ(t,e,i,n){if(e===null||typeof e>"u"||mZ(t,e,i,n))return!0;if(n)return!1;if(i!==null)switch(i.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Vr(t,e,i,n,r,a,u){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=i,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=u}var cr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){cr[t]=new Vr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];cr[e]=new Vr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){cr[t]=new Vr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){cr[t]=new Vr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){cr[t]=new Vr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){cr[t]=new Vr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){cr[t]=new Vr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){cr[t]=new Vr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){cr[t]=new Vr(t,5,!1,t.toLowerCase(),null,!1,!1)});var Zw=/[\-:]([a-z])/g;function Yw(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Zw,Yw);cr[e]=new Vr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Zw,Yw);cr[e]=new Vr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Zw,Yw);cr[e]=new Vr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){cr[t]=new Vr(t,1,!1,t.toLowerCase(),null,!1,!1)});cr.xlinkHref=new Vr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){cr[t]=new Vr(t,1,!1,t.toLowerCase(),null,!0,!0)});function Jw(t,e,i,n){var r=cr.hasOwnProperty(e)?cr[e]:null;(r!==null?r.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(gZ(e,i,r,n)&&(i=null),n||r===null?pZ(e)&&(i===null?t.removeAttribute(e):t.setAttribute(e,""+i)):r.mustUseProperty?t[r.propertyName]=i===null?r.type===3?!1:"":i:(e=r.attributeName,n=r.attributeNamespace,i===null?t.removeAttribute(e):(r=r.type,i=r===3||r===4&&i===!0?"":""+i,n?t.setAttributeNS(n,e,i):t.setAttribute(e,i))))}var za=dZ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Fg=Symbol.for("react.element"),wh=Symbol.for("react.portal"),Ah=Symbol.for("react.fragment"),Qw=Symbol.for("react.strict_mode"),Zx=Symbol.for("react.profiler"),N3=Symbol.for("react.provider"),L3=Symbol.for("react.context"),eA=Symbol.for("react.forward_ref"),Yx=Symbol.for("react.suspense"),Jx=Symbol.for("react.suspense_list"),tA=Symbol.for("react.memo"),Sl=Symbol.for("react.lazy"),U3=Symbol.for("react.offscreen"),J2=Symbol.iterator;function Mf(t){return t===null||typeof t!="object"?null:(t=J2&&t[J2]||t["@@iterator"],typeof t=="function"?t:null)}var rn=Object.assign,T1;function Gf(t){if(T1===void 0)try{throw Error()}catch(i){var e=i.stack.trim().match(/\n( *(at )?)/);T1=e&&e[1]||""}return`
`+T1+t}var E1=!1;function S1(t,e){if(!t||E1)return"";E1=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(w){var n=w}Reflect.construct(t,[],e)}else{try{e.call()}catch(w){n=w}t.call(e.prototype)}else{try{throw Error()}catch(w){n=w}t()}}catch(w){if(w&&n&&typeof w.stack=="string"){for(var r=w.stack.split(`
`),a=n.stack.split(`
`),u=r.length-1,l=a.length-1;1<=u&&0<=l&&r[u]!==a[l];)l--;for(;1<=u&&0<=l;u--,l--)if(r[u]!==a[l]){if(u!==1||l!==1)do if(u--,l--,0>l||r[u]!==a[l]){var _=`
`+r[u].replace(" at new "," at ");return t.displayName&&_.includes("<anonymous>")&&(_=_.replace("<anonymous>",t.displayName)),_}while(1<=u&&0<=l);break}}}finally{E1=!1,Error.prepareStackTrace=i}return(t=t?t.displayName||t.name:"")?Gf(t):""}function _Z(t){switch(t.tag){case 5:return Gf(t.type);case 16:return Gf("Lazy");case 13:return Gf("Suspense");case 19:return Gf("SuspenseList");case 0:case 2:case 15:return t=S1(t.type,!1),t;case 11:return t=S1(t.type.render,!1),t;case 1:return t=S1(t.type,!0),t;default:return""}}function Qx(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ah:return"Fragment";case wh:return"Portal";case Zx:return"Profiler";case Qw:return"StrictMode";case Yx:return"Suspense";case Jx:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case L3:return(t.displayName||"Context")+".Consumer";case N3:return(t._context.displayName||"Context")+".Provider";case eA:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case tA:return e=t.displayName||null,e!==null?e:Qx(t.type)||"Memo";case Sl:e=t._payload,t=t._init;try{return Qx(t(e))}catch{}}return null}function yZ(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qx(e);case 8:return e===Qw?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Kl(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function z3(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function vZ(t){var e=z3(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var r=i.get,a=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(u){n=""+u,a.call(this,u)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(u){n=""+u},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Ng(t){t._valueTracker||(t._valueTracker=vZ(t))}function V3(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var i=e.getValue(),n="";return t&&(n=z3(t)?t.checked?"true":"false":t.value),t=n,t!==i?(e.setValue(t),!0):!1}function G_(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function eb(t,e){var i=e.checked;return rn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??t._wrapperState.initialChecked})}function Q2(t,e){var i=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;i=Kl(e.value!=null?e.value:i),t._wrapperState={initialChecked:n,initialValue:i,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function j3(t,e){e=e.checked,e!=null&&Jw(t,"checked",e,!1)}function tb(t,e){j3(t,e);var i=Kl(e.value),n=e.type;if(i!=null)n==="number"?(i===0&&t.value===""||t.value!=i)&&(t.value=""+i):t.value!==""+i&&(t.value=""+i);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?ib(t,e.type,i):e.hasOwnProperty("defaultValue")&&ib(t,e.type,Kl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function eI(t,e,i){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,i||e===t.value||(t.value=e),t.defaultValue=e}i=t.name,i!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,i!==""&&(t.name=i)}function ib(t,e,i){(e!=="number"||G_(t.ownerDocument)!==t)&&(i==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+i&&(t.defaultValue=""+i))}var Wf=Array.isArray;function Vh(t,e,i,n){if(t=t.options,e){e={};for(var r=0;r<i.length;r++)e["$"+i[r]]=!0;for(i=0;i<t.length;i++)r=e.hasOwnProperty("$"+t[i].value),t[i].selected!==r&&(t[i].selected=r),r&&n&&(t[i].defaultSelected=!0)}else{for(i=""+Kl(i),e=null,r=0;r<t.length;r++){if(t[r].value===i){t[r].selected=!0,n&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function nb(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ze(91));return rn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function tI(t,e){var i=e.value;if(i==null){if(i=e.children,e=e.defaultValue,i!=null){if(e!=null)throw Error(Ze(92));if(Wf(i)){if(1<i.length)throw Error(Ze(93));i=i[0]}e=i}e==null&&(e=""),i=e}t._wrapperState={initialValue:Kl(i)}}function H3(t,e){var i=Kl(e.value),n=Kl(e.defaultValue);i!=null&&(i=""+i,i!==t.value&&(t.value=i),e.defaultValue==null&&t.defaultValue!==i&&(t.defaultValue=i)),n!=null&&(t.defaultValue=""+n)}function iI(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function $3(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rb(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?$3(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Lg,G3=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,i,n,r){MSApp.execUnsafeLocalFunction(function(){return t(e,i,n,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Lg=Lg||document.createElement("div"),Lg.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Lg.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Ep(t,e){if(e){var i=t.firstChild;if(i&&i===t.lastChild&&i.nodeType===3){i.nodeValue=e;return}}t.textContent=e}var np={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},xZ=["Webkit","ms","Moz","O"];Object.keys(np).forEach(function(t){xZ.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),np[e]=np[t]})});function W3(t,e,i){return e==null||typeof e=="boolean"||e===""?"":i||typeof e!="number"||e===0||np.hasOwnProperty(t)&&np[t]?(""+e).trim():e+"px"}function X3(t,e){t=t.style;for(var i in e)if(e.hasOwnProperty(i)){var n=i.indexOf("--")===0,r=W3(i,e[i],n);i==="float"&&(i="cssFloat"),n?t.setProperty(i,r):t[i]=r}}var bZ=rn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function sb(t,e){if(e){if(bZ[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ze(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ze(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ze(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ze(62))}}function ob(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ab=null;function iA(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var lb=null,jh=null,Hh=null;function nI(t){if(t=im(t)){if(typeof lb!="function")throw Error(Ze(280));var e=t.stateNode;e&&(e=Yy(e),lb(t.stateNode,t.type,e))}}function q3(t){jh?Hh?Hh.push(t):Hh=[t]:jh=t}function K3(){if(jh){var t=jh,e=Hh;if(Hh=jh=null,nI(t),e)for(t=0;t<e.length;t++)nI(e[t])}}function Z3(t,e){return t(e)}function Y3(){}var C1=!1;function J3(t,e,i){if(C1)return t(e,i);C1=!0;try{return Z3(t,e,i)}finally{C1=!1,(jh!==null||Hh!==null)&&(Y3(),K3())}}function Sp(t,e){var i=t.stateNode;if(i===null)return null;var n=Yy(i);if(n===null)return null;i=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(i&&typeof i!="function")throw Error(Ze(231,e,typeof i));return i}var cb=!1;if(ka)try{var Bf={};Object.defineProperty(Bf,"passive",{get:function(){cb=!0}}),window.addEventListener("test",Bf,Bf),window.removeEventListener("test",Bf,Bf)}catch{cb=!1}function wZ(t,e,i,n,r,a,u,l,_){var w=Array.prototype.slice.call(arguments,3);try{e.apply(i,w)}catch(E){this.onError(E)}}var rp=!1,W_=null,X_=!1,ub=null,AZ={onError:function(t){rp=!0,W_=t}};function TZ(t,e,i,n,r,a,u,l,_){rp=!1,W_=null,wZ.apply(AZ,arguments)}function EZ(t,e,i,n,r,a,u,l,_){if(TZ.apply(this,arguments),rp){if(rp){var w=W_;rp=!1,W_=null}else throw Error(Ze(198));X_||(X_=!0,ub=w)}}function uu(t){var e=t,i=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(i=e.return),t=e.return;while(t)}return e.tag===3?i:null}function Q3(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function rI(t){if(uu(t)!==t)throw Error(Ze(188))}function SZ(t){var e=t.alternate;if(!e){if(e=uu(t),e===null)throw Error(Ze(188));return e!==t?null:t}for(var i=t,n=e;;){var r=i.return;if(r===null)break;var a=r.alternate;if(a===null){if(n=r.return,n!==null){i=n;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===i)return rI(r),t;if(a===n)return rI(r),e;a=a.sibling}throw Error(Ze(188))}if(i.return!==n.return)i=r,n=a;else{for(var u=!1,l=r.child;l;){if(l===i){u=!0,i=r,n=a;break}if(l===n){u=!0,n=r,i=a;break}l=l.sibling}if(!u){for(l=a.child;l;){if(l===i){u=!0,i=a,n=r;break}if(l===n){u=!0,n=a,i=r;break}l=l.sibling}if(!u)throw Error(Ze(189))}}if(i.alternate!==n)throw Error(Ze(190))}if(i.tag!==3)throw Error(Ze(188));return i.stateNode.current===i?t:e}function eB(t){return t=SZ(t),t!==null?tB(t):null}function tB(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=tB(t);if(e!==null)return e;t=t.sibling}return null}var iB=Rs.unstable_scheduleCallback,sI=Rs.unstable_cancelCallback,CZ=Rs.unstable_shouldYield,IZ=Rs.unstable_requestPaint,pn=Rs.unstable_now,RZ=Rs.unstable_getCurrentPriorityLevel,nA=Rs.unstable_ImmediatePriority,nB=Rs.unstable_UserBlockingPriority,q_=Rs.unstable_NormalPriority,PZ=Rs.unstable_LowPriority,rB=Rs.unstable_IdlePriority,Xy=null,ta=null;function MZ(t){if(ta&&typeof ta.onCommitFiberRoot=="function")try{ta.onCommitFiberRoot(Xy,t,void 0,(t.current.flags&128)===128)}catch{}}var wo=Math.clz32?Math.clz32:OZ,BZ=Math.log,DZ=Math.LN2;function OZ(t){return t>>>=0,t===0?32:31-(BZ(t)/DZ|0)|0}var Ug=64,zg=4194304;function Xf(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function K_(t,e){var i=t.pendingLanes;if(i===0)return 0;var n=0,r=t.suspendedLanes,a=t.pingedLanes,u=i&268435455;if(u!==0){var l=u&~r;l!==0?n=Xf(l):(a&=u,a!==0&&(n=Xf(a)))}else u=i&~r,u!==0?n=Xf(u):a!==0&&(n=Xf(a));if(n===0)return 0;if(e!==0&&e!==n&&!(e&r)&&(r=n&-n,a=e&-e,r>=a||r===16&&(a&4194240)!==0))return e;if(n&4&&(n|=i&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)i=31-wo(e),r=1<<i,n|=t[i],e&=~r;return n}function kZ(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function FZ(t,e){for(var i=t.suspendedLanes,n=t.pingedLanes,r=t.expirationTimes,a=t.pendingLanes;0<a;){var u=31-wo(a),l=1<<u,_=r[u];_===-1?(!(l&i)||l&n)&&(r[u]=kZ(l,e)):_<=e&&(t.expiredLanes|=l),a&=~l}}function hb(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function sB(){var t=Ug;return Ug<<=1,!(Ug&4194240)&&(Ug=64),t}function I1(t){for(var e=[],i=0;31>i;i++)e.push(t);return e}function em(t,e,i){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-wo(e),t[e]=i}function NZ(t,e){var i=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<i;){var r=31-wo(i),a=1<<r;e[r]=0,n[r]=-1,t[r]=-1,i&=~a}}function rA(t,e){var i=t.entangledLanes|=e;for(t=t.entanglements;i;){var n=31-wo(i),r=1<<n;r&e|t[n]&e&&(t[n]|=e),i&=~r}}var wi=0;function oB(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var aB,sA,lB,cB,uB,db=!1,Vg=[],Ll=null,Ul=null,zl=null,Cp=new Map,Ip=new Map,Rl=[],LZ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function oI(t,e){switch(t){case"focusin":case"focusout":Ll=null;break;case"dragenter":case"dragleave":Ul=null;break;case"mouseover":case"mouseout":zl=null;break;case"pointerover":case"pointerout":Cp.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ip.delete(e.pointerId)}}function Df(t,e,i,n,r,a){return t===null||t.nativeEvent!==a?(t={blockedOn:e,domEventName:i,eventSystemFlags:n,nativeEvent:a,targetContainers:[r]},e!==null&&(e=im(e),e!==null&&sA(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function UZ(t,e,i,n,r){switch(e){case"focusin":return Ll=Df(Ll,t,e,i,n,r),!0;case"dragenter":return Ul=Df(Ul,t,e,i,n,r),!0;case"mouseover":return zl=Df(zl,t,e,i,n,r),!0;case"pointerover":var a=r.pointerId;return Cp.set(a,Df(Cp.get(a)||null,t,e,i,n,r)),!0;case"gotpointercapture":return a=r.pointerId,Ip.set(a,Df(Ip.get(a)||null,t,e,i,n,r)),!0}return!1}function hB(t){var e=jc(t.target);if(e!==null){var i=uu(e);if(i!==null){if(e=i.tag,e===13){if(e=Q3(i),e!==null){t.blockedOn=e,uB(t.priority,function(){lB(i)});return}}else if(e===3&&i.stateNode.current.memoizedState.isDehydrated){t.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}t.blockedOn=null}function c_(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var i=fb(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(i===null){i=t.nativeEvent;var n=new i.constructor(i.type,i);ab=n,i.target.dispatchEvent(n),ab=null}else return e=im(i),e!==null&&sA(e),t.blockedOn=i,!1;e.shift()}return!0}function aI(t,e,i){c_(t)&&i.delete(e)}function zZ(){db=!1,Ll!==null&&c_(Ll)&&(Ll=null),Ul!==null&&c_(Ul)&&(Ul=null),zl!==null&&c_(zl)&&(zl=null),Cp.forEach(aI),Ip.forEach(aI)}function Of(t,e){t.blockedOn===e&&(t.blockedOn=null,db||(db=!0,Rs.unstable_scheduleCallback(Rs.unstable_NormalPriority,zZ)))}function Rp(t){function e(r){return Of(r,t)}if(0<Vg.length){Of(Vg[0],t);for(var i=1;i<Vg.length;i++){var n=Vg[i];n.blockedOn===t&&(n.blockedOn=null)}}for(Ll!==null&&Of(Ll,t),Ul!==null&&Of(Ul,t),zl!==null&&Of(zl,t),Cp.forEach(e),Ip.forEach(e),i=0;i<Rl.length;i++)n=Rl[i],n.blockedOn===t&&(n.blockedOn=null);for(;0<Rl.length&&(i=Rl[0],i.blockedOn===null);)hB(i),i.blockedOn===null&&Rl.shift()}var $h=za.ReactCurrentBatchConfig,Z_=!0;function VZ(t,e,i,n){var r=wi,a=$h.transition;$h.transition=null;try{wi=1,oA(t,e,i,n)}finally{wi=r,$h.transition=a}}function jZ(t,e,i,n){var r=wi,a=$h.transition;$h.transition=null;try{wi=4,oA(t,e,i,n)}finally{wi=r,$h.transition=a}}function oA(t,e,i,n){if(Z_){var r=fb(t,e,i,n);if(r===null)L1(t,e,n,Y_,i),oI(t,n);else if(UZ(r,t,e,i,n))n.stopPropagation();else if(oI(t,n),e&4&&-1<LZ.indexOf(t)){for(;r!==null;){var a=im(r);if(a!==null&&aB(a),a=fb(t,e,i,n),a===null&&L1(t,e,n,Y_,i),a===r)break;r=a}r!==null&&n.stopPropagation()}else L1(t,e,n,null,i)}}var Y_=null;function fb(t,e,i,n){if(Y_=null,t=iA(n),t=jc(t),t!==null)if(e=uu(t),e===null)t=null;else if(i=e.tag,i===13){if(t=Q3(e),t!==null)return t;t=null}else if(i===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Y_=t,null}function dB(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(RZ()){case nA:return 1;case nB:return 4;case q_:case PZ:return 16;case rB:return 536870912;default:return 16}default:return 16}}var Dl=null,aA=null,u_=null;function fB(){if(u_)return u_;var t,e=aA,i=e.length,n,r="value"in Dl?Dl.value:Dl.textContent,a=r.length;for(t=0;t<i&&e[t]===r[t];t++);var u=i-t;for(n=1;n<=u&&e[i-n]===r[a-n];n++);return u_=r.slice(t,1<n?1-n:void 0)}function h_(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function jg(){return!0}function lI(){return!1}function Ms(t){function e(i,n,r,a,u){this._reactName=i,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=u,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(i=t[l],this[l]=i?i(a):a[l]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?jg:lI,this.isPropagationStopped=lI,this}return rn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=jg)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=jg)},persist:function(){},isPersistent:jg}),e}var md={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lA=Ms(md),tm=rn({},md,{view:0,detail:0}),HZ=Ms(tm),R1,P1,kf,qy=rn({},tm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:cA,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==kf&&(kf&&t.type==="mousemove"?(R1=t.screenX-kf.screenX,P1=t.screenY-kf.screenY):P1=R1=0,kf=t),R1)},movementY:function(t){return"movementY"in t?t.movementY:P1}}),cI=Ms(qy),$Z=rn({},qy,{dataTransfer:0}),GZ=Ms($Z),WZ=rn({},tm,{relatedTarget:0}),M1=Ms(WZ),XZ=rn({},md,{animationName:0,elapsedTime:0,pseudoElement:0}),qZ=Ms(XZ),KZ=rn({},md,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),ZZ=Ms(KZ),YZ=rn({},md,{data:0}),uI=Ms(YZ),JZ={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},QZ={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},eY={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function tY(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=eY[t])?!!e[t]:!1}function cA(){return tY}var iY=rn({},tm,{key:function(t){if(t.key){var e=JZ[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=h_(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?QZ[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:cA,charCode:function(t){return t.type==="keypress"?h_(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?h_(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),nY=Ms(iY),rY=rn({},qy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hI=Ms(rY),sY=rn({},tm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:cA}),oY=Ms(sY),aY=rn({},md,{propertyName:0,elapsedTime:0,pseudoElement:0}),lY=Ms(aY),cY=rn({},qy,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),uY=Ms(cY),hY=[9,13,27,32],uA=ka&&"CompositionEvent"in window,sp=null;ka&&"documentMode"in document&&(sp=document.documentMode);var dY=ka&&"TextEvent"in window&&!sp,pB=ka&&(!uA||sp&&8<sp&&11>=sp),dI=" ",fI=!1;function mB(t,e){switch(t){case"keyup":return hY.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function gB(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Th=!1;function fY(t,e){switch(t){case"compositionend":return gB(e);case"keypress":return e.which!==32?null:(fI=!0,dI);case"textInput":return t=e.data,t===dI&&fI?null:t;default:return null}}function pY(t,e){if(Th)return t==="compositionend"||!uA&&mB(t,e)?(t=fB(),u_=aA=Dl=null,Th=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return pB&&e.locale!=="ko"?null:e.data;default:return null}}var mY={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pI(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!mY[t.type]:e==="textarea"}function _B(t,e,i,n){q3(n),e=J_(e,"onChange"),0<e.length&&(i=new lA("onChange","change",null,i,n),t.push({event:i,listeners:e}))}var op=null,Pp=null;function gY(t){IB(t,0)}function Ky(t){var e=Ch(t);if(V3(e))return t}function _Y(t,e){if(t==="change")return e}var yB=!1;if(ka){var B1;if(ka){var D1="oninput"in document;if(!D1){var mI=document.createElement("div");mI.setAttribute("oninput","return;"),D1=typeof mI.oninput=="function"}B1=D1}else B1=!1;yB=B1&&(!document.documentMode||9<document.documentMode)}function gI(){op&&(op.detachEvent("onpropertychange",vB),Pp=op=null)}function vB(t){if(t.propertyName==="value"&&Ky(Pp)){var e=[];_B(e,Pp,t,iA(t)),J3(gY,e)}}function yY(t,e,i){t==="focusin"?(gI(),op=e,Pp=i,op.attachEvent("onpropertychange",vB)):t==="focusout"&&gI()}function vY(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ky(Pp)}function xY(t,e){if(t==="click")return Ky(e)}function bY(t,e){if(t==="input"||t==="change")return Ky(e)}function wY(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Eo=typeof Object.is=="function"?Object.is:wY;function Mp(t,e){if(Eo(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var r=i[n];if(!Kx.call(e,r)||!Eo(t[r],e[r]))return!1}return!0}function _I(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function yI(t,e){var i=_I(t);t=0;for(var n;i;){if(i.nodeType===3){if(n=t+i.textContent.length,t<=e&&n>=e)return{node:i,offset:e-t};t=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=_I(i)}}function xB(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?xB(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function bB(){for(var t=window,e=G_();e instanceof t.HTMLIFrameElement;){try{var i=typeof e.contentWindow.location.href=="string"}catch{i=!1}if(i)t=e.contentWindow;else break;e=G_(t.document)}return e}function hA(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function AY(t){var e=bB(),i=t.focusedElem,n=t.selectionRange;if(e!==i&&i&&i.ownerDocument&&xB(i.ownerDocument.documentElement,i)){if(n!==null&&hA(i)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in i)i.selectionStart=e,i.selectionEnd=Math.min(t,i.value.length);else if(t=(e=i.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=i.textContent.length,a=Math.min(n.start,r);n=n.end===void 0?a:Math.min(n.end,r),!t.extend&&a>n&&(r=n,n=a,a=r),r=yI(i,a);var u=yI(i,n);r&&u&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==u.node||t.focusOffset!==u.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),a>n?(t.addRange(e),t.extend(u.node,u.offset)):(e.setEnd(u.node,u.offset),t.addRange(e)))}}for(e=[],t=i;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<e.length;i++)t=e[i],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var TY=ka&&"documentMode"in document&&11>=document.documentMode,Eh=null,pb=null,ap=null,mb=!1;function vI(t,e,i){var n=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;mb||Eh==null||Eh!==G_(n)||(n=Eh,"selectionStart"in n&&hA(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),ap&&Mp(ap,n)||(ap=n,n=J_(pb,"onSelect"),0<n.length&&(e=new lA("onSelect","select",null,e,i),t.push({event:e,listeners:n}),e.target=Eh)))}function Hg(t,e){var i={};return i[t.toLowerCase()]=e.toLowerCase(),i["Webkit"+t]="webkit"+e,i["Moz"+t]="moz"+e,i}var Sh={animationend:Hg("Animation","AnimationEnd"),animationiteration:Hg("Animation","AnimationIteration"),animationstart:Hg("Animation","AnimationStart"),transitionend:Hg("Transition","TransitionEnd")},O1={},wB={};ka&&(wB=document.createElement("div").style,"AnimationEvent"in window||(delete Sh.animationend.animation,delete Sh.animationiteration.animation,delete Sh.animationstart.animation),"TransitionEvent"in window||delete Sh.transitionend.transition);function Zy(t){if(O1[t])return O1[t];if(!Sh[t])return t;var e=Sh[t],i;for(i in e)if(e.hasOwnProperty(i)&&i in wB)return O1[t]=e[i];return t}var AB=Zy("animationend"),TB=Zy("animationiteration"),EB=Zy("animationstart"),SB=Zy("transitionend"),CB=new Map,xI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ec(t,e){CB.set(t,e),cu(e,[t])}for(var k1=0;k1<xI.length;k1++){var F1=xI[k1],EY=F1.toLowerCase(),SY=F1[0].toUpperCase()+F1.slice(1);ec(EY,"on"+SY)}ec(AB,"onAnimationEnd");ec(TB,"onAnimationIteration");ec(EB,"onAnimationStart");ec("dblclick","onDoubleClick");ec("focusin","onFocus");ec("focusout","onBlur");ec(SB,"onTransitionEnd");rd("onMouseEnter",["mouseout","mouseover"]);rd("onMouseLeave",["mouseout","mouseover"]);rd("onPointerEnter",["pointerout","pointerover"]);rd("onPointerLeave",["pointerout","pointerover"]);cu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));cu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));cu("onBeforeInput",["compositionend","keypress","textInput","paste"]);cu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));cu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));cu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var qf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),CY=new Set("cancel close invalid load scroll toggle".split(" ").concat(qf));function bI(t,e,i){var n=t.type||"unknown-event";t.currentTarget=i,EZ(n,e,void 0,t),t.currentTarget=null}function IB(t,e){e=(e&4)!==0;for(var i=0;i<t.length;i++){var n=t[i],r=n.event;n=n.listeners;e:{var a=void 0;if(e)for(var u=n.length-1;0<=u;u--){var l=n[u],_=l.instance,w=l.currentTarget;if(l=l.listener,_!==a&&r.isPropagationStopped())break e;bI(r,l,w),a=_}else for(u=0;u<n.length;u++){if(l=n[u],_=l.instance,w=l.currentTarget,l=l.listener,_!==a&&r.isPropagationStopped())break e;bI(r,l,w),a=_}}}if(X_)throw t=ub,X_=!1,ub=null,t}function ji(t,e){var i=e[xb];i===void 0&&(i=e[xb]=new Set);var n=t+"__bubble";i.has(n)||(RB(e,t,2,!1),i.add(n))}function N1(t,e,i){var n=0;e&&(n|=4),RB(i,t,n,e)}var $g="_reactListening"+Math.random().toString(36).slice(2);function Bp(t){if(!t[$g]){t[$g]=!0,F3.forEach(function(i){i!=="selectionchange"&&(CY.has(i)||N1(i,!1,t),N1(i,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[$g]||(e[$g]=!0,N1("selectionchange",!1,e))}}function RB(t,e,i,n){switch(dB(e)){case 1:var r=VZ;break;case 4:r=jZ;break;default:r=oA}i=r.bind(null,e,i,t),r=void 0,!cb||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),n?r!==void 0?t.addEventListener(e,i,{capture:!0,passive:r}):t.addEventListener(e,i,!0):r!==void 0?t.addEventListener(e,i,{passive:r}):t.addEventListener(e,i,!1)}function L1(t,e,i,n,r){var a=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var u=n.tag;if(u===3||u===4){var l=n.stateNode.containerInfo;if(l===r||l.nodeType===8&&l.parentNode===r)break;if(u===4)for(u=n.return;u!==null;){var _=u.tag;if((_===3||_===4)&&(_=u.stateNode.containerInfo,_===r||_.nodeType===8&&_.parentNode===r))return;u=u.return}for(;l!==null;){if(u=jc(l),u===null)return;if(_=u.tag,_===5||_===6){n=a=u;continue e}l=l.parentNode}}n=n.return}J3(function(){var w=a,E=iA(i),I=[];e:{var R=CB.get(t);if(R!==void 0){var L=lA,W=t;switch(t){case"keypress":if(h_(i)===0)break e;case"keydown":case"keyup":L=nY;break;case"focusin":W="focus",L=M1;break;case"focusout":W="blur",L=M1;break;case"beforeblur":case"afterblur":L=M1;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":L=cI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":L=GZ;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":L=oY;break;case AB:case TB:case EB:L=qZ;break;case SB:L=lY;break;case"scroll":L=HZ;break;case"wheel":L=uY;break;case"copy":case"cut":case"paste":L=ZZ;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":L=hI}var K=(e&4)!==0,fe=!K&&t==="scroll",X=K?R!==null?R+"Capture":null:R;K=[];for(var $=w,Q;$!==null;){Q=$;var me=Q.stateNode;if(Q.tag===5&&me!==null&&(Q=me,X!==null&&(me=Sp($,X),me!=null&&K.push(Dp($,me,Q)))),fe)break;$=$.return}0<K.length&&(R=new L(R,W,null,i,E),I.push({event:R,listeners:K}))}}if(!(e&7)){e:{if(R=t==="mouseover"||t==="pointerover",L=t==="mouseout"||t==="pointerout",R&&i!==ab&&(W=i.relatedTarget||i.fromElement)&&(jc(W)||W[Fa]))break e;if((L||R)&&(R=E.window===E?E:(R=E.ownerDocument)?R.defaultView||R.parentWindow:window,L?(W=i.relatedTarget||i.toElement,L=w,W=W?jc(W):null,W!==null&&(fe=uu(W),W!==fe||W.tag!==5&&W.tag!==6)&&(W=null)):(L=null,W=w),L!==W)){if(K=cI,me="onMouseLeave",X="onMouseEnter",$="mouse",(t==="pointerout"||t==="pointerover")&&(K=hI,me="onPointerLeave",X="onPointerEnter",$="pointer"),fe=L==null?R:Ch(L),Q=W==null?R:Ch(W),R=new K(me,$+"leave",L,i,E),R.target=fe,R.relatedTarget=Q,me=null,jc(E)===w&&(K=new K(X,$+"enter",W,i,E),K.target=Q,K.relatedTarget=fe,me=K),fe=me,L&&W)t:{for(K=L,X=W,$=0,Q=K;Q;Q=hh(Q))$++;for(Q=0,me=X;me;me=hh(me))Q++;for(;0<$-Q;)K=hh(K),$--;for(;0<Q-$;)X=hh(X),Q--;for(;$--;){if(K===X||X!==null&&K===X.alternate)break t;K=hh(K),X=hh(X)}K=null}else K=null;L!==null&&wI(I,R,L,K,!1),W!==null&&fe!==null&&wI(I,fe,W,K,!0)}}e:{if(R=w?Ch(w):window,L=R.nodeName&&R.nodeName.toLowerCase(),L==="select"||L==="input"&&R.type==="file")var Ce=_Y;else if(pI(R))if(yB)Ce=bY;else{Ce=vY;var Be=yY}else(L=R.nodeName)&&L.toLowerCase()==="input"&&(R.type==="checkbox"||R.type==="radio")&&(Ce=xY);if(Ce&&(Ce=Ce(t,w))){_B(I,Ce,i,E);break e}Be&&Be(t,R,w),t==="focusout"&&(Be=R._wrapperState)&&Be.controlled&&R.type==="number"&&ib(R,"number",R.value)}switch(Be=w?Ch(w):window,t){case"focusin":(pI(Be)||Be.contentEditable==="true")&&(Eh=Be,pb=w,ap=null);break;case"focusout":ap=pb=Eh=null;break;case"mousedown":mb=!0;break;case"contextmenu":case"mouseup":case"dragend":mb=!1,vI(I,i,E);break;case"selectionchange":if(TY)break;case"keydown":case"keyup":vI(I,i,E)}var Fe;if(uA)e:{switch(t){case"compositionstart":var ze="onCompositionStart";break e;case"compositionend":ze="onCompositionEnd";break e;case"compositionupdate":ze="onCompositionUpdate";break e}ze=void 0}else Th?mB(t,i)&&(ze="onCompositionEnd"):t==="keydown"&&i.keyCode===229&&(ze="onCompositionStart");ze&&(pB&&i.locale!=="ko"&&(Th||ze!=="onCompositionStart"?ze==="onCompositionEnd"&&Th&&(Fe=fB()):(Dl=E,aA="value"in Dl?Dl.value:Dl.textContent,Th=!0)),Be=J_(w,ze),0<Be.length&&(ze=new uI(ze,t,null,i,E),I.push({event:ze,listeners:Be}),Fe?ze.data=Fe:(Fe=gB(i),Fe!==null&&(ze.data=Fe)))),(Fe=dY?fY(t,i):pY(t,i))&&(w=J_(w,"onBeforeInput"),0<w.length&&(E=new uI("onBeforeInput","beforeinput",null,i,E),I.push({event:E,listeners:w}),E.data=Fe))}IB(I,e)})}function Dp(t,e,i){return{instance:t,listener:e,currentTarget:i}}function J_(t,e){for(var i=e+"Capture",n=[];t!==null;){var r=t,a=r.stateNode;r.tag===5&&a!==null&&(r=a,a=Sp(t,i),a!=null&&n.unshift(Dp(t,a,r)),a=Sp(t,e),a!=null&&n.push(Dp(t,a,r))),t=t.return}return n}function hh(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function wI(t,e,i,n,r){for(var a=e._reactName,u=[];i!==null&&i!==n;){var l=i,_=l.alternate,w=l.stateNode;if(_!==null&&_===n)break;l.tag===5&&w!==null&&(l=w,r?(_=Sp(i,a),_!=null&&u.unshift(Dp(i,_,l))):r||(_=Sp(i,a),_!=null&&u.push(Dp(i,_,l)))),i=i.return}u.length!==0&&t.push({event:e,listeners:u})}var IY=/\r\n?/g,RY=/\u0000|\uFFFD/g;function AI(t){return(typeof t=="string"?t:""+t).replace(IY,`
`).replace(RY,"")}function Gg(t,e,i){if(e=AI(e),AI(t)!==e&&i)throw Error(Ze(425))}function Q_(){}var gb=null,_b=null;function yb(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var vb=typeof setTimeout=="function"?setTimeout:void 0,PY=typeof clearTimeout=="function"?clearTimeout:void 0,TI=typeof Promise=="function"?Promise:void 0,MY=typeof queueMicrotask=="function"?queueMicrotask:typeof TI<"u"?function(t){return TI.resolve(null).then(t).catch(BY)}:vb;function BY(t){setTimeout(function(){throw t})}function U1(t,e){var i=e,n=0;do{var r=i.nextSibling;if(t.removeChild(i),r&&r.nodeType===8)if(i=r.data,i==="/$"){if(n===0){t.removeChild(r),Rp(e);return}n--}else i!=="$"&&i!=="$?"&&i!=="$!"||n++;i=r}while(i);Rp(e)}function Vl(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function EI(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="$"||i==="$!"||i==="$?"){if(e===0)return t;e--}else i==="/$"&&e++}t=t.previousSibling}return null}var gd=Math.random().toString(36).slice(2),Yo="__reactFiber$"+gd,Op="__reactProps$"+gd,Fa="__reactContainer$"+gd,xb="__reactEvents$"+gd,DY="__reactListeners$"+gd,OY="__reactHandles$"+gd;function jc(t){var e=t[Yo];if(e)return e;for(var i=t.parentNode;i;){if(e=i[Fa]||i[Yo]){if(i=e.alternate,e.child!==null||i!==null&&i.child!==null)for(t=EI(t);t!==null;){if(i=t[Yo])return i;t=EI(t)}return e}t=i,i=t.parentNode}return null}function im(t){return t=t[Yo]||t[Fa],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ch(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ze(33))}function Yy(t){return t[Op]||null}var bb=[],Ih=-1;function tc(t){return{current:t}}function Hi(t){0>Ih||(t.current=bb[Ih],bb[Ih]=null,Ih--)}function ki(t,e){Ih++,bb[Ih]=t.current,t.current=e}var Zl={},Cr=tc(Zl),ss=tc(!1),eu=Zl;function sd(t,e){var i=t.type.contextTypes;if(!i)return Zl;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var r={},a;for(a in i)r[a]=e[a];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function os(t){return t=t.childContextTypes,t!=null}function ey(){Hi(ss),Hi(Cr)}function SI(t,e,i){if(Cr.current!==Zl)throw Error(Ze(168));ki(Cr,e),ki(ss,i)}function PB(t,e,i){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return i;n=n.getChildContext();for(var r in n)if(!(r in e))throw Error(Ze(108,yZ(t)||"Unknown",r));return rn({},i,n)}function ty(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Zl,eu=Cr.current,ki(Cr,t),ki(ss,ss.current),!0}function CI(t,e,i){var n=t.stateNode;if(!n)throw Error(Ze(169));i?(t=PB(t,e,eu),n.__reactInternalMemoizedMergedChildContext=t,Hi(ss),Hi(Cr),ki(Cr,t)):Hi(ss),ki(ss,i)}var Ea=null,Jy=!1,z1=!1;function MB(t){Ea===null?Ea=[t]:Ea.push(t)}function kY(t){Jy=!0,MB(t)}function ic(){if(!z1&&Ea!==null){z1=!0;var t=0,e=wi;try{var i=Ea;for(wi=1;t<i.length;t++){var n=i[t];do n=n(!0);while(n!==null)}Ea=null,Jy=!1}catch(r){throw Ea!==null&&(Ea=Ea.slice(t+1)),iB(nA,ic),r}finally{wi=e,z1=!1}}return null}var Rh=[],Ph=0,iy=null,ny=0,Gs=[],Ws=0,tu=null,Pa=1,Ma="";function Dc(t,e){Rh[Ph++]=ny,Rh[Ph++]=iy,iy=t,ny=e}function BB(t,e,i){Gs[Ws++]=Pa,Gs[Ws++]=Ma,Gs[Ws++]=tu,tu=t;var n=Pa;t=Ma;var r=32-wo(n)-1;n&=~(1<<r),i+=1;var a=32-wo(e)+r;if(30<a){var u=r-r%5;a=(n&(1<<u)-1).toString(32),n>>=u,r-=u,Pa=1<<32-wo(e)+r|i<<r|n,Ma=a+t}else Pa=1<<a|i<<r|n,Ma=t}function dA(t){t.return!==null&&(Dc(t,1),BB(t,1,0))}function fA(t){for(;t===iy;)iy=Rh[--Ph],Rh[Ph]=null,ny=Rh[--Ph],Rh[Ph]=null;for(;t===tu;)tu=Gs[--Ws],Gs[Ws]=null,Ma=Gs[--Ws],Gs[Ws]=null,Pa=Gs[--Ws],Gs[Ws]=null}var Is=null,Cs=null,Ki=!1,po=null;function DB(t,e){var i=Zs(5,null,null,0);i.elementType="DELETED",i.stateNode=e,i.return=t,e=t.deletions,e===null?(t.deletions=[i],t.flags|=16):e.push(i)}function II(t,e){switch(t.tag){case 5:var i=t.type;return e=e.nodeType!==1||i.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Is=t,Cs=Vl(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Is=t,Cs=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(i=tu!==null?{id:Pa,overflow:Ma}:null,t.memoizedState={dehydrated:e,treeContext:i,retryLane:1073741824},i=Zs(18,null,null,0),i.stateNode=e,i.return=t,t.child=i,Is=t,Cs=null,!0):!1;default:return!1}}function wb(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Ab(t){if(Ki){var e=Cs;if(e){var i=e;if(!II(t,e)){if(wb(t))throw Error(Ze(418));e=Vl(i.nextSibling);var n=Is;e&&II(t,e)?DB(n,i):(t.flags=t.flags&-4097|2,Ki=!1,Is=t)}}else{if(wb(t))throw Error(Ze(418));t.flags=t.flags&-4097|2,Ki=!1,Is=t}}}function RI(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Is=t}function Wg(t){if(t!==Is)return!1;if(!Ki)return RI(t),Ki=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!yb(t.type,t.memoizedProps)),e&&(e=Cs)){if(wb(t))throw OB(),Error(Ze(418));for(;e;)DB(t,e),e=Vl(e.nextSibling)}if(RI(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ze(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="/$"){if(e===0){Cs=Vl(t.nextSibling);break e}e--}else i!=="$"&&i!=="$!"&&i!=="$?"||e++}t=t.nextSibling}Cs=null}}else Cs=Is?Vl(t.stateNode.nextSibling):null;return!0}function OB(){for(var t=Cs;t;)t=Vl(t.nextSibling)}function od(){Cs=Is=null,Ki=!1}function pA(t){po===null?po=[t]:po.push(t)}var FY=za.ReactCurrentBatchConfig;function Ff(t,e,i){if(t=i.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(Ze(309));var n=i.stateNode}if(!n)throw Error(Ze(147,t));var r=n,a=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(u){var l=r.refs;u===null?delete l[a]:l[a]=u},e._stringRef=a,e)}if(typeof t!="string")throw Error(Ze(284));if(!i._owner)throw Error(Ze(290,t))}return t}function Xg(t,e){throw t=Object.prototype.toString.call(e),Error(Ze(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function PI(t){var e=t._init;return e(t._payload)}function kB(t){function e(X,$){if(t){var Q=X.deletions;Q===null?(X.deletions=[$],X.flags|=16):Q.push($)}}function i(X,$){if(!t)return null;for(;$!==null;)e(X,$),$=$.sibling;return null}function n(X,$){for(X=new Map;$!==null;)$.key!==null?X.set($.key,$):X.set($.index,$),$=$.sibling;return X}function r(X,$){return X=Gl(X,$),X.index=0,X.sibling=null,X}function a(X,$,Q){return X.index=Q,t?(Q=X.alternate,Q!==null?(Q=Q.index,Q<$?(X.flags|=2,$):Q):(X.flags|=2,$)):(X.flags|=1048576,$)}function u(X){return t&&X.alternate===null&&(X.flags|=2),X}function l(X,$,Q,me){return $===null||$.tag!==6?($=X1(Q,X.mode,me),$.return=X,$):($=r($,Q),$.return=X,$)}function _(X,$,Q,me){var Ce=Q.type;return Ce===Ah?E(X,$,Q.props.children,me,Q.key):$!==null&&($.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===Sl&&PI(Ce)===$.type)?(me=r($,Q.props),me.ref=Ff(X,$,Q),me.return=X,me):(me=y_(Q.type,Q.key,Q.props,null,X.mode,me),me.ref=Ff(X,$,Q),me.return=X,me)}function w(X,$,Q,me){return $===null||$.tag!==4||$.stateNode.containerInfo!==Q.containerInfo||$.stateNode.implementation!==Q.implementation?($=q1(Q,X.mode,me),$.return=X,$):($=r($,Q.children||[]),$.return=X,$)}function E(X,$,Q,me,Ce){return $===null||$.tag!==7?($=Kc(Q,X.mode,me,Ce),$.return=X,$):($=r($,Q),$.return=X,$)}function I(X,$,Q){if(typeof $=="string"&&$!==""||typeof $=="number")return $=X1(""+$,X.mode,Q),$.return=X,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case Fg:return Q=y_($.type,$.key,$.props,null,X.mode,Q),Q.ref=Ff(X,null,$),Q.return=X,Q;case wh:return $=q1($,X.mode,Q),$.return=X,$;case Sl:var me=$._init;return I(X,me($._payload),Q)}if(Wf($)||Mf($))return $=Kc($,X.mode,Q,null),$.return=X,$;Xg(X,$)}return null}function R(X,$,Q,me){var Ce=$!==null?$.key:null;if(typeof Q=="string"&&Q!==""||typeof Q=="number")return Ce!==null?null:l(X,$,""+Q,me);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case Fg:return Q.key===Ce?_(X,$,Q,me):null;case wh:return Q.key===Ce?w(X,$,Q,me):null;case Sl:return Ce=Q._init,R(X,$,Ce(Q._payload),me)}if(Wf(Q)||Mf(Q))return Ce!==null?null:E(X,$,Q,me,null);Xg(X,Q)}return null}function L(X,$,Q,me,Ce){if(typeof me=="string"&&me!==""||typeof me=="number")return X=X.get(Q)||null,l($,X,""+me,Ce);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case Fg:return X=X.get(me.key===null?Q:me.key)||null,_($,X,me,Ce);case wh:return X=X.get(me.key===null?Q:me.key)||null,w($,X,me,Ce);case Sl:var Be=me._init;return L(X,$,Q,Be(me._payload),Ce)}if(Wf(me)||Mf(me))return X=X.get(Q)||null,E($,X,me,Ce,null);Xg($,me)}return null}function W(X,$,Q,me){for(var Ce=null,Be=null,Fe=$,ze=$=0,Ve=null;Fe!==null&&ze<Q.length;ze++){Fe.index>ze?(Ve=Fe,Fe=null):Ve=Fe.sibling;var je=R(X,Fe,Q[ze],me);if(je===null){Fe===null&&(Fe=Ve);break}t&&Fe&&je.alternate===null&&e(X,Fe),$=a(je,$,ze),Be===null?Ce=je:Be.sibling=je,Be=je,Fe=Ve}if(ze===Q.length)return i(X,Fe),Ki&&Dc(X,ze),Ce;if(Fe===null){for(;ze<Q.length;ze++)Fe=I(X,Q[ze],me),Fe!==null&&($=a(Fe,$,ze),Be===null?Ce=Fe:Be.sibling=Fe,Be=Fe);return Ki&&Dc(X,ze),Ce}for(Fe=n(X,Fe);ze<Q.length;ze++)Ve=L(Fe,X,ze,Q[ze],me),Ve!==null&&(t&&Ve.alternate!==null&&Fe.delete(Ve.key===null?ze:Ve.key),$=a(Ve,$,ze),Be===null?Ce=Ve:Be.sibling=Ve,Be=Ve);return t&&Fe.forEach(function(Ke){return e(X,Ke)}),Ki&&Dc(X,ze),Ce}function K(X,$,Q,me){var Ce=Mf(Q);if(typeof Ce!="function")throw Error(Ze(150));if(Q=Ce.call(Q),Q==null)throw Error(Ze(151));for(var Be=Ce=null,Fe=$,ze=$=0,Ve=null,je=Q.next();Fe!==null&&!je.done;ze++,je=Q.next()){Fe.index>ze?(Ve=Fe,Fe=null):Ve=Fe.sibling;var Ke=R(X,Fe,je.value,me);if(Ke===null){Fe===null&&(Fe=Ve);break}t&&Fe&&Ke.alternate===null&&e(X,Fe),$=a(Ke,$,ze),Be===null?Ce=Ke:Be.sibling=Ke,Be=Ke,Fe=Ve}if(je.done)return i(X,Fe),Ki&&Dc(X,ze),Ce;if(Fe===null){for(;!je.done;ze++,je=Q.next())je=I(X,je.value,me),je!==null&&($=a(je,$,ze),Be===null?Ce=je:Be.sibling=je,Be=je);return Ki&&Dc(X,ze),Ce}for(Fe=n(X,Fe);!je.done;ze++,je=Q.next())je=L(Fe,X,ze,je.value,me),je!==null&&(t&&je.alternate!==null&&Fe.delete(je.key===null?ze:je.key),$=a(je,$,ze),Be===null?Ce=je:Be.sibling=je,Be=je);return t&&Fe.forEach(function(Lt){return e(X,Lt)}),Ki&&Dc(X,ze),Ce}function fe(X,$,Q,me){if(typeof Q=="object"&&Q!==null&&Q.type===Ah&&Q.key===null&&(Q=Q.props.children),typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case Fg:e:{for(var Ce=Q.key,Be=$;Be!==null;){if(Be.key===Ce){if(Ce=Q.type,Ce===Ah){if(Be.tag===7){i(X,Be.sibling),$=r(Be,Q.props.children),$.return=X,X=$;break e}}else if(Be.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===Sl&&PI(Ce)===Be.type){i(X,Be.sibling),$=r(Be,Q.props),$.ref=Ff(X,Be,Q),$.return=X,X=$;break e}i(X,Be);break}else e(X,Be);Be=Be.sibling}Q.type===Ah?($=Kc(Q.props.children,X.mode,me,Q.key),$.return=X,X=$):(me=y_(Q.type,Q.key,Q.props,null,X.mode,me),me.ref=Ff(X,$,Q),me.return=X,X=me)}return u(X);case wh:e:{for(Be=Q.key;$!==null;){if($.key===Be)if($.tag===4&&$.stateNode.containerInfo===Q.containerInfo&&$.stateNode.implementation===Q.implementation){i(X,$.sibling),$=r($,Q.children||[]),$.return=X,X=$;break e}else{i(X,$);break}else e(X,$);$=$.sibling}$=q1(Q,X.mode,me),$.return=X,X=$}return u(X);case Sl:return Be=Q._init,fe(X,$,Be(Q._payload),me)}if(Wf(Q))return W(X,$,Q,me);if(Mf(Q))return K(X,$,Q,me);Xg(X,Q)}return typeof Q=="string"&&Q!==""||typeof Q=="number"?(Q=""+Q,$!==null&&$.tag===6?(i(X,$.sibling),$=r($,Q),$.return=X,X=$):(i(X,$),$=X1(Q,X.mode,me),$.return=X,X=$),u(X)):i(X,$)}return fe}var ad=kB(!0),FB=kB(!1),ry=tc(null),sy=null,Mh=null,mA=null;function gA(){mA=Mh=sy=null}function _A(t){var e=ry.current;Hi(ry),t._currentValue=e}function Tb(t,e,i){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===i)break;t=t.return}}function Gh(t,e){sy=t,mA=Mh=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(rs=!0),t.firstContext=null)}function eo(t){var e=t._currentValue;if(mA!==t)if(t={context:t,memoizedValue:e,next:null},Mh===null){if(sy===null)throw Error(Ze(308));Mh=t,sy.dependencies={lanes:0,firstContext:t}}else Mh=Mh.next=t;return e}var Hc=null;function yA(t){Hc===null?Hc=[t]:Hc.push(t)}function NB(t,e,i,n){var r=e.interleaved;return r===null?(i.next=i,yA(e)):(i.next=r.next,r.next=i),e.interleaved=i,Na(t,n)}function Na(t,e){t.lanes|=e;var i=t.alternate;for(i!==null&&(i.lanes|=e),i=t,t=t.return;t!==null;)t.childLanes|=e,i=t.alternate,i!==null&&(i.childLanes|=e),i=t,t=t.return;return i.tag===3?i.stateNode:null}var Cl=!1;function vA(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function LB(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ba(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function jl(t,e,i){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,oi&2){var r=n.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),n.pending=e,Na(t,i)}return r=n.interleaved,r===null?(e.next=e,yA(n)):(e.next=r.next,r.next=e),n.interleaved=e,Na(t,i)}function d_(t,e,i){if(e=e.updateQueue,e!==null&&(e=e.shared,(i&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,i|=n,e.lanes=i,rA(t,i)}}function MI(t,e){var i=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,i===n)){var r=null,a=null;if(i=i.firstBaseUpdate,i!==null){do{var u={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};a===null?r=a=u:a=a.next=u,i=i.next}while(i!==null);a===null?r=a=e:a=a.next=e}else r=a=e;i={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:n.shared,effects:n.effects},t.updateQueue=i;return}t=i.lastBaseUpdate,t===null?i.firstBaseUpdate=e:t.next=e,i.lastBaseUpdate=e}function oy(t,e,i,n){var r=t.updateQueue;Cl=!1;var a=r.firstBaseUpdate,u=r.lastBaseUpdate,l=r.shared.pending;if(l!==null){r.shared.pending=null;var _=l,w=_.next;_.next=null,u===null?a=w:u.next=w,u=_;var E=t.alternate;E!==null&&(E=E.updateQueue,l=E.lastBaseUpdate,l!==u&&(l===null?E.firstBaseUpdate=w:l.next=w,E.lastBaseUpdate=_))}if(a!==null){var I=r.baseState;u=0,E=w=_=null,l=a;do{var R=l.lane,L=l.eventTime;if((n&R)===R){E!==null&&(E=E.next={eventTime:L,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var W=t,K=l;switch(R=e,L=i,K.tag){case 1:if(W=K.payload,typeof W=="function"){I=W.call(L,I,R);break e}I=W;break e;case 3:W.flags=W.flags&-65537|128;case 0:if(W=K.payload,R=typeof W=="function"?W.call(L,I,R):W,R==null)break e;I=rn({},I,R);break e;case 2:Cl=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,R=r.effects,R===null?r.effects=[l]:R.push(l))}else L={eventTime:L,lane:R,tag:l.tag,payload:l.payload,callback:l.callback,next:null},E===null?(w=E=L,_=I):E=E.next=L,u|=R;if(l=l.next,l===null){if(l=r.shared.pending,l===null)break;R=l,l=R.next,R.next=null,r.lastBaseUpdate=R,r.shared.pending=null}}while(!0);if(E===null&&(_=I),r.baseState=_,r.firstBaseUpdate=w,r.lastBaseUpdate=E,e=r.shared.interleaved,e!==null){r=e;do u|=r.lane,r=r.next;while(r!==e)}else a===null&&(r.shared.lanes=0);nu|=u,t.lanes=u,t.memoizedState=I}}function BI(t,e,i){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],r=n.callback;if(r!==null){if(n.callback=null,n=i,typeof r!="function")throw Error(Ze(191,r));r.call(n)}}}var nm={},ia=tc(nm),kp=tc(nm),Fp=tc(nm);function $c(t){if(t===nm)throw Error(Ze(174));return t}function xA(t,e){switch(ki(Fp,e),ki(kp,t),ki(ia,nm),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:rb(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=rb(e,t)}Hi(ia),ki(ia,e)}function ld(){Hi(ia),Hi(kp),Hi(Fp)}function UB(t){$c(Fp.current);var e=$c(ia.current),i=rb(e,t.type);e!==i&&(ki(kp,t),ki(ia,i))}function bA(t){kp.current===t&&(Hi(ia),Hi(kp))}var tn=tc(0);function ay(t){for(var e=t;e!==null;){if(e.tag===13){var i=e.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var V1=[];function wA(){for(var t=0;t<V1.length;t++)V1[t]._workInProgressVersionPrimary=null;V1.length=0}var f_=za.ReactCurrentDispatcher,j1=za.ReactCurrentBatchConfig,iu=0,nn=null,Mn=null,qn=null,ly=!1,lp=!1,Np=0,NY=0;function wr(){throw Error(Ze(321))}function AA(t,e){if(e===null)return!1;for(var i=0;i<e.length&&i<t.length;i++)if(!Eo(t[i],e[i]))return!1;return!0}function TA(t,e,i,n,r,a){if(iu=a,nn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,f_.current=t===null||t.memoizedState===null?VY:jY,t=i(n,r),lp){a=0;do{if(lp=!1,Np=0,25<=a)throw Error(Ze(301));a+=1,qn=Mn=null,e.updateQueue=null,f_.current=HY,t=i(n,r)}while(lp)}if(f_.current=cy,e=Mn!==null&&Mn.next!==null,iu=0,qn=Mn=nn=null,ly=!1,e)throw Error(Ze(300));return t}function EA(){var t=Np!==0;return Np=0,t}function Xo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return qn===null?nn.memoizedState=qn=t:qn=qn.next=t,qn}function to(){if(Mn===null){var t=nn.alternate;t=t!==null?t.memoizedState:null}else t=Mn.next;var e=qn===null?nn.memoizedState:qn.next;if(e!==null)qn=e,Mn=t;else{if(t===null)throw Error(Ze(310));Mn=t,t={memoizedState:Mn.memoizedState,baseState:Mn.baseState,baseQueue:Mn.baseQueue,queue:Mn.queue,next:null},qn===null?nn.memoizedState=qn=t:qn=qn.next=t}return qn}function Lp(t,e){return typeof e=="function"?e(t):e}function H1(t){var e=to(),i=e.queue;if(i===null)throw Error(Ze(311));i.lastRenderedReducer=t;var n=Mn,r=n.baseQueue,a=i.pending;if(a!==null){if(r!==null){var u=r.next;r.next=a.next,a.next=u}n.baseQueue=r=a,i.pending=null}if(r!==null){a=r.next,n=n.baseState;var l=u=null,_=null,w=a;do{var E=w.lane;if((iu&E)===E)_!==null&&(_=_.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),n=w.hasEagerState?w.eagerState:t(n,w.action);else{var I={lane:E,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};_===null?(l=_=I,u=n):_=_.next=I,nn.lanes|=E,nu|=E}w=w.next}while(w!==null&&w!==a);_===null?u=n:_.next=l,Eo(n,e.memoizedState)||(rs=!0),e.memoizedState=n,e.baseState=u,e.baseQueue=_,i.lastRenderedState=n}if(t=i.interleaved,t!==null){r=t;do a=r.lane,nn.lanes|=a,nu|=a,r=r.next;while(r!==t)}else r===null&&(i.lanes=0);return[e.memoizedState,i.dispatch]}function $1(t){var e=to(),i=e.queue;if(i===null)throw Error(Ze(311));i.lastRenderedReducer=t;var n=i.dispatch,r=i.pending,a=e.memoizedState;if(r!==null){i.pending=null;var u=r=r.next;do a=t(a,u.action),u=u.next;while(u!==r);Eo(a,e.memoizedState)||(rs=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),i.lastRenderedState=a}return[a,n]}function zB(){}function VB(t,e){var i=nn,n=to(),r=e(),a=!Eo(n.memoizedState,r);if(a&&(n.memoizedState=r,rs=!0),n=n.queue,SA($B.bind(null,i,n,t),[t]),n.getSnapshot!==e||a||qn!==null&&qn.memoizedState.tag&1){if(i.flags|=2048,Up(9,HB.bind(null,i,n,r,e),void 0,null),Kn===null)throw Error(Ze(349));iu&30||jB(i,e,r)}return r}function jB(t,e,i){t.flags|=16384,t={getSnapshot:e,value:i},e=nn.updateQueue,e===null?(e={lastEffect:null,stores:null},nn.updateQueue=e,e.stores=[t]):(i=e.stores,i===null?e.stores=[t]:i.push(t))}function HB(t,e,i,n){e.value=i,e.getSnapshot=n,GB(e)&&WB(t)}function $B(t,e,i){return i(function(){GB(e)&&WB(t)})}function GB(t){var e=t.getSnapshot;t=t.value;try{var i=e();return!Eo(t,i)}catch{return!0}}function WB(t){var e=Na(t,1);e!==null&&Ao(e,t,1,-1)}function DI(t){var e=Xo();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Lp,lastRenderedState:t},e.queue=t,t=t.dispatch=zY.bind(null,nn,t),[e.memoizedState,t]}function Up(t,e,i,n){return t={tag:t,create:e,destroy:i,deps:n,next:null},e=nn.updateQueue,e===null?(e={lastEffect:null,stores:null},nn.updateQueue=e,e.lastEffect=t.next=t):(i=e.lastEffect,i===null?e.lastEffect=t.next=t:(n=i.next,i.next=t,t.next=n,e.lastEffect=t)),t}function XB(){return to().memoizedState}function p_(t,e,i,n){var r=Xo();nn.flags|=t,r.memoizedState=Up(1|e,i,void 0,n===void 0?null:n)}function Qy(t,e,i,n){var r=to();n=n===void 0?null:n;var a=void 0;if(Mn!==null){var u=Mn.memoizedState;if(a=u.destroy,n!==null&&AA(n,u.deps)){r.memoizedState=Up(e,i,a,n);return}}nn.flags|=t,r.memoizedState=Up(1|e,i,a,n)}function OI(t,e){return p_(8390656,8,t,e)}function SA(t,e){return Qy(2048,8,t,e)}function qB(t,e){return Qy(4,2,t,e)}function KB(t,e){return Qy(4,4,t,e)}function ZB(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function YB(t,e,i){return i=i!=null?i.concat([t]):null,Qy(4,4,ZB.bind(null,e,t),i)}function CA(){}function JB(t,e){var i=to();e=e===void 0?null:e;var n=i.memoizedState;return n!==null&&e!==null&&AA(e,n[1])?n[0]:(i.memoizedState=[t,e],t)}function QB(t,e){var i=to();e=e===void 0?null:e;var n=i.memoizedState;return n!==null&&e!==null&&AA(e,n[1])?n[0]:(t=t(),i.memoizedState=[t,e],t)}function eD(t,e,i){return iu&21?(Eo(i,e)||(i=sB(),nn.lanes|=i,nu|=i,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,rs=!0),t.memoizedState=i)}function LY(t,e){var i=wi;wi=i!==0&&4>i?i:4,t(!0);var n=j1.transition;j1.transition={};try{t(!1),e()}finally{wi=i,j1.transition=n}}function tD(){return to().memoizedState}function UY(t,e,i){var n=$l(t);if(i={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null},iD(t))nD(e,i);else if(i=NB(t,e,i,n),i!==null){var r=Ur();Ao(i,t,n,r),rD(i,e,n)}}function zY(t,e,i){var n=$l(t),r={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null};if(iD(t))nD(e,r);else{var a=t.alternate;if(t.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var u=e.lastRenderedState,l=a(u,i);if(r.hasEagerState=!0,r.eagerState=l,Eo(l,u)){var _=e.interleaved;_===null?(r.next=r,yA(e)):(r.next=_.next,_.next=r),e.interleaved=r;return}}catch{}finally{}i=NB(t,e,r,n),i!==null&&(r=Ur(),Ao(i,t,n,r),rD(i,e,n))}}function iD(t){var e=t.alternate;return t===nn||e!==null&&e===nn}function nD(t,e){lp=ly=!0;var i=t.pending;i===null?e.next=e:(e.next=i.next,i.next=e),t.pending=e}function rD(t,e,i){if(i&4194240){var n=e.lanes;n&=t.pendingLanes,i|=n,e.lanes=i,rA(t,i)}}var cy={readContext:eo,useCallback:wr,useContext:wr,useEffect:wr,useImperativeHandle:wr,useInsertionEffect:wr,useLayoutEffect:wr,useMemo:wr,useReducer:wr,useRef:wr,useState:wr,useDebugValue:wr,useDeferredValue:wr,useTransition:wr,useMutableSource:wr,useSyncExternalStore:wr,useId:wr,unstable_isNewReconciler:!1},VY={readContext:eo,useCallback:function(t,e){return Xo().memoizedState=[t,e===void 0?null:e],t},useContext:eo,useEffect:OI,useImperativeHandle:function(t,e,i){return i=i!=null?i.concat([t]):null,p_(4194308,4,ZB.bind(null,e,t),i)},useLayoutEffect:function(t,e){return p_(4194308,4,t,e)},useInsertionEffect:function(t,e){return p_(4,2,t,e)},useMemo:function(t,e){var i=Xo();return e=e===void 0?null:e,t=t(),i.memoizedState=[t,e],t},useReducer:function(t,e,i){var n=Xo();return e=i!==void 0?i(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=UY.bind(null,nn,t),[n.memoizedState,t]},useRef:function(t){var e=Xo();return t={current:t},e.memoizedState=t},useState:DI,useDebugValue:CA,useDeferredValue:function(t){return Xo().memoizedState=t},useTransition:function(){var t=DI(!1),e=t[0];return t=LY.bind(null,t[1]),Xo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,i){var n=nn,r=Xo();if(Ki){if(i===void 0)throw Error(Ze(407));i=i()}else{if(i=e(),Kn===null)throw Error(Ze(349));iu&30||jB(n,e,i)}r.memoizedState=i;var a={value:i,getSnapshot:e};return r.queue=a,OI($B.bind(null,n,a,t),[t]),n.flags|=2048,Up(9,HB.bind(null,n,a,i,e),void 0,null),i},useId:function(){var t=Xo(),e=Kn.identifierPrefix;if(Ki){var i=Ma,n=Pa;i=(n&~(1<<32-wo(n)-1)).toString(32)+i,e=":"+e+"R"+i,i=Np++,0<i&&(e+="H"+i.toString(32)),e+=":"}else i=NY++,e=":"+e+"r"+i.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},jY={readContext:eo,useCallback:JB,useContext:eo,useEffect:SA,useImperativeHandle:YB,useInsertionEffect:qB,useLayoutEffect:KB,useMemo:QB,useReducer:H1,useRef:XB,useState:function(){return H1(Lp)},useDebugValue:CA,useDeferredValue:function(t){var e=to();return eD(e,Mn.memoizedState,t)},useTransition:function(){var t=H1(Lp)[0],e=to().memoizedState;return[t,e]},useMutableSource:zB,useSyncExternalStore:VB,useId:tD,unstable_isNewReconciler:!1},HY={readContext:eo,useCallback:JB,useContext:eo,useEffect:SA,useImperativeHandle:YB,useInsertionEffect:qB,useLayoutEffect:KB,useMemo:QB,useReducer:$1,useRef:XB,useState:function(){return $1(Lp)},useDebugValue:CA,useDeferredValue:function(t){var e=to();return Mn===null?e.memoizedState=t:eD(e,Mn.memoizedState,t)},useTransition:function(){var t=$1(Lp)[0],e=to().memoizedState;return[t,e]},useMutableSource:zB,useSyncExternalStore:VB,useId:tD,unstable_isNewReconciler:!1};function uo(t,e){if(t&&t.defaultProps){e=rn({},e),t=t.defaultProps;for(var i in t)e[i]===void 0&&(e[i]=t[i]);return e}return e}function Eb(t,e,i,n){e=t.memoizedState,i=i(n,e),i=i==null?e:rn({},e,i),t.memoizedState=i,t.lanes===0&&(t.updateQueue.baseState=i)}var e0={isMounted:function(t){return(t=t._reactInternals)?uu(t)===t:!1},enqueueSetState:function(t,e,i){t=t._reactInternals;var n=Ur(),r=$l(t),a=Ba(n,r);a.payload=e,i!=null&&(a.callback=i),e=jl(t,a,r),e!==null&&(Ao(e,t,r,n),d_(e,t,r))},enqueueReplaceState:function(t,e,i){t=t._reactInternals;var n=Ur(),r=$l(t),a=Ba(n,r);a.tag=1,a.payload=e,i!=null&&(a.callback=i),e=jl(t,a,r),e!==null&&(Ao(e,t,r,n),d_(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var i=Ur(),n=$l(t),r=Ba(i,n);r.tag=2,e!=null&&(r.callback=e),e=jl(t,r,n),e!==null&&(Ao(e,t,n,i),d_(e,t,n))}};function kI(t,e,i,n,r,a,u){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,a,u):e.prototype&&e.prototype.isPureReactComponent?!Mp(i,n)||!Mp(r,a):!0}function sD(t,e,i){var n=!1,r=Zl,a=e.contextType;return typeof a=="object"&&a!==null?a=eo(a):(r=os(e)?eu:Cr.current,n=e.contextTypes,a=(n=n!=null)?sd(t,r):Zl),e=new e(i,a),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=e0,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=a),e}function FI(t,e,i,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(i,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(i,n),e.state!==t&&e0.enqueueReplaceState(e,e.state,null)}function Sb(t,e,i,n){var r=t.stateNode;r.props=i,r.state=t.memoizedState,r.refs={},vA(t);var a=e.contextType;typeof a=="object"&&a!==null?r.context=eo(a):(a=os(e)?eu:Cr.current,r.context=sd(t,a)),r.state=t.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(Eb(t,e,a,i),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&e0.enqueueReplaceState(r,r.state,null),oy(t,i,r,n),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function cd(t,e){try{var i="",n=e;do i+=_Z(n),n=n.return;while(n);var r=i}catch(a){r=`
Error generating stack: `+a.message+`
`+a.stack}return{value:t,source:e,stack:r,digest:null}}function G1(t,e,i){return{value:t,source:null,stack:i??null,digest:e??null}}function Cb(t,e){try{console.error(e.value)}catch(i){setTimeout(function(){throw i})}}var $Y=typeof WeakMap=="function"?WeakMap:Map;function oD(t,e,i){i=Ba(-1,i),i.tag=3,i.payload={element:null};var n=e.value;return i.callback=function(){hy||(hy=!0,Nb=n),Cb(t,e)},i}function aD(t,e,i){i=Ba(-1,i),i.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var r=e.value;i.payload=function(){return n(r)},i.callback=function(){Cb(t,e)}}var a=t.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(i.callback=function(){Cb(t,e),typeof n!="function"&&(Hl===null?Hl=new Set([this]):Hl.add(this));var u=e.stack;this.componentDidCatch(e.value,{componentStack:u!==null?u:""})}),i}function NI(t,e,i){var n=t.pingCache;if(n===null){n=t.pingCache=new $Y;var r=new Set;n.set(e,r)}else r=n.get(e),r===void 0&&(r=new Set,n.set(e,r));r.has(i)||(r.add(i),t=rJ.bind(null,t,e,i),e.then(t,t))}function LI(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function UI(t,e,i,n,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(e=Ba(-1,1),e.tag=2,jl(i,e,1))),i.lanes|=1),t)}var GY=za.ReactCurrentOwner,rs=!1;function Lr(t,e,i,n){e.child=t===null?FB(e,null,i,n):ad(e,t.child,i,n)}function zI(t,e,i,n,r){i=i.render;var a=e.ref;return Gh(e,r),n=TA(t,e,i,n,a,r),i=EA(),t!==null&&!rs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,La(t,e,r)):(Ki&&i&&dA(e),e.flags|=1,Lr(t,e,n,r),e.child)}function VI(t,e,i,n,r){if(t===null){var a=i.type;return typeof a=="function"&&!kA(a)&&a.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(e.tag=15,e.type=a,lD(t,e,a,n,r)):(t=y_(i.type,null,n,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(a=t.child,!(t.lanes&r)){var u=a.memoizedProps;if(i=i.compare,i=i!==null?i:Mp,i(u,n)&&t.ref===e.ref)return La(t,e,r)}return e.flags|=1,t=Gl(a,n),t.ref=e.ref,t.return=e,e.child=t}function lD(t,e,i,n,r){if(t!==null){var a=t.memoizedProps;if(Mp(a,n)&&t.ref===e.ref)if(rs=!1,e.pendingProps=n=a,(t.lanes&r)!==0)t.flags&131072&&(rs=!0);else return e.lanes=t.lanes,La(t,e,r)}return Ib(t,e,i,n,r)}function cD(t,e,i){var n=e.pendingProps,r=n.children,a=t!==null?t.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ki(Dh,As),As|=i;else{if(!(i&1073741824))return t=a!==null?a.baseLanes|i:i,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ki(Dh,As),As|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=a!==null?a.baseLanes:i,ki(Dh,As),As|=n}else a!==null?(n=a.baseLanes|i,e.memoizedState=null):n=i,ki(Dh,As),As|=n;return Lr(t,e,r,i),e.child}function uD(t,e){var i=e.ref;(t===null&&i!==null||t!==null&&t.ref!==i)&&(e.flags|=512,e.flags|=2097152)}function Ib(t,e,i,n,r){var a=os(i)?eu:Cr.current;return a=sd(e,a),Gh(e,r),i=TA(t,e,i,n,a,r),n=EA(),t!==null&&!rs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,La(t,e,r)):(Ki&&n&&dA(e),e.flags|=1,Lr(t,e,i,r),e.child)}function jI(t,e,i,n,r){if(os(i)){var a=!0;ty(e)}else a=!1;if(Gh(e,r),e.stateNode===null)m_(t,e),sD(e,i,n),Sb(e,i,n,r),n=!0;else if(t===null){var u=e.stateNode,l=e.memoizedProps;u.props=l;var _=u.context,w=i.contextType;typeof w=="object"&&w!==null?w=eo(w):(w=os(i)?eu:Cr.current,w=sd(e,w));var E=i.getDerivedStateFromProps,I=typeof E=="function"||typeof u.getSnapshotBeforeUpdate=="function";I||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(l!==n||_!==w)&&FI(e,u,n,w),Cl=!1;var R=e.memoizedState;u.state=R,oy(e,n,u,r),_=e.memoizedState,l!==n||R!==_||ss.current||Cl?(typeof E=="function"&&(Eb(e,i,E,n),_=e.memoizedState),(l=Cl||kI(e,i,l,n,R,_,w))?(I||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount()),typeof u.componentDidMount=="function"&&(e.flags|=4194308)):(typeof u.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=_),u.props=n,u.state=_,u.context=w,n=l):(typeof u.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{u=e.stateNode,LB(t,e),l=e.memoizedProps,w=e.type===e.elementType?l:uo(e.type,l),u.props=w,I=e.pendingProps,R=u.context,_=i.contextType,typeof _=="object"&&_!==null?_=eo(_):(_=os(i)?eu:Cr.current,_=sd(e,_));var L=i.getDerivedStateFromProps;(E=typeof L=="function"||typeof u.getSnapshotBeforeUpdate=="function")||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(l!==I||R!==_)&&FI(e,u,n,_),Cl=!1,R=e.memoizedState,u.state=R,oy(e,n,u,r);var W=e.memoizedState;l!==I||R!==W||ss.current||Cl?(typeof L=="function"&&(Eb(e,i,L,n),W=e.memoizedState),(w=Cl||kI(e,i,w,n,R,W,_)||!1)?(E||typeof u.UNSAFE_componentWillUpdate!="function"&&typeof u.componentWillUpdate!="function"||(typeof u.componentWillUpdate=="function"&&u.componentWillUpdate(n,W,_),typeof u.UNSAFE_componentWillUpdate=="function"&&u.UNSAFE_componentWillUpdate(n,W,_)),typeof u.componentDidUpdate=="function"&&(e.flags|=4),typeof u.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof u.componentDidUpdate!="function"||l===t.memoizedProps&&R===t.memoizedState||(e.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&R===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=W),u.props=n,u.state=W,u.context=_,n=w):(typeof u.componentDidUpdate!="function"||l===t.memoizedProps&&R===t.memoizedState||(e.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&R===t.memoizedState||(e.flags|=1024),n=!1)}return Rb(t,e,i,n,a,r)}function Rb(t,e,i,n,r,a){uD(t,e);var u=(e.flags&128)!==0;if(!n&&!u)return r&&CI(e,i,!1),La(t,e,a);n=e.stateNode,GY.current=e;var l=u&&typeof i.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&u?(e.child=ad(e,t.child,null,a),e.child=ad(e,null,l,a)):Lr(t,e,l,a),e.memoizedState=n.state,r&&CI(e,i,!0),e.child}function hD(t){var e=t.stateNode;e.pendingContext?SI(t,e.pendingContext,e.pendingContext!==e.context):e.context&&SI(t,e.context,!1),xA(t,e.containerInfo)}function HI(t,e,i,n,r){return od(),pA(r),e.flags|=256,Lr(t,e,i,n),e.child}var Pb={dehydrated:null,treeContext:null,retryLane:0};function Mb(t){return{baseLanes:t,cachePool:null,transitions:null}}function dD(t,e,i){var n=e.pendingProps,r=tn.current,a=!1,u=(e.flags&128)!==0,l;if((l=u)||(l=t!==null&&t.memoizedState===null?!1:(r&2)!==0),l?(a=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),ki(tn,r&1),t===null)return Ab(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(u=n.children,t=n.fallback,a?(n=e.mode,a=e.child,u={mode:"hidden",children:u},!(n&1)&&a!==null?(a.childLanes=0,a.pendingProps=u):a=n0(u,n,0,null),t=Kc(t,n,i,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=Mb(i),e.memoizedState=Pb,t):IA(e,u));if(r=t.memoizedState,r!==null&&(l=r.dehydrated,l!==null))return WY(t,e,u,n,l,r,i);if(a){a=n.fallback,u=e.mode,r=t.child,l=r.sibling;var _={mode:"hidden",children:n.children};return!(u&1)&&e.child!==r?(n=e.child,n.childLanes=0,n.pendingProps=_,e.deletions=null):(n=Gl(r,_),n.subtreeFlags=r.subtreeFlags&14680064),l!==null?a=Gl(l,a):(a=Kc(a,u,i,null),a.flags|=2),a.return=e,n.return=e,n.sibling=a,e.child=n,n=a,a=e.child,u=t.child.memoizedState,u=u===null?Mb(i):{baseLanes:u.baseLanes|i,cachePool:null,transitions:u.transitions},a.memoizedState=u,a.childLanes=t.childLanes&~i,e.memoizedState=Pb,n}return a=t.child,t=a.sibling,n=Gl(a,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=i),n.return=e,n.sibling=null,t!==null&&(i=e.deletions,i===null?(e.deletions=[t],e.flags|=16):i.push(t)),e.child=n,e.memoizedState=null,n}function IA(t,e){return e=n0({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function qg(t,e,i,n){return n!==null&&pA(n),ad(e,t.child,null,i),t=IA(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function WY(t,e,i,n,r,a,u){if(i)return e.flags&256?(e.flags&=-257,n=G1(Error(Ze(422))),qg(t,e,u,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(a=n.fallback,r=e.mode,n=n0({mode:"visible",children:n.children},r,0,null),a=Kc(a,r,u,null),a.flags|=2,n.return=e,a.return=e,n.sibling=a,e.child=n,e.mode&1&&ad(e,t.child,null,u),e.child.memoizedState=Mb(u),e.memoizedState=Pb,a);if(!(e.mode&1))return qg(t,e,u,null);if(r.data==="$!"){if(n=r.nextSibling&&r.nextSibling.dataset,n)var l=n.dgst;return n=l,a=Error(Ze(419)),n=G1(a,n,void 0),qg(t,e,u,n)}if(l=(u&t.childLanes)!==0,rs||l){if(n=Kn,n!==null){switch(u&-u){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(n.suspendedLanes|u)?0:r,r!==0&&r!==a.retryLane&&(a.retryLane=r,Na(t,r),Ao(n,t,r,-1))}return OA(),n=G1(Error(Ze(421))),qg(t,e,u,n)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=sJ.bind(null,t),r._reactRetry=e,null):(t=a.treeContext,Cs=Vl(r.nextSibling),Is=e,Ki=!0,po=null,t!==null&&(Gs[Ws++]=Pa,Gs[Ws++]=Ma,Gs[Ws++]=tu,Pa=t.id,Ma=t.overflow,tu=e),e=IA(e,n.children),e.flags|=4096,e)}function $I(t,e,i){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),Tb(t.return,e,i)}function W1(t,e,i,n,r){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:r}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=n,a.tail=i,a.tailMode=r)}function fD(t,e,i){var n=e.pendingProps,r=n.revealOrder,a=n.tail;if(Lr(t,e,n.children,i),n=tn.current,n&2)n=n&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&$I(t,i,e);else if(t.tag===19)$I(t,i,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(ki(tn,n),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(i=e.child,r=null;i!==null;)t=i.alternate,t!==null&&ay(t)===null&&(r=i),i=i.sibling;i=r,i===null?(r=e.child,e.child=null):(r=i.sibling,i.sibling=null),W1(e,!1,r,i,a);break;case"backwards":for(i=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&ay(t)===null){e.child=r;break}t=r.sibling,r.sibling=i,i=r,r=t}W1(e,!0,i,null,a);break;case"together":W1(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function m_(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function La(t,e,i){if(t!==null&&(e.dependencies=t.dependencies),nu|=e.lanes,!(i&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ze(153));if(e.child!==null){for(t=e.child,i=Gl(t,t.pendingProps),e.child=i,i.return=e;t.sibling!==null;)t=t.sibling,i=i.sibling=Gl(t,t.pendingProps),i.return=e;i.sibling=null}return e.child}function XY(t,e,i){switch(e.tag){case 3:hD(e),od();break;case 5:UB(e);break;case 1:os(e.type)&&ty(e);break;case 4:xA(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,r=e.memoizedProps.value;ki(ry,n._currentValue),n._currentValue=r;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(ki(tn,tn.current&1),e.flags|=128,null):i&e.child.childLanes?dD(t,e,i):(ki(tn,tn.current&1),t=La(t,e,i),t!==null?t.sibling:null);ki(tn,tn.current&1);break;case 19:if(n=(i&e.childLanes)!==0,t.flags&128){if(n)return fD(t,e,i);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ki(tn,tn.current),n)break;return null;case 22:case 23:return e.lanes=0,cD(t,e,i)}return La(t,e,i)}var pD,Bb,mD,gD;pD=function(t,e){for(var i=e.child;i!==null;){if(i.tag===5||i.tag===6)t.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};Bb=function(){};mD=function(t,e,i,n){var r=t.memoizedProps;if(r!==n){t=e.stateNode,$c(ia.current);var a=null;switch(i){case"input":r=eb(t,r),n=eb(t,n),a=[];break;case"select":r=rn({},r,{value:void 0}),n=rn({},n,{value:void 0}),a=[];break;case"textarea":r=nb(t,r),n=nb(t,n),a=[];break;default:typeof r.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=Q_)}sb(i,n);var u;i=null;for(w in r)if(!n.hasOwnProperty(w)&&r.hasOwnProperty(w)&&r[w]!=null)if(w==="style"){var l=r[w];for(u in l)l.hasOwnProperty(u)&&(i||(i={}),i[u]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(Tp.hasOwnProperty(w)?a||(a=[]):(a=a||[]).push(w,null));for(w in n){var _=n[w];if(l=r!=null?r[w]:void 0,n.hasOwnProperty(w)&&_!==l&&(_!=null||l!=null))if(w==="style")if(l){for(u in l)!l.hasOwnProperty(u)||_&&_.hasOwnProperty(u)||(i||(i={}),i[u]="");for(u in _)_.hasOwnProperty(u)&&l[u]!==_[u]&&(i||(i={}),i[u]=_[u])}else i||(a||(a=[]),a.push(w,i)),i=_;else w==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,l=l?l.__html:void 0,_!=null&&l!==_&&(a=a||[]).push(w,_)):w==="children"?typeof _!="string"&&typeof _!="number"||(a=a||[]).push(w,""+_):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(Tp.hasOwnProperty(w)?(_!=null&&w==="onScroll"&&ji("scroll",t),a||l===_||(a=[])):(a=a||[]).push(w,_))}i&&(a=a||[]).push("style",i);var w=a;(e.updateQueue=w)&&(e.flags|=4)}};gD=function(t,e,i,n){i!==n&&(e.flags|=4)};function Nf(t,e){if(!Ki)switch(t.tailMode){case"hidden":e=t.tail;for(var i=null;e!==null;)e.alternate!==null&&(i=e),e=e.sibling;i===null?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var n=null;i!==null;)i.alternate!==null&&(n=i),i=i.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Ar(t){var e=t.alternate!==null&&t.alternate.child===t.child,i=0,n=0;if(e)for(var r=t.child;r!==null;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags&14680064,n|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=n,t.childLanes=i,e}function qY(t,e,i){var n=e.pendingProps;switch(fA(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ar(e),null;case 1:return os(e.type)&&ey(),Ar(e),null;case 3:return n=e.stateNode,ld(),Hi(ss),Hi(Cr),wA(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(Wg(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,po!==null&&(zb(po),po=null))),Bb(t,e),Ar(e),null;case 5:bA(e);var r=$c(Fp.current);if(i=e.type,t!==null&&e.stateNode!=null)mD(t,e,i,n,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(Ze(166));return Ar(e),null}if(t=$c(ia.current),Wg(e)){n=e.stateNode,i=e.type;var a=e.memoizedProps;switch(n[Yo]=e,n[Op]=a,t=(e.mode&1)!==0,i){case"dialog":ji("cancel",n),ji("close",n);break;case"iframe":case"object":case"embed":ji("load",n);break;case"video":case"audio":for(r=0;r<qf.length;r++)ji(qf[r],n);break;case"source":ji("error",n);break;case"img":case"image":case"link":ji("error",n),ji("load",n);break;case"details":ji("toggle",n);break;case"input":Q2(n,a),ji("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},ji("invalid",n);break;case"textarea":tI(n,a),ji("invalid",n)}sb(i,a),r=null;for(var u in a)if(a.hasOwnProperty(u)){var l=a[u];u==="children"?typeof l=="string"?n.textContent!==l&&(a.suppressHydrationWarning!==!0&&Gg(n.textContent,l,t),r=["children",l]):typeof l=="number"&&n.textContent!==""+l&&(a.suppressHydrationWarning!==!0&&Gg(n.textContent,l,t),r=["children",""+l]):Tp.hasOwnProperty(u)&&l!=null&&u==="onScroll"&&ji("scroll",n)}switch(i){case"input":Ng(n),eI(n,a,!0);break;case"textarea":Ng(n),iI(n);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(n.onclick=Q_)}n=r,e.updateQueue=n,n!==null&&(e.flags|=4)}else{u=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=$3(i)),t==="http://www.w3.org/1999/xhtml"?i==="script"?(t=u.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=u.createElement(i,{is:n.is}):(t=u.createElement(i),i==="select"&&(u=t,n.multiple?u.multiple=!0:n.size&&(u.size=n.size))):t=u.createElementNS(t,i),t[Yo]=e,t[Op]=n,pD(t,e,!1,!1),e.stateNode=t;e:{switch(u=ob(i,n),i){case"dialog":ji("cancel",t),ji("close",t),r=n;break;case"iframe":case"object":case"embed":ji("load",t),r=n;break;case"video":case"audio":for(r=0;r<qf.length;r++)ji(qf[r],t);r=n;break;case"source":ji("error",t),r=n;break;case"img":case"image":case"link":ji("error",t),ji("load",t),r=n;break;case"details":ji("toggle",t),r=n;break;case"input":Q2(t,n),r=eb(t,n),ji("invalid",t);break;case"option":r=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},r=rn({},n,{value:void 0}),ji("invalid",t);break;case"textarea":tI(t,n),r=nb(t,n),ji("invalid",t);break;default:r=n}sb(i,r),l=r;for(a in l)if(l.hasOwnProperty(a)){var _=l[a];a==="style"?X3(t,_):a==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,_!=null&&G3(t,_)):a==="children"?typeof _=="string"?(i!=="textarea"||_!=="")&&Ep(t,_):typeof _=="number"&&Ep(t,""+_):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(Tp.hasOwnProperty(a)?_!=null&&a==="onScroll"&&ji("scroll",t):_!=null&&Jw(t,a,_,u))}switch(i){case"input":Ng(t),eI(t,n,!1);break;case"textarea":Ng(t),iI(t);break;case"option":n.value!=null&&t.setAttribute("value",""+Kl(n.value));break;case"select":t.multiple=!!n.multiple,a=n.value,a!=null?Vh(t,!!n.multiple,a,!1):n.defaultValue!=null&&Vh(t,!!n.multiple,n.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Q_)}switch(i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ar(e),null;case 6:if(t&&e.stateNode!=null)gD(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(Ze(166));if(i=$c(Fp.current),$c(ia.current),Wg(e)){if(n=e.stateNode,i=e.memoizedProps,n[Yo]=e,(a=n.nodeValue!==i)&&(t=Is,t!==null))switch(t.tag){case 3:Gg(n.nodeValue,i,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Gg(n.nodeValue,i,(t.mode&1)!==0)}a&&(e.flags|=4)}else n=(i.nodeType===9?i:i.ownerDocument).createTextNode(n),n[Yo]=e,e.stateNode=n}return Ar(e),null;case 13:if(Hi(tn),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ki&&Cs!==null&&e.mode&1&&!(e.flags&128))OB(),od(),e.flags|=98560,a=!1;else if(a=Wg(e),n!==null&&n.dehydrated!==null){if(t===null){if(!a)throw Error(Ze(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Ze(317));a[Yo]=e}else od(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ar(e),a=!1}else po!==null&&(zb(po),po=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=i,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(t===null||tn.current&1?Dn===0&&(Dn=3):OA())),e.updateQueue!==null&&(e.flags|=4),Ar(e),null);case 4:return ld(),Bb(t,e),t===null&&Bp(e.stateNode.containerInfo),Ar(e),null;case 10:return _A(e.type._context),Ar(e),null;case 17:return os(e.type)&&ey(),Ar(e),null;case 19:if(Hi(tn),a=e.memoizedState,a===null)return Ar(e),null;if(n=(e.flags&128)!==0,u=a.rendering,u===null)if(n)Nf(a,!1);else{if(Dn!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(u=ay(t),u!==null){for(e.flags|=128,Nf(a,!1),n=u.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=i,i=e.child;i!==null;)a=i,t=n,a.flags&=14680066,u=a.alternate,u===null?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,t=u.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),i=i.sibling;return ki(tn,tn.current&1|2),e.child}t=t.sibling}a.tail!==null&&pn()>ud&&(e.flags|=128,n=!0,Nf(a,!1),e.lanes=4194304)}else{if(!n)if(t=ay(u),t!==null){if(e.flags|=128,n=!0,i=t.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),Nf(a,!0),a.tail===null&&a.tailMode==="hidden"&&!u.alternate&&!Ki)return Ar(e),null}else 2*pn()-a.renderingStartTime>ud&&i!==1073741824&&(e.flags|=128,n=!0,Nf(a,!1),e.lanes=4194304);a.isBackwards?(u.sibling=e.child,e.child=u):(i=a.last,i!==null?i.sibling=u:e.child=u,a.last=u)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=pn(),e.sibling=null,i=tn.current,ki(tn,n?i&1|2:i&1),e):(Ar(e),null);case 22:case 23:return DA(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?As&1073741824&&(Ar(e),e.subtreeFlags&6&&(e.flags|=8192)):Ar(e),null;case 24:return null;case 25:return null}throw Error(Ze(156,e.tag))}function KY(t,e){switch(fA(e),e.tag){case 1:return os(e.type)&&ey(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ld(),Hi(ss),Hi(Cr),wA(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return bA(e),null;case 13:if(Hi(tn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ze(340));od()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Hi(tn),null;case 4:return ld(),null;case 10:return _A(e.type._context),null;case 22:case 23:return DA(),null;case 24:return null;default:return null}}var Kg=!1,Sr=!1,ZY=typeof WeakSet=="function"?WeakSet:Set,vt=null;function Bh(t,e){var i=t.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(n){un(t,e,n)}else i.current=null}function Db(t,e,i){try{i()}catch(n){un(t,e,n)}}var GI=!1;function YY(t,e){if(gb=Z_,t=bB(),hA(t)){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else e:{i=(i=t.ownerDocument)&&i.defaultView||window;var n=i.getSelection&&i.getSelection();if(n&&n.rangeCount!==0){i=n.anchorNode;var r=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{i.nodeType,a.nodeType}catch{i=null;break e}var u=0,l=-1,_=-1,w=0,E=0,I=t,R=null;t:for(;;){for(var L;I!==i||r!==0&&I.nodeType!==3||(l=u+r),I!==a||n!==0&&I.nodeType!==3||(_=u+n),I.nodeType===3&&(u+=I.nodeValue.length),(L=I.firstChild)!==null;)R=I,I=L;for(;;){if(I===t)break t;if(R===i&&++w===r&&(l=u),R===a&&++E===n&&(_=u),(L=I.nextSibling)!==null)break;I=R,R=I.parentNode}I=L}i=l===-1||_===-1?null:{start:l,end:_}}else i=null}i=i||{start:0,end:0}}else i=null;for(_b={focusedElem:t,selectionRange:i},Z_=!1,vt=e;vt!==null;)if(e=vt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,vt=t;else for(;vt!==null;){e=vt;try{var W=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(W!==null){var K=W.memoizedProps,fe=W.memoizedState,X=e.stateNode,$=X.getSnapshotBeforeUpdate(e.elementType===e.type?K:uo(e.type,K),fe);X.__reactInternalSnapshotBeforeUpdate=$}break;case 3:var Q=e.stateNode.containerInfo;Q.nodeType===1?Q.textContent="":Q.nodeType===9&&Q.documentElement&&Q.removeChild(Q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ze(163))}}catch(me){un(e,e.return,me)}if(t=e.sibling,t!==null){t.return=e.return,vt=t;break}vt=e.return}return W=GI,GI=!1,W}function cp(t,e,i){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do{if((r.tag&t)===t){var a=r.destroy;r.destroy=void 0,a!==void 0&&Db(e,i,a)}r=r.next}while(r!==n)}}function t0(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var i=e=e.next;do{if((i.tag&t)===t){var n=i.create;i.destroy=n()}i=i.next}while(i!==e)}}function Ob(t){var e=t.ref;if(e!==null){var i=t.stateNode;switch(t.tag){case 5:t=i;break;default:t=i}typeof e=="function"?e(t):e.current=t}}function _D(t){var e=t.alternate;e!==null&&(t.alternate=null,_D(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Yo],delete e[Op],delete e[xb],delete e[DY],delete e[OY])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function yD(t){return t.tag===5||t.tag===3||t.tag===4}function WI(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||yD(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function kb(t,e,i){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?i.nodeType===8?i.parentNode.insertBefore(t,e):i.insertBefore(t,e):(i.nodeType===8?(e=i.parentNode,e.insertBefore(t,i)):(e=i,e.appendChild(t)),i=i._reactRootContainer,i!=null||e.onclick!==null||(e.onclick=Q_));else if(n!==4&&(t=t.child,t!==null))for(kb(t,e,i),t=t.sibling;t!==null;)kb(t,e,i),t=t.sibling}function Fb(t,e,i){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?i.insertBefore(t,e):i.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(Fb(t,e,i),t=t.sibling;t!==null;)Fb(t,e,i),t=t.sibling}var ar=null,ho=!1;function Tl(t,e,i){for(i=i.child;i!==null;)vD(t,e,i),i=i.sibling}function vD(t,e,i){if(ta&&typeof ta.onCommitFiberUnmount=="function")try{ta.onCommitFiberUnmount(Xy,i)}catch{}switch(i.tag){case 5:Sr||Bh(i,e);case 6:var n=ar,r=ho;ar=null,Tl(t,e,i),ar=n,ho=r,ar!==null&&(ho?(t=ar,i=i.stateNode,t.nodeType===8?t.parentNode.removeChild(i):t.removeChild(i)):ar.removeChild(i.stateNode));break;case 18:ar!==null&&(ho?(t=ar,i=i.stateNode,t.nodeType===8?U1(t.parentNode,i):t.nodeType===1&&U1(t,i),Rp(t)):U1(ar,i.stateNode));break;case 4:n=ar,r=ho,ar=i.stateNode.containerInfo,ho=!0,Tl(t,e,i),ar=n,ho=r;break;case 0:case 11:case 14:case 15:if(!Sr&&(n=i.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){r=n=n.next;do{var a=r,u=a.destroy;a=a.tag,u!==void 0&&(a&2||a&4)&&Db(i,e,u),r=r.next}while(r!==n)}Tl(t,e,i);break;case 1:if(!Sr&&(Bh(i,e),n=i.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=i.memoizedProps,n.state=i.memoizedState,n.componentWillUnmount()}catch(l){un(i,e,l)}Tl(t,e,i);break;case 21:Tl(t,e,i);break;case 22:i.mode&1?(Sr=(n=Sr)||i.memoizedState!==null,Tl(t,e,i),Sr=n):Tl(t,e,i);break;default:Tl(t,e,i)}}function XI(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var i=t.stateNode;i===null&&(i=t.stateNode=new ZY),e.forEach(function(n){var r=oJ.bind(null,t,n);i.has(n)||(i.add(n),n.then(r,r))})}}function co(t,e){var i=e.deletions;if(i!==null)for(var n=0;n<i.length;n++){var r=i[n];try{var a=t,u=e,l=u;e:for(;l!==null;){switch(l.tag){case 5:ar=l.stateNode,ho=!1;break e;case 3:ar=l.stateNode.containerInfo,ho=!0;break e;case 4:ar=l.stateNode.containerInfo,ho=!0;break e}l=l.return}if(ar===null)throw Error(Ze(160));vD(a,u,r),ar=null,ho=!1;var _=r.alternate;_!==null&&(_.return=null),r.return=null}catch(w){un(r,e,w)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)xD(e,t),e=e.sibling}function xD(t,e){var i=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(co(e,t),Go(t),n&4){try{cp(3,t,t.return),t0(3,t)}catch(K){un(t,t.return,K)}try{cp(5,t,t.return)}catch(K){un(t,t.return,K)}}break;case 1:co(e,t),Go(t),n&512&&i!==null&&Bh(i,i.return);break;case 5:if(co(e,t),Go(t),n&512&&i!==null&&Bh(i,i.return),t.flags&32){var r=t.stateNode;try{Ep(r,"")}catch(K){un(t,t.return,K)}}if(n&4&&(r=t.stateNode,r!=null)){var a=t.memoizedProps,u=i!==null?i.memoizedProps:a,l=t.type,_=t.updateQueue;if(t.updateQueue=null,_!==null)try{l==="input"&&a.type==="radio"&&a.name!=null&&j3(r,a),ob(l,u);var w=ob(l,a);for(u=0;u<_.length;u+=2){var E=_[u],I=_[u+1];E==="style"?X3(r,I):E==="dangerouslySetInnerHTML"?G3(r,I):E==="children"?Ep(r,I):Jw(r,E,I,w)}switch(l){case"input":tb(r,a);break;case"textarea":H3(r,a);break;case"select":var R=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var L=a.value;L!=null?Vh(r,!!a.multiple,L,!1):R!==!!a.multiple&&(a.defaultValue!=null?Vh(r,!!a.multiple,a.defaultValue,!0):Vh(r,!!a.multiple,a.multiple?[]:"",!1))}r[Op]=a}catch(K){un(t,t.return,K)}}break;case 6:if(co(e,t),Go(t),n&4){if(t.stateNode===null)throw Error(Ze(162));r=t.stateNode,a=t.memoizedProps;try{r.nodeValue=a}catch(K){un(t,t.return,K)}}break;case 3:if(co(e,t),Go(t),n&4&&i!==null&&i.memoizedState.isDehydrated)try{Rp(e.containerInfo)}catch(K){un(t,t.return,K)}break;case 4:co(e,t),Go(t);break;case 13:co(e,t),Go(t),r=t.child,r.flags&8192&&(a=r.memoizedState!==null,r.stateNode.isHidden=a,!a||r.alternate!==null&&r.alternate.memoizedState!==null||(MA=pn())),n&4&&XI(t);break;case 22:if(E=i!==null&&i.memoizedState!==null,t.mode&1?(Sr=(w=Sr)||E,co(e,t),Sr=w):co(e,t),Go(t),n&8192){if(w=t.memoizedState!==null,(t.stateNode.isHidden=w)&&!E&&t.mode&1)for(vt=t,E=t.child;E!==null;){for(I=vt=E;vt!==null;){switch(R=vt,L=R.child,R.tag){case 0:case 11:case 14:case 15:cp(4,R,R.return);break;case 1:Bh(R,R.return);var W=R.stateNode;if(typeof W.componentWillUnmount=="function"){n=R,i=R.return;try{e=n,W.props=e.memoizedProps,W.state=e.memoizedState,W.componentWillUnmount()}catch(K){un(n,i,K)}}break;case 5:Bh(R,R.return);break;case 22:if(R.memoizedState!==null){KI(I);continue}}L!==null?(L.return=R,vt=L):KI(I)}E=E.sibling}e:for(E=null,I=t;;){if(I.tag===5){if(E===null){E=I;try{r=I.stateNode,w?(a=r.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(l=I.stateNode,_=I.memoizedProps.style,u=_!=null&&_.hasOwnProperty("display")?_.display:null,l.style.display=W3("display",u))}catch(K){un(t,t.return,K)}}}else if(I.tag===6){if(E===null)try{I.stateNode.nodeValue=w?"":I.memoizedProps}catch(K){un(t,t.return,K)}}else if((I.tag!==22&&I.tag!==23||I.memoizedState===null||I===t)&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===t)break e;for(;I.sibling===null;){if(I.return===null||I.return===t)break e;E===I&&(E=null),I=I.return}E===I&&(E=null),I.sibling.return=I.return,I=I.sibling}}break;case 19:co(e,t),Go(t),n&4&&XI(t);break;case 21:break;default:co(e,t),Go(t)}}function Go(t){var e=t.flags;if(e&2){try{e:{for(var i=t.return;i!==null;){if(yD(i)){var n=i;break e}i=i.return}throw Error(Ze(160))}switch(n.tag){case 5:var r=n.stateNode;n.flags&32&&(Ep(r,""),n.flags&=-33);var a=WI(t);Fb(t,a,r);break;case 3:case 4:var u=n.stateNode.containerInfo,l=WI(t);kb(t,l,u);break;default:throw Error(Ze(161))}}catch(_){un(t,t.return,_)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function JY(t,e,i){vt=t,bD(t)}function bD(t,e,i){for(var n=(t.mode&1)!==0;vt!==null;){var r=vt,a=r.child;if(r.tag===22&&n){var u=r.memoizedState!==null||Kg;if(!u){var l=r.alternate,_=l!==null&&l.memoizedState!==null||Sr;l=Kg;var w=Sr;if(Kg=u,(Sr=_)&&!w)for(vt=r;vt!==null;)u=vt,_=u.child,u.tag===22&&u.memoizedState!==null?ZI(r):_!==null?(_.return=u,vt=_):ZI(r);for(;a!==null;)vt=a,bD(a),a=a.sibling;vt=r,Kg=l,Sr=w}qI(t)}else r.subtreeFlags&8772&&a!==null?(a.return=r,vt=a):qI(t)}}function qI(t){for(;vt!==null;){var e=vt;if(e.flags&8772){var i=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Sr||t0(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Sr)if(i===null)n.componentDidMount();else{var r=e.elementType===e.type?i.memoizedProps:uo(e.type,i.memoizedProps);n.componentDidUpdate(r,i.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&BI(e,a,n);break;case 3:var u=e.updateQueue;if(u!==null){if(i=null,e.child!==null)switch(e.child.tag){case 5:i=e.child.stateNode;break;case 1:i=e.child.stateNode}BI(e,u,i)}break;case 5:var l=e.stateNode;if(i===null&&e.flags&4){i=l;var _=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":_.autoFocus&&i.focus();break;case"img":_.src&&(i.src=_.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var w=e.alternate;if(w!==null){var E=w.memoizedState;if(E!==null){var I=E.dehydrated;I!==null&&Rp(I)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ze(163))}Sr||e.flags&512&&Ob(e)}catch(R){un(e,e.return,R)}}if(e===t){vt=null;break}if(i=e.sibling,i!==null){i.return=e.return,vt=i;break}vt=e.return}}function KI(t){for(;vt!==null;){var e=vt;if(e===t){vt=null;break}var i=e.sibling;if(i!==null){i.return=e.return,vt=i;break}vt=e.return}}function ZI(t){for(;vt!==null;){var e=vt;try{switch(e.tag){case 0:case 11:case 15:var i=e.return;try{t0(4,e)}catch(_){un(e,i,_)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var r=e.return;try{n.componentDidMount()}catch(_){un(e,r,_)}}var a=e.return;try{Ob(e)}catch(_){un(e,a,_)}break;case 5:var u=e.return;try{Ob(e)}catch(_){un(e,u,_)}}}catch(_){un(e,e.return,_)}if(e===t){vt=null;break}var l=e.sibling;if(l!==null){l.return=e.return,vt=l;break}vt=e.return}}var QY=Math.ceil,uy=za.ReactCurrentDispatcher,RA=za.ReactCurrentOwner,Qs=za.ReactCurrentBatchConfig,oi=0,Kn=null,En=null,lr=0,As=0,Dh=tc(0),Dn=0,zp=null,nu=0,i0=0,PA=0,up=null,is=null,MA=0,ud=1/0,Aa=null,hy=!1,Nb=null,Hl=null,Zg=!1,Ol=null,dy=0,hp=0,Lb=null,g_=-1,__=0;function Ur(){return oi&6?pn():g_!==-1?g_:g_=pn()}function $l(t){return t.mode&1?oi&2&&lr!==0?lr&-lr:FY.transition!==null?(__===0&&(__=sB()),__):(t=wi,t!==0||(t=window.event,t=t===void 0?16:dB(t.type)),t):1}function Ao(t,e,i,n){if(50<hp)throw hp=0,Lb=null,Error(Ze(185));em(t,i,n),(!(oi&2)||t!==Kn)&&(t===Kn&&(!(oi&2)&&(i0|=i),Dn===4&&Pl(t,lr)),as(t,n),i===1&&oi===0&&!(e.mode&1)&&(ud=pn()+500,Jy&&ic()))}function as(t,e){var i=t.callbackNode;FZ(t,e);var n=K_(t,t===Kn?lr:0);if(n===0)i!==null&&sI(i),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(i!=null&&sI(i),e===1)t.tag===0?kY(YI.bind(null,t)):MB(YI.bind(null,t)),MY(function(){!(oi&6)&&ic()}),i=null;else{switch(oB(n)){case 1:i=nA;break;case 4:i=nB;break;case 16:i=q_;break;case 536870912:i=rB;break;default:i=q_}i=RD(i,wD.bind(null,t))}t.callbackPriority=e,t.callbackNode=i}}function wD(t,e){if(g_=-1,__=0,oi&6)throw Error(Ze(327));var i=t.callbackNode;if(Wh()&&t.callbackNode!==i)return null;var n=K_(t,t===Kn?lr:0);if(n===0)return null;if(n&30||n&t.expiredLanes||e)e=fy(t,n);else{e=n;var r=oi;oi|=2;var a=TD();(Kn!==t||lr!==e)&&(Aa=null,ud=pn()+500,qc(t,e));do try{iJ();break}catch(l){AD(t,l)}while(!0);gA(),uy.current=a,oi=r,En!==null?e=0:(Kn=null,lr=0,e=Dn)}if(e!==0){if(e===2&&(r=hb(t),r!==0&&(n=r,e=Ub(t,r))),e===1)throw i=zp,qc(t,0),Pl(t,n),as(t,pn()),i;if(e===6)Pl(t,n);else{if(r=t.current.alternate,!(n&30)&&!eJ(r)&&(e=fy(t,n),e===2&&(a=hb(t),a!==0&&(n=a,e=Ub(t,a))),e===1))throw i=zp,qc(t,0),Pl(t,n),as(t,pn()),i;switch(t.finishedWork=r,t.finishedLanes=n,e){case 0:case 1:throw Error(Ze(345));case 2:Oc(t,is,Aa);break;case 3:if(Pl(t,n),(n&130023424)===n&&(e=MA+500-pn(),10<e)){if(K_(t,0)!==0)break;if(r=t.suspendedLanes,(r&n)!==n){Ur(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=vb(Oc.bind(null,t,is,Aa),e);break}Oc(t,is,Aa);break;case 4:if(Pl(t,n),(n&4194240)===n)break;for(e=t.eventTimes,r=-1;0<n;){var u=31-wo(n);a=1<<u,u=e[u],u>r&&(r=u),n&=~a}if(n=r,n=pn()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*QY(n/1960))-n,10<n){t.timeoutHandle=vb(Oc.bind(null,t,is,Aa),n);break}Oc(t,is,Aa);break;case 5:Oc(t,is,Aa);break;default:throw Error(Ze(329))}}}return as(t,pn()),t.callbackNode===i?wD.bind(null,t):null}function Ub(t,e){var i=up;return t.current.memoizedState.isDehydrated&&(qc(t,e).flags|=256),t=fy(t,e),t!==2&&(e=is,is=i,e!==null&&zb(e)),t}function zb(t){is===null?is=t:is.push.apply(is,t)}function eJ(t){for(var e=t;;){if(e.flags&16384){var i=e.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var n=0;n<i.length;n++){var r=i[n],a=r.getSnapshot;r=r.value;try{if(!Eo(a(),r))return!1}catch{return!1}}}if(i=e.child,e.subtreeFlags&16384&&i!==null)i.return=e,e=i;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Pl(t,e){for(e&=~PA,e&=~i0,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var i=31-wo(e),n=1<<i;t[i]=-1,e&=~n}}function YI(t){if(oi&6)throw Error(Ze(327));Wh();var e=K_(t,0);if(!(e&1))return as(t,pn()),null;var i=fy(t,e);if(t.tag!==0&&i===2){var n=hb(t);n!==0&&(e=n,i=Ub(t,n))}if(i===1)throw i=zp,qc(t,0),Pl(t,e),as(t,pn()),i;if(i===6)throw Error(Ze(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Oc(t,is,Aa),as(t,pn()),null}function BA(t,e){var i=oi;oi|=1;try{return t(e)}finally{oi=i,oi===0&&(ud=pn()+500,Jy&&ic())}}function ru(t){Ol!==null&&Ol.tag===0&&!(oi&6)&&Wh();var e=oi;oi|=1;var i=Qs.transition,n=wi;try{if(Qs.transition=null,wi=1,t)return t()}finally{wi=n,Qs.transition=i,oi=e,!(oi&6)&&ic()}}function DA(){As=Dh.current,Hi(Dh)}function qc(t,e){t.finishedWork=null,t.finishedLanes=0;var i=t.timeoutHandle;if(i!==-1&&(t.timeoutHandle=-1,PY(i)),En!==null)for(i=En.return;i!==null;){var n=i;switch(fA(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&ey();break;case 3:ld(),Hi(ss),Hi(Cr),wA();break;case 5:bA(n);break;case 4:ld();break;case 13:Hi(tn);break;case 19:Hi(tn);break;case 10:_A(n.type._context);break;case 22:case 23:DA()}i=i.return}if(Kn=t,En=t=Gl(t.current,null),lr=As=e,Dn=0,zp=null,PA=i0=nu=0,is=up=null,Hc!==null){for(e=0;e<Hc.length;e++)if(i=Hc[e],n=i.interleaved,n!==null){i.interleaved=null;var r=n.next,a=i.pending;if(a!==null){var u=a.next;a.next=r,n.next=u}i.pending=n}Hc=null}return t}function AD(t,e){do{var i=En;try{if(gA(),f_.current=cy,ly){for(var n=nn.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}ly=!1}if(iu=0,qn=Mn=nn=null,lp=!1,Np=0,RA.current=null,i===null||i.return===null){Dn=1,zp=e,En=null;break}e:{var a=t,u=i.return,l=i,_=e;if(e=lr,l.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){var w=_,E=l,I=E.tag;if(!(E.mode&1)&&(I===0||I===11||I===15)){var R=E.alternate;R?(E.updateQueue=R.updateQueue,E.memoizedState=R.memoizedState,E.lanes=R.lanes):(E.updateQueue=null,E.memoizedState=null)}var L=LI(u);if(L!==null){L.flags&=-257,UI(L,u,l,a,e),L.mode&1&&NI(a,w,e),e=L,_=w;var W=e.updateQueue;if(W===null){var K=new Set;K.add(_),e.updateQueue=K}else W.add(_);break e}else{if(!(e&1)){NI(a,w,e),OA();break e}_=Error(Ze(426))}}else if(Ki&&l.mode&1){var fe=LI(u);if(fe!==null){!(fe.flags&65536)&&(fe.flags|=256),UI(fe,u,l,a,e),pA(cd(_,l));break e}}a=_=cd(_,l),Dn!==4&&(Dn=2),up===null?up=[a]:up.push(a),a=u;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var X=oD(a,_,e);MI(a,X);break e;case 1:l=_;var $=a.type,Q=a.stateNode;if(!(a.flags&128)&&(typeof $.getDerivedStateFromError=="function"||Q!==null&&typeof Q.componentDidCatch=="function"&&(Hl===null||!Hl.has(Q)))){a.flags|=65536,e&=-e,a.lanes|=e;var me=aD(a,l,e);MI(a,me);break e}}a=a.return}while(a!==null)}SD(i)}catch(Ce){e=Ce,En===i&&i!==null&&(En=i=i.return);continue}break}while(!0)}function TD(){var t=uy.current;return uy.current=cy,t===null?cy:t}function OA(){(Dn===0||Dn===3||Dn===2)&&(Dn=4),Kn===null||!(nu&268435455)&&!(i0&268435455)||Pl(Kn,lr)}function fy(t,e){var i=oi;oi|=2;var n=TD();(Kn!==t||lr!==e)&&(Aa=null,qc(t,e));do try{tJ();break}catch(r){AD(t,r)}while(!0);if(gA(),oi=i,uy.current=n,En!==null)throw Error(Ze(261));return Kn=null,lr=0,Dn}function tJ(){for(;En!==null;)ED(En)}function iJ(){for(;En!==null&&!CZ();)ED(En)}function ED(t){var e=ID(t.alternate,t,As);t.memoizedProps=t.pendingProps,e===null?SD(t):En=e,RA.current=null}function SD(t){var e=t;do{var i=e.alternate;if(t=e.return,e.flags&32768){if(i=KY(i,e),i!==null){i.flags&=32767,En=i;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Dn=6,En=null;return}}else if(i=qY(i,e,As),i!==null){En=i;return}if(e=e.sibling,e!==null){En=e;return}En=e=t}while(e!==null);Dn===0&&(Dn=5)}function Oc(t,e,i){var n=wi,r=Qs.transition;try{Qs.transition=null,wi=1,nJ(t,e,i,n)}finally{Qs.transition=r,wi=n}return null}function nJ(t,e,i,n){do Wh();while(Ol!==null);if(oi&6)throw Error(Ze(327));i=t.finishedWork;var r=t.finishedLanes;if(i===null)return null;if(t.finishedWork=null,t.finishedLanes=0,i===t.current)throw Error(Ze(177));t.callbackNode=null,t.callbackPriority=0;var a=i.lanes|i.childLanes;if(NZ(t,a),t===Kn&&(En=Kn=null,lr=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||Zg||(Zg=!0,RD(q_,function(){return Wh(),null})),a=(i.flags&15990)!==0,i.subtreeFlags&15990||a){a=Qs.transition,Qs.transition=null;var u=wi;wi=1;var l=oi;oi|=4,RA.current=null,YY(t,i),xD(i,t),AY(_b),Z_=!!gb,_b=gb=null,t.current=i,JY(i),IZ(),oi=l,wi=u,Qs.transition=a}else t.current=i;if(Zg&&(Zg=!1,Ol=t,dy=r),a=t.pendingLanes,a===0&&(Hl=null),MZ(i.stateNode),as(t,pn()),e!==null)for(n=t.onRecoverableError,i=0;i<e.length;i++)r=e[i],n(r.value,{componentStack:r.stack,digest:r.digest});if(hy)throw hy=!1,t=Nb,Nb=null,t;return dy&1&&t.tag!==0&&Wh(),a=t.pendingLanes,a&1?t===Lb?hp++:(hp=0,Lb=t):hp=0,ic(),null}function Wh(){if(Ol!==null){var t=oB(dy),e=Qs.transition,i=wi;try{if(Qs.transition=null,wi=16>t?16:t,Ol===null)var n=!1;else{if(t=Ol,Ol=null,dy=0,oi&6)throw Error(Ze(331));var r=oi;for(oi|=4,vt=t.current;vt!==null;){var a=vt,u=a.child;if(vt.flags&16){var l=a.deletions;if(l!==null){for(var _=0;_<l.length;_++){var w=l[_];for(vt=w;vt!==null;){var E=vt;switch(E.tag){case 0:case 11:case 15:cp(8,E,a)}var I=E.child;if(I!==null)I.return=E,vt=I;else for(;vt!==null;){E=vt;var R=E.sibling,L=E.return;if(_D(E),E===w){vt=null;break}if(R!==null){R.return=L,vt=R;break}vt=L}}}var W=a.alternate;if(W!==null){var K=W.child;if(K!==null){W.child=null;do{var fe=K.sibling;K.sibling=null,K=fe}while(K!==null)}}vt=a}}if(a.subtreeFlags&2064&&u!==null)u.return=a,vt=u;else e:for(;vt!==null;){if(a=vt,a.flags&2048)switch(a.tag){case 0:case 11:case 15:cp(9,a,a.return)}var X=a.sibling;if(X!==null){X.return=a.return,vt=X;break e}vt=a.return}}var $=t.current;for(vt=$;vt!==null;){u=vt;var Q=u.child;if(u.subtreeFlags&2064&&Q!==null)Q.return=u,vt=Q;else e:for(u=$;vt!==null;){if(l=vt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:t0(9,l)}}catch(Ce){un(l,l.return,Ce)}if(l===u){vt=null;break e}var me=l.sibling;if(me!==null){me.return=l.return,vt=me;break e}vt=l.return}}if(oi=r,ic(),ta&&typeof ta.onPostCommitFiberRoot=="function")try{ta.onPostCommitFiberRoot(Xy,t)}catch{}n=!0}return n}finally{wi=i,Qs.transition=e}}return!1}function JI(t,e,i){e=cd(i,e),e=oD(t,e,1),t=jl(t,e,1),e=Ur(),t!==null&&(em(t,1,e),as(t,e))}function un(t,e,i){if(t.tag===3)JI(t,t,i);else for(;e!==null;){if(e.tag===3){JI(e,t,i);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Hl===null||!Hl.has(n))){t=cd(i,t),t=aD(e,t,1),e=jl(e,t,1),t=Ur(),e!==null&&(em(e,1,t),as(e,t));break}}e=e.return}}function rJ(t,e,i){var n=t.pingCache;n!==null&&n.delete(e),e=Ur(),t.pingedLanes|=t.suspendedLanes&i,Kn===t&&(lr&i)===i&&(Dn===4||Dn===3&&(lr&130023424)===lr&&500>pn()-MA?qc(t,0):PA|=i),as(t,e)}function CD(t,e){e===0&&(t.mode&1?(e=zg,zg<<=1,!(zg&130023424)&&(zg=4194304)):e=1);var i=Ur();t=Na(t,e),t!==null&&(em(t,e,i),as(t,i))}function sJ(t){var e=t.memoizedState,i=0;e!==null&&(i=e.retryLane),CD(t,i)}function oJ(t,e){var i=0;switch(t.tag){case 13:var n=t.stateNode,r=t.memoizedState;r!==null&&(i=r.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(Ze(314))}n!==null&&n.delete(e),CD(t,i)}var ID;ID=function(t,e,i){if(t!==null)if(t.memoizedProps!==e.pendingProps||ss.current)rs=!0;else{if(!(t.lanes&i)&&!(e.flags&128))return rs=!1,XY(t,e,i);rs=!!(t.flags&131072)}else rs=!1,Ki&&e.flags&1048576&&BB(e,ny,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;m_(t,e),t=e.pendingProps;var r=sd(e,Cr.current);Gh(e,i),r=TA(null,e,n,t,r,i);var a=EA();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,os(n)?(a=!0,ty(e)):a=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,vA(e),r.updater=e0,e.stateNode=r,r._reactInternals=e,Sb(e,n,t,i),e=Rb(null,e,n,!0,a,i)):(e.tag=0,Ki&&a&&dA(e),Lr(null,e,r,i),e=e.child),e;case 16:n=e.elementType;e:{switch(m_(t,e),t=e.pendingProps,r=n._init,n=r(n._payload),e.type=n,r=e.tag=lJ(n),t=uo(n,t),r){case 0:e=Ib(null,e,n,t,i);break e;case 1:e=jI(null,e,n,t,i);break e;case 11:e=zI(null,e,n,t,i);break e;case 14:e=VI(null,e,n,uo(n.type,t),i);break e}throw Error(Ze(306,n,""))}return e;case 0:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:uo(n,r),Ib(t,e,n,r,i);case 1:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:uo(n,r),jI(t,e,n,r,i);case 3:e:{if(hD(e),t===null)throw Error(Ze(387));n=e.pendingProps,a=e.memoizedState,r=a.element,LB(t,e),oy(e,n,null,i);var u=e.memoizedState;if(n=u.element,a.isDehydrated)if(a={element:n,isDehydrated:!1,cache:u.cache,pendingSuspenseBoundaries:u.pendingSuspenseBoundaries,transitions:u.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){r=cd(Error(Ze(423)),e),e=HI(t,e,n,i,r);break e}else if(n!==r){r=cd(Error(Ze(424)),e),e=HI(t,e,n,i,r);break e}else for(Cs=Vl(e.stateNode.containerInfo.firstChild),Is=e,Ki=!0,po=null,i=FB(e,null,n,i),e.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(od(),n===r){e=La(t,e,i);break e}Lr(t,e,n,i)}e=e.child}return e;case 5:return UB(e),t===null&&Ab(e),n=e.type,r=e.pendingProps,a=t!==null?t.memoizedProps:null,u=r.children,yb(n,r)?u=null:a!==null&&yb(n,a)&&(e.flags|=32),uD(t,e),Lr(t,e,u,i),e.child;case 6:return t===null&&Ab(e),null;case 13:return dD(t,e,i);case 4:return xA(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=ad(e,null,n,i):Lr(t,e,n,i),e.child;case 11:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:uo(n,r),zI(t,e,n,r,i);case 7:return Lr(t,e,e.pendingProps,i),e.child;case 8:return Lr(t,e,e.pendingProps.children,i),e.child;case 12:return Lr(t,e,e.pendingProps.children,i),e.child;case 10:e:{if(n=e.type._context,r=e.pendingProps,a=e.memoizedProps,u=r.value,ki(ry,n._currentValue),n._currentValue=u,a!==null)if(Eo(a.value,u)){if(a.children===r.children&&!ss.current){e=La(t,e,i);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var l=a.dependencies;if(l!==null){u=a.child;for(var _=l.firstContext;_!==null;){if(_.context===n){if(a.tag===1){_=Ba(-1,i&-i),_.tag=2;var w=a.updateQueue;if(w!==null){w=w.shared;var E=w.pending;E===null?_.next=_:(_.next=E.next,E.next=_),w.pending=_}}a.lanes|=i,_=a.alternate,_!==null&&(_.lanes|=i),Tb(a.return,i,e),l.lanes|=i;break}_=_.next}}else if(a.tag===10)u=a.type===e.type?null:a.child;else if(a.tag===18){if(u=a.return,u===null)throw Error(Ze(341));u.lanes|=i,l=u.alternate,l!==null&&(l.lanes|=i),Tb(u,i,e),u=a.sibling}else u=a.child;if(u!==null)u.return=a;else for(u=a;u!==null;){if(u===e){u=null;break}if(a=u.sibling,a!==null){a.return=u.return,u=a;break}u=u.return}a=u}Lr(t,e,r.children,i),e=e.child}return e;case 9:return r=e.type,n=e.pendingProps.children,Gh(e,i),r=eo(r),n=n(r),e.flags|=1,Lr(t,e,n,i),e.child;case 14:return n=e.type,r=uo(n,e.pendingProps),r=uo(n.type,r),VI(t,e,n,r,i);case 15:return lD(t,e,e.type,e.pendingProps,i);case 17:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:uo(n,r),m_(t,e),e.tag=1,os(n)?(t=!0,ty(e)):t=!1,Gh(e,i),sD(e,n,r),Sb(e,n,r,i),Rb(null,e,n,!0,t,i);case 19:return fD(t,e,i);case 22:return cD(t,e,i)}throw Error(Ze(156,e.tag))};function RD(t,e){return iB(t,e)}function aJ(t,e,i,n){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zs(t,e,i,n){return new aJ(t,e,i,n)}function kA(t){return t=t.prototype,!(!t||!t.isReactComponent)}function lJ(t){if(typeof t=="function")return kA(t)?1:0;if(t!=null){if(t=t.$$typeof,t===eA)return 11;if(t===tA)return 14}return 2}function Gl(t,e){var i=t.alternate;return i===null?(i=Zs(t.tag,e,t.key,t.mode),i.elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=e,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=t.flags&14680064,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,e=t.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i}function y_(t,e,i,n,r,a){var u=2;if(n=t,typeof t=="function")kA(t)&&(u=1);else if(typeof t=="string")u=5;else e:switch(t){case Ah:return Kc(i.children,r,a,e);case Qw:u=8,r|=8;break;case Zx:return t=Zs(12,i,e,r|2),t.elementType=Zx,t.lanes=a,t;case Yx:return t=Zs(13,i,e,r),t.elementType=Yx,t.lanes=a,t;case Jx:return t=Zs(19,i,e,r),t.elementType=Jx,t.lanes=a,t;case U3:return n0(i,r,a,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case N3:u=10;break e;case L3:u=9;break e;case eA:u=11;break e;case tA:u=14;break e;case Sl:u=16,n=null;break e}throw Error(Ze(130,t==null?t:typeof t,""))}return e=Zs(u,i,e,r),e.elementType=t,e.type=n,e.lanes=a,e}function Kc(t,e,i,n){return t=Zs(7,t,n,e),t.lanes=i,t}function n0(t,e,i,n){return t=Zs(22,t,n,e),t.elementType=U3,t.lanes=i,t.stateNode={isHidden:!1},t}function X1(t,e,i){return t=Zs(6,t,null,e),t.lanes=i,t}function q1(t,e,i){return e=Zs(4,t.children!==null?t.children:[],t.key,e),e.lanes=i,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function cJ(t,e,i,n,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=I1(0),this.expirationTimes=I1(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=I1(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function FA(t,e,i,n,r,a,u,l,_){return t=new cJ(t,e,i,l,_),e===1?(e=1,a===!0&&(e|=8)):e=0,a=Zs(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:n,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},vA(a),t}function uJ(t,e,i){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wh,key:n==null?null:""+n,children:t,containerInfo:e,implementation:i}}function PD(t){if(!t)return Zl;t=t._reactInternals;e:{if(uu(t)!==t||t.tag!==1)throw Error(Ze(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(os(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ze(171))}if(t.tag===1){var i=t.type;if(os(i))return PB(t,i,e)}return e}function MD(t,e,i,n,r,a,u,l,_){return t=FA(i,n,!0,t,r,a,u,l,_),t.context=PD(null),i=t.current,n=Ur(),r=$l(i),a=Ba(n,r),a.callback=e??null,jl(i,a,r),t.current.lanes=r,em(t,r,n),as(t,n),t}function r0(t,e,i,n){var r=e.current,a=Ur(),u=$l(r);return i=PD(i),e.context===null?e.context=i:e.pendingContext=i,e=Ba(a,u),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=jl(r,e,u),t!==null&&(Ao(t,r,u,a),d_(t,r,u)),u}function py(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function QI(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var i=t.retryLane;t.retryLane=i!==0&&i<e?i:e}}function NA(t,e){QI(t,e),(t=t.alternate)&&QI(t,e)}function hJ(){return null}var BD=typeof reportError=="function"?reportError:function(t){console.error(t)};function LA(t){this._internalRoot=t}s0.prototype.render=LA.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ze(409));r0(t,e,null,null)};s0.prototype.unmount=LA.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ru(function(){r0(null,t,null,null)}),e[Fa]=null}};function s0(t){this._internalRoot=t}s0.prototype.unstable_scheduleHydration=function(t){if(t){var e=cB();t={blockedOn:null,target:t,priority:e};for(var i=0;i<Rl.length&&e!==0&&e<Rl[i].priority;i++);Rl.splice(i,0,t),i===0&&hB(t)}};function UA(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function o0(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function eR(){}function dJ(t,e,i,n,r){if(r){if(typeof n=="function"){var a=n;n=function(){var w=py(u);a.call(w)}}var u=MD(e,n,t,0,null,!1,!1,"",eR);return t._reactRootContainer=u,t[Fa]=u.current,Bp(t.nodeType===8?t.parentNode:t),ru(),u}for(;r=t.lastChild;)t.removeChild(r);if(typeof n=="function"){var l=n;n=function(){var w=py(_);l.call(w)}}var _=FA(t,0,!1,null,null,!1,!1,"",eR);return t._reactRootContainer=_,t[Fa]=_.current,Bp(t.nodeType===8?t.parentNode:t),ru(function(){r0(e,_,i,n)}),_}function a0(t,e,i,n,r){var a=i._reactRootContainer;if(a){var u=a;if(typeof r=="function"){var l=r;r=function(){var _=py(u);l.call(_)}}r0(e,u,t,r)}else u=dJ(i,e,t,r,n);return py(u)}aB=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var i=Xf(e.pendingLanes);i!==0&&(rA(e,i|1),as(e,pn()),!(oi&6)&&(ud=pn()+500,ic()))}break;case 13:ru(function(){var n=Na(t,1);if(n!==null){var r=Ur();Ao(n,t,1,r)}}),NA(t,1)}};sA=function(t){if(t.tag===13){var e=Na(t,134217728);if(e!==null){var i=Ur();Ao(e,t,134217728,i)}NA(t,134217728)}};lB=function(t){if(t.tag===13){var e=$l(t),i=Na(t,e);if(i!==null){var n=Ur();Ao(i,t,e,n)}NA(t,e)}};cB=function(){return wi};uB=function(t,e){var i=wi;try{return wi=t,e()}finally{wi=i}};lb=function(t,e,i){switch(e){case"input":if(tb(t,i),e=i.name,i.type==="radio"&&e!=null){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<i.length;e++){var n=i[e];if(n!==t&&n.form===t.form){var r=Yy(n);if(!r)throw Error(Ze(90));V3(n),tb(n,r)}}}break;case"textarea":H3(t,i);break;case"select":e=i.value,e!=null&&Vh(t,!!i.multiple,e,!1)}};Z3=BA;Y3=ru;var fJ={usingClientEntryPoint:!1,Events:[im,Ch,Yy,q3,K3,BA]},Lf={findFiberByHostInstance:jc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},pJ={bundleType:Lf.bundleType,version:Lf.version,rendererPackageName:Lf.rendererPackageName,rendererConfig:Lf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:za.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=eB(t),t===null?null:t.stateNode},findFiberByHostInstance:Lf.findFiberByHostInstance||hJ,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yg.isDisabled&&Yg.supportsFiber)try{Xy=Yg.inject(pJ),ta=Yg}catch{}}Ps.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fJ;Ps.createPortal=function(t,e){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!UA(e))throw Error(Ze(200));return uJ(t,e,null,i)};Ps.createRoot=function(t,e){if(!UA(t))throw Error(Ze(299));var i=!1,n="",r=BD;return e!=null&&(e.unstable_strictMode===!0&&(i=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=FA(t,1,!1,null,null,i,!1,n,r),t[Fa]=e.current,Bp(t.nodeType===8?t.parentNode:t),new LA(e)};Ps.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ze(188)):(t=Object.keys(t).join(","),Error(Ze(268,t)));return t=eB(e),t=t===null?null:t.stateNode,t};Ps.flushSync=function(t){return ru(t)};Ps.hydrate=function(t,e,i){if(!o0(e))throw Error(Ze(200));return a0(null,t,e,!0,i)};Ps.hydrateRoot=function(t,e,i){if(!UA(t))throw Error(Ze(405));var n=i!=null&&i.hydratedSources||null,r=!1,a="",u=BD;if(i!=null&&(i.unstable_strictMode===!0&&(r=!0),i.identifierPrefix!==void 0&&(a=i.identifierPrefix),i.onRecoverableError!==void 0&&(u=i.onRecoverableError)),e=MD(e,null,t,1,i??null,r,!1,a,u),t[Fa]=e.current,Bp(t),n)for(t=0;t<n.length;t++)i=n[t],r=i._getVersion,r=r(i._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[i,r]:e.mutableSourceEagerHydrationData.push(i,r);return new s0(e)};Ps.render=function(t,e,i){if(!o0(e))throw Error(Ze(200));return a0(null,t,e,!1,i)};Ps.unmountComponentAtNode=function(t){if(!o0(t))throw Error(Ze(40));return t._reactRootContainer?(ru(function(){a0(null,null,t,!1,function(){t._reactRootContainer=null,t[Fa]=null})}),!0):!1};Ps.unstable_batchedUpdates=BA;Ps.unstable_renderSubtreeIntoContainer=function(t,e,i,n){if(!o0(i))throw Error(Ze(200));if(t==null||t._reactInternals===void 0)throw Error(Ze(38));return a0(t,e,i,!1,n)};Ps.version="18.3.1-next-f1338f8080-20240426";function DD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(DD)}catch(t){console.error(t)}}DD(),D3.exports=Ps;var mJ=D3.exports,OD,tR=mJ;OD=tR.createRoot,tR.hydrateRoot;OD(document.getElementById("root")).render(e_.jsx(uZ,{}));
